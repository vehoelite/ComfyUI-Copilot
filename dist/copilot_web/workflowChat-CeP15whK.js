const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["copilot_web/message-components-vcAbzMOn.js","copilot_web/vendor-react-ByKzdfMq.js","copilot_web/vendor-markdown-B4Av9P7l.js","copilot_web/WorkflowOption-DGjMCBYt.js","copilot_web/input.js","copilot_web/assets/input-D1QFSb15.css","copilot_web/fonts.css","copilot_web/App-DFDyTOo4.js","copilot_web/DebugGuide-C033E6Gd.js","copilot_web/DebugResult-Dnw-e9dx.js"])))=>i.map(i=>d[i]);
import{j as r,r as wg,b as vg}from"./vendor-markdown-B4Av9P7l.js";import{r as x,c as Mr,e as Yl,R as Qi}from"./vendor-react-ByKzdfMq.js";import{b as kg,c as Sg,X as On,a as $e,g as Ql,f as Ig,d as Zl,v as Tl,W as ct,S as jg,H as Cg,M as Ng,T as ec,E as Lg,I as Tr,e as Ag,F as tc,h as ur,i as Pl,B as Dl,j as Eg,P as Mg,u as kn,R as Tg,k as Pg,l as Dg,m as Og,V as Fg,n as Rg,o as zg,p as it,q as nc,r as Ug,s as Bg,t as Gg,x as Wg,y as qg,z as Vg,A as $g,D as Hg,G as Kg}from"./message-components-vcAbzMOn.js";import{_ as hn}from"./input.js";import{C as fr}from"./App-DFDyTOo4.js";const Ol=o=>{const{isPassword:l=!1,value:s="",setValue:c=()=>{},setIsValueValid:d,placeholder:f="",className:m=""}=o,[g,_]=x.useState(!l),S=v=>{c(v.target.value),d?.(v.target.value)};return r.jsxs("div",{className:`relative ${m}`,children:[r.jsx("input",{type:g?"text":"password",value:s,onChange:S,placeholder:f,className:`w-full px-4 py-3 border border-gray-200 dark:border-gray-600 rounded-lg\r
          bg-gray-50 dark:bg-gray-700 \r
          text-gray-900 dark:text-white\r
          placeholder-gray-500 dark:placeholder-gray-400\r
          focus:border-blue-500 dark:focus:border-blue-400 \r
          focus:ring-2 focus:ring-blue-500/20 dark:focus:ring-blue-400/20\r
          focus:outline-none`}),l&&r.jsx("button",{type:"button",className:`absolute inset-y-0 right-4 flex items-center text-gray-500 dark:text-gray-400 \r
          hover:text-gray-700 dark:hover:text-gray-200 transition-colors bg-transparent border-none`,onClick:()=>_(!g),children:g?r.jsxs("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]}):r.jsx("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"})})})]})},Zi=o=>{const{title:l="",className:s="",children:c}=o,[d,f]=x.useState(!1);return r.jsxs("div",{className:`border border-gray-200 dark:border-gray-600 rounded-lg p-4 ${s}`,children:[r.jsxs("div",{className:"flex justify-between items-center mb-4",children:[r.jsx("div",{children:typeof l=="string"?r.jsx("h3",{className:"text-sm text-gray-900 dark:text-white font-medium mb-4",children:l}):l}),r.jsx("button",{onClick:()=>f(!d),children:d?r.jsx(kg,{}):r.jsx(Sg,{})})]}),r.jsx("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-4",children:d&&c})]})},so=({open:o,onClose:l,children:s,className:c="",overlayClassName:d="",autoClose:f=!0})=>(x.useEffect(()=>{let m;return o&&f&&(m=setTimeout(()=>{l()},3e3)),()=>clearTimeout(m)},[o,f]),o?r.jsx("div",{className:`fixed inset-0 z-50 flex items-center justify-center bg-black/40 ${d}`,onClick:l,children:r.jsxs("div",{className:`relative bg-white rounded-lg shadow-lg p-6 min-w-[300px] max-w-full ${c}`,onClick:m=>m.stopPropagation(),children:[r.jsx("button",{className:"absolute top-2 right-4 bg-transparent border-none text-gray-400 hover:text-gray-600",onClick:l,"aria-label":"Close",children:r.jsx(On,{size:16})}),s]})}):null);var As={exports:{}};/**
 * @license
 * Lodash <https://lodash.com/>
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */As.exports;(function(o,l){(function(){var s,c="4.17.21",d=200,f="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",m="Expected a function",g="Invalid `variable` option passed into `_.template`",_="__lodash_hash_undefined__",S=500,v="__lodash_placeholder__",j=1,I=2,N=4,L=1,W=2,z=1,U=2,se=4,Z=8,H=16,R=32,B=64,V=128,X=256,y=512,ee=30,oe="...",F=800,pe=16,ge=1,ae=2,de=3,le=1/0,G=9007199254740991,ze=17976931348623157e292,ue=NaN,ie=4294967295,ke=ie-1,J=ie>>>1,ye=[["ary",V],["bind",z],["bindKey",U],["curry",Z],["curryRight",H],["flip",y],["partial",R],["partialRight",B],["rearg",X]],T="[object Arguments]",te="[object Array]",Q="[object AsyncFunction]",Se="[object Boolean]",Fe="[object Date]",De="[object DOMException]",Ee="[object Error]",Re="[object Function]",St="[object GeneratorFunction]",Qe="[object Map]",xt="[object Number]",It="[object Null]",Ze="[object Object]",Dt="[object Promise]",qe="[object Proxy]",bt="[object RegExp]",Ue="[object Set]",dt="[object String]",Ot="[object Symbol]",qt="[object Undefined]",jt="[object WeakMap]",ft="[object WeakSet]",Vt="[object ArrayBuffer]",$t="[object DataView]",ln="[object Float32Array]",tn="[object Float64Array]",$="[object Int8Array]",xe="[object Int16Array]",et="[object Int32Array]",ot="[object Uint8Array]",ut="[object Uint8ClampedArray]",gt="[object Uint16Array]",Ft="[object Uint32Array]",q=/\b__p \+= '';/g,re=/\b(__p \+=) '' \+/g,Ie=/(__e\(.*?\)|\b__t\)) \+\n'';/g,ce=/&(?:amp|lt|gt|quot|#39);/g,Ne=/[&<>"']/g,Je=RegExp(ce.source),be=RegExp(Ne.source),Me=/<%-([\s\S]+?)%>/g,tt=/<%([\s\S]+?)%>/g,wt=/<%=([\s\S]+?)%>/g,nn=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Ds=/^\w*$/,nt=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,mr=/[\\^$.*+?()[\]{}|]/g,Fr=RegExp(mr.source),Fn=/^\s+/,Os=/\s/,Fs=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,Sn=/\{\n\/\* \[wrapped with (.+)\] \*/,Rs=/,? & /,zs=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,Us=/[()=,{}\[\]\/\s]/,Rr=/\\(\\)?/g,gr=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,pr=/\w*$/,zr=/^[-+]0x[0-9a-f]+$/i,Ur=/^0b[01]+$/i,Rn=/^\[object .+?Constructor\]$/,Bs=/^0o[0-7]+$/i,In=/^(?:0|[1-9]\d*)$/,Jn=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,P=/($^)/,D=/['\n\r\u2028\u2029\\]/g,_e="\\ud800-\\udfff",rt="\\u0300-\\u036f",At="\\ufe20-\\ufe2f",Xn="\\u20d0-\\u20ff",ao=rt+At+Xn,lo="\\u2700-\\u27bf",co="a-z\\xdf-\\xf6\\xf8-\\xff",pc="\\xac\\xb1\\xd7\\xf7",xc="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",bc="\\u2000-\\u206f",yc=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",uo="A-Z\\xc0-\\xd6\\xd8-\\xde",fo="\\ufe0e\\ufe0f",ho=pc+xc+bc+yc,Gs="['’]",_c="["+_e+"]",mo="["+ho+"]",Br="["+ao+"]",go="\\d+",wc="["+lo+"]",po="["+co+"]",xo="[^"+_e+ho+go+lo+co+uo+"]",Ws="\\ud83c[\\udffb-\\udfff]",vc="(?:"+Br+"|"+Ws+")",bo="[^"+_e+"]",qs="(?:\\ud83c[\\udde6-\\uddff]){2}",Vs="[\\ud800-\\udbff][\\udc00-\\udfff]",Yn="["+uo+"]",yo="\\u200d",_o="(?:"+po+"|"+xo+")",kc="(?:"+Yn+"|"+xo+")",wo="(?:"+Gs+"(?:d|ll|m|re|s|t|ve))?",vo="(?:"+Gs+"(?:D|LL|M|RE|S|T|VE))?",ko=vc+"?",So="["+fo+"]?",Sc="(?:"+yo+"(?:"+[bo,qs,Vs].join("|")+")"+So+ko+")*",Ic="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",jc="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",Io=So+ko+Sc,Cc="(?:"+[wc,qs,Vs].join("|")+")"+Io,Nc="(?:"+[bo+Br+"?",Br,qs,Vs,_c].join("|")+")",Lc=RegExp(Gs,"g"),Ac=RegExp(Br,"g"),$s=RegExp(Ws+"(?="+Ws+")|"+Nc+Io,"g"),Ec=RegExp([Yn+"?"+po+"+"+wo+"(?="+[mo,Yn,"$"].join("|")+")",kc+"+"+vo+"(?="+[mo,Yn+_o,"$"].join("|")+")",Yn+"?"+_o+"+"+wo,Yn+"+"+vo,jc,Ic,go,Cc].join("|"),"g"),Mc=RegExp("["+yo+_e+ao+fo+"]"),Tc=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,Pc=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],Dc=-1,Ke={};Ke[ln]=Ke[tn]=Ke[$]=Ke[xe]=Ke[et]=Ke[ot]=Ke[ut]=Ke[gt]=Ke[Ft]=!0,Ke[T]=Ke[te]=Ke[Vt]=Ke[Se]=Ke[$t]=Ke[Fe]=Ke[Ee]=Ke[Re]=Ke[Qe]=Ke[xt]=Ke[Ze]=Ke[bt]=Ke[Ue]=Ke[dt]=Ke[jt]=!1;var He={};He[T]=He[te]=He[Vt]=He[$t]=He[Se]=He[Fe]=He[ln]=He[tn]=He[$]=He[xe]=He[et]=He[Qe]=He[xt]=He[Ze]=He[bt]=He[Ue]=He[dt]=He[Ot]=He[ot]=He[ut]=He[gt]=He[Ft]=!0,He[Ee]=He[Re]=He[jt]=!1;var Oc={À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",Ç:"C",ç:"c",Ð:"D",ð:"d",È:"E",É:"E",Ê:"E",Ë:"E",è:"e",é:"e",ê:"e",ë:"e",Ì:"I",Í:"I",Î:"I",Ï:"I",ì:"i",í:"i",î:"i",ï:"i",Ñ:"N",ñ:"n",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",Ù:"U",Ú:"U",Û:"U",Ü:"U",ù:"u",ú:"u",û:"u",ü:"u",Ý:"Y",ý:"y",ÿ:"y",Æ:"Ae",æ:"ae",Þ:"Th",þ:"th",ß:"ss",Ā:"A",Ă:"A",Ą:"A",ā:"a",ă:"a",ą:"a",Ć:"C",Ĉ:"C",Ċ:"C",Č:"C",ć:"c",ĉ:"c",ċ:"c",č:"c",Ď:"D",Đ:"D",ď:"d",đ:"d",Ē:"E",Ĕ:"E",Ė:"E",Ę:"E",Ě:"E",ē:"e",ĕ:"e",ė:"e",ę:"e",ě:"e",Ĝ:"G",Ğ:"G",Ġ:"G",Ģ:"G",ĝ:"g",ğ:"g",ġ:"g",ģ:"g",Ĥ:"H",Ħ:"H",ĥ:"h",ħ:"h",Ĩ:"I",Ī:"I",Ĭ:"I",Į:"I",İ:"I",ĩ:"i",ī:"i",ĭ:"i",į:"i",ı:"i",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",ĸ:"k",Ĺ:"L",Ļ:"L",Ľ:"L",Ŀ:"L",Ł:"L",ĺ:"l",ļ:"l",ľ:"l",ŀ:"l",ł:"l",Ń:"N",Ņ:"N",Ň:"N",Ŋ:"N",ń:"n",ņ:"n",ň:"n",ŋ:"n",Ō:"O",Ŏ:"O",Ő:"O",ō:"o",ŏ:"o",ő:"o",Ŕ:"R",Ŗ:"R",Ř:"R",ŕ:"r",ŗ:"r",ř:"r",Ś:"S",Ŝ:"S",Ş:"S",Š:"S",ś:"s",ŝ:"s",ş:"s",š:"s",Ţ:"T",Ť:"T",Ŧ:"T",ţ:"t",ť:"t",ŧ:"t",Ũ:"U",Ū:"U",Ŭ:"U",Ů:"U",Ű:"U",Ų:"U",ũ:"u",ū:"u",ŭ:"u",ů:"u",ű:"u",ų:"u",Ŵ:"W",ŵ:"w",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Ź:"Z",Ż:"Z",Ž:"Z",ź:"z",ż:"z",ž:"z",Ĳ:"IJ",ĳ:"ij",Œ:"Oe",œ:"oe",ŉ:"'n",ſ:"s"},Fc={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},Rc={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},zc={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Uc=parseFloat,Bc=parseInt,jo=typeof Mr=="object"&&Mr&&Mr.Object===Object&&Mr,Gc=typeof self=="object"&&self&&self.Object===Object&&self,yt=jo||Gc||Function("return this")(),Hs=l&&!l.nodeType&&l,zn=Hs&&!0&&o&&!o.nodeType&&o,Co=zn&&zn.exports===Hs,Ks=Co&&jo.process,Ht=function(){try{var w=zn&&zn.require&&zn.require("util").types;return w||Ks&&Ks.binding&&Ks.binding("util")}catch{}}(),No=Ht&&Ht.isArrayBuffer,Lo=Ht&&Ht.isDate,Ao=Ht&&Ht.isMap,Eo=Ht&&Ht.isRegExp,Mo=Ht&&Ht.isSet,To=Ht&&Ht.isTypedArray;function Rt(w,A,C){switch(C.length){case 0:return w.call(A);case 1:return w.call(A,C[0]);case 2:return w.call(A,C[0],C[1]);case 3:return w.call(A,C[0],C[1],C[2])}return w.apply(A,C)}function Wc(w,A,C,Y){for(var we=-1,Be=w==null?0:w.length;++we<Be;){var ht=w[we];A(Y,ht,C(ht),w)}return Y}function Kt(w,A){for(var C=-1,Y=w==null?0:w.length;++C<Y&&A(w[C],C,w)!==!1;);return w}function qc(w,A){for(var C=w==null?0:w.length;C--&&A(w[C],C,w)!==!1;);return w}function Po(w,A){for(var C=-1,Y=w==null?0:w.length;++C<Y;)if(!A(w[C],C,w))return!1;return!0}function jn(w,A){for(var C=-1,Y=w==null?0:w.length,we=0,Be=[];++C<Y;){var ht=w[C];A(ht,C,w)&&(Be[we++]=ht)}return Be}function Gr(w,A){var C=w==null?0:w.length;return!!C&&Qn(w,A,0)>-1}function Js(w,A,C){for(var Y=-1,we=w==null?0:w.length;++Y<we;)if(C(A,w[Y]))return!0;return!1}function Xe(w,A){for(var C=-1,Y=w==null?0:w.length,we=Array(Y);++C<Y;)we[C]=A(w[C],C,w);return we}function Cn(w,A){for(var C=-1,Y=A.length,we=w.length;++C<Y;)w[we+C]=A[C];return w}function Xs(w,A,C,Y){var we=-1,Be=w==null?0:w.length;for(Y&&Be&&(C=w[++we]);++we<Be;)C=A(C,w[we],we,w);return C}function Vc(w,A,C,Y){var we=w==null?0:w.length;for(Y&&we&&(C=w[--we]);we--;)C=A(C,w[we],we,w);return C}function Ys(w,A){for(var C=-1,Y=w==null?0:w.length;++C<Y;)if(A(w[C],C,w))return!0;return!1}var $c=Qs("length");function Hc(w){return w.split("")}function Kc(w){return w.match(zs)||[]}function Do(w,A,C){var Y;return C(w,function(we,Be,ht){if(A(we,Be,ht))return Y=Be,!1}),Y}function Wr(w,A,C,Y){for(var we=w.length,Be=C+(Y?1:-1);Y?Be--:++Be<we;)if(A(w[Be],Be,w))return Be;return-1}function Qn(w,A,C){return A===A?od(w,A,C):Wr(w,Oo,C)}function Jc(w,A,C,Y){for(var we=C-1,Be=w.length;++we<Be;)if(Y(w[we],A))return we;return-1}function Oo(w){return w!==w}function Fo(w,A){var C=w==null?0:w.length;return C?ei(w,A)/C:ue}function Qs(w){return function(A){return A==null?s:A[w]}}function Zs(w){return function(A){return w==null?s:w[A]}}function Ro(w,A,C,Y,we){return we(w,function(Be,ht,Ve){C=Y?(Y=!1,Be):A(C,Be,ht,Ve)}),C}function Xc(w,A){var C=w.length;for(w.sort(A);C--;)w[C]=w[C].value;return w}function ei(w,A){for(var C,Y=-1,we=w.length;++Y<we;){var Be=A(w[Y]);Be!==s&&(C=C===s?Be:C+Be)}return C}function ti(w,A){for(var C=-1,Y=Array(w);++C<w;)Y[C]=A(C);return Y}function Yc(w,A){return Xe(A,function(C){return[C,w[C]]})}function zo(w){return w&&w.slice(0,Wo(w)+1).replace(Fn,"")}function zt(w){return function(A){return w(A)}}function ni(w,A){return Xe(A,function(C){return w[C]})}function xr(w,A){return w.has(A)}function Uo(w,A){for(var C=-1,Y=w.length;++C<Y&&Qn(A,w[C],0)>-1;);return C}function Bo(w,A){for(var C=w.length;C--&&Qn(A,w[C],0)>-1;);return C}function Qc(w,A){for(var C=w.length,Y=0;C--;)w[C]===A&&++Y;return Y}var Zc=Zs(Oc),ed=Zs(Fc);function td(w){return"\\"+zc[w]}function nd(w,A){return w==null?s:w[A]}function Zn(w){return Mc.test(w)}function rd(w){return Tc.test(w)}function sd(w){for(var A,C=[];!(A=w.next()).done;)C.push(A.value);return C}function ri(w){var A=-1,C=Array(w.size);return w.forEach(function(Y,we){C[++A]=[we,Y]}),C}function Go(w,A){return function(C){return w(A(C))}}function Nn(w,A){for(var C=-1,Y=w.length,we=0,Be=[];++C<Y;){var ht=w[C];(ht===A||ht===v)&&(w[C]=v,Be[we++]=C)}return Be}function qr(w){var A=-1,C=Array(w.size);return w.forEach(function(Y){C[++A]=Y}),C}function id(w){var A=-1,C=Array(w.size);return w.forEach(function(Y){C[++A]=[Y,Y]}),C}function od(w,A,C){for(var Y=C-1,we=w.length;++Y<we;)if(w[Y]===A)return Y;return-1}function ad(w,A,C){for(var Y=C+1;Y--;)if(w[Y]===A)return Y;return Y}function er(w){return Zn(w)?cd(w):$c(w)}function rn(w){return Zn(w)?dd(w):Hc(w)}function Wo(w){for(var A=w.length;A--&&Os.test(w.charAt(A)););return A}var ld=Zs(Rc);function cd(w){for(var A=$s.lastIndex=0;$s.test(w);)++A;return A}function dd(w){return w.match($s)||[]}function ud(w){return w.match(Ec)||[]}var fd=function w(A){A=A==null?yt:tr.defaults(yt.Object(),A,tr.pick(yt,Pc));var C=A.Array,Y=A.Date,we=A.Error,Be=A.Function,ht=A.Math,Ve=A.Object,si=A.RegExp,hd=A.String,Jt=A.TypeError,Vr=C.prototype,md=Be.prototype,nr=Ve.prototype,$r=A["__core-js_shared__"],Hr=md.toString,We=nr.hasOwnProperty,gd=0,qo=function(){var e=/[^.]+$/.exec($r&&$r.keys&&$r.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),Kr=nr.toString,pd=Hr.call(Ve),xd=yt._,bd=si("^"+Hr.call(We).replace(mr,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Jr=Co?A.Buffer:s,Ln=A.Symbol,Xr=A.Uint8Array,Vo=Jr?Jr.allocUnsafe:s,Yr=Go(Ve.getPrototypeOf,Ve),$o=Ve.create,Ho=nr.propertyIsEnumerable,Qr=Vr.splice,Ko=Ln?Ln.isConcatSpreadable:s,br=Ln?Ln.iterator:s,Un=Ln?Ln.toStringTag:s,Zr=function(){try{var e=Vn(Ve,"defineProperty");return e({},"",{}),e}catch{}}(),yd=A.clearTimeout!==yt.clearTimeout&&A.clearTimeout,_d=Y&&Y.now!==yt.Date.now&&Y.now,wd=A.setTimeout!==yt.setTimeout&&A.setTimeout,es=ht.ceil,ts=ht.floor,ii=Ve.getOwnPropertySymbols,vd=Jr?Jr.isBuffer:s,Jo=A.isFinite,kd=Vr.join,Sd=Go(Ve.keys,Ve),mt=ht.max,vt=ht.min,Id=Y.now,jd=A.parseInt,Xo=ht.random,Cd=Vr.reverse,oi=Vn(A,"DataView"),yr=Vn(A,"Map"),ai=Vn(A,"Promise"),rr=Vn(A,"Set"),_r=Vn(A,"WeakMap"),wr=Vn(Ve,"create"),ns=_r&&new _r,sr={},Nd=$n(oi),Ld=$n(yr),Ad=$n(ai),Ed=$n(rr),Md=$n(_r),rs=Ln?Ln.prototype:s,vr=rs?rs.valueOf:s,Yo=rs?rs.toString:s;function u(e){if(st(e)&&!ve(e)&&!(e instanceof Pe)){if(e instanceof Xt)return e;if(We.call(e,"__wrapped__"))return Qa(e)}return new Xt(e)}var ir=function(){function e(){}return function(t){if(!Ye(t))return{};if($o)return $o(t);e.prototype=t;var n=new e;return e.prototype=s,n}}();function ss(){}function Xt(e,t){this.__wrapped__=e,this.__actions__=[],this.__chain__=!!t,this.__index__=0,this.__values__=s}u.templateSettings={escape:Me,evaluate:tt,interpolate:wt,variable:"",imports:{_:u}},u.prototype=ss.prototype,u.prototype.constructor=u,Xt.prototype=ir(ss.prototype),Xt.prototype.constructor=Xt;function Pe(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=ie,this.__views__=[]}function Td(){var e=new Pe(this.__wrapped__);return e.__actions__=Et(this.__actions__),e.__dir__=this.__dir__,e.__filtered__=this.__filtered__,e.__iteratees__=Et(this.__iteratees__),e.__takeCount__=this.__takeCount__,e.__views__=Et(this.__views__),e}function Pd(){if(this.__filtered__){var e=new Pe(this);e.__dir__=-1,e.__filtered__=!0}else e=this.clone(),e.__dir__*=-1;return e}function Dd(){var e=this.__wrapped__.value(),t=this.__dir__,n=ve(e),i=t<0,a=n?e.length:0,h=Hu(0,a,this.__views__),p=h.start,b=h.end,k=b-p,E=i?b:p-1,M=this.__iteratees__,O=M.length,K=0,ne=vt(k,this.__takeCount__);if(!n||!i&&a==k&&ne==k)return wa(e,this.__actions__);var he=[];e:for(;k--&&K<ne;){E+=t;for(var Ce=-1,me=e[E];++Ce<O;){var Te=M[Ce],Oe=Te.iteratee,Gt=Te.type,Lt=Oe(me);if(Gt==ae)me=Lt;else if(!Lt){if(Gt==ge)continue e;break e}}he[K++]=me}return he}Pe.prototype=ir(ss.prototype),Pe.prototype.constructor=Pe;function Bn(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var i=e[t];this.set(i[0],i[1])}}function Od(){this.__data__=wr?wr(null):{},this.size=0}function Fd(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}function Rd(e){var t=this.__data__;if(wr){var n=t[e];return n===_?s:n}return We.call(t,e)?t[e]:s}function zd(e){var t=this.__data__;return wr?t[e]!==s:We.call(t,e)}function Ud(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=wr&&t===s?_:t,this}Bn.prototype.clear=Od,Bn.prototype.delete=Fd,Bn.prototype.get=Rd,Bn.prototype.has=zd,Bn.prototype.set=Ud;function mn(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var i=e[t];this.set(i[0],i[1])}}function Bd(){this.__data__=[],this.size=0}function Gd(e){var t=this.__data__,n=is(t,e);if(n<0)return!1;var i=t.length-1;return n==i?t.pop():Qr.call(t,n,1),--this.size,!0}function Wd(e){var t=this.__data__,n=is(t,e);return n<0?s:t[n][1]}function qd(e){return is(this.__data__,e)>-1}function Vd(e,t){var n=this.__data__,i=is(n,e);return i<0?(++this.size,n.push([e,t])):n[i][1]=t,this}mn.prototype.clear=Bd,mn.prototype.delete=Gd,mn.prototype.get=Wd,mn.prototype.has=qd,mn.prototype.set=Vd;function gn(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var i=e[t];this.set(i[0],i[1])}}function $d(){this.size=0,this.__data__={hash:new Bn,map:new(yr||mn),string:new Bn}}function Hd(e){var t=xs(this,e).delete(e);return this.size-=t?1:0,t}function Kd(e){return xs(this,e).get(e)}function Jd(e){return xs(this,e).has(e)}function Xd(e,t){var n=xs(this,e),i=n.size;return n.set(e,t),this.size+=n.size==i?0:1,this}gn.prototype.clear=$d,gn.prototype.delete=Hd,gn.prototype.get=Kd,gn.prototype.has=Jd,gn.prototype.set=Xd;function Gn(e){var t=-1,n=e==null?0:e.length;for(this.__data__=new gn;++t<n;)this.add(e[t])}function Yd(e){return this.__data__.set(e,_),this}function Qd(e){return this.__data__.has(e)}Gn.prototype.add=Gn.prototype.push=Yd,Gn.prototype.has=Qd;function sn(e){var t=this.__data__=new mn(e);this.size=t.size}function Zd(){this.__data__=new mn,this.size=0}function eu(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n}function tu(e){return this.__data__.get(e)}function nu(e){return this.__data__.has(e)}function ru(e,t){var n=this.__data__;if(n instanceof mn){var i=n.__data__;if(!yr||i.length<d-1)return i.push([e,t]),this.size=++n.size,this;n=this.__data__=new gn(i)}return n.set(e,t),this.size=n.size,this}sn.prototype.clear=Zd,sn.prototype.delete=eu,sn.prototype.get=tu,sn.prototype.has=nu,sn.prototype.set=ru;function Qo(e,t){var n=ve(e),i=!n&&Hn(e),a=!n&&!i&&Pn(e),h=!n&&!i&&!a&&cr(e),p=n||i||a||h,b=p?ti(e.length,hd):[],k=b.length;for(var E in e)(t||We.call(e,E))&&!(p&&(E=="length"||a&&(E=="offset"||E=="parent")||h&&(E=="buffer"||E=="byteLength"||E=="byteOffset")||yn(E,k)))&&b.push(E);return b}function Zo(e){var t=e.length;return t?e[bi(0,t-1)]:s}function su(e,t){return bs(Et(e),Wn(t,0,e.length))}function iu(e){return bs(Et(e))}function li(e,t,n){(n!==s&&!on(e[t],n)||n===s&&!(t in e))&&pn(e,t,n)}function kr(e,t,n){var i=e[t];(!(We.call(e,t)&&on(i,n))||n===s&&!(t in e))&&pn(e,t,n)}function is(e,t){for(var n=e.length;n--;)if(on(e[n][0],t))return n;return-1}function ou(e,t,n,i){return An(e,function(a,h,p){t(i,a,n(a),p)}),i}function ea(e,t){return e&&dn(t,pt(t),e)}function au(e,t){return e&&dn(t,Tt(t),e)}function pn(e,t,n){t=="__proto__"&&Zr?Zr(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n}function ci(e,t){for(var n=-1,i=t.length,a=C(i),h=e==null;++n<i;)a[n]=h?s:Wi(e,t[n]);return a}function Wn(e,t,n){return e===e&&(n!==s&&(e=e<=n?e:n),t!==s&&(e=e>=t?e:t)),e}function Yt(e,t,n,i,a,h){var p,b=t&j,k=t&I,E=t&N;if(n&&(p=a?n(e,i,a,h):n(e)),p!==s)return p;if(!Ye(e))return e;var M=ve(e);if(M){if(p=Ju(e),!b)return Et(e,p)}else{var O=kt(e),K=O==Re||O==St;if(Pn(e))return Sa(e,b);if(O==Ze||O==T||K&&!a){if(p=k||K?{}:Wa(e),!b)return k?Ru(e,au(p,e)):Fu(e,ea(p,e))}else{if(!He[O])return a?e:{};p=Xu(e,O,b)}}h||(h=new sn);var ne=h.get(e);if(ne)return ne;h.set(e,p),bl(e)?e.forEach(function(me){p.add(Yt(me,t,n,me,e,h))}):pl(e)&&e.forEach(function(me,Te){p.set(Te,Yt(me,t,n,Te,e,h))});var he=E?k?Li:Ni:k?Tt:pt,Ce=M?s:he(e);return Kt(Ce||e,function(me,Te){Ce&&(Te=me,me=e[Te]),kr(p,Te,Yt(me,t,n,Te,e,h))}),p}function lu(e){var t=pt(e);return function(n){return ta(n,e,t)}}function ta(e,t,n){var i=n.length;if(e==null)return!i;for(e=Ve(e);i--;){var a=n[i],h=t[a],p=e[a];if(p===s&&!(a in e)||!h(p))return!1}return!0}function na(e,t,n){if(typeof e!="function")throw new Jt(m);return Ar(function(){e.apply(s,n)},t)}function Sr(e,t,n,i){var a=-1,h=Gr,p=!0,b=e.length,k=[],E=t.length;if(!b)return k;n&&(t=Xe(t,zt(n))),i?(h=Js,p=!1):t.length>=d&&(h=xr,p=!1,t=new Gn(t));e:for(;++a<b;){var M=e[a],O=n==null?M:n(M);if(M=i||M!==0?M:0,p&&O===O){for(var K=E;K--;)if(t[K]===O)continue e;k.push(M)}else h(t,O,i)||k.push(M)}return k}var An=La(cn),ra=La(ui,!0);function cu(e,t){var n=!0;return An(e,function(i,a,h){return n=!!t(i,a,h),n}),n}function os(e,t,n){for(var i=-1,a=e.length;++i<a;){var h=e[i],p=t(h);if(p!=null&&(b===s?p===p&&!Bt(p):n(p,b)))var b=p,k=h}return k}function du(e,t,n,i){var a=e.length;for(n=je(n),n<0&&(n=-n>a?0:a+n),i=i===s||i>a?a:je(i),i<0&&(i+=a),i=n>i?0:_l(i);n<i;)e[n++]=t;return e}function sa(e,t){var n=[];return An(e,function(i,a,h){t(i,a,h)&&n.push(i)}),n}function _t(e,t,n,i,a){var h=-1,p=e.length;for(n||(n=Qu),a||(a=[]);++h<p;){var b=e[h];t>0&&n(b)?t>1?_t(b,t-1,n,i,a):Cn(a,b):i||(a[a.length]=b)}return a}var di=Aa(),ia=Aa(!0);function cn(e,t){return e&&di(e,t,pt)}function ui(e,t){return e&&ia(e,t,pt)}function as(e,t){return jn(t,function(n){return _n(e[n])})}function qn(e,t){t=Mn(t,e);for(var n=0,i=t.length;e!=null&&n<i;)e=e[un(t[n++])];return n&&n==i?e:s}function oa(e,t,n){var i=t(e);return ve(e)?i:Cn(i,n(e))}function Ct(e){return e==null?e===s?qt:It:Un&&Un in Ve(e)?$u(e):i0(e)}function fi(e,t){return e>t}function uu(e,t){return e!=null&&We.call(e,t)}function fu(e,t){return e!=null&&t in Ve(e)}function hu(e,t,n){return e>=vt(t,n)&&e<mt(t,n)}function hi(e,t,n){for(var i=n?Js:Gr,a=e[0].length,h=e.length,p=h,b=C(h),k=1/0,E=[];p--;){var M=e[p];p&&t&&(M=Xe(M,zt(t))),k=vt(M.length,k),b[p]=!n&&(t||a>=120&&M.length>=120)?new Gn(p&&M):s}M=e[0];var O=-1,K=b[0];e:for(;++O<a&&E.length<k;){var ne=M[O],he=t?t(ne):ne;if(ne=n||ne!==0?ne:0,!(K?xr(K,he):i(E,he,n))){for(p=h;--p;){var Ce=b[p];if(!(Ce?xr(Ce,he):i(e[p],he,n)))continue e}K&&K.push(he),E.push(ne)}}return E}function mu(e,t,n,i){return cn(e,function(a,h,p){t(i,n(a),h,p)}),i}function Ir(e,t,n){t=Mn(t,e),e=Ha(e,t);var i=e==null?e:e[un(Zt(t))];return i==null?s:Rt(i,e,n)}function aa(e){return st(e)&&Ct(e)==T}function gu(e){return st(e)&&Ct(e)==Vt}function pu(e){return st(e)&&Ct(e)==Fe}function jr(e,t,n,i,a){return e===t?!0:e==null||t==null||!st(e)&&!st(t)?e!==e&&t!==t:xu(e,t,n,i,jr,a)}function xu(e,t,n,i,a,h){var p=ve(e),b=ve(t),k=p?te:kt(e),E=b?te:kt(t);k=k==T?Ze:k,E=E==T?Ze:E;var M=k==Ze,O=E==Ze,K=k==E;if(K&&Pn(e)){if(!Pn(t))return!1;p=!0,M=!1}if(K&&!M)return h||(h=new sn),p||cr(e)?Ua(e,t,n,i,a,h):qu(e,t,k,n,i,a,h);if(!(n&L)){var ne=M&&We.call(e,"__wrapped__"),he=O&&We.call(t,"__wrapped__");if(ne||he){var Ce=ne?e.value():e,me=he?t.value():t;return h||(h=new sn),a(Ce,me,n,i,h)}}return K?(h||(h=new sn),Vu(e,t,n,i,a,h)):!1}function bu(e){return st(e)&&kt(e)==Qe}function mi(e,t,n,i){var a=n.length,h=a,p=!i;if(e==null)return!h;for(e=Ve(e);a--;){var b=n[a];if(p&&b[2]?b[1]!==e[b[0]]:!(b[0]in e))return!1}for(;++a<h;){b=n[a];var k=b[0],E=e[k],M=b[1];if(p&&b[2]){if(E===s&&!(k in e))return!1}else{var O=new sn;if(i)var K=i(E,M,k,e,t,O);if(!(K===s?jr(M,E,L|W,i,O):K))return!1}}return!0}function la(e){if(!Ye(e)||e0(e))return!1;var t=_n(e)?bd:Rn;return t.test($n(e))}function yu(e){return st(e)&&Ct(e)==bt}function _u(e){return st(e)&&kt(e)==Ue}function wu(e){return st(e)&&Ss(e.length)&&!!Ke[Ct(e)]}function ca(e){return typeof e=="function"?e:e==null?Pt:typeof e=="object"?ve(e)?fa(e[0],e[1]):ua(e):El(e)}function gi(e){if(!Lr(e))return Sd(e);var t=[];for(var n in Ve(e))We.call(e,n)&&n!="constructor"&&t.push(n);return t}function vu(e){if(!Ye(e))return s0(e);var t=Lr(e),n=[];for(var i in e)i=="constructor"&&(t||!We.call(e,i))||n.push(i);return n}function pi(e,t){return e<t}function da(e,t){var n=-1,i=Mt(e)?C(e.length):[];return An(e,function(a,h,p){i[++n]=t(a,h,p)}),i}function ua(e){var t=Ei(e);return t.length==1&&t[0][2]?Va(t[0][0],t[0][1]):function(n){return n===e||mi(n,e,t)}}function fa(e,t){return Ti(e)&&qa(t)?Va(un(e),t):function(n){var i=Wi(n,e);return i===s&&i===t?qi(n,e):jr(t,i,L|W)}}function ls(e,t,n,i,a){e!==t&&di(t,function(h,p){if(a||(a=new sn),Ye(h))ku(e,t,p,n,ls,i,a);else{var b=i?i(Di(e,p),h,p+"",e,t,a):s;b===s&&(b=h),li(e,p,b)}},Tt)}function ku(e,t,n,i,a,h,p){var b=Di(e,n),k=Di(t,n),E=p.get(k);if(E){li(e,n,E);return}var M=h?h(b,k,n+"",e,t,p):s,O=M===s;if(O){var K=ve(k),ne=!K&&Pn(k),he=!K&&!ne&&cr(k);M=k,K||ne||he?ve(b)?M=b:at(b)?M=Et(b):ne?(O=!1,M=Sa(k,!0)):he?(O=!1,M=Ia(k,!0)):M=[]:Er(k)||Hn(k)?(M=b,Hn(b)?M=wl(b):(!Ye(b)||_n(b))&&(M=Wa(k))):O=!1}O&&(p.set(k,M),a(M,k,i,h,p),p.delete(k)),li(e,n,M)}function ha(e,t){var n=e.length;if(n)return t+=t<0?n:0,yn(t,n)?e[t]:s}function ma(e,t,n){t.length?t=Xe(t,function(h){return ve(h)?function(p){return qn(p,h.length===1?h[0]:h)}:h}):t=[Pt];var i=-1;t=Xe(t,zt(fe()));var a=da(e,function(h,p,b){var k=Xe(t,function(E){return E(h)});return{criteria:k,index:++i,value:h}});return Xc(a,function(h,p){return Ou(h,p,n)})}function Su(e,t){return ga(e,t,function(n,i){return qi(e,i)})}function ga(e,t,n){for(var i=-1,a=t.length,h={};++i<a;){var p=t[i],b=qn(e,p);n(b,p)&&Cr(h,Mn(p,e),b)}return h}function Iu(e){return function(t){return qn(t,e)}}function xi(e,t,n,i){var a=i?Jc:Qn,h=-1,p=t.length,b=e;for(e===t&&(t=Et(t)),n&&(b=Xe(e,zt(n)));++h<p;)for(var k=0,E=t[h],M=n?n(E):E;(k=a(b,M,k,i))>-1;)b!==e&&Qr.call(b,k,1),Qr.call(e,k,1);return e}function pa(e,t){for(var n=e?t.length:0,i=n-1;n--;){var a=t[n];if(n==i||a!==h){var h=a;yn(a)?Qr.call(e,a,1):wi(e,a)}}return e}function bi(e,t){return e+ts(Xo()*(t-e+1))}function ju(e,t,n,i){for(var a=-1,h=mt(es((t-e)/(n||1)),0),p=C(h);h--;)p[i?h:++a]=e,e+=n;return p}function yi(e,t){var n="";if(!e||t<1||t>G)return n;do t%2&&(n+=e),t=ts(t/2),t&&(e+=e);while(t);return n}function Le(e,t){return Oi($a(e,t,Pt),e+"")}function Cu(e){return Zo(dr(e))}function Nu(e,t){var n=dr(e);return bs(n,Wn(t,0,n.length))}function Cr(e,t,n,i){if(!Ye(e))return e;t=Mn(t,e);for(var a=-1,h=t.length,p=h-1,b=e;b!=null&&++a<h;){var k=un(t[a]),E=n;if(k==="__proto__"||k==="constructor"||k==="prototype")return e;if(a!=p){var M=b[k];E=i?i(M,k,b):s,E===s&&(E=Ye(M)?M:yn(t[a+1])?[]:{})}kr(b,k,E),b=b[k]}return e}var xa=ns?function(e,t){return ns.set(e,t),e}:Pt,Lu=Zr?function(e,t){return Zr(e,"toString",{configurable:!0,enumerable:!1,value:$i(t),writable:!0})}:Pt;function Au(e){return bs(dr(e))}function Qt(e,t,n){var i=-1,a=e.length;t<0&&(t=-t>a?0:a+t),n=n>a?a:n,n<0&&(n+=a),a=t>n?0:n-t>>>0,t>>>=0;for(var h=C(a);++i<a;)h[i]=e[i+t];return h}function Eu(e,t){var n;return An(e,function(i,a,h){return n=t(i,a,h),!n}),!!n}function cs(e,t,n){var i=0,a=e==null?i:e.length;if(typeof t=="number"&&t===t&&a<=J){for(;i<a;){var h=i+a>>>1,p=e[h];p!==null&&!Bt(p)&&(n?p<=t:p<t)?i=h+1:a=h}return a}return _i(e,t,Pt,n)}function _i(e,t,n,i){var a=0,h=e==null?0:e.length;if(h===0)return 0;t=n(t);for(var p=t!==t,b=t===null,k=Bt(t),E=t===s;a<h;){var M=ts((a+h)/2),O=n(e[M]),K=O!==s,ne=O===null,he=O===O,Ce=Bt(O);if(p)var me=i||he;else E?me=he&&(i||K):b?me=he&&K&&(i||!ne):k?me=he&&K&&!ne&&(i||!Ce):ne||Ce?me=!1:me=i?O<=t:O<t;me?a=M+1:h=M}return vt(h,ke)}function ba(e,t){for(var n=-1,i=e.length,a=0,h=[];++n<i;){var p=e[n],b=t?t(p):p;if(!n||!on(b,k)){var k=b;h[a++]=p===0?0:p}}return h}function ya(e){return typeof e=="number"?e:Bt(e)?ue:+e}function Ut(e){if(typeof e=="string")return e;if(ve(e))return Xe(e,Ut)+"";if(Bt(e))return Yo?Yo.call(e):"";var t=e+"";return t=="0"&&1/e==-le?"-0":t}function En(e,t,n){var i=-1,a=Gr,h=e.length,p=!0,b=[],k=b;if(n)p=!1,a=Js;else if(h>=d){var E=t?null:Gu(e);if(E)return qr(E);p=!1,a=xr,k=new Gn}else k=t?[]:b;e:for(;++i<h;){var M=e[i],O=t?t(M):M;if(M=n||M!==0?M:0,p&&O===O){for(var K=k.length;K--;)if(k[K]===O)continue e;t&&k.push(O),b.push(M)}else a(k,O,n)||(k!==b&&k.push(O),b.push(M))}return b}function wi(e,t){return t=Mn(t,e),e=Ha(e,t),e==null||delete e[un(Zt(t))]}function _a(e,t,n,i){return Cr(e,t,n(qn(e,t)),i)}function ds(e,t,n,i){for(var a=e.length,h=i?a:-1;(i?h--:++h<a)&&t(e[h],h,e););return n?Qt(e,i?0:h,i?h+1:a):Qt(e,i?h+1:0,i?a:h)}function wa(e,t){var n=e;return n instanceof Pe&&(n=n.value()),Xs(t,function(i,a){return a.func.apply(a.thisArg,Cn([i],a.args))},n)}function vi(e,t,n){var i=e.length;if(i<2)return i?En(e[0]):[];for(var a=-1,h=C(i);++a<i;)for(var p=e[a],b=-1;++b<i;)b!=a&&(h[a]=Sr(h[a]||p,e[b],t,n));return En(_t(h,1),t,n)}function va(e,t,n){for(var i=-1,a=e.length,h=t.length,p={};++i<a;){var b=i<h?t[i]:s;n(p,e[i],b)}return p}function ki(e){return at(e)?e:[]}function Si(e){return typeof e=="function"?e:Pt}function Mn(e,t){return ve(e)?e:Ti(e,t)?[e]:Ya(Ge(e))}var Mu=Le;function Tn(e,t,n){var i=e.length;return n=n===s?i:n,!t&&n>=i?e:Qt(e,t,n)}var ka=yd||function(e){return yt.clearTimeout(e)};function Sa(e,t){if(t)return e.slice();var n=e.length,i=Vo?Vo(n):new e.constructor(n);return e.copy(i),i}function Ii(e){var t=new e.constructor(e.byteLength);return new Xr(t).set(new Xr(e)),t}function Tu(e,t){var n=t?Ii(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)}function Pu(e){var t=new e.constructor(e.source,pr.exec(e));return t.lastIndex=e.lastIndex,t}function Du(e){return vr?Ve(vr.call(e)):{}}function Ia(e,t){var n=t?Ii(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)}function ja(e,t){if(e!==t){var n=e!==s,i=e===null,a=e===e,h=Bt(e),p=t!==s,b=t===null,k=t===t,E=Bt(t);if(!b&&!E&&!h&&e>t||h&&p&&k&&!b&&!E||i&&p&&k||!n&&k||!a)return 1;if(!i&&!h&&!E&&e<t||E&&n&&a&&!i&&!h||b&&n&&a||!p&&a||!k)return-1}return 0}function Ou(e,t,n){for(var i=-1,a=e.criteria,h=t.criteria,p=a.length,b=n.length;++i<p;){var k=ja(a[i],h[i]);if(k){if(i>=b)return k;var E=n[i];return k*(E=="desc"?-1:1)}}return e.index-t.index}function Ca(e,t,n,i){for(var a=-1,h=e.length,p=n.length,b=-1,k=t.length,E=mt(h-p,0),M=C(k+E),O=!i;++b<k;)M[b]=t[b];for(;++a<p;)(O||a<h)&&(M[n[a]]=e[a]);for(;E--;)M[b++]=e[a++];return M}function Na(e,t,n,i){for(var a=-1,h=e.length,p=-1,b=n.length,k=-1,E=t.length,M=mt(h-b,0),O=C(M+E),K=!i;++a<M;)O[a]=e[a];for(var ne=a;++k<E;)O[ne+k]=t[k];for(;++p<b;)(K||a<h)&&(O[ne+n[p]]=e[a++]);return O}function Et(e,t){var n=-1,i=e.length;for(t||(t=C(i));++n<i;)t[n]=e[n];return t}function dn(e,t,n,i){var a=!n;n||(n={});for(var h=-1,p=t.length;++h<p;){var b=t[h],k=i?i(n[b],e[b],b,n,e):s;k===s&&(k=e[b]),a?pn(n,b,k):kr(n,b,k)}return n}function Fu(e,t){return dn(e,Mi(e),t)}function Ru(e,t){return dn(e,Ba(e),t)}function us(e,t){return function(n,i){var a=ve(n)?Wc:ou,h=t?t():{};return a(n,e,fe(i,2),h)}}function or(e){return Le(function(t,n){var i=-1,a=n.length,h=a>1?n[a-1]:s,p=a>2?n[2]:s;for(h=e.length>3&&typeof h=="function"?(a--,h):s,p&&Nt(n[0],n[1],p)&&(h=a<3?s:h,a=1),t=Ve(t);++i<a;){var b=n[i];b&&e(t,b,i,h)}return t})}function La(e,t){return function(n,i){if(n==null)return n;if(!Mt(n))return e(n,i);for(var a=n.length,h=t?a:-1,p=Ve(n);(t?h--:++h<a)&&i(p[h],h,p)!==!1;);return n}}function Aa(e){return function(t,n,i){for(var a=-1,h=Ve(t),p=i(t),b=p.length;b--;){var k=p[e?b:++a];if(n(h[k],k,h)===!1)break}return t}}function zu(e,t,n){var i=t&z,a=Nr(e);function h(){var p=this&&this!==yt&&this instanceof h?a:e;return p.apply(i?n:this,arguments)}return h}function Ea(e){return function(t){t=Ge(t);var n=Zn(t)?rn(t):s,i=n?n[0]:t.charAt(0),a=n?Tn(n,1).join(""):t.slice(1);return i[e]()+a}}function ar(e){return function(t){return Xs(Ll(Nl(t).replace(Lc,"")),e,"")}}function Nr(e){return function(){var t=arguments;switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3]);case 5:return new e(t[0],t[1],t[2],t[3],t[4]);case 6:return new e(t[0],t[1],t[2],t[3],t[4],t[5]);case 7:return new e(t[0],t[1],t[2],t[3],t[4],t[5],t[6])}var n=ir(e.prototype),i=e.apply(n,t);return Ye(i)?i:n}}function Uu(e,t,n){var i=Nr(e);function a(){for(var h=arguments.length,p=C(h),b=h,k=lr(a);b--;)p[b]=arguments[b];var E=h<3&&p[0]!==k&&p[h-1]!==k?[]:Nn(p,k);if(h-=E.length,h<n)return Oa(e,t,fs,a.placeholder,s,p,E,s,s,n-h);var M=this&&this!==yt&&this instanceof a?i:e;return Rt(M,this,p)}return a}function Ma(e){return function(t,n,i){var a=Ve(t);if(!Mt(t)){var h=fe(n,3);t=pt(t),n=function(b){return h(a[b],b,a)}}var p=e(t,n,i);return p>-1?a[h?t[p]:p]:s}}function Ta(e){return bn(function(t){var n=t.length,i=n,a=Xt.prototype.thru;for(e&&t.reverse();i--;){var h=t[i];if(typeof h!="function")throw new Jt(m);if(a&&!p&&ps(h)=="wrapper")var p=new Xt([],!0)}for(i=p?i:n;++i<n;){h=t[i];var b=ps(h),k=b=="wrapper"?Ai(h):s;k&&Pi(k[0])&&k[1]==(V|Z|R|X)&&!k[4].length&&k[9]==1?p=p[ps(k[0])].apply(p,k[3]):p=h.length==1&&Pi(h)?p[b]():p.thru(h)}return function(){var E=arguments,M=E[0];if(p&&E.length==1&&ve(M))return p.plant(M).value();for(var O=0,K=n?t[O].apply(this,E):M;++O<n;)K=t[O].call(this,K);return K}})}function fs(e,t,n,i,a,h,p,b,k,E){var M=t&V,O=t&z,K=t&U,ne=t&(Z|H),he=t&y,Ce=K?s:Nr(e);function me(){for(var Te=arguments.length,Oe=C(Te),Gt=Te;Gt--;)Oe[Gt]=arguments[Gt];if(ne)var Lt=lr(me),Wt=Qc(Oe,Lt);if(i&&(Oe=Ca(Oe,i,a,ne)),h&&(Oe=Na(Oe,h,p,ne)),Te-=Wt,ne&&Te<E){var lt=Nn(Oe,Lt);return Oa(e,t,fs,me.placeholder,n,Oe,lt,b,k,E-Te)}var an=O?n:this,vn=K?an[e]:e;return Te=Oe.length,b?Oe=o0(Oe,b):he&&Te>1&&Oe.reverse(),M&&k<Te&&(Oe.length=k),this&&this!==yt&&this instanceof me&&(vn=Ce||Nr(vn)),vn.apply(an,Oe)}return me}function Pa(e,t){return function(n,i){return mu(n,e,t(i),{})}}function hs(e,t){return function(n,i){var a;if(n===s&&i===s)return t;if(n!==s&&(a=n),i!==s){if(a===s)return i;typeof n=="string"||typeof i=="string"?(n=Ut(n),i=Ut(i)):(n=ya(n),i=ya(i)),a=e(n,i)}return a}}function ji(e){return bn(function(t){return t=Xe(t,zt(fe())),Le(function(n){var i=this;return e(t,function(a){return Rt(a,i,n)})})})}function ms(e,t){t=t===s?" ":Ut(t);var n=t.length;if(n<2)return n?yi(t,e):t;var i=yi(t,es(e/er(t)));return Zn(t)?Tn(rn(i),0,e).join(""):i.slice(0,e)}function Bu(e,t,n,i){var a=t&z,h=Nr(e);function p(){for(var b=-1,k=arguments.length,E=-1,M=i.length,O=C(M+k),K=this&&this!==yt&&this instanceof p?h:e;++E<M;)O[E]=i[E];for(;k--;)O[E++]=arguments[++b];return Rt(K,a?n:this,O)}return p}function Da(e){return function(t,n,i){return i&&typeof i!="number"&&Nt(t,n,i)&&(n=i=s),t=wn(t),n===s?(n=t,t=0):n=wn(n),i=i===s?t<n?1:-1:wn(i),ju(t,n,i,e)}}function gs(e){return function(t,n){return typeof t=="string"&&typeof n=="string"||(t=en(t),n=en(n)),e(t,n)}}function Oa(e,t,n,i,a,h,p,b,k,E){var M=t&Z,O=M?p:s,K=M?s:p,ne=M?h:s,he=M?s:h;t|=M?R:B,t&=~(M?B:R),t&se||(t&=-4);var Ce=[e,t,a,ne,O,he,K,b,k,E],me=n.apply(s,Ce);return Pi(e)&&Ka(me,Ce),me.placeholder=i,Ja(me,e,t)}function Ci(e){var t=ht[e];return function(n,i){if(n=en(n),i=i==null?0:vt(je(i),292),i&&Jo(n)){var a=(Ge(n)+"e").split("e"),h=t(a[0]+"e"+(+a[1]+i));return a=(Ge(h)+"e").split("e"),+(a[0]+"e"+(+a[1]-i))}return t(n)}}var Gu=rr&&1/qr(new rr([,-0]))[1]==le?function(e){return new rr(e)}:Ji;function Fa(e){return function(t){var n=kt(t);return n==Qe?ri(t):n==Ue?id(t):Yc(t,e(t))}}function xn(e,t,n,i,a,h,p,b){var k=t&U;if(!k&&typeof e!="function")throw new Jt(m);var E=i?i.length:0;if(E||(t&=-97,i=a=s),p=p===s?p:mt(je(p),0),b=b===s?b:je(b),E-=a?a.length:0,t&B){var M=i,O=a;i=a=s}var K=k?s:Ai(e),ne=[e,t,n,i,a,M,O,h,p,b];if(K&&r0(ne,K),e=ne[0],t=ne[1],n=ne[2],i=ne[3],a=ne[4],b=ne[9]=ne[9]===s?k?0:e.length:mt(ne[9]-E,0),!b&&t&(Z|H)&&(t&=-25),!t||t==z)var he=zu(e,t,n);else t==Z||t==H?he=Uu(e,t,b):(t==R||t==(z|R))&&!a.length?he=Bu(e,t,n,i):he=fs.apply(s,ne);var Ce=K?xa:Ka;return Ja(Ce(he,ne),e,t)}function Ra(e,t,n,i){return e===s||on(e,nr[n])&&!We.call(i,n)?t:e}function za(e,t,n,i,a,h){return Ye(e)&&Ye(t)&&(h.set(t,e),ls(e,t,s,za,h),h.delete(t)),e}function Wu(e){return Er(e)?s:e}function Ua(e,t,n,i,a,h){var p=n&L,b=e.length,k=t.length;if(b!=k&&!(p&&k>b))return!1;var E=h.get(e),M=h.get(t);if(E&&M)return E==t&&M==e;var O=-1,K=!0,ne=n&W?new Gn:s;for(h.set(e,t),h.set(t,e);++O<b;){var he=e[O],Ce=t[O];if(i)var me=p?i(Ce,he,O,t,e,h):i(he,Ce,O,e,t,h);if(me!==s){if(me)continue;K=!1;break}if(ne){if(!Ys(t,function(Te,Oe){if(!xr(ne,Oe)&&(he===Te||a(he,Te,n,i,h)))return ne.push(Oe)})){K=!1;break}}else if(!(he===Ce||a(he,Ce,n,i,h))){K=!1;break}}return h.delete(e),h.delete(t),K}function qu(e,t,n,i,a,h,p){switch(n){case $t:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case Vt:return!(e.byteLength!=t.byteLength||!h(new Xr(e),new Xr(t)));case Se:case Fe:case xt:return on(+e,+t);case Ee:return e.name==t.name&&e.message==t.message;case bt:case dt:return e==t+"";case Qe:var b=ri;case Ue:var k=i&L;if(b||(b=qr),e.size!=t.size&&!k)return!1;var E=p.get(e);if(E)return E==t;i|=W,p.set(e,t);var M=Ua(b(e),b(t),i,a,h,p);return p.delete(e),M;case Ot:if(vr)return vr.call(e)==vr.call(t)}return!1}function Vu(e,t,n,i,a,h){var p=n&L,b=Ni(e),k=b.length,E=Ni(t),M=E.length;if(k!=M&&!p)return!1;for(var O=k;O--;){var K=b[O];if(!(p?K in t:We.call(t,K)))return!1}var ne=h.get(e),he=h.get(t);if(ne&&he)return ne==t&&he==e;var Ce=!0;h.set(e,t),h.set(t,e);for(var me=p;++O<k;){K=b[O];var Te=e[K],Oe=t[K];if(i)var Gt=p?i(Oe,Te,K,t,e,h):i(Te,Oe,K,e,t,h);if(!(Gt===s?Te===Oe||a(Te,Oe,n,i,h):Gt)){Ce=!1;break}me||(me=K=="constructor")}if(Ce&&!me){var Lt=e.constructor,Wt=t.constructor;Lt!=Wt&&"constructor"in e&&"constructor"in t&&!(typeof Lt=="function"&&Lt instanceof Lt&&typeof Wt=="function"&&Wt instanceof Wt)&&(Ce=!1)}return h.delete(e),h.delete(t),Ce}function bn(e){return Oi($a(e,s,tl),e+"")}function Ni(e){return oa(e,pt,Mi)}function Li(e){return oa(e,Tt,Ba)}var Ai=ns?function(e){return ns.get(e)}:Ji;function ps(e){for(var t=e.name+"",n=sr[t],i=We.call(sr,t)?n.length:0;i--;){var a=n[i],h=a.func;if(h==null||h==e)return a.name}return t}function lr(e){var t=We.call(u,"placeholder")?u:e;return t.placeholder}function fe(){var e=u.iteratee||Hi;return e=e===Hi?ca:e,arguments.length?e(arguments[0],arguments[1]):e}function xs(e,t){var n=e.__data__;return Zu(t)?n[typeof t=="string"?"string":"hash"]:n.map}function Ei(e){for(var t=pt(e),n=t.length;n--;){var i=t[n],a=e[i];t[n]=[i,a,qa(a)]}return t}function Vn(e,t){var n=nd(e,t);return la(n)?n:s}function $u(e){var t=We.call(e,Un),n=e[Un];try{e[Un]=s;var i=!0}catch{}var a=Kr.call(e);return i&&(t?e[Un]=n:delete e[Un]),a}var Mi=ii?function(e){return e==null?[]:(e=Ve(e),jn(ii(e),function(t){return Ho.call(e,t)}))}:Xi,Ba=ii?function(e){for(var t=[];e;)Cn(t,Mi(e)),e=Yr(e);return t}:Xi,kt=Ct;(oi&&kt(new oi(new ArrayBuffer(1)))!=$t||yr&&kt(new yr)!=Qe||ai&&kt(ai.resolve())!=Dt||rr&&kt(new rr)!=Ue||_r&&kt(new _r)!=jt)&&(kt=function(e){var t=Ct(e),n=t==Ze?e.constructor:s,i=n?$n(n):"";if(i)switch(i){case Nd:return $t;case Ld:return Qe;case Ad:return Dt;case Ed:return Ue;case Md:return jt}return t});function Hu(e,t,n){for(var i=-1,a=n.length;++i<a;){var h=n[i],p=h.size;switch(h.type){case"drop":e+=p;break;case"dropRight":t-=p;break;case"take":t=vt(t,e+p);break;case"takeRight":e=mt(e,t-p);break}}return{start:e,end:t}}function Ku(e){var t=e.match(Sn);return t?t[1].split(Rs):[]}function Ga(e,t,n){t=Mn(t,e);for(var i=-1,a=t.length,h=!1;++i<a;){var p=un(t[i]);if(!(h=e!=null&&n(e,p)))break;e=e[p]}return h||++i!=a?h:(a=e==null?0:e.length,!!a&&Ss(a)&&yn(p,a)&&(ve(e)||Hn(e)))}function Ju(e){var t=e.length,n=new e.constructor(t);return t&&typeof e[0]=="string"&&We.call(e,"index")&&(n.index=e.index,n.input=e.input),n}function Wa(e){return typeof e.constructor=="function"&&!Lr(e)?ir(Yr(e)):{}}function Xu(e,t,n){var i=e.constructor;switch(t){case Vt:return Ii(e);case Se:case Fe:return new i(+e);case $t:return Tu(e,n);case ln:case tn:case $:case xe:case et:case ot:case ut:case gt:case Ft:return Ia(e,n);case Qe:return new i;case xt:case dt:return new i(e);case bt:return Pu(e);case Ue:return new i;case Ot:return Du(e)}}function Yu(e,t){var n=t.length;if(!n)return e;var i=n-1;return t[i]=(n>1?"& ":"")+t[i],t=t.join(n>2?", ":" "),e.replace(Fs,`{
/* [wrapped with `+t+`] */
`)}function Qu(e){return ve(e)||Hn(e)||!!(Ko&&e&&e[Ko])}function yn(e,t){var n=typeof e;return t=t??G,!!t&&(n=="number"||n!="symbol"&&In.test(e))&&e>-1&&e%1==0&&e<t}function Nt(e,t,n){if(!Ye(n))return!1;var i=typeof t;return(i=="number"?Mt(n)&&yn(t,n.length):i=="string"&&t in n)?on(n[t],e):!1}function Ti(e,t){if(ve(e))return!1;var n=typeof e;return n=="number"||n=="symbol"||n=="boolean"||e==null||Bt(e)?!0:Ds.test(e)||!nn.test(e)||t!=null&&e in Ve(t)}function Zu(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}function Pi(e){var t=ps(e),n=u[t];if(typeof n!="function"||!(t in Pe.prototype))return!1;if(e===n)return!0;var i=Ai(n);return!!i&&e===i[0]}function e0(e){return!!qo&&qo in e}var t0=$r?_n:Yi;function Lr(e){var t=e&&e.constructor,n=typeof t=="function"&&t.prototype||nr;return e===n}function qa(e){return e===e&&!Ye(e)}function Va(e,t){return function(n){return n==null?!1:n[e]===t&&(t!==s||e in Ve(n))}}function n0(e){var t=vs(e,function(i){return n.size===S&&n.clear(),i}),n=t.cache;return t}function r0(e,t){var n=e[1],i=t[1],a=n|i,h=a<(z|U|V),p=i==V&&n==Z||i==V&&n==X&&e[7].length<=t[8]||i==(V|X)&&t[7].length<=t[8]&&n==Z;if(!(h||p))return e;i&z&&(e[2]=t[2],a|=n&z?0:se);var b=t[3];if(b){var k=e[3];e[3]=k?Ca(k,b,t[4]):b,e[4]=k?Nn(e[3],v):t[4]}return b=t[5],b&&(k=e[5],e[5]=k?Na(k,b,t[6]):b,e[6]=k?Nn(e[5],v):t[6]),b=t[7],b&&(e[7]=b),i&V&&(e[8]=e[8]==null?t[8]:vt(e[8],t[8])),e[9]==null&&(e[9]=t[9]),e[0]=t[0],e[1]=a,e}function s0(e){var t=[];if(e!=null)for(var n in Ve(e))t.push(n);return t}function i0(e){return Kr.call(e)}function $a(e,t,n){return t=mt(t===s?e.length-1:t,0),function(){for(var i=arguments,a=-1,h=mt(i.length-t,0),p=C(h);++a<h;)p[a]=i[t+a];a=-1;for(var b=C(t+1);++a<t;)b[a]=i[a];return b[t]=n(p),Rt(e,this,b)}}function Ha(e,t){return t.length<2?e:qn(e,Qt(t,0,-1))}function o0(e,t){for(var n=e.length,i=vt(t.length,n),a=Et(e);i--;){var h=t[i];e[i]=yn(h,n)?a[h]:s}return e}function Di(e,t){if(!(t==="constructor"&&typeof e[t]=="function")&&t!="__proto__")return e[t]}var Ka=Xa(xa),Ar=wd||function(e,t){return yt.setTimeout(e,t)},Oi=Xa(Lu);function Ja(e,t,n){var i=t+"";return Oi(e,Yu(i,a0(Ku(i),n)))}function Xa(e){var t=0,n=0;return function(){var i=Id(),a=pe-(i-n);if(n=i,a>0){if(++t>=F)return arguments[0]}else t=0;return e.apply(s,arguments)}}function bs(e,t){var n=-1,i=e.length,a=i-1;for(t=t===s?i:t;++n<t;){var h=bi(n,a),p=e[h];e[h]=e[n],e[n]=p}return e.length=t,e}var Ya=n0(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(nt,function(n,i,a,h){t.push(a?h.replace(Rr,"$1"):i||n)}),t});function un(e){if(typeof e=="string"||Bt(e))return e;var t=e+"";return t=="0"&&1/e==-le?"-0":t}function $n(e){if(e!=null){try{return Hr.call(e)}catch{}try{return e+""}catch{}}return""}function a0(e,t){return Kt(ye,function(n){var i="_."+n[0];t&n[1]&&!Gr(e,i)&&e.push(i)}),e.sort()}function Qa(e){if(e instanceof Pe)return e.clone();var t=new Xt(e.__wrapped__,e.__chain__);return t.__actions__=Et(e.__actions__),t.__index__=e.__index__,t.__values__=e.__values__,t}function l0(e,t,n){(n?Nt(e,t,n):t===s)?t=1:t=mt(je(t),0);var i=e==null?0:e.length;if(!i||t<1)return[];for(var a=0,h=0,p=C(es(i/t));a<i;)p[h++]=Qt(e,a,a+=t);return p}function c0(e){for(var t=-1,n=e==null?0:e.length,i=0,a=[];++t<n;){var h=e[t];h&&(a[i++]=h)}return a}function d0(){var e=arguments.length;if(!e)return[];for(var t=C(e-1),n=arguments[0],i=e;i--;)t[i-1]=arguments[i];return Cn(ve(n)?Et(n):[n],_t(t,1))}var u0=Le(function(e,t){return at(e)?Sr(e,_t(t,1,at,!0)):[]}),f0=Le(function(e,t){var n=Zt(t);return at(n)&&(n=s),at(e)?Sr(e,_t(t,1,at,!0),fe(n,2)):[]}),h0=Le(function(e,t){var n=Zt(t);return at(n)&&(n=s),at(e)?Sr(e,_t(t,1,at,!0),s,n):[]});function m0(e,t,n){var i=e==null?0:e.length;return i?(t=n||t===s?1:je(t),Qt(e,t<0?0:t,i)):[]}function g0(e,t,n){var i=e==null?0:e.length;return i?(t=n||t===s?1:je(t),t=i-t,Qt(e,0,t<0?0:t)):[]}function p0(e,t){return e&&e.length?ds(e,fe(t,3),!0,!0):[]}function x0(e,t){return e&&e.length?ds(e,fe(t,3),!0):[]}function b0(e,t,n,i){var a=e==null?0:e.length;return a?(n&&typeof n!="number"&&Nt(e,t,n)&&(n=0,i=a),du(e,t,n,i)):[]}function Za(e,t,n){var i=e==null?0:e.length;if(!i)return-1;var a=n==null?0:je(n);return a<0&&(a=mt(i+a,0)),Wr(e,fe(t,3),a)}function el(e,t,n){var i=e==null?0:e.length;if(!i)return-1;var a=i-1;return n!==s&&(a=je(n),a=n<0?mt(i+a,0):vt(a,i-1)),Wr(e,fe(t,3),a,!0)}function tl(e){var t=e==null?0:e.length;return t?_t(e,1):[]}function y0(e){var t=e==null?0:e.length;return t?_t(e,le):[]}function _0(e,t){var n=e==null?0:e.length;return n?(t=t===s?1:je(t),_t(e,t)):[]}function w0(e){for(var t=-1,n=e==null?0:e.length,i={};++t<n;){var a=e[t];i[a[0]]=a[1]}return i}function nl(e){return e&&e.length?e[0]:s}function v0(e,t,n){var i=e==null?0:e.length;if(!i)return-1;var a=n==null?0:je(n);return a<0&&(a=mt(i+a,0)),Qn(e,t,a)}function k0(e){var t=e==null?0:e.length;return t?Qt(e,0,-1):[]}var S0=Le(function(e){var t=Xe(e,ki);return t.length&&t[0]===e[0]?hi(t):[]}),I0=Le(function(e){var t=Zt(e),n=Xe(e,ki);return t===Zt(n)?t=s:n.pop(),n.length&&n[0]===e[0]?hi(n,fe(t,2)):[]}),j0=Le(function(e){var t=Zt(e),n=Xe(e,ki);return t=typeof t=="function"?t:s,t&&n.pop(),n.length&&n[0]===e[0]?hi(n,s,t):[]});function C0(e,t){return e==null?"":kd.call(e,t)}function Zt(e){var t=e==null?0:e.length;return t?e[t-1]:s}function N0(e,t,n){var i=e==null?0:e.length;if(!i)return-1;var a=i;return n!==s&&(a=je(n),a=a<0?mt(i+a,0):vt(a,i-1)),t===t?ad(e,t,a):Wr(e,Oo,a,!0)}function L0(e,t){return e&&e.length?ha(e,je(t)):s}var A0=Le(rl);function rl(e,t){return e&&e.length&&t&&t.length?xi(e,t):e}function E0(e,t,n){return e&&e.length&&t&&t.length?xi(e,t,fe(n,2)):e}function M0(e,t,n){return e&&e.length&&t&&t.length?xi(e,t,s,n):e}var T0=bn(function(e,t){var n=e==null?0:e.length,i=ci(e,t);return pa(e,Xe(t,function(a){return yn(a,n)?+a:a}).sort(ja)),i});function P0(e,t){var n=[];if(!(e&&e.length))return n;var i=-1,a=[],h=e.length;for(t=fe(t,3);++i<h;){var p=e[i];t(p,i,e)&&(n.push(p),a.push(i))}return pa(e,a),n}function Fi(e){return e==null?e:Cd.call(e)}function D0(e,t,n){var i=e==null?0:e.length;return i?(n&&typeof n!="number"&&Nt(e,t,n)?(t=0,n=i):(t=t==null?0:je(t),n=n===s?i:je(n)),Qt(e,t,n)):[]}function O0(e,t){return cs(e,t)}function F0(e,t,n){return _i(e,t,fe(n,2))}function R0(e,t){var n=e==null?0:e.length;if(n){var i=cs(e,t);if(i<n&&on(e[i],t))return i}return-1}function z0(e,t){return cs(e,t,!0)}function U0(e,t,n){return _i(e,t,fe(n,2),!0)}function B0(e,t){var n=e==null?0:e.length;if(n){var i=cs(e,t,!0)-1;if(on(e[i],t))return i}return-1}function G0(e){return e&&e.length?ba(e):[]}function W0(e,t){return e&&e.length?ba(e,fe(t,2)):[]}function q0(e){var t=e==null?0:e.length;return t?Qt(e,1,t):[]}function V0(e,t,n){return e&&e.length?(t=n||t===s?1:je(t),Qt(e,0,t<0?0:t)):[]}function $0(e,t,n){var i=e==null?0:e.length;return i?(t=n||t===s?1:je(t),t=i-t,Qt(e,t<0?0:t,i)):[]}function H0(e,t){return e&&e.length?ds(e,fe(t,3),!1,!0):[]}function K0(e,t){return e&&e.length?ds(e,fe(t,3)):[]}var J0=Le(function(e){return En(_t(e,1,at,!0))}),X0=Le(function(e){var t=Zt(e);return at(t)&&(t=s),En(_t(e,1,at,!0),fe(t,2))}),Y0=Le(function(e){var t=Zt(e);return t=typeof t=="function"?t:s,En(_t(e,1,at,!0),s,t)});function Q0(e){return e&&e.length?En(e):[]}function Z0(e,t){return e&&e.length?En(e,fe(t,2)):[]}function ef(e,t){return t=typeof t=="function"?t:s,e&&e.length?En(e,s,t):[]}function Ri(e){if(!(e&&e.length))return[];var t=0;return e=jn(e,function(n){if(at(n))return t=mt(n.length,t),!0}),ti(t,function(n){return Xe(e,Qs(n))})}function sl(e,t){if(!(e&&e.length))return[];var n=Ri(e);return t==null?n:Xe(n,function(i){return Rt(t,s,i)})}var tf=Le(function(e,t){return at(e)?Sr(e,t):[]}),nf=Le(function(e){return vi(jn(e,at))}),rf=Le(function(e){var t=Zt(e);return at(t)&&(t=s),vi(jn(e,at),fe(t,2))}),sf=Le(function(e){var t=Zt(e);return t=typeof t=="function"?t:s,vi(jn(e,at),s,t)}),of=Le(Ri);function af(e,t){return va(e||[],t||[],kr)}function lf(e,t){return va(e||[],t||[],Cr)}var cf=Le(function(e){var t=e.length,n=t>1?e[t-1]:s;return n=typeof n=="function"?(e.pop(),n):s,sl(e,n)});function il(e){var t=u(e);return t.__chain__=!0,t}function df(e,t){return t(e),e}function ys(e,t){return t(e)}var uf=bn(function(e){var t=e.length,n=t?e[0]:0,i=this.__wrapped__,a=function(h){return ci(h,e)};return t>1||this.__actions__.length||!(i instanceof Pe)||!yn(n)?this.thru(a):(i=i.slice(n,+n+(t?1:0)),i.__actions__.push({func:ys,args:[a],thisArg:s}),new Xt(i,this.__chain__).thru(function(h){return t&&!h.length&&h.push(s),h}))});function ff(){return il(this)}function hf(){return new Xt(this.value(),this.__chain__)}function mf(){this.__values__===s&&(this.__values__=yl(this.value()));var e=this.__index__>=this.__values__.length,t=e?s:this.__values__[this.__index__++];return{done:e,value:t}}function gf(){return this}function pf(e){for(var t,n=this;n instanceof ss;){var i=Qa(n);i.__index__=0,i.__values__=s,t?a.__wrapped__=i:t=i;var a=i;n=n.__wrapped__}return a.__wrapped__=e,t}function xf(){var e=this.__wrapped__;if(e instanceof Pe){var t=e;return this.__actions__.length&&(t=new Pe(this)),t=t.reverse(),t.__actions__.push({func:ys,args:[Fi],thisArg:s}),new Xt(t,this.__chain__)}return this.thru(Fi)}function bf(){return wa(this.__wrapped__,this.__actions__)}var yf=us(function(e,t,n){We.call(e,n)?++e[n]:pn(e,n,1)});function _f(e,t,n){var i=ve(e)?Po:cu;return n&&Nt(e,t,n)&&(t=s),i(e,fe(t,3))}function wf(e,t){var n=ve(e)?jn:sa;return n(e,fe(t,3))}var vf=Ma(Za),kf=Ma(el);function Sf(e,t){return _t(_s(e,t),1)}function If(e,t){return _t(_s(e,t),le)}function jf(e,t,n){return n=n===s?1:je(n),_t(_s(e,t),n)}function ol(e,t){var n=ve(e)?Kt:An;return n(e,fe(t,3))}function al(e,t){var n=ve(e)?qc:ra;return n(e,fe(t,3))}var Cf=us(function(e,t,n){We.call(e,n)?e[n].push(t):pn(e,n,[t])});function Nf(e,t,n,i){e=Mt(e)?e:dr(e),n=n&&!i?je(n):0;var a=e.length;return n<0&&(n=mt(a+n,0)),Is(e)?n<=a&&e.indexOf(t,n)>-1:!!a&&Qn(e,t,n)>-1}var Lf=Le(function(e,t,n){var i=-1,a=typeof t=="function",h=Mt(e)?C(e.length):[];return An(e,function(p){h[++i]=a?Rt(t,p,n):Ir(p,t,n)}),h}),Af=us(function(e,t,n){pn(e,n,t)});function _s(e,t){var n=ve(e)?Xe:da;return n(e,fe(t,3))}function Ef(e,t,n,i){return e==null?[]:(ve(t)||(t=t==null?[]:[t]),n=i?s:n,ve(n)||(n=n==null?[]:[n]),ma(e,t,n))}var Mf=us(function(e,t,n){e[n?0:1].push(t)},function(){return[[],[]]});function Tf(e,t,n){var i=ve(e)?Xs:Ro,a=arguments.length<3;return i(e,fe(t,4),n,a,An)}function Pf(e,t,n){var i=ve(e)?Vc:Ro,a=arguments.length<3;return i(e,fe(t,4),n,a,ra)}function Df(e,t){var n=ve(e)?jn:sa;return n(e,ks(fe(t,3)))}function Of(e){var t=ve(e)?Zo:Cu;return t(e)}function Ff(e,t,n){(n?Nt(e,t,n):t===s)?t=1:t=je(t);var i=ve(e)?su:Nu;return i(e,t)}function Rf(e){var t=ve(e)?iu:Au;return t(e)}function zf(e){if(e==null)return 0;if(Mt(e))return Is(e)?er(e):e.length;var t=kt(e);return t==Qe||t==Ue?e.size:gi(e).length}function Uf(e,t,n){var i=ve(e)?Ys:Eu;return n&&Nt(e,t,n)&&(t=s),i(e,fe(t,3))}var Bf=Le(function(e,t){if(e==null)return[];var n=t.length;return n>1&&Nt(e,t[0],t[1])?t=[]:n>2&&Nt(t[0],t[1],t[2])&&(t=[t[0]]),ma(e,_t(t,1),[])}),ws=_d||function(){return yt.Date.now()};function Gf(e,t){if(typeof t!="function")throw new Jt(m);return e=je(e),function(){if(--e<1)return t.apply(this,arguments)}}function ll(e,t,n){return t=n?s:t,t=e&&t==null?e.length:t,xn(e,V,s,s,s,s,t)}function cl(e,t){var n;if(typeof t!="function")throw new Jt(m);return e=je(e),function(){return--e>0&&(n=t.apply(this,arguments)),e<=1&&(t=s),n}}var zi=Le(function(e,t,n){var i=z;if(n.length){var a=Nn(n,lr(zi));i|=R}return xn(e,i,t,n,a)}),dl=Le(function(e,t,n){var i=z|U;if(n.length){var a=Nn(n,lr(dl));i|=R}return xn(t,i,e,n,a)});function ul(e,t,n){t=n?s:t;var i=xn(e,Z,s,s,s,s,s,t);return i.placeholder=ul.placeholder,i}function fl(e,t,n){t=n?s:t;var i=xn(e,H,s,s,s,s,s,t);return i.placeholder=fl.placeholder,i}function hl(e,t,n){var i,a,h,p,b,k,E=0,M=!1,O=!1,K=!0;if(typeof e!="function")throw new Jt(m);t=en(t)||0,Ye(n)&&(M=!!n.leading,O="maxWait"in n,h=O?mt(en(n.maxWait)||0,t):h,K="trailing"in n?!!n.trailing:K);function ne(lt){var an=i,vn=a;return i=a=s,E=lt,p=e.apply(vn,an),p}function he(lt){return E=lt,b=Ar(Te,t),M?ne(lt):p}function Ce(lt){var an=lt-k,vn=lt-E,Ml=t-an;return O?vt(Ml,h-vn):Ml}function me(lt){var an=lt-k,vn=lt-E;return k===s||an>=t||an<0||O&&vn>=h}function Te(){var lt=ws();if(me(lt))return Oe(lt);b=Ar(Te,Ce(lt))}function Oe(lt){return b=s,K&&i?ne(lt):(i=a=s,p)}function Gt(){b!==s&&ka(b),E=0,i=k=a=b=s}function Lt(){return b===s?p:Oe(ws())}function Wt(){var lt=ws(),an=me(lt);if(i=arguments,a=this,k=lt,an){if(b===s)return he(k);if(O)return ka(b),b=Ar(Te,t),ne(k)}return b===s&&(b=Ar(Te,t)),p}return Wt.cancel=Gt,Wt.flush=Lt,Wt}var Wf=Le(function(e,t){return na(e,1,t)}),qf=Le(function(e,t,n){return na(e,en(t)||0,n)});function Vf(e){return xn(e,y)}function vs(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new Jt(m);var n=function(){var i=arguments,a=t?t.apply(this,i):i[0],h=n.cache;if(h.has(a))return h.get(a);var p=e.apply(this,i);return n.cache=h.set(a,p)||h,p};return n.cache=new(vs.Cache||gn),n}vs.Cache=gn;function ks(e){if(typeof e!="function")throw new Jt(m);return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}function $f(e){return cl(2,e)}var Hf=Mu(function(e,t){t=t.length==1&&ve(t[0])?Xe(t[0],zt(fe())):Xe(_t(t,1),zt(fe()));var n=t.length;return Le(function(i){for(var a=-1,h=vt(i.length,n);++a<h;)i[a]=t[a].call(this,i[a]);return Rt(e,this,i)})}),Ui=Le(function(e,t){var n=Nn(t,lr(Ui));return xn(e,R,s,t,n)}),ml=Le(function(e,t){var n=Nn(t,lr(ml));return xn(e,B,s,t,n)}),Kf=bn(function(e,t){return xn(e,X,s,s,s,t)});function Jf(e,t){if(typeof e!="function")throw new Jt(m);return t=t===s?t:je(t),Le(e,t)}function Xf(e,t){if(typeof e!="function")throw new Jt(m);return t=t==null?0:mt(je(t),0),Le(function(n){var i=n[t],a=Tn(n,0,t);return i&&Cn(a,i),Rt(e,this,a)})}function Yf(e,t,n){var i=!0,a=!0;if(typeof e!="function")throw new Jt(m);return Ye(n)&&(i="leading"in n?!!n.leading:i,a="trailing"in n?!!n.trailing:a),hl(e,t,{leading:i,maxWait:t,trailing:a})}function Qf(e){return ll(e,1)}function Zf(e,t){return Ui(Si(t),e)}function eh(){if(!arguments.length)return[];var e=arguments[0];return ve(e)?e:[e]}function th(e){return Yt(e,N)}function nh(e,t){return t=typeof t=="function"?t:s,Yt(e,N,t)}function rh(e){return Yt(e,j|N)}function sh(e,t){return t=typeof t=="function"?t:s,Yt(e,j|N,t)}function ih(e,t){return t==null||ta(e,t,pt(t))}function on(e,t){return e===t||e!==e&&t!==t}var oh=gs(fi),ah=gs(function(e,t){return e>=t}),Hn=aa(function(){return arguments}())?aa:function(e){return st(e)&&We.call(e,"callee")&&!Ho.call(e,"callee")},ve=C.isArray,lh=No?zt(No):gu;function Mt(e){return e!=null&&Ss(e.length)&&!_n(e)}function at(e){return st(e)&&Mt(e)}function ch(e){return e===!0||e===!1||st(e)&&Ct(e)==Se}var Pn=vd||Yi,dh=Lo?zt(Lo):pu;function uh(e){return st(e)&&e.nodeType===1&&!Er(e)}function fh(e){if(e==null)return!0;if(Mt(e)&&(ve(e)||typeof e=="string"||typeof e.splice=="function"||Pn(e)||cr(e)||Hn(e)))return!e.length;var t=kt(e);if(t==Qe||t==Ue)return!e.size;if(Lr(e))return!gi(e).length;for(var n in e)if(We.call(e,n))return!1;return!0}function hh(e,t){return jr(e,t)}function mh(e,t,n){n=typeof n=="function"?n:s;var i=n?n(e,t):s;return i===s?jr(e,t,s,n):!!i}function Bi(e){if(!st(e))return!1;var t=Ct(e);return t==Ee||t==De||typeof e.message=="string"&&typeof e.name=="string"&&!Er(e)}function gh(e){return typeof e=="number"&&Jo(e)}function _n(e){if(!Ye(e))return!1;var t=Ct(e);return t==Re||t==St||t==Q||t==qe}function gl(e){return typeof e=="number"&&e==je(e)}function Ss(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=G}function Ye(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}function st(e){return e!=null&&typeof e=="object"}var pl=Ao?zt(Ao):bu;function ph(e,t){return e===t||mi(e,t,Ei(t))}function xh(e,t,n){return n=typeof n=="function"?n:s,mi(e,t,Ei(t),n)}function bh(e){return xl(e)&&e!=+e}function yh(e){if(t0(e))throw new we(f);return la(e)}function _h(e){return e===null}function wh(e){return e==null}function xl(e){return typeof e=="number"||st(e)&&Ct(e)==xt}function Er(e){if(!st(e)||Ct(e)!=Ze)return!1;var t=Yr(e);if(t===null)return!0;var n=We.call(t,"constructor")&&t.constructor;return typeof n=="function"&&n instanceof n&&Hr.call(n)==pd}var Gi=Eo?zt(Eo):yu;function vh(e){return gl(e)&&e>=-G&&e<=G}var bl=Mo?zt(Mo):_u;function Is(e){return typeof e=="string"||!ve(e)&&st(e)&&Ct(e)==dt}function Bt(e){return typeof e=="symbol"||st(e)&&Ct(e)==Ot}var cr=To?zt(To):wu;function kh(e){return e===s}function Sh(e){return st(e)&&kt(e)==jt}function Ih(e){return st(e)&&Ct(e)==ft}var jh=gs(pi),Ch=gs(function(e,t){return e<=t});function yl(e){if(!e)return[];if(Mt(e))return Is(e)?rn(e):Et(e);if(br&&e[br])return sd(e[br]());var t=kt(e),n=t==Qe?ri:t==Ue?qr:dr;return n(e)}function wn(e){if(!e)return e===0?e:0;if(e=en(e),e===le||e===-le){var t=e<0?-1:1;return t*ze}return e===e?e:0}function je(e){var t=wn(e),n=t%1;return t===t?n?t-n:t:0}function _l(e){return e?Wn(je(e),0,ie):0}function en(e){if(typeof e=="number")return e;if(Bt(e))return ue;if(Ye(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=Ye(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=zo(e);var n=Ur.test(e);return n||Bs.test(e)?Bc(e.slice(2),n?2:8):zr.test(e)?ue:+e}function wl(e){return dn(e,Tt(e))}function Nh(e){return e?Wn(je(e),-G,G):e===0?e:0}function Ge(e){return e==null?"":Ut(e)}var Lh=or(function(e,t){if(Lr(t)||Mt(t)){dn(t,pt(t),e);return}for(var n in t)We.call(t,n)&&kr(e,n,t[n])}),vl=or(function(e,t){dn(t,Tt(t),e)}),js=or(function(e,t,n,i){dn(t,Tt(t),e,i)}),Ah=or(function(e,t,n,i){dn(t,pt(t),e,i)}),Eh=bn(ci);function Mh(e,t){var n=ir(e);return t==null?n:ea(n,t)}var Th=Le(function(e,t){e=Ve(e);var n=-1,i=t.length,a=i>2?t[2]:s;for(a&&Nt(t[0],t[1],a)&&(i=1);++n<i;)for(var h=t[n],p=Tt(h),b=-1,k=p.length;++b<k;){var E=p[b],M=e[E];(M===s||on(M,nr[E])&&!We.call(e,E))&&(e[E]=h[E])}return e}),Ph=Le(function(e){return e.push(s,za),Rt(kl,s,e)});function Dh(e,t){return Do(e,fe(t,3),cn)}function Oh(e,t){return Do(e,fe(t,3),ui)}function Fh(e,t){return e==null?e:di(e,fe(t,3),Tt)}function Rh(e,t){return e==null?e:ia(e,fe(t,3),Tt)}function zh(e,t){return e&&cn(e,fe(t,3))}function Uh(e,t){return e&&ui(e,fe(t,3))}function Bh(e){return e==null?[]:as(e,pt(e))}function Gh(e){return e==null?[]:as(e,Tt(e))}function Wi(e,t,n){var i=e==null?s:qn(e,t);return i===s?n:i}function Wh(e,t){return e!=null&&Ga(e,t,uu)}function qi(e,t){return e!=null&&Ga(e,t,fu)}var qh=Pa(function(e,t,n){t!=null&&typeof t.toString!="function"&&(t=Kr.call(t)),e[t]=n},$i(Pt)),Vh=Pa(function(e,t,n){t!=null&&typeof t.toString!="function"&&(t=Kr.call(t)),We.call(e,t)?e[t].push(n):e[t]=[n]},fe),$h=Le(Ir);function pt(e){return Mt(e)?Qo(e):gi(e)}function Tt(e){return Mt(e)?Qo(e,!0):vu(e)}function Hh(e,t){var n={};return t=fe(t,3),cn(e,function(i,a,h){pn(n,t(i,a,h),i)}),n}function Kh(e,t){var n={};return t=fe(t,3),cn(e,function(i,a,h){pn(n,a,t(i,a,h))}),n}var Jh=or(function(e,t,n){ls(e,t,n)}),kl=or(function(e,t,n,i){ls(e,t,n,i)}),Xh=bn(function(e,t){var n={};if(e==null)return n;var i=!1;t=Xe(t,function(h){return h=Mn(h,e),i||(i=h.length>1),h}),dn(e,Li(e),n),i&&(n=Yt(n,j|I|N,Wu));for(var a=t.length;a--;)wi(n,t[a]);return n});function Yh(e,t){return Sl(e,ks(fe(t)))}var Qh=bn(function(e,t){return e==null?{}:Su(e,t)});function Sl(e,t){if(e==null)return{};var n=Xe(Li(e),function(i){return[i]});return t=fe(t),ga(e,n,function(i,a){return t(i,a[0])})}function Zh(e,t,n){t=Mn(t,e);var i=-1,a=t.length;for(a||(a=1,e=s);++i<a;){var h=e==null?s:e[un(t[i])];h===s&&(i=a,h=n),e=_n(h)?h.call(e):h}return e}function em(e,t,n){return e==null?e:Cr(e,t,n)}function tm(e,t,n,i){return i=typeof i=="function"?i:s,e==null?e:Cr(e,t,n,i)}var Il=Fa(pt),jl=Fa(Tt);function nm(e,t,n){var i=ve(e),a=i||Pn(e)||cr(e);if(t=fe(t,4),n==null){var h=e&&e.constructor;a?n=i?new h:[]:Ye(e)?n=_n(h)?ir(Yr(e)):{}:n={}}return(a?Kt:cn)(e,function(p,b,k){return t(n,p,b,k)}),n}function rm(e,t){return e==null?!0:wi(e,t)}function sm(e,t,n){return e==null?e:_a(e,t,Si(n))}function im(e,t,n,i){return i=typeof i=="function"?i:s,e==null?e:_a(e,t,Si(n),i)}function dr(e){return e==null?[]:ni(e,pt(e))}function om(e){return e==null?[]:ni(e,Tt(e))}function am(e,t,n){return n===s&&(n=t,t=s),n!==s&&(n=en(n),n=n===n?n:0),t!==s&&(t=en(t),t=t===t?t:0),Wn(en(e),t,n)}function lm(e,t,n){return t=wn(t),n===s?(n=t,t=0):n=wn(n),e=en(e),hu(e,t,n)}function cm(e,t,n){if(n&&typeof n!="boolean"&&Nt(e,t,n)&&(t=n=s),n===s&&(typeof t=="boolean"?(n=t,t=s):typeof e=="boolean"&&(n=e,e=s)),e===s&&t===s?(e=0,t=1):(e=wn(e),t===s?(t=e,e=0):t=wn(t)),e>t){var i=e;e=t,t=i}if(n||e%1||t%1){var a=Xo();return vt(e+a*(t-e+Uc("1e-"+((a+"").length-1))),t)}return bi(e,t)}var dm=ar(function(e,t,n){return t=t.toLowerCase(),e+(n?Cl(t):t)});function Cl(e){return Vi(Ge(e).toLowerCase())}function Nl(e){return e=Ge(e),e&&e.replace(Jn,Zc).replace(Ac,"")}function um(e,t,n){e=Ge(e),t=Ut(t);var i=e.length;n=n===s?i:Wn(je(n),0,i);var a=n;return n-=t.length,n>=0&&e.slice(n,a)==t}function fm(e){return e=Ge(e),e&&be.test(e)?e.replace(Ne,ed):e}function hm(e){return e=Ge(e),e&&Fr.test(e)?e.replace(mr,"\\$&"):e}var mm=ar(function(e,t,n){return e+(n?"-":"")+t.toLowerCase()}),gm=ar(function(e,t,n){return e+(n?" ":"")+t.toLowerCase()}),pm=Ea("toLowerCase");function xm(e,t,n){e=Ge(e),t=je(t);var i=t?er(e):0;if(!t||i>=t)return e;var a=(t-i)/2;return ms(ts(a),n)+e+ms(es(a),n)}function bm(e,t,n){e=Ge(e),t=je(t);var i=t?er(e):0;return t&&i<t?e+ms(t-i,n):e}function ym(e,t,n){e=Ge(e),t=je(t);var i=t?er(e):0;return t&&i<t?ms(t-i,n)+e:e}function _m(e,t,n){return n||t==null?t=0:t&&(t=+t),jd(Ge(e).replace(Fn,""),t||0)}function wm(e,t,n){return(n?Nt(e,t,n):t===s)?t=1:t=je(t),yi(Ge(e),t)}function vm(){var e=arguments,t=Ge(e[0]);return e.length<3?t:t.replace(e[1],e[2])}var km=ar(function(e,t,n){return e+(n?"_":"")+t.toLowerCase()});function Sm(e,t,n){return n&&typeof n!="number"&&Nt(e,t,n)&&(t=n=s),n=n===s?ie:n>>>0,n?(e=Ge(e),e&&(typeof t=="string"||t!=null&&!Gi(t))&&(t=Ut(t),!t&&Zn(e))?Tn(rn(e),0,n):e.split(t,n)):[]}var Im=ar(function(e,t,n){return e+(n?" ":"")+Vi(t)});function jm(e,t,n){return e=Ge(e),n=n==null?0:Wn(je(n),0,e.length),t=Ut(t),e.slice(n,n+t.length)==t}function Cm(e,t,n){var i=u.templateSettings;n&&Nt(e,t,n)&&(t=s),e=Ge(e),t=js({},t,i,Ra);var a=js({},t.imports,i.imports,Ra),h=pt(a),p=ni(a,h),b,k,E=0,M=t.interpolate||P,O="__p += '",K=si((t.escape||P).source+"|"+M.source+"|"+(M===wt?gr:P).source+"|"+(t.evaluate||P).source+"|$","g"),ne="//# sourceURL="+(We.call(t,"sourceURL")?(t.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++Dc+"]")+`
`;e.replace(K,function(me,Te,Oe,Gt,Lt,Wt){return Oe||(Oe=Gt),O+=e.slice(E,Wt).replace(D,td),Te&&(b=!0,O+=`' +
__e(`+Te+`) +
'`),Lt&&(k=!0,O+=`';
`+Lt+`;
__p += '`),Oe&&(O+=`' +
((__t = (`+Oe+`)) == null ? '' : __t) +
'`),E=Wt+me.length,me}),O+=`';
`;var he=We.call(t,"variable")&&t.variable;if(!he)O=`with (obj) {
`+O+`
}
`;else if(Us.test(he))throw new we(g);O=(k?O.replace(q,""):O).replace(re,"$1").replace(Ie,"$1;"),O="function("+(he||"obj")+`) {
`+(he?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(b?", __e = _.escape":"")+(k?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+O+`return __p
}`;var Ce=Al(function(){return Be(h,ne+"return "+O).apply(s,p)});if(Ce.source=O,Bi(Ce))throw Ce;return Ce}function Nm(e){return Ge(e).toLowerCase()}function Lm(e){return Ge(e).toUpperCase()}function Am(e,t,n){if(e=Ge(e),e&&(n||t===s))return zo(e);if(!e||!(t=Ut(t)))return e;var i=rn(e),a=rn(t),h=Uo(i,a),p=Bo(i,a)+1;return Tn(i,h,p).join("")}function Em(e,t,n){if(e=Ge(e),e&&(n||t===s))return e.slice(0,Wo(e)+1);if(!e||!(t=Ut(t)))return e;var i=rn(e),a=Bo(i,rn(t))+1;return Tn(i,0,a).join("")}function Mm(e,t,n){if(e=Ge(e),e&&(n||t===s))return e.replace(Fn,"");if(!e||!(t=Ut(t)))return e;var i=rn(e),a=Uo(i,rn(t));return Tn(i,a).join("")}function Tm(e,t){var n=ee,i=oe;if(Ye(t)){var a="separator"in t?t.separator:a;n="length"in t?je(t.length):n,i="omission"in t?Ut(t.omission):i}e=Ge(e);var h=e.length;if(Zn(e)){var p=rn(e);h=p.length}if(n>=h)return e;var b=n-er(i);if(b<1)return i;var k=p?Tn(p,0,b).join(""):e.slice(0,b);if(a===s)return k+i;if(p&&(b+=k.length-b),Gi(a)){if(e.slice(b).search(a)){var E,M=k;for(a.global||(a=si(a.source,Ge(pr.exec(a))+"g")),a.lastIndex=0;E=a.exec(M);)var O=E.index;k=k.slice(0,O===s?b:O)}}else if(e.indexOf(Ut(a),b)!=b){var K=k.lastIndexOf(a);K>-1&&(k=k.slice(0,K))}return k+i}function Pm(e){return e=Ge(e),e&&Je.test(e)?e.replace(ce,ld):e}var Dm=ar(function(e,t,n){return e+(n?" ":"")+t.toUpperCase()}),Vi=Ea("toUpperCase");function Ll(e,t,n){return e=Ge(e),t=n?s:t,t===s?rd(e)?ud(e):Kc(e):e.match(t)||[]}var Al=Le(function(e,t){try{return Rt(e,s,t)}catch(n){return Bi(n)?n:new we(n)}}),Om=bn(function(e,t){return Kt(t,function(n){n=un(n),pn(e,n,zi(e[n],e))}),e});function Fm(e){var t=e==null?0:e.length,n=fe();return e=t?Xe(e,function(i){if(typeof i[1]!="function")throw new Jt(m);return[n(i[0]),i[1]]}):[],Le(function(i){for(var a=-1;++a<t;){var h=e[a];if(Rt(h[0],this,i))return Rt(h[1],this,i)}})}function Rm(e){return lu(Yt(e,j))}function $i(e){return function(){return e}}function zm(e,t){return e==null||e!==e?t:e}var Um=Ta(),Bm=Ta(!0);function Pt(e){return e}function Hi(e){return ca(typeof e=="function"?e:Yt(e,j))}function Gm(e){return ua(Yt(e,j))}function Wm(e,t){return fa(e,Yt(t,j))}var qm=Le(function(e,t){return function(n){return Ir(n,e,t)}}),Vm=Le(function(e,t){return function(n){return Ir(e,n,t)}});function Ki(e,t,n){var i=pt(t),a=as(t,i);n==null&&!(Ye(t)&&(a.length||!i.length))&&(n=t,t=e,e=this,a=as(t,pt(t)));var h=!(Ye(n)&&"chain"in n)||!!n.chain,p=_n(e);return Kt(a,function(b){var k=t[b];e[b]=k,p&&(e.prototype[b]=function(){var E=this.__chain__;if(h||E){var M=e(this.__wrapped__),O=M.__actions__=Et(this.__actions__);return O.push({func:k,args:arguments,thisArg:e}),M.__chain__=E,M}return k.apply(e,Cn([this.value()],arguments))})}),e}function $m(){return yt._===this&&(yt._=xd),this}function Ji(){}function Hm(e){return e=je(e),Le(function(t){return ha(t,e)})}var Km=ji(Xe),Jm=ji(Po),Xm=ji(Ys);function El(e){return Ti(e)?Qs(un(e)):Iu(e)}function Ym(e){return function(t){return e==null?s:qn(e,t)}}var Qm=Da(),Zm=Da(!0);function Xi(){return[]}function Yi(){return!1}function eg(){return{}}function tg(){return""}function ng(){return!0}function rg(e,t){if(e=je(e),e<1||e>G)return[];var n=ie,i=vt(e,ie);t=fe(t),e-=ie;for(var a=ti(i,t);++n<e;)t(n);return a}function sg(e){return ve(e)?Xe(e,un):Bt(e)?[e]:Et(Ya(Ge(e)))}function ig(e){var t=++gd;return Ge(e)+t}var og=hs(function(e,t){return e+t},0),ag=Ci("ceil"),lg=hs(function(e,t){return e/t},1),cg=Ci("floor");function dg(e){return e&&e.length?os(e,Pt,fi):s}function ug(e,t){return e&&e.length?os(e,fe(t,2),fi):s}function fg(e){return Fo(e,Pt)}function hg(e,t){return Fo(e,fe(t,2))}function mg(e){return e&&e.length?os(e,Pt,pi):s}function gg(e,t){return e&&e.length?os(e,fe(t,2),pi):s}var pg=hs(function(e,t){return e*t},1),xg=Ci("round"),bg=hs(function(e,t){return e-t},0);function yg(e){return e&&e.length?ei(e,Pt):0}function _g(e,t){return e&&e.length?ei(e,fe(t,2)):0}return u.after=Gf,u.ary=ll,u.assign=Lh,u.assignIn=vl,u.assignInWith=js,u.assignWith=Ah,u.at=Eh,u.before=cl,u.bind=zi,u.bindAll=Om,u.bindKey=dl,u.castArray=eh,u.chain=il,u.chunk=l0,u.compact=c0,u.concat=d0,u.cond=Fm,u.conforms=Rm,u.constant=$i,u.countBy=yf,u.create=Mh,u.curry=ul,u.curryRight=fl,u.debounce=hl,u.defaults=Th,u.defaultsDeep=Ph,u.defer=Wf,u.delay=qf,u.difference=u0,u.differenceBy=f0,u.differenceWith=h0,u.drop=m0,u.dropRight=g0,u.dropRightWhile=p0,u.dropWhile=x0,u.fill=b0,u.filter=wf,u.flatMap=Sf,u.flatMapDeep=If,u.flatMapDepth=jf,u.flatten=tl,u.flattenDeep=y0,u.flattenDepth=_0,u.flip=Vf,u.flow=Um,u.flowRight=Bm,u.fromPairs=w0,u.functions=Bh,u.functionsIn=Gh,u.groupBy=Cf,u.initial=k0,u.intersection=S0,u.intersectionBy=I0,u.intersectionWith=j0,u.invert=qh,u.invertBy=Vh,u.invokeMap=Lf,u.iteratee=Hi,u.keyBy=Af,u.keys=pt,u.keysIn=Tt,u.map=_s,u.mapKeys=Hh,u.mapValues=Kh,u.matches=Gm,u.matchesProperty=Wm,u.memoize=vs,u.merge=Jh,u.mergeWith=kl,u.method=qm,u.methodOf=Vm,u.mixin=Ki,u.negate=ks,u.nthArg=Hm,u.omit=Xh,u.omitBy=Yh,u.once=$f,u.orderBy=Ef,u.over=Km,u.overArgs=Hf,u.overEvery=Jm,u.overSome=Xm,u.partial=Ui,u.partialRight=ml,u.partition=Mf,u.pick=Qh,u.pickBy=Sl,u.property=El,u.propertyOf=Ym,u.pull=A0,u.pullAll=rl,u.pullAllBy=E0,u.pullAllWith=M0,u.pullAt=T0,u.range=Qm,u.rangeRight=Zm,u.rearg=Kf,u.reject=Df,u.remove=P0,u.rest=Jf,u.reverse=Fi,u.sampleSize=Ff,u.set=em,u.setWith=tm,u.shuffle=Rf,u.slice=D0,u.sortBy=Bf,u.sortedUniq=G0,u.sortedUniqBy=W0,u.split=Sm,u.spread=Xf,u.tail=q0,u.take=V0,u.takeRight=$0,u.takeRightWhile=H0,u.takeWhile=K0,u.tap=df,u.throttle=Yf,u.thru=ys,u.toArray=yl,u.toPairs=Il,u.toPairsIn=jl,u.toPath=sg,u.toPlainObject=wl,u.transform=nm,u.unary=Qf,u.union=J0,u.unionBy=X0,u.unionWith=Y0,u.uniq=Q0,u.uniqBy=Z0,u.uniqWith=ef,u.unset=rm,u.unzip=Ri,u.unzipWith=sl,u.update=sm,u.updateWith=im,u.values=dr,u.valuesIn=om,u.without=tf,u.words=Ll,u.wrap=Zf,u.xor=nf,u.xorBy=rf,u.xorWith=sf,u.zip=of,u.zipObject=af,u.zipObjectDeep=lf,u.zipWith=cf,u.entries=Il,u.entriesIn=jl,u.extend=vl,u.extendWith=js,Ki(u,u),u.add=og,u.attempt=Al,u.camelCase=dm,u.capitalize=Cl,u.ceil=ag,u.clamp=am,u.clone=th,u.cloneDeep=rh,u.cloneDeepWith=sh,u.cloneWith=nh,u.conformsTo=ih,u.deburr=Nl,u.defaultTo=zm,u.divide=lg,u.endsWith=um,u.eq=on,u.escape=fm,u.escapeRegExp=hm,u.every=_f,u.find=vf,u.findIndex=Za,u.findKey=Dh,u.findLast=kf,u.findLastIndex=el,u.findLastKey=Oh,u.floor=cg,u.forEach=ol,u.forEachRight=al,u.forIn=Fh,u.forInRight=Rh,u.forOwn=zh,u.forOwnRight=Uh,u.get=Wi,u.gt=oh,u.gte=ah,u.has=Wh,u.hasIn=qi,u.head=nl,u.identity=Pt,u.includes=Nf,u.indexOf=v0,u.inRange=lm,u.invoke=$h,u.isArguments=Hn,u.isArray=ve,u.isArrayBuffer=lh,u.isArrayLike=Mt,u.isArrayLikeObject=at,u.isBoolean=ch,u.isBuffer=Pn,u.isDate=dh,u.isElement=uh,u.isEmpty=fh,u.isEqual=hh,u.isEqualWith=mh,u.isError=Bi,u.isFinite=gh,u.isFunction=_n,u.isInteger=gl,u.isLength=Ss,u.isMap=pl,u.isMatch=ph,u.isMatchWith=xh,u.isNaN=bh,u.isNative=yh,u.isNil=wh,u.isNull=_h,u.isNumber=xl,u.isObject=Ye,u.isObjectLike=st,u.isPlainObject=Er,u.isRegExp=Gi,u.isSafeInteger=vh,u.isSet=bl,u.isString=Is,u.isSymbol=Bt,u.isTypedArray=cr,u.isUndefined=kh,u.isWeakMap=Sh,u.isWeakSet=Ih,u.join=C0,u.kebabCase=mm,u.last=Zt,u.lastIndexOf=N0,u.lowerCase=gm,u.lowerFirst=pm,u.lt=jh,u.lte=Ch,u.max=dg,u.maxBy=ug,u.mean=fg,u.meanBy=hg,u.min=mg,u.minBy=gg,u.stubArray=Xi,u.stubFalse=Yi,u.stubObject=eg,u.stubString=tg,u.stubTrue=ng,u.multiply=pg,u.nth=L0,u.noConflict=$m,u.noop=Ji,u.now=ws,u.pad=xm,u.padEnd=bm,u.padStart=ym,u.parseInt=_m,u.random=cm,u.reduce=Tf,u.reduceRight=Pf,u.repeat=wm,u.replace=vm,u.result=Zh,u.round=xg,u.runInContext=w,u.sample=Of,u.size=zf,u.snakeCase=km,u.some=Uf,u.sortedIndex=O0,u.sortedIndexBy=F0,u.sortedIndexOf=R0,u.sortedLastIndex=z0,u.sortedLastIndexBy=U0,u.sortedLastIndexOf=B0,u.startCase=Im,u.startsWith=jm,u.subtract=bg,u.sum=yg,u.sumBy=_g,u.template=Cm,u.times=rg,u.toFinite=wn,u.toInteger=je,u.toLength=_l,u.toLower=Nm,u.toNumber=en,u.toSafeInteger=Nh,u.toString=Ge,u.toUpper=Lm,u.trim=Am,u.trimEnd=Em,u.trimStart=Mm,u.truncate=Tm,u.unescape=Pm,u.uniqueId=ig,u.upperCase=Dm,u.upperFirst=Vi,u.each=ol,u.eachRight=al,u.first=nl,Ki(u,function(){var e={};return cn(u,function(t,n){We.call(u.prototype,n)||(e[n]=t)}),e}(),{chain:!1}),u.VERSION=c,Kt(["bind","bindKey","curry","curryRight","partial","partialRight"],function(e){u[e].placeholder=u}),Kt(["drop","take"],function(e,t){Pe.prototype[e]=function(n){n=n===s?1:mt(je(n),0);var i=this.__filtered__&&!t?new Pe(this):this.clone();return i.__filtered__?i.__takeCount__=vt(n,i.__takeCount__):i.__views__.push({size:vt(n,ie),type:e+(i.__dir__<0?"Right":"")}),i},Pe.prototype[e+"Right"]=function(n){return this.reverse()[e](n).reverse()}}),Kt(["filter","map","takeWhile"],function(e,t){var n=t+1,i=n==ge||n==de;Pe.prototype[e]=function(a){var h=this.clone();return h.__iteratees__.push({iteratee:fe(a,3),type:n}),h.__filtered__=h.__filtered__||i,h}}),Kt(["head","last"],function(e,t){var n="take"+(t?"Right":"");Pe.prototype[e]=function(){return this[n](1).value()[0]}}),Kt(["initial","tail"],function(e,t){var n="drop"+(t?"":"Right");Pe.prototype[e]=function(){return this.__filtered__?new Pe(this):this[n](1)}}),Pe.prototype.compact=function(){return this.filter(Pt)},Pe.prototype.find=function(e){return this.filter(e).head()},Pe.prototype.findLast=function(e){return this.reverse().find(e)},Pe.prototype.invokeMap=Le(function(e,t){return typeof e=="function"?new Pe(this):this.map(function(n){return Ir(n,e,t)})}),Pe.prototype.reject=function(e){return this.filter(ks(fe(e)))},Pe.prototype.slice=function(e,t){e=je(e);var n=this;return n.__filtered__&&(e>0||t<0)?new Pe(n):(e<0?n=n.takeRight(-e):e&&(n=n.drop(e)),t!==s&&(t=je(t),n=t<0?n.dropRight(-t):n.take(t-e)),n)},Pe.prototype.takeRightWhile=function(e){return this.reverse().takeWhile(e).reverse()},Pe.prototype.toArray=function(){return this.take(ie)},cn(Pe.prototype,function(e,t){var n=/^(?:filter|find|map|reject)|While$/.test(t),i=/^(?:head|last)$/.test(t),a=u[i?"take"+(t=="last"?"Right":""):t],h=i||/^find/.test(t);a&&(u.prototype[t]=function(){var p=this.__wrapped__,b=i?[1]:arguments,k=p instanceof Pe,E=b[0],M=k||ve(p),O=function(Te){var Oe=a.apply(u,Cn([Te],b));return i&&K?Oe[0]:Oe};M&&n&&typeof E=="function"&&E.length!=1&&(k=M=!1);var K=this.__chain__,ne=!!this.__actions__.length,he=h&&!K,Ce=k&&!ne;if(!h&&M){p=Ce?p:new Pe(this);var me=e.apply(p,b);return me.__actions__.push({func:ys,args:[O],thisArg:s}),new Xt(me,K)}return he&&Ce?e.apply(this,b):(me=this.thru(O),he?i?me.value()[0]:me.value():me)})}),Kt(["pop","push","shift","sort","splice","unshift"],function(e){var t=Vr[e],n=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",i=/^(?:pop|shift)$/.test(e);u.prototype[e]=function(){var a=arguments;if(i&&!this.__chain__){var h=this.value();return t.apply(ve(h)?h:[],a)}return this[n](function(p){return t.apply(ve(p)?p:[],a)})}}),cn(Pe.prototype,function(e,t){var n=u[t];if(n){var i=n.name+"";We.call(sr,i)||(sr[i]=[]),sr[i].push({name:t,func:n})}}),sr[fs(s,U).name]=[{name:"wrapper",func:s}],Pe.prototype.clone=Td,Pe.prototype.reverse=Pd,Pe.prototype.value=Dd,u.prototype.at=uf,u.prototype.chain=ff,u.prototype.commit=hf,u.prototype.next=mf,u.prototype.plant=pf,u.prototype.reverse=xf,u.prototype.toJSON=u.prototype.valueOf=u.prototype.value=bf,u.prototype.first=u.prototype.head,br&&(u.prototype[br]=gf),u},tr=fd();zn?((zn.exports=tr)._=tr,Hs._=tr):yt._=tr}).call(Mr)})(As,As.exports);var Kn=As.exports;const Jg=(o,l=!1)=>{const s=x.useRef(o),c=x.useRef(null),[d,f]=x.useState(0),m=()=>{c.current||(f(s.current),c.current=setInterval(()=>{f(_=>_<=1?(g(),0):_-1)},1e3))},g=()=>{c.current&&(clearInterval(c.current),c.current=null)};return x.useEffect(()=>(s.current=o,l&&m(),g),[o,l]),{countDown:d,start:m,stop:g}},Xg=()=>r.jsx("span",{children:r.jsxs("svg",{className:"animate-spin h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[r.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),r.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})}),Yg=[{type:"chat",tool:"workflow_generate",name:"给我一个工作流，基于ltx创建一个短视频",messages:[{id:"showcase1-3",role:"user",content:"给我一个工作流，基于ltx创建一个短视频",trace_id:"showcase1"},{id:"showcase1-4",role:"ai",content:`{"session_id":"611f8fda-e441-4e87-9fe3-59f51c29e910","text":"\\n\\n🔄 **Switching to ComfyUI-Copilot**\\n\\n### Workflow Recommendations for Creating Short Video Clips from LTX\\n\\nHere are some workflow options to help you create short video clips based on \\"ltx\\":\\n\\n#### 1. Recalled Workflows\\n\\nBased on your request, I found these existing workflows that might be helpful:\\n\\n*   **api-t2i2v-txt\\\\_to\\\\_image\\\\_to\\\\_video**\\n    *   **Description:** Creates a short animated video clip from a text description of a nature scene.\\n    *   **Use Case:** Ideal if your \\"ltx\\" content can be translated into a text description of a scene you want to animate.\\n    *   **Image:** ![api-t2i2v-txt\\\\_to\\\\_image\\\\_to\\\\_video](https://aib-vision-hz.oss-accelerate.aliyuncs.com/mood_board%2Finput%2F2025-06-26%2F648f8d5e2e924162852e98f2a249e3b0.png?x-oss-process=style%2Fresize&OSSAccessKeyId=LTAI5tQyhnsJhtiinV3B1gfV&Expires=2066264036&Signature=ZcP5qLm%2B4W23KXaNhJlQnPJljDw%3D)\\n\\n*   **sdxl-t2i2v-api**\\n    *   **Description:** Creates a short animated video clip based on your text description.\\n    *   **Use Case:** Similar to the above, this workflow is good for generating smooth, high-quality animations from text prompts.\\n    *   **Image:** ![sdxl-t2i2v-api](https://aib-vision-hz.oss-accelerate.aliyuncs.com/mood_board%2Finput%2F2025-06-26%2Fbb9685f63da3498f8e743172a8083f9d.png?x-oss-process=style%2Fresize&OSSAccessKeyId=LTAI5tQyhnsJhtiinV3B1gfV&Expires=2066264381&Signature=BiWhDeYVswBNpH23UtP9WqDNUEk%3D)\\n\\n*   **api-t2v\\\\_ltxv\\\\_text\\\\_to\\\\_video**\\n    *   **Description:** Creates a short animated video clip (about 4 seconds) from text, with a focus on natural and fluid movement. This workflow specifically mentions \\"ltxv\\".\\n    *   **Use Case:** This workflow seems highly relevant as it explicitly includes \\"ltxv\\" in its description, suggesting it might be directly applicable to your \\"ltx\\" content.\\n    *   **Image:** ![api-t2v\\\\_ltxv\\\\_text\\\\_to\\\\_video](https://aib-vision-hz.oss-accelerate.aliyuncs.com/mood_board%2Finput%2F2025-06-26%2F2f5343c2b19c4afba48b8f9079ed736d.png?x-oss-process=style%2Fresize&OSSAccessKeyId=LTAI5tQyhnsJhtiinV3B1gfV&Expires=2066264124&Signature=w1X1XSG3Pxay02KBI3twT%2B3xEpQ%3D)\\n\\n#### 2. AI Generated Workflow\\n\\nI have also generated a new personalized workflow solution for you:\\n\\n*   **AI Generated Workflow**\\n    *   **Description:** Build a workflow that creates a short video clip based on 'ltx' content.\\n    *   **Use Case:** This is a custom-generated workflow tailored to your specific request.\\n    *   **Image:** ![AI Generated Workflow](https://ppc-img.oss-ap-southeast-1.aliyuncs.com/AI_workflow_default.jpg)\\n\\nPlease let me know if you have any questions about these workflows or would like further adjustments!","finished":true,"type":"message","format":"markdown","ext":[{"type":"workflow","data":[{"id":31809,"name":"AI Generated Workflow","description":"Build a workflow that creates a short video clip based on 'ltx' content.","image":"https://ppc-img.oss-ap-southeast-1.aliyuncs.com/AI_workflow_default.jpg","unique_id":"4d7e074f326a544bfcba0daf615ae220","score":null,"source":"AI Generated"},{"id":26740,"name":"api-t2i2v-txt_to_image_to_video","description":"Create a short animated video clip from a text description of a nature scene. I want to describe a beautiful landscape and have it turned into a flowing video with natural movement, like clouds drifting or water flowing, without needing to provide any reference video or images.","image":"https://aib-vision-hz.oss-accelerate.aliyuncs.com/mood_board%2Finput%2F2025-06-26%2F648f8d5e2e924162852e98f2a249e3b0.png?x-oss-process=style%2Fresize&OSSAccessKeyId=LTAI5tQyhnsJhtiinV3B1gfV&Expires=2066264036&Signature=ZcP5qLm%2B4W23KXaNhJlQnPJljDw%3D","unique_id":"554fd2c996083c5b9525051d49a6b2f5","score":[0.5690833843847055,0.5]},{"id":26745,"name":"sdxl-t2i2v-api","description":"Create a short animated video clip based on my text description. I want to be able to type in what I want to see (like \\"a cute dog running on the beach\\"), and get back a smooth, high-quality animation that brings my description to life. The video should be a few seconds long and loop seamlessly.","image":"https://aib-vision-hz.oss-accelerate.aliyuncs.com/mood_board%2Finput%2F2025-06-26%2Fbb9685f63da3498f8e743172a8083f9d.png?x-oss-process=style%2Fresize&OSSAccessKeyId=LTAI5tQyhnsJhtiinV3B1gfV&Expires=2066264381&Signature=BiWhDeYVswBNpH23UtP9WqDNUEk%3D","unique_id":"ef568bd54974e83122c8ac59ba02c8c2","score":[0.616972625255589,0.5]},{"id":26831,"name":"api-t2v_ltxv_text_to_video","description":"Create a short animated video clip (about 4 seconds) showing two women having a conversation, where one has brown hair wearing a black jacket and the other has blonde hair. Make sure the video looks natural and fluid, focusing on the brown-haired woman's face with warm sunset lighting.","image":"https://aib-vision-hz.oss-accelerate.aliyuncs.com/mood_board%2Finput%2F2025-06-26%2F2f5343c2b19c4afba48b8f9079ed736d.png?x-oss-process=style%2Fresize&OSSAccessKeyId=LTAI5tQyhnsJhtiinV3B1gfV&Expires=2066264124&Signature=w1X1XSG3Pxay02KBI3twT%2B3xEpQ%3D","unique_id":"6fc80d5671a79696ddff0db0bd39ee02","score":[0.589295913064967,1]}]}],"message_id":"3cd1418e-e57c-4c01-9005-93365b0acc70"}`,format:"markdown",finished:!0,name:"Assistant"}]},{type:"chat",tool:"workflow_generate",name:"给我一个工作流，把图片变成动漫风格",messages:[{id:"showcase1-5",role:"user",content:"给我一个工作流，把图片变成动漫风格",trace_id:"showcase1"},{id:"showcase1-6",role:"ai",content:`{"session_id":"fd931296-4337-4f1a-bd23-27b3a17caf07","text":"\\n\\n🔄 **Switching to ComfyUI-Copilot**\\n\\n### Image to Anime Style Workflows\\n\\nHere are some workflow options to transform your images into an anime style:\\n\\n#### Recalled Workflows\\n\\n1.  **api-i2i_image2image**\\n    *   **Description:** This workflow is designed to modify portrait photos to add anime-style features like furry ears while preserving most of the original facial features. It aims for a clean final image without watermarks or text overlays.\\n    *   **Image:** ![api-i2i_image2image](https://aib-vision-hz.oss-accelerate.aliyuncs.com/mood_board%2Finput%2F2025-06-26%2Ff3a37b904b6d4ad4ae7db5039c8fffe9.png?x-oss-process=style%2Fresize&OSSAccessKeyId=LTAI5tQyhnsJhtiinV3B1gfV&Expires=2066263152&Signature=DsEDthKG%2BEHXHWO3S0dSD7rRURY%3D)\\n\\n2.  **api-i2i_flux_canny_model_example**\\n    *   **Description:** This workflow focuses on transforming portrait photos into anime-style characters while maintaining the basic pose and composition of the original photo. It can incorporate specific anime features such as fennec ears, a fluffy tail, blonde hair, and blue eyes, with characters wearing casual clothes. The goal is a high-quality anime illustration.\\n    *   **Image:** ![api-i2i_flux_canny_model_example](https://aib-vision-hz.oss-accelerate.aliyuncs.com/mood_board%2Finput%2F2025-06-26%2Fa36288a992704596b74556539fefbd25.png?x-oss-process=style%2Fresize&OSSAccessKeyId=LTAI5tQyhnsJhtiinV3B1gfV&Expires=2066263038&Signature=oTHt155s64%2FHAzETosaTYesTUc%3D)\\n\\n3.  **api-i2v_image_to_video_wan**\\n    *   **Description:** While primarily for animation, this workflow involves an initial image of an anime character and can be used to create movement from a still anime image. This might be relevant if you later want to animate the anime-styled output.\\n    *   **Image:** ![api-i2v_image_to_video_wan](https://aib-vision-hz.oss-accelerate.aliyuncs.com/mood_board%2Finput%2F2025-06-26%2Fbb12a2decb0c4f55a66caefa98eaf1d8.png?x-oss-process=style%2Fresize&OSSAccessKeyId=LTAI5tQyhnsJhtiinV3B1gfV&Expires=2066263536&Signature=c9MxE0hqAMEb4%2FNGG7UnwRylz6Y%3D)\\n\\n#### AI Generated Workflow\\n\\n*   **Name:** AI Generated Workflow\\n*   **Description:** This custom workflow is designed to transform an input image into an anime art style, effectively preserving key features from the original image while applying characteristic anime aesthetics.\\n*   **Image:** ![AI Generated Workflow](https://ppc-img.oss-ap-southeast-1.aliyuncs.com/AI_workflow_default.jpg)\\n\\nYou can choose one of the recommended workflows above, or explore the AI-generated solution. If you have any further questions about these workflows, feel free to ask!","finished":true,"type":"message","format":"markdown","ext":[{"type":"workflow","data":[{"id":31813,"name":"AI Generated Workflow","description":"Build a workflow that transforms an input image into an anime art style, preserving key features while applying anime aesthetics.","image":"https://ppc-img.oss-ap-southeast-1.aliyuncs.com/AI_workflow_default.jpg","unique_id":"578e2c1ebc888b09319bfc7310dd3b02","score":null,"source":"AI Generated"},{"id":26711,"name":"api-i2i_image2image","description":"I want to modify my portrait photo to add anime-style features like furry ears while keeping most of my original facial features intact. The final image should look clean without any watermarks or text overlays.","image":"https://aib-vision-hz.oss-accelerate.aliyuncs.com/mood_board%2Finput%2F2025-06-26%2Ff3a37b904b6d4ad4ae7db5039c8fffe9.png?x-oss-process=style%2Fresize&OSSAccessKeyId=LTAI5tQyhnsJhtiinV3B1gfV&Expires=2066263152&Signature=DsEDthKG%2BEHXHWO3S0dSD7rRURY%3D","unique_id":"7326dc2eb7014aea9bb8853293f1261b","score":[0.5843760618939373,0.5]},{"id":26819,"name":"api-i2i_flux_canny_model_example","description":"I want to transform my portrait photos into anime-style characters while keeping the basic pose and composition of the original photo. The anime character should have specific features like fennec ears and a fluffy tail, with blonde hair and blue eyes, wearing casual clothes. The final result should look like a high-quality anime illustration.","image":"https://aib-vision-hz.oss-accelerate.aliyuncs.com/mood_board%2Finput%2F2025-06-26%2Fa36288a992704596b74556539fefbd25.png?x-oss-process=style%2Fresize&OSSAccessKeyId=LTAI5tQyhnsJhtiinV3B1gfV&Expires=2066263038&Signature=oTHt155s64%2FLHAzETosaTYesTUc%3D","unique_id":"8e456b0c483b5eb64b4aac78bd5cd4be","score":[0.6201659297745311,0.5]},{"id":26822,"name":"api-i2v_image_to_video_wan","description":"I have a still image of an anime character and I want to create a short animation where the character smoothly turns around. The animation should maintain the character's original style and details while adding natural movement. Can you create a workflow that can do this automatically?","image":"https://aib-vision-hz.oss-accelerate.aliyuncs.com/mood_board%2Finput%2F2025-06-26%2Fbb12a2decb0c4f55a66caefa98eaf1d8.png?x-oss-process=style%2Fresize&OSSAccessKeyId=LTAI5tQyhnsJhtiinV3B1gfV&Expires=2066263536&Signature=c9MxE0hqAMEb4%2FNGG7UnwRylz6Y%3D","unique_id":"0ed3d66aea19873488df2b6821dcf7f0","score":[0.632876618757651,0.5]}]}],"message_id":"8895ed9c-f188-4bdb-9646-13b0ec909aa2"}`,format:"markdown",finished:!0,name:"Assistant"}]},{type:"chat",tool:"workflow_generate",name:"给我一个编辑图片的工作流",messages:[{id:"showcase1-7",role:"user",content:"给我一个编辑图片的工作流",trace_id:"showcase1"},{id:"showcase1-8",role:"ai",content:`{"session_id":"bb570efe-14c4-4bde-b595-593026375d5f","text":"\\n\\n🔄 **Switching to ComfyUI-Copilot**\\n\\n### Image Editing Workflows\\n\\nHere are some workflow options for image editing, including both recalled and newly generated solutions:\\n\\n#### **Recalled Workflows**\\n\\nBased on your request, I've found a few relevant workflows that handle various image editing tasks:\\n\\n1.  **image-edit-api (1)**\\n    *   **Description:** This workflow allows you to modify photos using text descriptions. For example, you can change hair color or add specific features while preserving the natural look and original composition of the image. It takes your photo and a text description of the desired changes as input.\\n\\n2.  **image-edit-api**\\n    *   **Description:** This workflow is designed for modifying photos of people. You can add specific objects or change expressions while maintaining the person's identity and overall appearance. For instance, you could make someone smile more or add a coffee cup they're holding, with the changes blending in seamlessly.\\n\\n3.  **i2i-editing**\\n    *   **Description:** If you have a landscape image and want to extend its canvas size in any direction, this workflow can help. It maintains the original artistic style and atmosphere, ensuring the new areas blend seamlessly with the existing image.\\n\\n#### **AI Generated Workflow**\\n\\nI've also generated a new, personalized workflow solution for general image editing:\\n\\n1.  **AI Generated Workflow**\\n    *   **Description:** This workflow is designed to perform general image editing operations, including resizing, cropping, and color correction. It provides a versatile solution for common image manipulation needs.\\n\\nYou can choose one of the recommended workflows above, or let AI generate a personalized solution based on your input. If you have any specific questions about any of these workflows, feel free to ask!","finished":true,"type":"message","format":"markdown","ext":[{"type":"workflow","data":[{"id":31815,"name":"AI Generated Workflow","description":"Build a workflow that allows for general image editing, including operations like resizing, cropping, and color correction.","image":"https://ppc-img.oss-ap-southeast-1.aliyuncs.com/AI_workflow_default.jpg","unique_id":"6f7faac37e32285a935b8699ecc70c15","score":null,"source":"AI Generated"},{"id":26728,"name":"image-edit-api (1)","description":"I want to modify my photos by describing the changes I want in plain text. For example, I want to be able to change hair color or add specific features while keeping the rest of the image looking natural and maintaining the original composition. The workflow should take my photo and a text description of the desired changes as input, and produce a modified version of my photo that incorporates these changes.","image":"","unique_id":"7c9029b78952b52475f5a77d3b5dd781","score":[0.6382076740264893,0]},{"id":26733,"name":"image-edit-api","description":"I have a photo of a person, and I'd like to modify it to add specific objects or change their expression while keeping their identity and overall appearance intact. For example, I want to make them smile more and add objects they're holding, like a coffee cup. The changes should look natural and seamless.","image":"","unique_id":"4080a7a9b33783892cf3cf4fed1755de","score":[0.5695966821668564,0]},{"id":26776,"name":"i2i-editing","description":"I have a beautiful landscape image and I want to extend its canvas size in all directions while maintaining the same artistic style and atmosphere. The new areas should blend seamlessly with the original image and follow the same artistic pattern. Can you create a workflow that achieves this?","image":"","unique_id":"2e7970867f24319161de9a09504350d3","score":[0.5364670477191844,0.25]}]}],"message_id":"225cc1d8-10d9-44ae-bccd-007d4f3e88b2"}`,format:"markdown",finished:!0,name:"Assistant"}]},{type:"chat",tool:"workflow_rewrite",name:"修改当前工作流，检测并裁剪出图片中的猫",messages:[{id:"showcase1-9",role:"user",content:"修改当前工作流，检测并裁剪出图片中的猫",trace_id:"showcase1"},{id:"showcase1-10",role:"ai",content:`{"session_id":"62d2eed7-a9c2-4b34-b596-4a73b9ce6dad","text":"\\n▸ **Switching to Workflow Rewrite Agent**\\n\\nI'll help you rewrite the current workflow to add cat detection and cutout functionality. Let me first get the current workflow and then add the appropriate nodes for intelligent background removal.Now let me get the intelligent background removal experience to add cat detection and cutout functionality:Perfect! I'll rewrite your workflow to add intelligent cat detection and cutout functionality. I'll use the SAM (Segment Anything Model) with GroundingDINO for precise cat detection and segmentation.Perfect! I've successfully rewritten your workflow to add intelligent cat detection and cutout functionality. Here's what I've added:\\n\\n## New Features Added:\\n\\n### **Cat Detection & Segmentation System:**\\n1. **SAM Model Loader (Node 29)** - Loads the Segment Anything Model for precise segmentation\\n2. **GroundingDINO Model Loader (Node 30)** - Loads the object detection model for finding cats\\n3. **Cat Detection & Segmentation (Node 31)** - The main node that:\\n   - Detects cats in your generated image using the prompt \\"cat\\"\\n   - Uses a threshold of 0.3 for detection sensitivity\\n   - Automatically segments and cuts out the detected cat with precise boundaries\\n\\n### **Enhanced Output Options:**\\n1. **Save Original Image (Node 20)** - Saves your original generated image with prefix \\"ComfyUI_original\\"\\n2. **Save Cat Cutout (Node 32)** - Saves the extracted cat as a separate image with prefix \\"ComfyUI_cat_cutout\\"\\n3. **Preview Cat Cutout (Node 33)** - Shows a preview of the extracted cat in the interface\\n\\n## How It Works:\\n1. Your original workflow generates the cat image as before\\n2. The generated image is fed into the GroundingDINO + SAM pipeline\\n3. GroundingDINO detects the cat using natural language (\\"cat\\" prompt)\\n4. SAM performs precise segmentation to cut out the cat with clean edges\\n5. You get both the original image and the extracted cat as separate outputs\\n\\n## Model Requirements:\\n- **SAM Model**: \\"sam_vit_h (2.56GB)\\" - High-quality segmentation model\\n- **GroundingDINO**: \\"GroundingDINO_SwinT_OGC (694MB)\\" - Object detection model\\n\\nThe workflow will now automatically detect and cut out any cats in your generated images with high precision, giving you clean cutouts suitable for further use or editing!","finished":true,"type":"message","format":"markdown","ext":[{"type":"workflow_update","data":{"workflow_data":{"2":{"inputs":{"noise":["5",0],"guider":["7",0],"sampler":["4",0],"sigmas":["3",0],"latent_image":["10",0]},"class_type":"SamplerCustomAdvanced","_meta":{"title":"SamplerCustomAdvanced"}},"3":{"inputs":{"scheduler":"simple","steps":20,"denoise":1,"model":["8",0]},"class_type":"BasicScheduler","_meta":{"title":"BasicScheduler"}},"4":{"inputs":{"sampler_name":"euler"},"class_type":"KSamplerSelect","_meta":{"title":"KSamplerSelect"}},"5":{"inputs":{"noise_seed":571457442342604},"class_type":"RandomNoise","_meta":{"title":"RandomNoise"}},"6":{"inputs":{"clip_name1":"t5xxl_fp8_e4m3fn.safetensors","clip_name2":"clip_l.safetensors","type":"flux","device":"default"},"class_type":"DualCLIPLoader","_meta":{"title":"DualCLIPLoader"}},"7":{"inputs":{"model":["8",0],"conditioning":["11",0]},"class_type":"BasicGuider","_meta":{"title":"BasicGuider"}},"8":{"inputs":{"unet_name":"flux1-krea-dev.safetensors","weight_dtype":"fp8_e4m3fn"},"class_type":"UNETLoader","_meta":{"title":"Load Diffusion Model"}},"9":{"inputs":{"vae_name":"ae.safetensors"},"class_type":"VAELoader","_meta":{"title":"Load VAE"}},"10":{"inputs":{"width":["27",0],"height":["28",0],"batch_size":1},"class_type":"EmptyLatentImage","_meta":{"title":"Empty Latent Image"}},"11":{"inputs":{"text":["25",0],"clip":["6",0]},"class_type":"CLIPTextEncode","_meta":{"title":"CLIP Text Encode (Prompt)"}},"14":{"inputs":{"samples":["2",0],"vae":["9",0]},"class_type":"VAEDecode","_meta":{"title":"VAE Decode"}},"20":{"inputs":{"filename_prefix":"ComfyUI_original","images":["14",0]},"class_type":"SaveImage","_meta":{"title":"Save Original Image"}},"25":{"inputs":{"text":"a cat,simple background"},"class_type":"Text _O","_meta":{"title":"Text _O"}},"27":{"inputs":{"value":1024},"class_type":"easy int","_meta":{"title":"Int"}},"28":{"inputs":{"value":1400},"class_type":"easy int","_meta":{"title":"Int"}},"29":{"inputs":{"model_name":"sam_vit_h (2.56GB)"},"class_type":"SAMModelLoader (segment anything)","_meta":{"title":"SAM Model Loader"}},"30":{"inputs":{"model_name":"GroundingDINO_SwinT_OGC (694MB)"},"class_type":"GroundingDinoModelLoader (segment anything)","_meta":{"title":"GroundingDINO Model Loader"}},"31":{"inputs":{"prompt":"cat","threshold":0.3,"sam_model":["29",0],"grounding_dino_model":["30",0],"image":["14",0]},"class_type":"GroundingDinoSAMSegment (segment anything)","_meta":{"title":"Cat Detection & Segmentation"}},"32":{"inputs":{"filename_prefix":"ComfyUI_cat_cutout","images":["31",0]},"class_type":"SaveImage","_meta":{"title":"Save Cat Cutout"}},"33":{"inputs":{"images":["31",0]},"class_type":"PreviewImage","_meta":{"title":"Preview Cat Cutout"}}}}},{"type":"workflow_rewrite_checkpoint","data":{"checkpoint_id":21,"checkpoint_type":"workflow_rewrite_start"}}],"message_id":"b0ddb085-c47b-496a-9f63-ecb5f7afafe1"}`,format:"markdown",finished:!0,name:"Assistant"}]},{type:"chat",tool:"workflow_debug",name:"调试当前工作流",messages:[{id:"showcase1-11",role:"ai",content:'{"text":"Would you like me to help you debug the current workflow on the canvas?","ext":[{"type":"debug_start_checkpoint","data":{"checkpoint_id":2168,"checkpoint_type":"debug_start"}}]}',format:"debug_guide",name:"Assistant"},{id:"showcase1-12",role:"ai",content:'{"text":"▸ **Switching to ComfyUI-Debug-Coordinator**\\n\\nI\'ll validate and debug your ComfyUI workflow. Let me start by checking the current state of the workflow to identify any errors.\\n\\n⚙ *ComfyUI-Debug-Coordinator is using run_workflow...*\\n\\n\\n\\n● *Tool execution completed*\\n\\n```\\n{\\"success\\": false, \\"error\\": {\\"type\\": \\"prompt_outputs_failed_validation\\", \\"message\\": \\"Prompt outputs failed validation\\", \\"details\\": \\"\\", \\"extra_info\\": {}}, \\"node_errors\\": {\\"21\\": {\\"errors\\": [{\\"type\\": \\"re...\\n```\\n\\nI found an error in the workflow! There\'s a connection issue where node 21 (VAEDecode) is missing its required \\"samples\\" input. Let me analyze this error type to determine the best approach for fixing it.\\n\\n⚙ *ComfyUI-Debug-Coordinator is using analyze_error_type...*\\n\\n\\n\\n● *Tool execution completed*\\n\\n```\\n{\\"error_type\\": \\"connection_error\\", \\"recommended_agent\\": \\"link_agent\\", \\"error_details\\": [{\\"error_type\\": \\"connection_error\\", \\"message\\": \\"Detected 4 connection-related issues\\", \\"details\\": \\"Connection or ...\\n```\\n\\nThis is a connection error where the VAEDecode node is missing its required \\"samples\\" input connection. I\'ll hand this off to the Link Agent to fix the missing connection.\\n\\n▸ **Switching to Link Agent**\\n\\nPerfect! Now I\'m the Link Agent and will analyze and fix the connection issues in your workflow. Let me start by performing a comprehensive connection analysis.\\n\\n⚙ *Link Agent is using analyze_missing_connections...*\\n\\n\\n\\n● *Tool execution completed*\\n\\n```\\n{\\"missing_connections\\": [{\\"node_id\\": \\"7\\", \\"node_class\\": \\"KSampler\\", \\"input_name\\": \\"latent_image\\", \\"input_config\\": [\\"LATENT\\", {\\"tooltip\\": \\"The latent image to denoise.\\"}], \\"required\\": true, \\"expected_t...\\n```\\n\\n**Connection analysis:** Found 5 missing required connections across multiple nodes:\\n- Node 7 (KSampler): missing latent_image input \\n- Node 21 (VAEDecode): missing samples input\\n- Node 28 (ReduxAdvanced): missing conditioning, style_model, and image inputs\\n\\nAll missing connections can be resolved using existing nodes with high confidence matches available.\\n\\n**Chosen strategy:** Connect existing nodes - all required inputs have perfect type-compatible outputs available from existing nodes. This is a pure connection fix scenario with no new nodes needed.\\n\\nLet me apply the connection fixes using the optimal connection strategy:\\n\\n⚙ *Link Agent is using apply_connection_fixes...*\\n\\n\\n\\n● *Tool execution completed*\\n\\n```\\n{\\"success\\": true, \\"version_id\\": 2171, \\"applied_fixes\\": [{\\"type\\": \\"connection\\", \\"target\\": \\"7.latent_image\\", \\"source\\": \\"75[0]\\", \\"old_value\\": \\"not connected\\", \\"new_value\\": [\\"75\\", 0]}, {\\"type\\": \\"connectio...\\n```\\n\\n**Fixes applied:** Successfully connected all 5 missing required inputs:\\n- ✅ Connected EmptyLatentImage → KSampler (latent_image)\\n- ✅ Connected KSampler → VAEDecode (samples) \\n- ✅ Connected CLIPTextEncode → ReduxAdvanced (conditioning)\\n- ✅ Connected StyleModelLoader → ReduxAdvanced (style_model)\\n- ✅ Connected LoadImage → ReduxAdvanced (image)\\n\\nAll connections were established with high confidence type matches. The workflow now has a complete data flow from input nodes through processing to final output.\\n\\n▸ **Switching to ComfyUI-Debug-Coordinator**\\n\\nExcellent! The Link Agent has successfully fixed all the missing connections. Now let me validate the workflow again to confirm all issues have been resolved.\\n\\n⚙ *ComfyUI-Debug-Coordinator is using run_workflow...*\\n\\n\\n\\n● *Tool execution completed*\\n\\n```\\n{\\"success\\": false, \\"error\\": {\\"type\\": \\"prompt_outputs_failed_validation\\", \\"message\\": \\"Prompt outputs failed validation\\", \\"details\\": \\"\\", \\"extra_info\\": {}}, \\"node_errors\\": {\\"3\\": {\\"errors\\": [{\\"type\\": \\"val...\\n```\\n\\nGreat progress! The connection issues have been resolved, but now there\'s a parameter error. Node 3 (LoraLoader) has an invalid LoRA name that\'s not in the available list. Let me analyze this error type.\\n\\n⚙ *ComfyUI-Debug-Coordinator is using analyze_error_type...*\\n\\n\\n\\n● *Tool execution completed*\\n\\n```\\n{\\"error_type\\": \\"mixed_connection_error\\", \\"recommended_agent\\": \\"link_agent\\", \\"error_details\\": [{\\"error_type\\": \\"connection_error\\", \\"message\\": \\"Detected 3 connection-related issues\\", \\"details\\": \\"Connecti...\\n```\\n\\nThis is actually a parameter error (value_not_in_list), not a connection error. The analysis might be mixed up. Let me hand this off to the Parameter Agent to fix the invalid LoRA name.\\n\\n▸ **Switching to Parameter Agent**\\n\\nIssue identified: enum_value_mismatch - LoRA file \'flux/Flux_Ghibli_v2_25.safetensors\' not found in available LoRA list.\\n\\nLet me analyze this parameter error to find a suitable replacement:\\n\\n⚙ *Parameter Agent is using find_matching_parameter_value...*\\n\\n\\n\\n● *Tool execution completed*\\n\\n```\\n{\\"found_match\\": false, \\"error_type\\": \\"model_missing\\", \\"message\\": \\"Missing model file: flux/Flux_Ghibli_v2_25.safetensors\\", \\"recommendation\\": \\"Check for available model replacements, otherwise download...\\n```\\n\\nGreat! I can see the available LoRA list and found several Ghibli-style LoRAs. The requested \\"flux/Flux_Ghibli_v2_25.safetensors\\" is not available, but there are several similar Ghibli LoRAs in the FLUX folder. \\n\\nLooking at the available options, the closest matches are:\\n- \\"FLUX/Flux_Ghibli_people_v3_23.safetensors\\"\\n- \\"FLUX/Flux_Ghibli_v1_10.safetensors\\", \\"FLUX/Flux_Ghibli_v1_15.safetensors\\", \\"FLUX/Flux_Ghibli_v1_20.safetensors\\"\\n- \\"FLUX/Flux_Ghibli_v2_30.safetensors\\"\\n\\nThe \\"FLUX/Flux_Ghibli_v2_30.safetensors\\" seems like the best match since it\'s from the same v2 series and has a higher version number (30 vs 25).\\n\\n**Solution:** auto-fixed - Replacing with the most similar available Ghibli v2 version LoRA.\\n\\n⚙ *Parameter Agent is using update_workflow_parameter...*\\n\\n\\n\\n● *Tool execution completed*\\n\\n```\\n{\\"success\\": true, \\"answer\\": \\"Successfully updated lora_name from \'flux/Flux_Ghibli_v2_25.safetensors\' to \'FLUX/Flux_Ghibli_v2_30.safetensors\' in node 3\\", \\"node_id\\": \\"3\\", \\"parameter\\": \\"lora_name\\", \\"old...\\n```\\n\\n**Status:** Fixed - Successfully updated the LoRA from unavailable \'flux/Flux_Ghibli_v2_25.safetensors\' to the available \'FLUX/Flux_Ghibli_v2_30.safetensors\' which is a very similar Ghibli v2 style LoRA.\\n\\n▸ **Switching to ComfyUI-Debug-Coordinator**\\n\\nExcellent! The Parameter Agent has fixed the invalid LoRA name. Now let me validate the workflow again to check if all issues have been resolved.\\n\\n⚙ *ComfyUI-Debug-Coordinator is using run_workflow...*\\n\\n\\n\\n● *Tool execution completed*\\n\\n```\\n{\\"success\\": true, \\"prompt_id\\": \\"a028058b-4aab-4f9b-9d0d-48c12ace616b\\", \\"number\\": 3, \\"node_errors\\": {}}\\n```\\n\\n🎉 **Workflow Validation Complete - SUCCESS!**\\n\\nYour ComfyUI workflow has been successfully debugged and is now fully functional! Here\'s a summary of the issues that were fixed:\\n\\n## Issues Fixed:\\n\\n1. **Connection Issues (5 fixes via Link Agent):**\\n   - ✅ Connected EmptyLatentImage (75) → KSampler (7) latent_image input\\n   - ✅ Connected KSampler (7) → VAEDecode (21) samples input  \\n   - ✅ Connected CLIPTextEncode (8) → ReduxAdvanced (28) conditioning input\\n   - ✅ Connected StyleModelLoader (29) → ReduxAdvanced (28) style_model input\\n   - ✅ Connected LoadImage (6) → ReduxAdvanced (28) image input\\n\\n2. **Parameter Issue (1 fix via Parameter Agent):**\\n   - ✅ Updated invalid LoRA: `flux/Flux_Ghibli_v2_25.safetensors` → `FLUX/Flux_Ghibli_v2_30.safetensors`\\n\\n## Current Workflow Status:\\n- **Validation:** ✅ PASSED\\n- **Prompt ID:** a028058b-4aab-4f9b-9d0d-48c12ace616b\\n- **Node Errors:** None\\n- **Ready to Execute:** Yes\\n\\nYour workflow now has a complete data flow from input nodes through processing to final output, with all required connections established and valid parameters configured. The workflow is ready for execution!","ext":[{"type":"param_update","data":{"workflow_data":{"1":{"inputs":{"unet_name":"flux1-dev.safetensors","weight_dtype":"default"},"class_type":"UNETLoader","_meta":{"title":"Load Diffusion Model"}},"2":{"inputs":{"clip_name1":"clip_l.safetensors","clip_name2":"t5xxl_fp16.safetensors","type":"flux","device":"default"},"class_type":"DualCLIPLoader","_meta":{"title":"DualCLIPLoader"}},"3":{"inputs":{"lora_name":"FLUX/Flux_Ghibli_v2_30.safetensors","strength_model":0.8,"strength_clip":1,"model":["1",0],"clip":["2",0]},"class_type":"LoraLoader","_meta":{"title":"Load LoRA"}},"6":{"inputs":{"image":"狗-德国短毛指示犬-4.jpeg"},"class_type":"LoadImage","_meta":{"title":"Load Image"}},"7":{"inputs":{"seed":720601145747867,"steps":20,"cfg":1,"sampler_name":"euler","scheduler":"normal","denoise":1,"model":["3",0],"positive":["28",0],"negative":["9",0],"latent_image":["75",0]},"class_type":"KSampler","_meta":{"title":"KSampler"}},"8":{"inputs":{"text":"Ghibli style,illustration,graphic,2d,Rich colors","clip":["3",1]},"class_type":"CLIPTextEncode","_meta":{"title":"CLIP Text Encode (Prompt)"}},"9":{"inputs":{"text":"","clip":["3",1]},"class_type":"CLIPTextEncode","_meta":{"title":"CLIP Text Encode (Prompt)"}},"20":{"inputs":{"vae_name":"ae.safetensors"},"class_type":"VAELoader","_meta":{"title":"Load VAE"}},"21":{"inputs":{"vae":["20",0],"samples":["7",0]},"class_type":"VAEDecode","_meta":{"title":"VAE Decode"}},"28":{"inputs":{"downsampling_factor":1,"downsampling_function":"area","mode":"keep aspect ratio","weight":0.6,"autocrop_margin":0.1,"clip_vision":["30",0],"conditioning":["8",0],"style_model":["29",0],"image":["6",0]},"class_type":"ReduxAdvanced","_meta":{"title":"ReduxAdvanced"}},"29":{"inputs":{"style_model_name":"flux1-redux-dev.safetensors"},"class_type":"StyleModelLoader","_meta":{"title":"Load Style Model"}},"30":{"inputs":{"clip_name":"sigclip_vision_patch14_384.safetensors"},"class_type":"CLIPVisionLoader","_meta":{"title":"Load CLIP Vision"}},"75":{"inputs":{"width":768,"height":1344,"batch_size":1},"class_type":"EmptyLatentImage","_meta":{"title":"Empty Latent Image"}},"78":{"inputs":{"images":["21",0]},"class_type":"PreviewImage","_meta":{"title":"Preview Image"}}},"changes":[{"node_id":"3","parameter":"lora_name","old_value":"flux/Flux_Ghibli_v2_25.safetensors","new_value":"FLUX/Flux_Ghibli_v2_30.safetensors"}]}},{"type":"debug_complete","data":{"status":"completed","final_agent":"ComfyUI-Debug-Coordinator","events":[{"type":"agent_handoff","current_agent":"ComfyUI-Debug-Coordinator","to_agent":"ComfyUI-Debug-Coordinator","timestamp":46},{"type":"tool_call","tool":"run_workflow","agent":"ComfyUI-Debug-Coordinator","timestamp":233},{"type":"tool_result","output_preview":"{\\"success\\": false, \\"error\\": {\\"type\\": \\"prompt_outputs_failed_validation\\", \\"message\\": \\"Prompt outputs failed validation\\", \\"details\\": \\"\\", \\"extra_info\\": {}}, \\"node_errors\\": {\\"21\\": {\\"errors\\": [{\\"type\\": \\"re...","agent":"ComfyUI-Debug-Coordinator","timestamp":478},{"type":"tool_call","tool":"analyze_error_type","agent":"ComfyUI-Debug-Coordinator","timestamp":746},{"type":"tool_result","output_preview":"{\\"error_type\\": \\"connection_error\\", \\"recommended_agent\\": \\"link_agent\\", \\"error_details\\": [{\\"error_type\\": \\"connection_error\\", \\"message\\": \\"Detected 4 connection-related issues\\", \\"details\\": \\"Connection or ...","agent":"ComfyUI-Debug-Coordinator","timestamp":991},{"type":"agent_handoff","current_agent":"Link Agent","to_agent":"Link Agent","timestamp":1195},{"type":"tool_call","tool":"analyze_missing_connections","agent":"Link Agent","timestamp":1413},{"type":"tool_result","output_preview":"{\\"missing_connections\\": [{\\"node_id\\": \\"7\\", \\"node_class\\": \\"KSampler\\", \\"input_name\\": \\"latent_image\\", \\"input_config\\": [\\"LATENT\\", {\\"tooltip\\": \\"The latent image to denoise.\\"}], \\"required\\": true, \\"expected_t...","agent":"Link Agent","timestamp":1658},{"type":"tool_call","tool":"apply_connection_fixes","agent":"Link Agent","timestamp":2344},{"type":"tool_result","output_preview":"{\\"success\\": true, \\"version_id\\": 2171, \\"applied_fixes\\": [{\\"type\\": \\"connection\\", \\"target\\": \\"7.latent_image\\", \\"source\\": \\"75[0]\\", \\"old_value\\": \\"not connected\\", \\"new_value\\": [\\"75\\", 0]}, {\\"type\\": \\"connectio...","agent":"Link Agent","timestamp":2589},{"type":"agent_handoff","current_agent":"ComfyUI-Debug-Coordinator","to_agent":"ComfyUI-Debug-Coordinator","timestamp":3145},{"type":"tool_call","tool":"run_workflow","agent":"ComfyUI-Debug-Coordinator","timestamp":3361},{"type":"tool_result","output_preview":"{\\"success\\": false, \\"error\\": {\\"type\\": \\"prompt_outputs_failed_validation\\", \\"message\\": \\"Prompt outputs failed validation\\", \\"details\\": \\"\\", \\"extra_info\\": {}}, \\"node_errors\\": {\\"3\\": {\\"errors\\": [{\\"type\\": \\"val...","agent":"ComfyUI-Debug-Coordinator","timestamp":3606},{"type":"tool_call","tool":"analyze_error_type","agent":"ComfyUI-Debug-Coordinator","timestamp":3873},{"type":"tool_result","output_preview":"{\\"error_type\\": \\"mixed_connection_error\\", \\"recommended_agent\\": \\"link_agent\\", \\"error_details\\": [{\\"error_type\\": \\"connection_error\\", \\"message\\": \\"Detected 3 connection-related issues\\", \\"details\\": \\"Connecti...","agent":"ComfyUI-Debug-Coordinator","timestamp":4118},{"type":"agent_handoff","current_agent":"Parameter Agent","to_agent":"Parameter Agent","timestamp":4341},{"type":"tool_call","tool":"find_matching_parameter_value","agent":"Parameter Agent","timestamp":4595},{"type":"tool_result","output_preview":"{\\"found_match\\": false, \\"error_type\\": \\"model_missing\\", \\"message\\": \\"Missing model file: flux/Flux_Ghibli_v2_25.safetensors\\", \\"recommendation\\": \\"Check for available model replacements, otherwise download...","agent":"Parameter Agent","timestamp":4840},{"type":"tool_call","tool":"update_workflow_parameter","agent":"Parameter Agent","timestamp":5613},{"type":"tool_result","output_preview":"{\\"success\\": true, \\"answer\\": \\"Successfully updated lora_name from \'flux/Flux_Ghibli_v2_25.safetensors\' to \'FLUX/Flux_Ghibli_v2_30.safetensors\' in node 3\\", \\"node_id\\": \\"3\\", \\"parameter\\": \\"lora_name\\", \\"old...","agent":"Parameter Agent","timestamp":5858},{"type":"agent_handoff","current_agent":"ComfyUI-Debug-Coordinator","to_agent":"ComfyUI-Debug-Coordinator","timestamp":6109},{"type":"tool_call","tool":"run_workflow","agent":"ComfyUI-Debug-Coordinator","timestamp":6312},{"type":"tool_result","output_preview":"{\\"success\\": true, \\"prompt_id\\": \\"a028058b-4aab-4f9b-9d0d-48c12ace616b\\", \\"number\\": 3, \\"node_errors\\": {}}","agent":"ComfyUI-Debug-Coordinator","timestamp":6456}],"total_events":23}},{"type":"debug_checkpoint","data":{"checkpoint_id":2173,"checkpoint_type":"debug_complete"}},{"type":"debug_checkpoint","data":{"checkpoint_id":2174,"checkpoint_type":"debug_complete"}}]}',format:"markdown",name:"Assistant",finished:!0,debugGuide:!0}]},{type:"chat",tool:"node_recommend",name:"给我一个把多张图合并的节点",messages:[{id:"showcase2-1",role:"user",content:"给我一个把多张图合并的节点",trace_id:"showcase2"},{id:"showcase2-2",role:"ai",content:'{"session_id":"bbe71936-8402-4fd0-8bb4-69eecac5ee01","text":"以下是可以合并多张图片的节点：\\n\\n1. **MonoMerge**  \\n   [GitHub链接](https://github.com/bmad4ever/comfyui_bmad_nodes): 将两张图片合并为单色图片，可选择在白色或黑色方向合并。\\n\\n2. **Concat Images (mtb)**  \\n   [GitHub链接](https://github.com/melMass/comfy_mtb): 可将多张图片合并成一个批次，适用于处理和操控图片集。\\n\\n3. **JoinImageBatch**  \\n   [GitHub链接](https://github.com/yolain/ComfyUI-Easy-Use): 合并批量图片成一张大图，支持水平或垂直拼接。\\n\\n4. **MergeLayers**  \\n   [GitHub链接](https://github.com/shadowcz007/comfyui-mixlab-nodes): 将多层图像合并为单张图片，支持指定的遮罩和混合选项。\\n\\n5. **Composite Images 🧅**  \\n   [GitHub链接](https://github.com/natto-maki/ComfyUI-NegiTools): 结合两张图片，支持多种复合方法，如乘法、划分、叠加等。\\n\\n6. **ImageContainerInheritanceSum**  \\n   [GitHub链接](https://github.com/Nourepide/ComfyUI-Allor): 通过总结图像维度以创建复合图像，适用于需要考虑输入图像总宽和高的情况。\\n\\n7. **Join Image Lists**  \\n   [GitHub链接](https://github.com/M1kep/Comfy_KepListStuff): 合并多张图片列表成为一个列表，同时提供原列表大小。\\n\\n8. **Merge Image List**  \\n   [GitHub链接](https://github.com/AInseven/ComfyUI-fastblend): 合并图像张量列表为一个单一张量，便于图像相关任务的批处理。\\n\\n根据你的具体需求选择合适的节点使用。","finished":true,"format":"markdown","ext":[{"type":"node","data":[{"id":28311,"unique_id":"7cca1314298b9a9d4b785e009099ea28","name":"MonoMerge","name_oral":"MonoMerge","description":"The MonoMerge node is designed to merge two images into a monochromatic image based on a target color scheme (either towards white or black). This process involves comparing the luminance (L component) of corresponding pixels from both images and selecting the higher or lower value depending on the target, resulting in an image that emphasizes either the lighter or darker aspects of the combined images.","github_url":"https://github.com/bmad4ever/comfyui_bmad_nodes","github_stars":50,"from_index":0,"to_index":0,"is_existed":true},{"id":29658,"unique_id":"e3a2782874d3bf8f99bb2b70c7090f74","name":"Concat Images (mtb)","name_oral":"Concat Images (mtb)","description":"The Concat Images node is designed to merge multiple images into a single batch, allowing for efficient processing and manipulation of image collections. It provides flexibility in handling size mismatches through customizable strategies.","github_url":"https://github.com/melMass/comfy_mtb","github_stars":350,"from_index":0,"to_index":0,"is_existed":true},{"id":29719,"unique_id":"458e445b2f21e81111dc9a7d3fb8cb7b","name":"easy joinImageBatch","name_oral":"JoinImageBatch","description":"This node is designed to merge a batch of images into a single large image, either by stacking them horizontally or vertically based on the specified mode. It abstracts the complexity of image manipulation and resizing, providing a straightforward way to create composite images from multiple inputs.","github_url":"https://github.com/yolain/ComfyUI-Easy-Use","github_stars":510,"from_index":0,"to_index":0,"is_existed":true},{"id":32325,"unique_id":"0ea3707eaaf8052e37630f95f4e5b72b","name":"MergeLayers","name_oral":"Merge Layers ♾️Mixlab","description":"The MergeLayers node is designed to combine multiple image layers into a single image while applying specified masks and blending options. It facilitates the creation of complex images by layering and compositing various elements based on their defined properties.","github_url":"https://github.com/shadowcz007/comfyui-mixlab-nodes","github_stars":null,"from_index":0,"to_index":0,"is_existed":true},{"id":32571,"unique_id":"0bd39afd25f012f877c9676b3c9837a1","name":"NegiTools_CompositeImages","name_oral":"Composite Images 🧅","description":"NegiTools_CompositeImages is a versatile node designed to combine two images using various compositing methods. This node allows you to blend images in multiple ways, such as multiplying, dividing, overlaying, and more, to achieve different visual effects.","github_url":"https://github.com/natto-maki/ComfyUI-NegiTools","github_stars":30,"from_index":0,"to_index":0,"is_existed":true},{"id":32865,"unique_id":"4e6b0fa27366545e19695c4e8931e270","name":"ImageContainerInheritanceSum","name_oral":"ImageContainerInheritanceSum","description":"Efficiently combine and sum image dimensions for creating composite images with integrity and visual quality. This node is designed to facilitate the combination of multiple images by summing their dimensions. This node is particularly useful when you need to create a composite image that encompasses the total width and height of the input images.","github_url":"https://github.com/Nourepide/ComfyUI-Allor","github_stars":200,"from_index":0,"to_index":0,"is_existed":true},{"id":72827,"unique_id":"1c76ce5bcc2c5097bdf515bddd32fb0b","name":"Join Image Lists","name_oral":"Join Image Lists","description":"This node is designed to combine multiple lists of images into a single list while also providing the sizes of the original lists. It facilitates the management of image data by allowing users to easily merge and track the number of images from various sources.","github_url":"https://github.com/M1kep/Comfy_KepListStuff","github_stars":null,"from_index":0,"to_index":0,"is_existed":true},{"id":81206,"unique_id":"1cc97ed3bc709de3f23c378eef1ce74e","name":"Merge_Image_List","name_oral":"Merge Image List","description":"This node is designed to merge a list of image tensors into a single tensor, facilitating batch processing in image-related tasks. It efficiently concatenates the input images along a specified dimension, enabling seamless integration of multiple images for further processing.","github_url":"https://github.com/AInseven/ComfyUI-fastblend","github_stars":null,"from_index":0,"to_index":0,"is_existed":true}]}],"message_id":"f60c3cf2-0b54-47a3-97e3-f536fc992c81"}',format:"markdown",finished:!0,name:"Assistant"}]},{type:"chat",tool:"model_recommend",name:"给我一个宫崎骏风格的lora",messages:[{id:"showcase3-1",role:"user",content:"给我一个宫崎骏风格的lora",trace_id:"showcase3"},{id:"showcase3-2",role:"ai",content:'{"session_id":"0b26efaf-e417-4344-9942-658fedbbc12c","text":"请问您需要基于哪种基座模型的宫崎骏风格LORA？可选择以下基座模型：\\n\\n1. Stable Diffusion v1.5\\n2. Illustrious\\n3. Pony\\n4. Flux.1\\n5. Flux.1 D\\n6. Stable Diffusion XL 1.0","finished":true,"format":"markdown","ext":[{"type":"guides","data":["Stable Diffusion v1.5","Illustrious","Pony","Flux.1","Flux.1 D","Stable Diffusion XL 1.0"]}],"message_id":"cfecdc29-5131-4afa-9807-9fe911e6b670"}',format:"markdown",finished:!0,name:"Assistant"},{id:"showcase3-3",role:"user",content:"Flux.1",trace_id:"showcase3"},{id:"showcase3-4",role:"ai",content:`{"session_id":"0b26efaf-e417-4344-9942-658fedbbc12c","text":"以下是几个基于Flux.1的宫崎骏风格LORA模型：\\n\\n1. **宫崎骏风格插画**  \\n   - 描述：此模型擅长创作灵感来自宫崎骏风格的插图，展示奇幻、细致的风景和幻想元素。它强调丰富的质感、鲜艳的色彩和复杂的自然环境，擅长营造充满生机和暖意的场景，以讲述具有特色的宫崎骏风格的故事。  \\n   - [获取链接](https://www.liblib.art/modelinfo/51b6a44f87b543a6b21dfbadc2952313)  \\n\\n2. **宫崎骏的现实主义**  \\n   - 描述：模型擅长生成吉卜力风格的梦幻景观，展现葱郁的绿地、鲜亮的蓝色以及自然与建筑之间的和谐融合。它捕捉梦幻般的场景，具有柔和的幻想氛围，体现出在宁静森林和空中城堡间的魔幻现实主义。  \\n   - ![示例图片1](https://aib-data-sg.oss-ap-southeast-1.aliyuncs.com/ext-img/comuify/liblib||505b51e94736455c9d78ebe38afc3148||20d56a93ad9fd5daeaf043453766b60d.jpg)  \\n   - ![示例图片2](https://aib-data-sg.oss-ap-southeast-1.aliyuncs.com/ext-img/comuify/liblib||505b51e94736455c9d78ebe38afc3148||4fca763050d3e8941193b4230e8e7410.jpg)  \\n   - [获取链接](https://www.liblib.art/modelinfo/c2ea3eebba764e388a3f08c2ca6eed3a)  \\n\\n3. **F.1-宫崎骏风格**  \\n   - 描述：模型擅长生成宫崎骏影响下的动漫风格图像，呈现鲜艳的色彩、富有想象力的构图和生动的表现。专注于生成年轻女孩在各种迷人环境中的场景，擅长渲染云的细节纹理和复杂的光影。 \\n   - [获取链接](https://www.liblib.art/modelinfo/5638cc813c264f899b43536e02abfc82)  \\n\\n您可以选择一个适合您需求的模型进行使用。","finished":true,"format":"markdown","ext":[{"type":"model","data":[{"id":375989,"name":"宫崎骏风格插画","description":"This model excels in creating illustrations inspired by Miyazaki's style, featuring whimsical, detailed landscapes and fantastical elements. It consistently captures scenes brimming with life and warmth, emphasizing lush textures, vibrant colors, and intricate natural settings. This model is adept at generating compositions that convey a sense of wonder and storytelling in a distinctively Miyazaki fashion.","model_type":"LORA","model_algorithm":"Flux.1","model_pics":[],"source_url":"https://www.liblib.art/modelinfo/51b6a44f87b543a6b21dfbadc2952313","unique_id":"c3123b5ab427eebeaae884a3f1fe10cc"},{"id":378349,"name":"宫崎骏的现实主义","description":"The model excels in generating whimsical, serene landscapes with a Ghibli-inspired aesthetic, featuring lush greenery, vibrant blues, and harmonious nature-architecture integration. It captures dreamy sceneries with a soft, fantasy-like ambiance, demonstrating strengths in depicting tranquil forests, ethereal sky castles, and interactions between natural and man-made elements with a magical realism touch.","model_type":"LORA","model_algorithm":"Flux.1","model_pics":["https://aib-data-sg.oss-ap-southeast-1.aliyuncs.com/ext-img/comuify/liblib||505b51e94736455c9d78ebe38afc3148||20d56a93ad9fd5daeaf043453766b60d.jpg","https://aib-data-sg.oss-ap-southeast-1.aliyuncs.com/ext-img/comuify/liblib||505b51e94736455c9d78ebe38afc3148||4fca763050d3e8941193b4230e8e7410.jpg","https://aib-data-sg.oss-ap-southeast-1.aliyuncs.com/ext-img/comuify/liblib||505b51e94736455c9d78ebe38afc3148||b782cc39b8d159cb2c52fbb31b0c51b8.jpg","https://aib-data-sg.oss-ap-southeast-1.aliyuncs.com/ext-img/comuify/liblib||505b51e94736455c9d78ebe38afc3148||cddb9c4648639e78805dd2c088f3f039.jpg","https://aib-data-sg.oss-ap-southeast-1.aliyuncs.com/ext-img/comuify/liblib||505b51e94736455c9d78ebe38afc3148||ef8b418d2ad9c6092c14c17e4aa1b051.jpg"],"source_url":"https://www.liblib.art/modelinfo/c2ea3eebba764e388a3f08c2ca6eed3a","unique_id":"256ec6894dd15b42eb60c91fde22b61b"},{"id":385880,"name":"F.1-宫崎骏风格","description":"The model excels in generating whimsical anime-style images influenced by Miyazaki's distinct aesthetic, characterized by vibrant colors, playful compositions, and lively expressions. It specializes in scenes featuring young girls in varied enchanting settings, demonstrating strong skills in rendering detailed textures like clouds and intricate lighting. Notably adept at creating charming and imaginative animated environments.","model_type":"LORA","model_algorithm":"Flux.1","model_pics":[],"source_url":"https://www.liblib.art/modelinfo/5638cc813c264f899b43536e02abfc82","unique_id":"cbcbc993133822bccd46f16d49f5a4db"}]}],"message_id":"6903403f-cd32-447e-a9a6-a9247ab77c15"}`,format:"markdown",finished:!0,name:"Assistant"}]},{type:"chat",tool:"prompt",name:"基于我的描述生成prompt",messages:[{id:"showcase4-1",role:"user",content:'请为我生成英文prompt: "一个红衣女子在海边跳舞，笑容很灿烂"',trace_id:"showcase4"},{id:"showcase4-2",role:"ai",content:'{"session_id":"6272c460-04da-4b30-9090-1c05406f46e3","text":"woman in a red dress dancing by the seaside, bright smile, high quality, cinematic lighting, detailed, realistic, wide shot","finished":true,"format":"markdown","ext":null,"message_id":"13f0a58e-8670-4457-97da-cbad7a7d7530"}',format:"markdown",finished:!0,name:"Assistant"}]},{type:"genlab",tool:"genlab_prompt",name:"根据我的诉求生成3个prompt，各自生图查看效果",messages:[{id:"showcase5-1",role:"user",content:"根据我的诉求生成3个prompt，各自生图查看效果",trace_id:"showcase5"},{id:"showcase5-2",role:"ai",content:'{"text":"请根据下面的演示，使用Genlab来实现您的调试prompt的诉求。\\n ![](https://aib-vision-hz.oss-accelerate.aliyuncs.com/mood_board%2Finput%2F2025-07-16%2Fab89513606fd4966b0362f95f3f1ab86.gif?OSSAccessKeyId=LTAI5tQyhnsJhtiinV3B1gfV&Expires=2068018398&Signature=3XUgadQjjsGRu46S1fRxA7iDWJU%3D)"}',format:"markdown",finished:!0,name:"Assistant"}]}],Fl=[{type:"chat",tool:"workflow_generate",name:"Give me a workflow to create a short video clip based on ltx",messages:[{id:"showcase1-3",role:"user",content:"Give me a workflow to create a short video clip based on ltx",trace_id:"showcase1"},{id:"showcase1-4",role:"ai",content:`{"session_id":"611f8fda-e441-4e87-9fe3-59f51c29e910","text":"\\n\\n🔄 **Switching to ComfyUI-Copilot**\\n\\n### Workflow Recommendations for Creating Short Video Clips from LTX\\n\\nHere are some workflow options to help you create short video clips based on \\"ltx\\":\\n\\n#### 1. Recalled Workflows\\n\\nBased on your request, I found these existing workflows that might be helpful:\\n\\n*   **api-t2i2v-txt\\\\_to\\\\_image\\\\_to\\\\_video**\\n    *   **Description:** Creates a short animated video clip from a text description of a nature scene.\\n    *   **Use Case:** Ideal if your \\"ltx\\" content can be translated into a text description of a scene you want to animate.\\n    *   **Image:** ![api-t2i2v-txt\\\\_to\\\\_image\\\\_to\\\\_video](https://aib-vision-hz.oss-accelerate.aliyuncs.com/mood_board%2Finput%2F2025-07-30%2F5cdab63527824cfc80749127cb0b15ee.png?x-oss-process=style%2Fresize&OSSAccessKeyId=LTAI5tQyhnsJhtiinV3B1gfV&Expires=2069225390&Signature=T%2B9URvbgI7KPB4%2Ft9CSe3zBLHtA%3D)\\n\\n*   **sdxl-t2i2v-api**\\n    *   **Description:** Creates a short animated video clip based on your text description.\\n    *   **Use Case:** Similar to the above, this workflow is good for generating smooth, high-quality animations from text prompts.\\n    *   **Image:** ![sdxl-t2i2v-api](https://aib-vision-hz.oss-accelerate.aliyuncs.com/mood_board%2Finput%2F2025-07-30%2Ff1fd0f203429423ca3e334701736b1f5.png?x-oss-process=style%2Fresize&OSSAccessKeyId=LTAI5tQyhnsJhtiinV3B1gfV&Expires=2069225261&Signature=8pSHmG2Yl%2FTpkxy9SVjjVk5M7RA%3D)\\n\\n*   **api-t2v\\\\_ltxv\\\\_text\\\\_to\\\\_video**\\n    *   **Description:** Creates a short animated video clip (about 4 seconds) from text, with a focus on natural and fluid movement. This workflow specifically mentions \\"ltxv\\".\\n    *   **Use Case:** This workflow seems highly relevant as it explicitly includes \\"ltxv\\" in its description, suggesting it might be directly applicable to your \\"ltx\\" content.\\n    *   **Image:** ![api-t2v\\\\_ltxv\\\\_text\\\\_to\\\\_video](https://aib-vision-hz.oss-accelerate.aliyuncs.com/mood_board%2Finput%2F2025-06-26%2F2f5343c2b19c4afba48b8f9079ed736d.png?x-oss-process=style%2Fresize&OSSAccessKeyId=LTAI5tQyhnsJhtiinV3B1gfV&Expires=2066264124&Signature=w1X1XSG3Pxay02KBI3twT%2B3xEpQ%3D)\\n\\n#### 2. AI Generated Workflow\\n\\nI have also generated a new personalized workflow solution for you:\\n\\n*   **AI Generated Workflow**\\n    *   **Description:** Build a workflow that creates a short video clip based on 'ltx' content.\\n    *   **Use Case:** This is a custom-generated workflow tailored to your specific request.\\n    *   **Image:** ![AI Generated Workflow](https://ppc-img.oss-ap-southeast-1.aliyuncs.com/AI_workflow_default.jpg)\\n\\nPlease let me know if you have any questions about these workflows or would like further adjustments!","finished":true,"type":"message","format":"markdown","ext":[{"type":"workflow","data":[{"id":31809,"name":"AI Generated Workflow","description":"Build a workflow that creates a short video clip based on 'ltx' content.","image":"https://ppc-img.oss-ap-southeast-1.aliyuncs.com/AI_workflow_default.jpg","unique_id":"4d7e074f326a544bfcba0daf615ae220","score":null,"source":"AI Generated"},{"id":26740,"name":"api-t2i2v-txt_to_image_to_video","description":"Create a short animated video clip from a text description of a nature scene. I want to describe a beautiful landscape and have it turned into a flowing video with natural movement, like clouds drifting or water flowing, without needing to provide any reference video or images.","image":"https://aib-vision-hz.oss-accelerate.aliyuncs.com/mood_board%2Finput%2F2025-07-30%2F5cdab63527824cfc80749127cb0b15ee.png?x-oss-process=style%2Fresize&OSSAccessKeyId=LTAI5tQyhnsJhtiinV3B1gfV&Expires=2069225390&Signature=T%2B9URvbgI7KPB4%2Ft9CSe3zBLHtA%3D","unique_id":"554fd2c996083c5b9525051d49a6b2f5","score":[0.5690833843847055,0.5]},{"id":26745,"name":"sdxl-t2i2v-api","description":"Create a short animated video clip based on my text description. I want to be able to type in what I want to see (like \\"a cute dog running on the beach\\"), and get back a smooth, high-quality animation that brings my description to life. The video should be a few seconds long and loop seamlessly.","image":"https://aib-vision-hz.oss-accelerate.aliyuncs.com/mood_board%2Finput%2F2025-07-30%2Ff1fd0f203429423ca3e334701736b1f5.png?x-oss-process=style%2Fresize&OSSAccessKeyId=LTAI5tQyhnsJhtiinV3B1gfV&Expires=2069225261&Signature=8pSHmG2Yl%2FTpkxy9SVjjVk5M7RA%3D","unique_id":"ef568bd54974e83122c8ac59ba02c8c2","score":[0.616972625255589,0.5]},{"id":26831,"name":"api-t2v_ltxv_text_to_video","description":"Create a short animated video clip (about 4 seconds) showing two women having a conversation, where one has brown hair wearing a black jacket and the other has blonde hair. Make sure the video looks natural and fluid, focusing on the brown-haired woman's face with warm sunset lighting.","image":"https://aib-vision-hz.oss-accelerate.aliyuncs.com/mood_board%2Finput%2F2025-06-26%2F2f5343c2b19c4afba48b8f9079ed736d.png?x-oss-process=style%2Fresize&OSSAccessKeyId=LTAI5tQyhnsJhtiinV3B1gfV&Expires=2066264124&Signature=w1X1XSG3Pxay02KBI3twT%2B3xEpQ%3D","unique_id":"6fc80d5671a79696ddff0db0bd39ee02","score":[0.589295913064967,1]}]}],"message_id":"3cd1418e-e57c-4c01-9005-93365b0acc70"}`,format:"markdown",finished:!0,name:"Assistant"}]},{type:"chat",tool:"workflow_generate",name:"Give me a workflow that can turn the image into anime style",messages:[{id:"showcase1-5",role:"user",content:"give me a workflow that can turn the image into anime style",trace_id:"showcase1"},{id:"showcase1-6",role:"ai",content:`{"session_id":"fd931296-4337-4f1a-bd23-27b3a17caf07","text":"\\n\\n🔄 **Switching to ComfyUI-Copilot**\\n\\n### Image to Anime Style Workflows\\n\\nHere are some workflow options to transform your images into an anime style:\\n\\n#### Recalled Workflows\\n\\n1.  **api-i2i_image2image**\\n    *   **Description:** This workflow is designed to modify portrait photos to add anime-style features like furry ears while preserving most of the original facial features. It aims for a clean final image without watermarks or text overlays.\\n    *   **Image:** ![api-i2i_image2image](https://aib-vision-hz.oss-accelerate.aliyuncs.com/mood_board%2Finput%2F2025-07-30%2Fcc02e225a2eb4468bbbb588af597b2aa.png?x-oss-process=style%2Fresize&OSSAccessKeyId=LTAI5tQyhnsJhtiinV3B1gfV&Expires=2069223989&Signature=TjszfM%2FgbSWnsgLzRvaah9B7SQE%3D)\\n\\n2.  **api-i2i_flux_canny_model_example**\\n    *   **Description:** This workflow focuses on transforming portrait photos into anime-style characters while maintaining the basic pose and composition of the original photo. It can incorporate specific anime features such as fennec ears, a fluffy tail, blonde hair, and blue eyes, with characters wearing casual clothes. The goal is a high-quality anime illustration.\\n    *   **Image:** ![api-i2i_flux_canny_model_example](https://aib-vision-hz.oss-accelerate.aliyuncs.com/mood_board%2Finput%2F2025-07-30%2Fb97fb825b2f843f086079dc0b3cf4993.png?x-oss-process=style%2Fresize&OSSAccessKeyId=LTAI5tQyhnsJhtiinV3B1gfV&Expires=2069224074&Signature=5DXU4qpuEcMbimfInVQcsTcwDIU%3D)\\n\\n3.  **api-i2v_image_to_video_wan**\\n    *   **Description:** While primarily for animation, this workflow involves an initial image of an anime character and can be used to create movement from a still anime image. This might be relevant if you later want to animate the anime-styled output.\\n    *   **Image:** ![api-i2v_image_to_video_wan](https://aib-vision-hz.oss-accelerate.aliyuncs.com/mood_board%2Finput%2F2025-07-30%2Fa1369bd4f3304e4f9cf5f7e0cb427733.png?x-oss-process=style%2Fresize&OSSAccessKeyId=LTAI5tQyhnsJhtiinV3B1gfV&Expires=2069225510&Signature=SHsULg0tYRJlw6riGKwrKBJgVAs%3D)\\n\\n#### AI Generated Workflow\\n\\n*   **Name:** AI Generated Workflow\\n*   **Description:** This custom workflow is designed to transform an input image into an anime art style, effectively preserving key features from the original image while applying characteristic anime aesthetics.\\n*   **Image:** ![AI Generated Workflow](https://ppc-img.oss-ap-southeast-1.aliyuncs.com/AI_workflow_default.jpg)\\n\\nYou can choose one of the recommended workflows above, or explore the AI-generated solution. If you have any further questions about these workflows, feel free to ask!","finished":true,"type":"message","format":"markdown","ext":[{"type":"workflow","data":[{"id":31813,"name":"AI Generated Workflow","description":"Build a workflow that transforms an input image into an anime art style, preserving key features while applying anime aesthetics.","image":"https://ppc-img.oss-ap-southeast-1.aliyuncs.com/AI_workflow_default.jpg","unique_id":"578e2c1ebc888b09319bfc7310dd3b02","score":null,"source":"AI Generated"},{"id":26711,"name":"api-i2i_image2image","description":"I want to modify my portrait photo to add anime-style features like furry ears while keeping most of my original facial features intact. The final image should look clean without any watermarks or text overlays.","image":"https://aib-vision-hz.oss-accelerate.aliyuncs.com/mood_board%2Finput%2F2025-07-30%2Fcc02e225a2eb4468bbbb588af597b2aa.png?x-oss-process=style%2Fresize&OSSAccessKeyId=LTAI5tQyhnsJhtiinV3B1gfV&Expires=2069223989&Signature=TjszfM%2FgbSWnsgLzRvaah9B7SQE%3D","unique_id":"7326dc2eb7014aea9bb8853293f1261b","score":[0.5843760618939373,0.5]},{"id":26819,"name":"api-i2i_flux_canny_model_example","description":"I want to transform my portrait photos into anime-style characters while keeping the basic pose and composition of the original photo. The anime character should have specific features like fennec ears and a fluffy tail, with blonde hair and blue eyes, wearing casual clothes. The final result should look like a high-quality anime illustration.","image":"https://aib-vision-hz.oss-accelerate.aliyuncs.com/mood_board%2Finput%2F2025-07-30%2Fb97fb825b2f843f086079dc0b3cf4993.png?x-oss-process=style%2Fresize&OSSAccessKeyId=LTAI5tQyhnsJhtiinV3B1gfV&Expires=2069224074&Signature=5DXU4qpuEcMbimfInVQcsTcwDIU%3D","unique_id":"8e456b0c483b5eb64b4aac78bd5cd4be","score":[0.6201659297745311,0.5]},{"id":26822,"name":"api-i2v_image_to_video_wan","description":"I have a still image of an anime character and I want to create a short animation where the character smoothly turns around. The animation should maintain the character's original style and details while adding natural movement. Can you create a workflow that can do this automatically?","image":"https://aib-vision-hz.oss-accelerate.aliyuncs.com/mood_board%2Finput%2F2025-07-30%2Fa1369bd4f3304e4f9cf5f7e0cb427733.png?x-oss-process=style%2Fresize&OSSAccessKeyId=LTAI5tQyhnsJhtiinV3B1gfV&Expires=2069225510&Signature=SHsULg0tYRJlw6riGKwrKBJgVAs%3D","unique_id":"0ed3d66aea19873488df2b6821dcf7f0","score":[0.632876618757651,0.5]}]}],"message_id":"8895ed9c-f188-4bdb-9646-13b0ec909aa2"}`,format:"markdown",finished:!0,name:"Assistant"}]},{type:"chat",tool:"workflow_generate",name:"Give me a workflow for image editing",messages:[{id:"showcase1-7",role:"user",content:"give me a workflow for image editing",trace_id:"showcase1"},{id:"showcase1-8",role:"ai",content:`{"session_id":"bb570efe-14c4-4bde-b595-593026375d5f","text":"\\n\\n🔄 **Switching to ComfyUI-Copilot**\\n\\n### Image Editing Workflows\\n\\nHere are some workflow options for image editing, including both recalled and newly generated solutions:\\n\\n#### **Recalled Workflows**\\n\\nBased on your request, I've found a few relevant workflows that handle various image editing tasks:\\n\\n1.  **image-edit-api (1)**\\n    *   **Description:** This workflow allows you to modify photos using text descriptions. For example, you can change hair color or add specific features while preserving the natural look and original composition of the image. It takes your photo and a text description of the desired changes as input.\\n*   **Image:** ![image-edit-api1](https://aib-vision-hz.oss-accelerate.aliyuncs.com/mood_board%2Finput%2F2025-07-30%2F6475427cb093410fbe86ddecead83082.png?x-oss-process=style%2Fresize&OSSAccessKeyId=LTAI5tQyhnsJhtiinV3B1gfV&Expires=2069224145&Signature=ZTw8WXVW3aB7LRStH6RhwqtywsM%3D)   \\n\\n2.  **image-edit-api**\\n    *   **Description:** This workflow is designed for modifying photos of people. You can add specific objects or change expressions while maintaining the person's identity and overall appearance. For instance, you could make someone smile more or add a coffee cup they're holding, with the changes blending in seamlessly. \\n*   **Image:** ![image-edit-api](https://aib-vision-hz.oss-accelerate.aliyuncs.com/mood_board%2Finput%2F2025-07-30%2F31914a4fe5f448ea8ab4e677f26b536a.png?x-oss-process=style%2Fresize&OSSAccessKeyId=LTAI5tQyhnsJhtiinV3B1gfV&Expires=2069224230&Signature=AqBT3em4CKJE7jZNHXvyrvHZOik%3D) \\n\\n3.  **i2i-editing**\\n    *   **Description:** If you have a landscape image and want to extend its canvas size in any direction, this workflow can help. It maintains the original artistic style and atmosphere, ensuring the new areas blend seamlessly with the existing image.\\n*   **Image:** ![i2i-editing](https://aib-vision-hz.oss-accelerate.aliyuncs.com/mood_board%2Finput%2F2025-07-30%2Ff4d1ff5492ef43fdb57d3b3d8976bba1.png?x-oss-process=style%2Fresize&OSSAccessKeyId=LTAI5tQyhnsJhtiinV3B1gfV&Expires=2069224308&Signature=i8uqKJcqBgNGPq3uXS8PD%2BS8UF8%3D)  \\n\\n#### **AI Generated Workflow**\\n\\nI've also generated a new, personalized workflow solution for general image editing:\\n\\n1.  **AI Generated Workflow**\\n    *   **Description:** This workflow is designed to perform general image editing operations, including resizing, cropping, and color correction. It provides a versatile solution for common image manipulation needs.\\n\\nYou can choose one of the recommended workflows above, or let AI generate a personalized solution based on your input. If you have any specific questions about any of these workflows, feel free to ask!","finished":true,"type":"message","format":"markdown","ext":[{"type":"workflow","data":[{"id":31815,"name":"AI Generated Workflow","description":"Build a workflow that allows for general image editing, including operations like resizing, cropping, and color correction.","image":"https://ppc-img.oss-ap-southeast-1.aliyuncs.com/AI_workflow_default.jpg","unique_id":"6f7faac37e32285a935b8699ecc70c15","score":null,"source":"AI Generated"},{"id":26728,"name":"image-edit-api (1)","description":"I want to modify my photos by describing the changes I want in plain text. For example, I want to be able to change hair color or add specific features while keeping the rest of the image looking natural and maintaining the original composition. The workflow should take my photo and a text description of the desired changes as input, and produce a modified version of my photo that incorporates these changes.","image":"https://aib-vision-hz.oss-accelerate.aliyuncs.com/mood_board%2Finput%2F2025-07-30%2F6475427cb093410fbe86ddecead83082.png?x-oss-process=style%2Fresize&OSSAccessKeyId=LTAI5tQyhnsJhtiinV3B1gfV&Expires=2069224145&Signature=ZTw8WXVW3aB7LRStH6RhwqtywsM%3D","unique_id":"7c9029b78952b52475f5a77d3b5dd781","score":[0.6382076740264893,0]},{"id":26733,"name":"image-edit-api","description":"I have a photo of a person, and I'd like to modify it to add specific objects or change their expression while keeping their identity and overall appearance intact. For example, I want to make them smile more and add objects they're holding, like a coffee cup. The changes should look natural and seamless.","image":"https://aib-vision-hz.oss-accelerate.aliyuncs.com/mood_board%2Finput%2F2025-07-30%2F31914a4fe5f448ea8ab4e677f26b536a.png?x-oss-process=style%2Fresize&OSSAccessKeyId=LTAI5tQyhnsJhtiinV3B1gfV&Expires=2069224230&Signature=AqBT3em4CKJE7jZNHXvyrvHZOik%3D","unique_id":"4080a7a9b33783892cf3cf4fed1755de","score":[0.5695966821668564,0]},{"id":26776,"name":"i2i-editing","description":"I have a beautiful landscape image and I want to extend its canvas size in all directions while maintaining the same artistic style and atmosphere. The new areas should blend seamlessly with the original image and follow the same artistic pattern. Can you create a workflow that achieves this?","image":"https://aib-vision-hz.oss-accelerate.aliyuncs.com/mood_board%2Finput%2F2025-07-30%2Ff4d1ff5492ef43fdb57d3b3d8976bba1.png?x-oss-process=style%2Fresize&OSSAccessKeyId=LTAI5tQyhnsJhtiinV3B1gfV&Expires=2069224308&Signature=i8uqKJcqBgNGPq3uXS8PD%2BS8UF8%3D","unique_id":"2e7970867f24319161de9a09504350d3","score":[0.5364670477191844,0.25]}]}],"message_id":"225cc1d8-10d9-44ae-bccd-007d4f3e88b2"}`,format:"markdown",finished:!0,name:"Assistant"}]},{type:"chat",tool:"workflow_rewrite",name:"rewrite current workflow, cut out the cat in my output image",messages:[{id:"showcase1-9",role:"user",content:"rewrite the workflow of the current canvas to detect and cut out the cat in my output image",trace_id:"showcase1"},{id:"showcase1-10",role:"ai",content:`{"session_id":"62d2eed7-a9c2-4b34-b596-4a73b9ce6dad","text":"\\n▸ **Switching to Workflow Rewrite Agent**\\n\\nI'll help you rewrite the current workflow to add cat detection and cutout functionality. Let me first get the current workflow and then add the appropriate nodes for intelligent background removal.Now let me get the intelligent background removal experience to add cat detection and cutout functionality:Perfect! I'll rewrite your workflow to add intelligent cat detection and cutout functionality. I'll use the SAM (Segment Anything Model) with GroundingDINO for precise cat detection and segmentation.Perfect! I've successfully rewritten your workflow to add intelligent cat detection and cutout functionality. Here's what I've added:\\n\\n## New Features Added:\\n\\n### **Cat Detection & Segmentation System:**\\n1. **SAM Model Loader (Node 29)** - Loads the Segment Anything Model for precise segmentation\\n2. **GroundingDINO Model Loader (Node 30)** - Loads the object detection model for finding cats\\n3. **Cat Detection & Segmentation (Node 31)** - The main node that:\\n   - Detects cats in your generated image using the prompt \\"cat\\"\\n   - Uses a threshold of 0.3 for detection sensitivity\\n   - Automatically segments and cuts out the detected cat with precise boundaries\\n\\n### **Enhanced Output Options:**\\n1. **Save Original Image (Node 20)** - Saves your original generated image with prefix \\"ComfyUI_original\\"\\n2. **Save Cat Cutout (Node 32)** - Saves the extracted cat as a separate image with prefix \\"ComfyUI_cat_cutout\\"\\n3. **Preview Cat Cutout (Node 33)** - Shows a preview of the extracted cat in the interface\\n\\n## How It Works:\\n1. Your original workflow generates the cat image as before\\n2. The generated image is fed into the GroundingDINO + SAM pipeline\\n3. GroundingDINO detects the cat using natural language (\\"cat\\" prompt)\\n4. SAM performs precise segmentation to cut out the cat with clean edges\\n5. You get both the original image and the extracted cat as separate outputs\\n\\n## Model Requirements:\\n- **SAM Model**: \\"sam_vit_h (2.56GB)\\" - High-quality segmentation model\\n- **GroundingDINO**: \\"GroundingDINO_SwinT_OGC (694MB)\\" - Object detection model\\n\\nThe workflow will now automatically detect and cut out any cats in your generated images with high precision, giving you clean cutouts suitable for further use or editing!","finished":true,"type":"message","format":"markdown","ext":[{"type":"workflow_update","data":{"workflow_data":{"2":{"inputs":{"noise":["5",0],"guider":["7",0],"sampler":["4",0],"sigmas":["3",0],"latent_image":["10",0]},"class_type":"SamplerCustomAdvanced","_meta":{"title":"SamplerCustomAdvanced"}},"3":{"inputs":{"scheduler":"simple","steps":20,"denoise":1,"model":["8",0]},"class_type":"BasicScheduler","_meta":{"title":"BasicScheduler"}},"4":{"inputs":{"sampler_name":"euler"},"class_type":"KSamplerSelect","_meta":{"title":"KSamplerSelect"}},"5":{"inputs":{"noise_seed":571457442342604},"class_type":"RandomNoise","_meta":{"title":"RandomNoise"}},"6":{"inputs":{"clip_name1":"t5xxl_fp8_e4m3fn.safetensors","clip_name2":"clip_l.safetensors","type":"flux","device":"default"},"class_type":"DualCLIPLoader","_meta":{"title":"DualCLIPLoader"}},"7":{"inputs":{"model":["8",0],"conditioning":["11",0]},"class_type":"BasicGuider","_meta":{"title":"BasicGuider"}},"8":{"inputs":{"unet_name":"flux1-krea-dev.safetensors","weight_dtype":"fp8_e4m3fn"},"class_type":"UNETLoader","_meta":{"title":"Load Diffusion Model"}},"9":{"inputs":{"vae_name":"ae.safetensors"},"class_type":"VAELoader","_meta":{"title":"Load VAE"}},"10":{"inputs":{"width":["27",0],"height":["28",0],"batch_size":1},"class_type":"EmptyLatentImage","_meta":{"title":"Empty Latent Image"}},"11":{"inputs":{"text":["25",0],"clip":["6",0]},"class_type":"CLIPTextEncode","_meta":{"title":"CLIP Text Encode (Prompt)"}},"14":{"inputs":{"samples":["2",0],"vae":["9",0]},"class_type":"VAEDecode","_meta":{"title":"VAE Decode"}},"20":{"inputs":{"filename_prefix":"ComfyUI_original","images":["14",0]},"class_type":"SaveImage","_meta":{"title":"Save Original Image"}},"25":{"inputs":{"text":"a cat,simple background"},"class_type":"Text _O","_meta":{"title":"Text _O"}},"27":{"inputs":{"value":1024},"class_type":"easy int","_meta":{"title":"Int"}},"28":{"inputs":{"value":1400},"class_type":"easy int","_meta":{"title":"Int"}},"29":{"inputs":{"model_name":"sam_vit_h (2.56GB)"},"class_type":"SAMModelLoader (segment anything)","_meta":{"title":"SAM Model Loader"}},"30":{"inputs":{"model_name":"GroundingDINO_SwinT_OGC (694MB)"},"class_type":"GroundingDinoModelLoader (segment anything)","_meta":{"title":"GroundingDINO Model Loader"}},"31":{"inputs":{"prompt":"cat","threshold":0.3,"sam_model":["29",0],"grounding_dino_model":["30",0],"image":["14",0]},"class_type":"GroundingDinoSAMSegment (segment anything)","_meta":{"title":"Cat Detection & Segmentation"}},"32":{"inputs":{"filename_prefix":"ComfyUI_cat_cutout","images":["31",0]},"class_type":"SaveImage","_meta":{"title":"Save Cat Cutout"}},"33":{"inputs":{"images":["31",0]},"class_type":"PreviewImage","_meta":{"title":"Preview Cat Cutout"}}}}},{"type":"workflow_rewrite_checkpoint","data":{"checkpoint_id":21,"checkpoint_type":"workflow_rewrite_start"}}],"message_id":"b0ddb085-c47b-496a-9f63-ecb5f7afafe1"}`,format:"markdown",finished:!0,name:"Assistant"}]},{type:"chat",tool:"workflow_debug",name:"debug the workflow of the current canvas",messages:[{id:"showcase1-11",role:"ai",content:'{"text":"Would you like me to help you debug the current workflow on the canvas?","ext":[{"type":"debug_start_checkpoint","data":{"checkpoint_id":2168,"checkpoint_type":"debug_start"}}]}',format:"debug_guide",name:"Assistant"},{id:"showcase1-12",role:"ai",content:'{"text":"▸ **Switching to ComfyUI-Debug-Coordinator**\\n\\nI\'ll validate and debug your ComfyUI workflow. Let me start by checking the current state of the workflow to identify any errors.\\n\\n⚙ *ComfyUI-Debug-Coordinator is using run_workflow...*\\n\\n\\n\\n● *Tool execution completed*\\n\\n```\\n{\\"success\\": false, \\"error\\": {\\"type\\": \\"prompt_outputs_failed_validation\\", \\"message\\": \\"Prompt outputs failed validation\\", \\"details\\": \\"\\", \\"extra_info\\": {}}, \\"node_errors\\": {\\"21\\": {\\"errors\\": [{\\"type\\": \\"re...\\n```\\n\\nI found an error in the workflow! There\'s a connection issue where node 21 (VAEDecode) is missing its required \\"samples\\" input. Let me analyze this error type to determine the best approach for fixing it.\\n\\n⚙ *ComfyUI-Debug-Coordinator is using analyze_error_type...*\\n\\n\\n\\n● *Tool execution completed*\\n\\n```\\n{\\"error_type\\": \\"connection_error\\", \\"recommended_agent\\": \\"link_agent\\", \\"error_details\\": [{\\"error_type\\": \\"connection_error\\", \\"message\\": \\"Detected 4 connection-related issues\\", \\"details\\": \\"Connection or ...\\n```\\n\\nThis is a connection error where the VAEDecode node is missing its required \\"samples\\" input connection. I\'ll hand this off to the Link Agent to fix the missing connection.\\n\\n▸ **Switching to Link Agent**\\n\\nPerfect! Now I\'m the Link Agent and will analyze and fix the connection issues in your workflow. Let me start by performing a comprehensive connection analysis.\\n\\n⚙ *Link Agent is using analyze_missing_connections...*\\n\\n\\n\\n● *Tool execution completed*\\n\\n```\\n{\\"missing_connections\\": [{\\"node_id\\": \\"7\\", \\"node_class\\": \\"KSampler\\", \\"input_name\\": \\"latent_image\\", \\"input_config\\": [\\"LATENT\\", {\\"tooltip\\": \\"The latent image to denoise.\\"}], \\"required\\": true, \\"expected_t...\\n```\\n\\n**Connection analysis:** Found 5 missing required connections across multiple nodes:\\n- Node 7 (KSampler): missing latent_image input \\n- Node 21 (VAEDecode): missing samples input\\n- Node 28 (ReduxAdvanced): missing conditioning, style_model, and image inputs\\n\\nAll missing connections can be resolved using existing nodes with high confidence matches available.\\n\\n**Chosen strategy:** Connect existing nodes - all required inputs have perfect type-compatible outputs available from existing nodes. This is a pure connection fix scenario with no new nodes needed.\\n\\nLet me apply the connection fixes using the optimal connection strategy:\\n\\n⚙ *Link Agent is using apply_connection_fixes...*\\n\\n\\n\\n● *Tool execution completed*\\n\\n```\\n{\\"success\\": true, \\"version_id\\": 2171, \\"applied_fixes\\": [{\\"type\\": \\"connection\\", \\"target\\": \\"7.latent_image\\", \\"source\\": \\"75[0]\\", \\"old_value\\": \\"not connected\\", \\"new_value\\": [\\"75\\", 0]}, {\\"type\\": \\"connectio...\\n```\\n\\n**Fixes applied:** Successfully connected all 5 missing required inputs:\\n- ✅ Connected EmptyLatentImage → KSampler (latent_image)\\n- ✅ Connected KSampler → VAEDecode (samples) \\n- ✅ Connected CLIPTextEncode → ReduxAdvanced (conditioning)\\n- ✅ Connected StyleModelLoader → ReduxAdvanced (style_model)\\n- ✅ Connected LoadImage → ReduxAdvanced (image)\\n\\nAll connections were established with high confidence type matches. The workflow now has a complete data flow from input nodes through processing to final output.\\n\\n▸ **Switching to ComfyUI-Debug-Coordinator**\\n\\nExcellent! The Link Agent has successfully fixed all the missing connections. Now let me validate the workflow again to confirm all issues have been resolved.\\n\\n⚙ *ComfyUI-Debug-Coordinator is using run_workflow...*\\n\\n\\n\\n● *Tool execution completed*\\n\\n```\\n{\\"success\\": false, \\"error\\": {\\"type\\": \\"prompt_outputs_failed_validation\\", \\"message\\": \\"Prompt outputs failed validation\\", \\"details\\": \\"\\", \\"extra_info\\": {}}, \\"node_errors\\": {\\"3\\": {\\"errors\\": [{\\"type\\": \\"val...\\n```\\n\\nGreat progress! The connection issues have been resolved, but now there\'s a parameter error. Node 3 (LoraLoader) has an invalid LoRA name that\'s not in the available list. Let me analyze this error type.\\n\\n⚙ *ComfyUI-Debug-Coordinator is using analyze_error_type...*\\n\\n\\n\\n● *Tool execution completed*\\n\\n```\\n{\\"error_type\\": \\"mixed_connection_error\\", \\"recommended_agent\\": \\"link_agent\\", \\"error_details\\": [{\\"error_type\\": \\"connection_error\\", \\"message\\": \\"Detected 3 connection-related issues\\", \\"details\\": \\"Connecti...\\n```\\n\\nThis is actually a parameter error (value_not_in_list), not a connection error. The analysis might be mixed up. Let me hand this off to the Parameter Agent to fix the invalid LoRA name.\\n\\n▸ **Switching to Parameter Agent**\\n\\nIssue identified: enum_value_mismatch - LoRA file \'flux/Flux_Ghibli_v2_25.safetensors\' not found in available LoRA list.\\n\\nLet me analyze this parameter error to find a suitable replacement:\\n\\n⚙ *Parameter Agent is using find_matching_parameter_value...*\\n\\n\\n\\n● *Tool execution completed*\\n\\n```\\n{\\"found_match\\": false, \\"error_type\\": \\"model_missing\\", \\"message\\": \\"Missing model file: flux/Flux_Ghibli_v2_25.safetensors\\", \\"recommendation\\": \\"Check for available model replacements, otherwise download...\\n```\\n\\nGreat! I can see the available LoRA list and found several Ghibli-style LoRAs. The requested \\"flux/Flux_Ghibli_v2_25.safetensors\\" is not available, but there are several similar Ghibli LoRAs in the FLUX folder. \\n\\nLooking at the available options, the closest matches are:\\n- \\"FLUX/Flux_Ghibli_people_v3_23.safetensors\\"\\n- \\"FLUX/Flux_Ghibli_v1_10.safetensors\\", \\"FLUX/Flux_Ghibli_v1_15.safetensors\\", \\"FLUX/Flux_Ghibli_v1_20.safetensors\\"\\n- \\"FLUX/Flux_Ghibli_v2_30.safetensors\\"\\n\\nThe \\"FLUX/Flux_Ghibli_v2_30.safetensors\\" seems like the best match since it\'s from the same v2 series and has a higher version number (30 vs 25).\\n\\n**Solution:** auto-fixed - Replacing with the most similar available Ghibli v2 version LoRA.\\n\\n⚙ *Parameter Agent is using update_workflow_parameter...*\\n\\n\\n\\n● *Tool execution completed*\\n\\n```\\n{\\"success\\": true, \\"answer\\": \\"Successfully updated lora_name from \'flux/Flux_Ghibli_v2_25.safetensors\' to \'FLUX/Flux_Ghibli_v2_30.safetensors\' in node 3\\", \\"node_id\\": \\"3\\", \\"parameter\\": \\"lora_name\\", \\"old...\\n```\\n\\n**Status:** Fixed - Successfully updated the LoRA from unavailable \'flux/Flux_Ghibli_v2_25.safetensors\' to the available \'FLUX/Flux_Ghibli_v2_30.safetensors\' which is a very similar Ghibli v2 style LoRA.\\n\\n▸ **Switching to ComfyUI-Debug-Coordinator**\\n\\nExcellent! The Parameter Agent has fixed the invalid LoRA name. Now let me validate the workflow again to check if all issues have been resolved.\\n\\n⚙ *ComfyUI-Debug-Coordinator is using run_workflow...*\\n\\n\\n\\n● *Tool execution completed*\\n\\n```\\n{\\"success\\": true, \\"prompt_id\\": \\"a028058b-4aab-4f9b-9d0d-48c12ace616b\\", \\"number\\": 3, \\"node_errors\\": {}}\\n```\\n\\n🎉 **Workflow Validation Complete - SUCCESS!**\\n\\nYour ComfyUI workflow has been successfully debugged and is now fully functional! Here\'s a summary of the issues that were fixed:\\n\\n## Issues Fixed:\\n\\n1. **Connection Issues (5 fixes via Link Agent):**\\n   - ✅ Connected EmptyLatentImage (75) → KSampler (7) latent_image input\\n   - ✅ Connected KSampler (7) → VAEDecode (21) samples input  \\n   - ✅ Connected CLIPTextEncode (8) → ReduxAdvanced (28) conditioning input\\n   - ✅ Connected StyleModelLoader (29) → ReduxAdvanced (28) style_model input\\n   - ✅ Connected LoadImage (6) → ReduxAdvanced (28) image input\\n\\n2. **Parameter Issue (1 fix via Parameter Agent):**\\n   - ✅ Updated invalid LoRA: `flux/Flux_Ghibli_v2_25.safetensors` → `FLUX/Flux_Ghibli_v2_30.safetensors`\\n\\n## Current Workflow Status:\\n- **Validation:** ✅ PASSED\\n- **Prompt ID:** a028058b-4aab-4f9b-9d0d-48c12ace616b\\n- **Node Errors:** None\\n- **Ready to Execute:** Yes\\n\\nYour workflow now has a complete data flow from input nodes through processing to final output, with all required connections established and valid parameters configured. The workflow is ready for execution!","ext":[{"type":"param_update","data":{"workflow_data":{"1":{"inputs":{"unet_name":"flux1-dev.safetensors","weight_dtype":"default"},"class_type":"UNETLoader","_meta":{"title":"Load Diffusion Model"}},"2":{"inputs":{"clip_name1":"clip_l.safetensors","clip_name2":"t5xxl_fp16.safetensors","type":"flux","device":"default"},"class_type":"DualCLIPLoader","_meta":{"title":"DualCLIPLoader"}},"3":{"inputs":{"lora_name":"FLUX/Flux_Ghibli_v2_30.safetensors","strength_model":0.8,"strength_clip":1,"model":["1",0],"clip":["2",0]},"class_type":"LoraLoader","_meta":{"title":"Load LoRA"}},"6":{"inputs":{"image":"狗-德国短毛指示犬-4.jpeg"},"class_type":"LoadImage","_meta":{"title":"Load Image"}},"7":{"inputs":{"seed":720601145747867,"steps":20,"cfg":1,"sampler_name":"euler","scheduler":"normal","denoise":1,"model":["3",0],"positive":["28",0],"negative":["9",0],"latent_image":["75",0]},"class_type":"KSampler","_meta":{"title":"KSampler"}},"8":{"inputs":{"text":"Ghibli style,illustration,graphic,2d,Rich colors","clip":["3",1]},"class_type":"CLIPTextEncode","_meta":{"title":"CLIP Text Encode (Prompt)"}},"9":{"inputs":{"text":"","clip":["3",1]},"class_type":"CLIPTextEncode","_meta":{"title":"CLIP Text Encode (Prompt)"}},"20":{"inputs":{"vae_name":"ae.safetensors"},"class_type":"VAELoader","_meta":{"title":"Load VAE"}},"21":{"inputs":{"vae":["20",0],"samples":["7",0]},"class_type":"VAEDecode","_meta":{"title":"VAE Decode"}},"28":{"inputs":{"downsampling_factor":1,"downsampling_function":"area","mode":"keep aspect ratio","weight":0.6,"autocrop_margin":0.1,"clip_vision":["30",0],"conditioning":["8",0],"style_model":["29",0],"image":["6",0]},"class_type":"ReduxAdvanced","_meta":{"title":"ReduxAdvanced"}},"29":{"inputs":{"style_model_name":"flux1-redux-dev.safetensors"},"class_type":"StyleModelLoader","_meta":{"title":"Load Style Model"}},"30":{"inputs":{"clip_name":"sigclip_vision_patch14_384.safetensors"},"class_type":"CLIPVisionLoader","_meta":{"title":"Load CLIP Vision"}},"75":{"inputs":{"width":768,"height":1344,"batch_size":1},"class_type":"EmptyLatentImage","_meta":{"title":"Empty Latent Image"}},"78":{"inputs":{"images":["21",0]},"class_type":"PreviewImage","_meta":{"title":"Preview Image"}}},"changes":[{"node_id":"3","parameter":"lora_name","old_value":"flux/Flux_Ghibli_v2_25.safetensors","new_value":"FLUX/Flux_Ghibli_v2_30.safetensors"}]}},{"type":"debug_complete","data":{"status":"completed","final_agent":"ComfyUI-Debug-Coordinator","events":[{"type":"agent_handoff","current_agent":"ComfyUI-Debug-Coordinator","to_agent":"ComfyUI-Debug-Coordinator","timestamp":46},{"type":"tool_call","tool":"run_workflow","agent":"ComfyUI-Debug-Coordinator","timestamp":233},{"type":"tool_result","output_preview":"{\\"success\\": false, \\"error\\": {\\"type\\": \\"prompt_outputs_failed_validation\\", \\"message\\": \\"Prompt outputs failed validation\\", \\"details\\": \\"\\", \\"extra_info\\": {}}, \\"node_errors\\": {\\"21\\": {\\"errors\\": [{\\"type\\": \\"re...","agent":"ComfyUI-Debug-Coordinator","timestamp":478},{"type":"tool_call","tool":"analyze_error_type","agent":"ComfyUI-Debug-Coordinator","timestamp":746},{"type":"tool_result","output_preview":"{\\"error_type\\": \\"connection_error\\", \\"recommended_agent\\": \\"link_agent\\", \\"error_details\\": [{\\"error_type\\": \\"connection_error\\", \\"message\\": \\"Detected 4 connection-related issues\\", \\"details\\": \\"Connection or ...","agent":"ComfyUI-Debug-Coordinator","timestamp":991},{"type":"agent_handoff","current_agent":"Link Agent","to_agent":"Link Agent","timestamp":1195},{"type":"tool_call","tool":"analyze_missing_connections","agent":"Link Agent","timestamp":1413},{"type":"tool_result","output_preview":"{\\"missing_connections\\": [{\\"node_id\\": \\"7\\", \\"node_class\\": \\"KSampler\\", \\"input_name\\": \\"latent_image\\", \\"input_config\\": [\\"LATENT\\", {\\"tooltip\\": \\"The latent image to denoise.\\"}], \\"required\\": true, \\"expected_t...","agent":"Link Agent","timestamp":1658},{"type":"tool_call","tool":"apply_connection_fixes","agent":"Link Agent","timestamp":2344},{"type":"tool_result","output_preview":"{\\"success\\": true, \\"version_id\\": 2171, \\"applied_fixes\\": [{\\"type\\": \\"connection\\", \\"target\\": \\"7.latent_image\\", \\"source\\": \\"75[0]\\", \\"old_value\\": \\"not connected\\", \\"new_value\\": [\\"75\\", 0]}, {\\"type\\": \\"connectio...","agent":"Link Agent","timestamp":2589},{"type":"agent_handoff","current_agent":"ComfyUI-Debug-Coordinator","to_agent":"ComfyUI-Debug-Coordinator","timestamp":3145},{"type":"tool_call","tool":"run_workflow","agent":"ComfyUI-Debug-Coordinator","timestamp":3361},{"type":"tool_result","output_preview":"{\\"success\\": false, \\"error\\": {\\"type\\": \\"prompt_outputs_failed_validation\\", \\"message\\": \\"Prompt outputs failed validation\\", \\"details\\": \\"\\", \\"extra_info\\": {}}, \\"node_errors\\": {\\"3\\": {\\"errors\\": [{\\"type\\": \\"val...","agent":"ComfyUI-Debug-Coordinator","timestamp":3606},{"type":"tool_call","tool":"analyze_error_type","agent":"ComfyUI-Debug-Coordinator","timestamp":3873},{"type":"tool_result","output_preview":"{\\"error_type\\": \\"mixed_connection_error\\", \\"recommended_agent\\": \\"link_agent\\", \\"error_details\\": [{\\"error_type\\": \\"connection_error\\", \\"message\\": \\"Detected 3 connection-related issues\\", \\"details\\": \\"Connecti...","agent":"ComfyUI-Debug-Coordinator","timestamp":4118},{"type":"agent_handoff","current_agent":"Parameter Agent","to_agent":"Parameter Agent","timestamp":4341},{"type":"tool_call","tool":"find_matching_parameter_value","agent":"Parameter Agent","timestamp":4595},{"type":"tool_result","output_preview":"{\\"found_match\\": false, \\"error_type\\": \\"model_missing\\", \\"message\\": \\"Missing model file: flux/Flux_Ghibli_v2_25.safetensors\\", \\"recommendation\\": \\"Check for available model replacements, otherwise download...","agent":"Parameter Agent","timestamp":4840},{"type":"tool_call","tool":"update_workflow_parameter","agent":"Parameter Agent","timestamp":5613},{"type":"tool_result","output_preview":"{\\"success\\": true, \\"answer\\": \\"Successfully updated lora_name from \'flux/Flux_Ghibli_v2_25.safetensors\' to \'FLUX/Flux_Ghibli_v2_30.safetensors\' in node 3\\", \\"node_id\\": \\"3\\", \\"parameter\\": \\"lora_name\\", \\"old...","agent":"Parameter Agent","timestamp":5858},{"type":"agent_handoff","current_agent":"ComfyUI-Debug-Coordinator","to_agent":"ComfyUI-Debug-Coordinator","timestamp":6109},{"type":"tool_call","tool":"run_workflow","agent":"ComfyUI-Debug-Coordinator","timestamp":6312},{"type":"tool_result","output_preview":"{\\"success\\": true, \\"prompt_id\\": \\"a028058b-4aab-4f9b-9d0d-48c12ace616b\\", \\"number\\": 3, \\"node_errors\\": {}}","agent":"ComfyUI-Debug-Coordinator","timestamp":6456}],"total_events":23}},{"type":"debug_checkpoint","data":{"checkpoint_id":2173,"checkpoint_type":"debug_complete"}},{"type":"debug_checkpoint","data":{"checkpoint_id":2174,"checkpoint_type":"debug_complete"}}]}',format:"markdown",name:"Assistant",finished:!0,debugGuide:!0}]},{type:"chat",tool:"node_recommend",name:"Give me a node to merge multiple images",messages:[{id:"showcase2-1",role:"user",content:"Give me a node to merge multiple images",trace_id:"showcase2"},{id:"showcase2-2",role:"ai",content:'{"session_id":"bbe71936-8402-4fd0-8bb4-69eecac5ee01","text":"Here are nodes that can merge multiple images:\\n\\n1. **MonoMerge**  \\n   [GitHub Link](https://github.com/bmad4ever/comfyui_bmad_nodes): Merges two images into a monochromatic image, with options to merge towards white or black direction.\\n\\n2. **Concat Images (mtb)**  \\n   [GitHub Link](https://github.com/melMass/comfy_mtb): Can merge multiple images into a single batch, suitable for processing and manipulating image collections.\\n\\n3. **JoinImageBatch**  \\n   [GitHub Link](https://github.com/yolain/ComfyUI-Easy-Use): Merges batch images into one large image, supports horizontal or vertical stitching.\\n\\n4. **MergeLayers**  \\n   [GitHub Link](https://github.com/shadowcz007/comfyui-mixlab-nodes): Merges multi-layer images into a single image, supports specified masks and blending options.\\n\\n5. **Composite Images 🧅**  \\n   [GitHub Link](https://github.com/natto-maki/ComfyUI-NegiTools): Combines two images, supports multiple composite methods such as multiply, divide, overlay, etc.\\n\\n6. **ImageContainerInheritanceSum**  \\n   [GitHub Link](https://github.com/Nourepide/ComfyUI-Allor): Creates composite images by summarizing image dimensions, suitable for cases that need to consider the total width and height of input images.\\n\\n7. **Join Image Lists**  \\n   [GitHub Link](https://github.com/M1kep/Comfy_KepListStuff): Merges multiple image lists into one list while providing original list sizes.\\n\\n8. **Merge Image List**  \\n   [GitHub Link](https://github.com/AInseven/ComfyUI-fastblend): Merges image tensor lists into a single tensor, convenient for batch processing of image-related tasks.\\n\\nChoose the appropriate node based on your specific needs.","finished":true,"format":"markdown","ext":[{"type":"node","data":[{"id":28311,"unique_id":"7cca1314298b9a9d4b785e009099ea28","name":"MonoMerge","name_oral":"MonoMerge","description":"The MonoMerge node is designed to merge two images into a monochromatic image based on a target color scheme (either towards white or black). This process involves comparing the luminance (L component) of corresponding pixels from both images and selecting the higher or lower value depending on the target, resulting in an image that emphasizes either the lighter or darker aspects of the combined images.","github_url":"https://github.com/bmad4ever/comfyui_bmad_nodes","github_stars":50,"from_index":0,"to_index":0,"is_existed":true},{"id":29658,"unique_id":"e3a2782874d3bf8f99bb2b70c7090f74","name":"Concat Images (mtb)","name_oral":"Concat Images (mtb)","description":"The Concat Images node is designed to merge multiple images into a single batch, allowing for efficient processing and manipulation of image collections. It provides flexibility in handling size mismatches through customizable strategies.","github_url":"https://github.com/melMass/comfy_mtb","github_stars":350,"from_index":0,"to_index":0,"is_existed":true},{"id":29719,"unique_id":"458e445b2f21e81111dc9a7d3fb8cb7b","name":"easy joinImageBatch","name_oral":"JoinImageBatch","description":"This node is designed to merge a batch of images into a single large image, either by stacking them horizontally or vertically based on the specified mode. It abstracts the complexity of image manipulation and resizing, providing a straightforward way to create composite images from multiple inputs.","github_url":"https://github.com/yolain/ComfyUI-Easy-Use","github_stars":510,"from_index":0,"to_index":0,"is_existed":true},{"id":32325,"unique_id":"0ea3707eaaf8052e37630f95f4e5b72b","name":"MergeLayers","name_oral":"Merge Layers ♾️Mixlab","description":"The MergeLayers node is designed to combine multiple image layers into a single image while applying specified masks and blending options. It facilitates the creation of complex images by layering and compositing various elements based on their defined properties.","github_url":"https://github.com/shadowcz007/comfyui-mixlab-nodes","github_stars":null,"from_index":0,"to_index":0,"is_existed":true},{"id":32571,"unique_id":"0bd39afd25f012f877c9676b3c9837a1","name":"NegiTools_CompositeImages","name_oral":"Composite Images 🧅","description":"NegiTools_CompositeImages is a versatile node designed to combine two images using various compositing methods. This node allows you to blend images in multiple ways, such as multiplying, dividing, overlaying, and more, to achieve different visual effects.","github_url":"https://github.com/natto-maki/ComfyUI-NegiTools","github_stars":30,"from_index":0,"to_index":0,"is_existed":true},{"id":32865,"unique_id":"4e6b0fa27366545e19695c4e8931e270","name":"ImageContainerInheritanceSum","name_oral":"ImageContainerInheritanceSum","description":"Efficiently combine and sum image dimensions for creating composite images with integrity and visual quality. This node is designed to facilitate the combination of multiple images by summing their dimensions. This node is particularly useful when you need to create a composite image that encompasses the total width and height of the input images.","github_url":"https://github.com/Nourepide/ComfyUI-Allor","github_stars":200,"from_index":0,"to_index":0,"is_existed":true},{"id":72827,"unique_id":"1c76ce5bcc2c5097bdf515bddd32fb0b","name":"Join Image Lists","name_oral":"Join Image Lists","description":"This node is designed to combine multiple lists of images into a single list while also providing the sizes of the original lists. It facilitates the management of image data by allowing users to easily merge and track the number of images from various sources.","github_url":"https://github.com/M1kep/Comfy_KepListStuff","github_stars":null,"from_index":0,"to_index":0,"is_existed":true},{"id":81206,"unique_id":"1cc97ed3bc709de3f23c378eef1ce74e","name":"Merge_Image_List","name_oral":"Merge Image List","description":"This node is designed to merge a list of image tensors into a single tensor, facilitating batch processing in image-related tasks. It efficiently concatenates the input images along a specified dimension, enabling seamless integration of multiple images for further processing.","github_url":"https://github.com/AInseven/ComfyUI-fastblend","github_stars":null,"from_index":0,"to_index":0,"is_existed":true}]}],"message_id":"f60c3cf2-0b54-47a3-97e3-f536fc992c81"}',format:"markdown",finished:!0,name:"Assistant"}]},{type:"chat",tool:"model_recommend",name:"Give me a Studio Ghibli style LoRA",messages:[{id:"showcase3-1",role:"user",content:"Give me a Studio Ghibli style LoRA",trace_id:"showcase3"},{id:"showcase3-2",role:"ai",content:'{"session_id":"0b26efaf-e417-4344-9942-658fedbbc12c","text":"Which base model would you like for the Studio Ghibli style LoRA? You can choose from the following base models:\\n\\n1. Stable Diffusion v1.5\\n2. Illustrious\\n3. Pony\\n4. Flux.1\\n5. Flux.1 D\\n6. Stable Diffusion XL 1.0","finished":true,"format":"markdown","ext":[{"type":"guides","data":["Stable Diffusion v1.5","Illustrious","Pony","Flux.1","Flux.1 D","Stable Diffusion XL 1.0"]}],"message_id":"cfecdc29-5131-4afa-9807-9fe911e6b670"}',format:"markdown",finished:!0,name:"Assistant"},{id:"showcase3-3",role:"user",content:"Flux.1",trace_id:"showcase3"},{id:"showcase3-4",role:"ai",content:`{"session_id":"0b26efaf-e417-4344-9942-658fedbbc12c","text":"Here are several Studio Ghibli style LoRA models based on Flux.1:\\n\\n1. **Studio Ghibli Style Illustration**  \\n   - Description: This model excels at creating illustrations inspired by Studio Ghibli's style, showcasing whimsical, detailed landscapes and fantasy elements. It emphasizes rich textures, vibrant colors, and intricate natural environments, excelling at creating scenes full of life and warmth to tell stories with distinctive Studio Ghibli characteristics.  \\n   - [Get Link](https://www.liblib.art/modelinfo/51b6a44f87b543a6b21dfbadc2952313)  \\n\\n2. **Studio Ghibli Realism**  \\n   - Description: The model excels at generating Ghibli-style dreamlike landscapes, showcasing lush greenery, bright blues, and harmonious integration between nature and architecture. It captures dreamy scenes with soft fantasy atmosphere, embodying magical realism between tranquil forests and sky castles.  \\n   - ![Example Image 1](https://aib-data-sg.oss-ap-southeast-1.aliyuncs.com/ext-img/comuify/liblib||505b51e94736455c9d78ebe38afc3148||20d56a93ad9fd5daeaf043453766b60d.jpg)  \\n   - ![Example Image 2](https://aib-data-sg.oss-ap-southeast-1.aliyuncs.com/ext-img/comuify/liblib||505b51e94736455c9d78ebe38afc3148||4fca763050d3e8941193b4230e8e7410.jpg)  \\n   - [Get Link](https://www.liblib.art/modelinfo/c2ea3eebba764e388a3f08c2ca6eed3a)  \\n\\n3. **F.1-Studio Ghibli Style**  \\n   - Description: The model excels at generating anime-style images influenced by Studio Ghibli, presenting vibrant colors, imaginative compositions, and lively expressions. It focuses on generating scenes of young girls in various charming environments, excelling at rendering detailed cloud textures and complex lighting and shadows. \\n   - [Get Link](https://www.liblib.art/modelinfo/5638cc813c264f899b43536e02abfc82)  \\n\\nYou can choose a model that suits your needs.","finished":true,"format":"markdown","ext":[{"type":"model","data":[{"id":375989,"name":"Studio Ghibli Style Illustration","description":"This model excels in creating illustrations inspired by Miyazaki's style, featuring whimsical, detailed landscapes and fantastical elements. It consistently captures scenes brimming with life and warmth, emphasizing lush textures, vibrant colors, and intricate natural settings. This model is adept at generating compositions that convey a sense of wonder and storytelling in a distinctively Miyazaki fashion.","model_type":"LORA","model_algorithm":"Flux.1","model_pics":[],"source_url":"https://www.liblib.art/modelinfo/51b6a44f87b543a6b21dfbadc2952313","unique_id":"c3123b5ab427eebeaae884a3f1fe10cc"},{"id":378349,"name":"Studio Ghibli Realism","description":"The model excels in generating whimsical, serene landscapes with a Ghibli-inspired aesthetic, featuring lush greenery, vibrant blues, and harmonious nature-architecture integration. It captures dreamy sceneries with a soft, fantasy-like ambiance, demonstrating strengths in depicting tranquil forests, ethereal sky castles, and interactions between natural and man-made elements with a magical realism touch.","model_type":"LORA","model_algorithm":"Flux.1","model_pics":["https://aib-data-sg.oss-ap-southeast-1.aliyuncs.com/ext-img/comuify/liblib||505b51e94736455c9d78ebe38afc3148||20d56a93ad9fd5daeaf043453766b60d.jpg","https://aib-data-sg.oss-ap-southeast-1.aliyuncs.com/ext-img/comuify/liblib||505b51e94736455c9d78ebe38afc3148||4fca763050d3e8941193b4230e8e7410.jpg","https://aib-data-sg.oss-ap-southeast-1.aliyuncs.com/ext-img/comuify/liblib||505b51e94736455c9d78ebe38afc3148||b782cc39b8d159cb2c52fbb31b0c51b8.jpg","https://aib-data-sg.oss-ap-southeast-1.aliyuncs.com/ext-img/comuify/liblib||505b51e94736455c9d78ebe38afc3148||cddb9c4648639e78805dd2c088f3f039.jpg","https://aib-data-sg.oss-ap-southeast-1.aliyuncs.com/ext-img/comuify/liblib||505b51e94736455c9d78ebe38afc3148||ef8b418d2ad9c6092c14c17e4aa1b051.jpg"],"source_url":"https://www.liblib.art/modelinfo/c2ea3eebba764e388a3f08c2ca6eed3a","unique_id":"256ec6894dd15b42eb60c91fde22b61b"},{"id":385880,"name":"F.1-Studio Ghibli Style","description":"The model excels in generating whimsical anime-style images influenced by Miyazaki's distinct aesthetic, characterized by vibrant colors, playful compositions, and lively expressions. It specializes in scenes featuring young girls in varied enchanting settings, demonstrating strong skills in rendering detailed textures like clouds and intricate lighting. Notably adept at creating charming and imaginative animated environments.","model_type":"LORA","model_algorithm":"Flux.1","model_pics":[],"source_url":"https://www.liblib.art/modelinfo/5638cc813c264f899b43536e02abfc82","unique_id":"cbcbc993133822bccd46f16d49f5a4db"}]}],"message_id":"6903403f-cd32-447e-a9a6-a9247ab77c15"}`,format:"markdown",finished:!0,name:"Assistant"}]},{type:"chat",tool:"prompt",name:"Generate prompt based on my description",messages:[{id:"showcase4-1",role:"user",content:'Please generate an English prompt for me: "A woman in red dancing by the seaside with a bright smile"',trace_id:"showcase4"},{id:"showcase4-2",role:"ai",content:'{"session_id":"6272c460-04da-4b30-9090-1c05406f46e3","text":"woman in a red dress dancing by the seaside, bright smile, high quality, cinematic lighting, detailed, realistic, wide shot","finished":true,"format":"markdown","ext":null,"message_id":"13f0a58e-8670-4457-97da-cbad7a7d7530"}',format:"markdown",finished:!0,name:"Assistant"}]},{type:"genlab",tool:"genlab_prompt",name:"Generate 3 prompts based on my requirements and test each with image generation",messages:[{id:"showcase5-1",role:"user",content:"Generate 3 prompts based on my requirements and test each with image generation",trace_id:"showcase5"},{id:"showcase5-2",role:"ai",content:'{"text":"Please follow the demonstration below to use Genlab to fulfill your prompt debugging requirements.\\n ![](https://aib-vision-hz.oss-accelerate.aliyuncs.com/mood_board%2Finput%2F2025-07-16%2Fab89513606fd4966b0362f95f3f1ab86.gif?OSSAccessKeyId=LTAI5tQyhnsJhtiinV3B1gfV&Expires=2068018398&Signature=3XUgadQjjsGRu46S1fRxA7iDWJU%3D)"}',format:"markdown",finished:!0,name:"Assistant"}]}],Cs=3e3,Ms=()=>{const o=$e.extensionManager.setting.get("Comfy.Locale");return x.useMemo(()=>{let s="",c="",d=Fl,f="",m="",g="",_="";switch(o){case"zh":s="欢迎使用ComfyUI Copilot!",c=`已有 ${Cs}+ 开发者加入🚀，您的Star是我们持续维护和升级的动力， 👉🏻立即Star。`,d=Yg,f="🌟 免费羊毛可持续薅，点个Star服务器不跑路！每个Star都是我们续命的氧气！",m="您的Star=我们的动力",g=`加入我们由 ${Cs}+ 位 Star 支持者组成的大家庭 
 您的 Star 让我们更强大！`,_="点赞加入我们！";break;case"en":default:s="Welcome to ComfyUI Copilot!",c=`${Cs}+ developers joined🚀, Star us to support continuous updates, 👉🏻Star now.`,d=Fl,f="💖 Every ⭐ is our lifeline! Tap that star button to keep the magic alive!",m="Your Star = Our Power",g=`Join our family of ${Cs}+ Star supporiters 
 Your Star makes us stronger!`,_="Join Us! Star Now!";break}return{showcase_title:s,showcase_subtitle:c,showcase_list:d,apikeymodel_title:f,chatinput_title:m,startpopview_title:g,startpopview_join:_}},[o])},io=({children:o,className:l=""})=>r.jsx("a",{className:`text-xs text-gray-600 font-normal text-center ${l}`,href:Ql,target:"_blank",rel:"noopener noreferrer",children:o}),no=({active:o,onClick:l,children:s})=>r.jsx("button",{onClick:l,className:`px-4 py-2 font-medium text-xs transition-colors duration-200 border-b-2 ${o?"text-[#71A3F2] border-[#71A3F2]":"text-gray-600 border-transparent hover:!text-[#71A3F2] hover:!border-[#71A3F2]"}`,children:s}),Qg=Zl.apiBaseUrl,eo=["OpenAI","Groq","Anthropic","LMStudio"];function Zg({isOpen:o,onClose:l,onSave:s,initialApiKey:c="",onConfigurationUpdated:d}){const[f,m]=x.useState(c),[g,_]=x.useState(""),[S,v]=x.useState(!1),[j,I]=x.useState(!1),[N,L]=x.useState(""),{countDown:W,start:z}=Jg(60),[U,se]=x.useState(!1),[Z,H]=x.useState(""),[R,B]=x.useState(""),[V,X]=x.useState(!1),[y,ee]=x.useState(!1),[oe,F]=x.useState(null),[pe,ge]=x.useState(null),[ae,de]=x.useState(""),[le,G]=x.useState(""),[ze,ue]=x.useState(!1),[ie,ke]=x.useState(""),[J,ye]=x.useState(!1),[T,te]=x.useState(null),[Q,Se]=x.useState([]),[Fe,De]=x.useState(!1),[Ee,Re]=x.useState("auto"),[St,Qe]=x.useState(""),[xt,It]=x.useState(""),[Ze,Dt]=x.useState(!1),[qe,bt]=x.useState(eo[0]),[Ue,dt]=x.useState(null),{apikeymodel_title:Ot}=Ms();x.useEffect(()=>{const $={};eo?.forEach(xe=>{$[xe]={openaiApiKey:"",openaiBaseUrl:""}}),dt($)},[]),x.useEffect(()=>{m(c);const $=localStorage.getItem("openaiApiKey")||"",xe=localStorage.getItem("openaiBaseUrl")||"",et=localStorage.getItem("workflowLLMApiKey"),ot=localStorage.getItem("workflowLLMBaseUrl"),ut=localStorage.getItem("workflowLLMModel");$&&H($),xe&&B(xe),et&&de(et),ot&&G(ot),ut&&ke(ut);const gt=localStorage.getItem("voiceProvider")||"auto",Ft=localStorage.getItem("voiceApiKey")||"",q=localStorage.getItem("voiceBaseUrl")||"";Re(gt),Qe(Ft),It(q);const re=xe.includes("localhost")||xe.includes("127.0.0.1")||xe.includes(":1234"),Ie=xe.includes("api.groq.com"),ce=xe.includes("api.anthropic.com"),Ne=Ie?"Groq":ce?"Anthropic":xe&&re?"LMStudio":"OpenAI";dt(be=>{const Me={...be};return Me[Ne]={...Me[Ne],openaiApiKey:$,openaiBaseUrl:xe},Me}),xe&&(Ie?bt("Groq"):ce?bt("Anthropic"):re&&bt("LMStudio")),(async()=>{try{const be=localStorage.getItem("rsaPublicKey");if(be)ge(be);else{const Me=await Ig();ge(Me),localStorage.setItem("rsaPublicKey",Me)}}catch(be){console.error("Failed to fetch RSA public key:",be)}})()},[c]);const qt=async()=>{const $=R.toLowerCase().includes("localhost")||R.toLowerCase().includes("127.0.0.1")||R.includes(":1234"),xe=R.includes("api.groq.com"),et=R.includes("api.anthropic.com"),ot=xe?"Groq":et?"Anthropic":$?"LMStudio":"API";if(!Z.trim()&&!$){F({success:!1,message:`Please enter a ${ot} API key`});return}if(!pe&&!$&&!xe&&!et){F({success:!1,message:"RSA public key not available. Please try again later."});return}ee(!0),F(null);try{const ut=await Tl(Z,R);F({success:ut,message:ut?`${ot} connection successful!`:`${ot} connection failed. Please check your ${$?"server":"API key"}.`})}catch(ut){F({success:!1,message:ut instanceof Error?ut.message:"Failed to verify connection"})}finally{ee(!1)}},jt=async()=>{const $=le.toLowerCase().includes("localhost")||le.toLowerCase().includes("127.0.0.1")||le.includes(":1234");if(!ae.trim()&&!$){te({success:!1,message:"Please enter an API key or use LMStudio URL (localhost:1234)"});return}ye(!0),te(null);try{const xe=await Tl(ae,le);te({success:xe,message:xe?$?"LMStudio connection successful!":"API key is valid!":$?"LMStudio connection failed. Please check if LMStudio server is running.":"Invalid API key. Please check and try again."})}catch(xe){te({success:!1,message:xe instanceof Error?xe.message:"Failed to verify connection"})}finally{ye(!1)}ft()},ft=async()=>{if(!le||le.trim()===""){te({success:!1,message:"Please enter Workflow LLM Server URL first"});return}try{De(!0);const $=await ct.listModelsFromLLM(le.trim(),ae.trim()||void 0);Se($)}catch($){te({success:!1,message:$ instanceof Error?$.message:"Failed to fetch models"})}finally{De(!1)}},Vt=x.useMemo(()=>Kn.debounce($=>{console.log("checkEmailValid",$),v(/^[\w.-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test($))},500),[]),$t=$=>{bt($);const xe=Ue?.[$],et=xe?.openaiBaseUrl&&xe.openaiBaseUrl.trim()!=="",ot={Groq:"https://api.groq.com/openai/v1",Anthropic:"https://api.anthropic.com/v1",LMStudio:"http://localhost:1234/api/v1",OpenAI:""},ut=et?xe.openaiBaseUrl:ot[$]||"";H(xe?.openaiApiKey||""),B(ut),!et&&ot[$]&&dt(gt=>({...gt,[$]:{...gt?.[$],openaiBaseUrl:ot[$]}}))},ln=async()=>{if(!g||g===""||!S)return;se(!0);const $=g?.split("@")?.[0]||"",et=await(await fetch(`${Qg}/api/user/create`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:$,email:g})})).json();se(!1),I(!0),z(),et?.data?L("Send email successfully, please check your email"):L(et?.message||"Send email failed")},tn=()=>{s(f);const $=localStorage.getItem("openaiApiKey")||"",xe=localStorage.getItem("openaiBaseUrl")||"",et=Z.trim()!==$||R.trim()!==xe,ot=localStorage.getItem("workflowLLMApiKey")||"",ut=localStorage.getItem("workflowLLMBaseUrl")||"",gt=localStorage.getItem("workflowLLMModel")||"",Ft=ae.trim()!==ot||le.trim()!==ut||ie.trim()!==gt;R.trim()?localStorage.setItem("openaiBaseUrl",R.trim()):localStorage.removeItem("openaiBaseUrl"),le.trim()?localStorage.setItem("workflowLLMBaseUrl",le.trim()):localStorage.removeItem("workflowLLMBaseUrl"),ie.trim()?localStorage.setItem("workflowLLMModel",ie.trim()):localStorage.removeItem("workflowLLMModel"),Z.trim()?localStorage.setItem("openaiApiKey",Z.trim()):localStorage.removeItem("openaiApiKey"),ae.trim()?localStorage.setItem("workflowLLMApiKey",ae):localStorage.removeItem("workflowLLMApiKey"),Ee&&Ee!=="auto"?localStorage.setItem("voiceProvider",Ee):localStorage.removeItem("voiceProvider"),St.trim()?localStorage.setItem("voiceApiKey",St.trim()):localStorage.removeItem("voiceApiKey"),xt.trim()?localStorage.setItem("voiceBaseUrl",xt.trim()):localStorage.removeItem("voiceBaseUrl"),(et||Ft)&&d&&(localStorage.removeItem("models_time"),d()),l()};return o?r.jsxs("div",{className:"fixed inset-0 bg-black/40 backdrop-blur-sm z-10 flex items-center justify-center",children:[r.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-8 w-[480px] max-h-[80vh] shadow-2xl overflow-y-auto",children:[r.jsx("h2",{className:"text-xl text-gray-900 dark:text-white font-semibold mb-6",children:"Set API Key"}),r.jsxs("div",{className:"mb-6",children:[r.jsxs("div",{className:"flex flex-row justify-between",children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Email"}),r.jsx("div",{className:"text-sm text-red-600 dark:text-red-300",children:r.jsx("span",{children:g&&g!==""&&!S?"Please enter a valid email":""})})]}),r.jsxs("div",{className:"relative mb-4 flex flex-row gap-2",children:[r.jsx(Ol,{value:g,setValue:_,setIsValueValid:Vt,placeholder:"Enter your Email",className:"flex-1"}),r.jsx("button",{onClick:ln,disabled:U||!S||W>0,className:`w-28 py-2.5 ${!U&&S&&W===0?"bg-blue-600 hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-600 text-white":"bg-gray-300 dark:bg-gray-600 text-gray-500 dark:text-gray-400 cursor-not-allowed"} 
                            rounded-lg font-medium transition-colors flex justify-center items-center`,children:U?r.jsx(Xg,{}):W>0?`Resend in ${W}s`:"Send"})]}),r.jsxs("div",{className:"text-xs text-gray-600",children:['By clicking the "Send" button below and submitting your information to us, you agree to our ',r.jsx("a",{href:"https://cdn.contract.alibaba.com/terms/privacy_policy_full/20250219145958852/20250219145958852.html?lng=en",target:"_blank",rel:"noopener noreferrer",className:"underline underline-offset-2",children:"Privacy Policy"})," and ",r.jsx("a",{href:"https://cdn.contract.alibaba.com/terms/c_end_product_protocol/20250219150239949/20250219150239949.html?lng=en",target:"_blank",rel:"noopener noreferrer",className:"underline underline-offset-2",children:"Terms of Use"}),"."]})]}),r.jsxs("div",{className:"mb-6",children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"ComfyUI Copilot API Key"}),r.jsx("div",{className:"relative mb-4",children:r.jsx(Ol,{isPassword:!0,value:f,setValue:m,placeholder:"Enter your API key",className:"mb-4"})}),r.jsxs(io,{className:"flex justify-start items-end",children:[Ot,r.jsx("svg",{viewBox:"0 0 1024 1024",className:"w-4 h-4",fill:"currentColor",children:r.jsx("path",{d:"M498.894518 100.608396c-211.824383 0-409.482115 189.041494-409.482115 422.192601 0 186.567139 127.312594 344.783581 295.065226 400.602887 21.13025 3.916193 32.039717-9.17701 32.039717-20.307512 0-10.101055 1.176802-43.343157 1.019213-78.596056-117.448946 25.564235-141.394311-49.835012-141.394311-49.835012-19.225877-48.805566-46.503127-61.793368-46.503127-61.793368-38.293141-26.233478 3.13848-25.611308 3.13848-25.611308 42.361807 2.933819 64.779376 43.443441 64.779376 43.443441 37.669948 64.574714 98.842169 45.865607 122.912377 35.094286 3.815909-27.262924 14.764262-45.918819 26.823925-56.431244-93.796246-10.665921-192.323237-46.90017-192.323237-208.673623 0-46.071292 16.498766-83.747379 43.449581-113.332185-4.379751-10.665921-18.805298-53.544497 4.076852-111.732757 0 0 35.46063-11.336186 116.16265 43.296085 33.653471-9.330506 69.783343-14.022365 105.654318-14.174837 35.869952 0.153496 72.046896 4.844332 105.753579 14.174837 80.606853-54.631248 116.00813-43.296085 116.00813-43.296085 22.935362 58.18826 8.559956 101.120049 4.180206 111.732757 27.052123 29.584806 43.443441 67.260893 43.443441 113.332185 0 162.137751-98.798167 197.850114-192.799074 208.262254 15.151072 13.088086 28.65155 38.804794 28.65155 78.17957 0 56.484456-0.459464 101.94381-0.459464 115.854635 0 11.235902 7.573489 24.381293 29.014824 20.2543C825.753867 867.330798 933.822165 709.10924 933.822165 522.700713c0-233.155201-224.12657-422.192601-434.927647-422.192601L498.894518 100.608396z"})})]})]}),r.jsx(Zi,{title:r.jsx("h3",{className:"text-sm text-gray-900 dark:text-white font-medium",children:"LLM Configuration (OpenAI / Groq / Anthropic / LMStudio)"}),className:"mb-4",children:r.jsxs("div",{children:[r.jsx("div",{className:"mb-4",children:eo?.map($=>r.jsx(no,{active:qe===$,onClick:()=>$t($),children:$},$))}),qe!=="LMStudio"&&r.jsxs("div",{className:"mb-4",children:[r.jsx("label",{className:"block text-xs font-medium text-gray-700 dark:text-gray-300 mt-2 mb-2",children:qe==="Groq"?"Groq API Key":qe==="Anthropic"?"Anthropic API Key":"API Key"}),r.jsxs("div",{className:"relative",children:[r.jsx("input",{type:V?"text":"password",value:Z,onChange:$=>{dt(xe=>({...xe,[qe]:{...xe?.[qe],openaiApiKey:$.target.value}})),H($.target.value)},placeholder:{Groq:"Enter your Groq API key (gsk_...)",Anthropic:"Enter your Anthropic API key (sk-ant-...)",OpenAI:"Enter your OpenAI API key (sk-...)"}[qe]||"Enter your API key",className:`w-full px-4 py-3 border border-gray-200 dark:border-gray-600 rounded-lg pr-12 text-xs\r
                                        bg-gray-50 dark:bg-gray-700\r
                                        text-gray-900 dark:text-white\r
                                        placeholder-gray-500 dark:placeholder-gray-400\r
                                        focus:border-blue-500 dark:focus:border-blue-400 \r
                                        focus:ring-2 focus:ring-blue-500/20 dark:focus:ring-blue-400/20\r
                                        focus:outline-none`}),r.jsx("button",{type:"button",className:`absolute inset-y-0 right-0 pr-4 flex items-center text-gray-500 dark:text-gray-400 \r
                                        hover:text-gray-700 dark:hover:text-gray-200 transition-colors bg-transparent border-none`,onClick:()=>X(!V),children:V?r.jsxs("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]}):r.jsx("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"})})})]})]}),qe==="LMStudio"&&r.jsxs("div",{className:"mb-4",children:[r.jsxs("label",{className:"block text-xs font-medium text-gray-700 dark:text-gray-300 mt-2 mb-2",children:["API Token ",r.jsx("span",{className:"text-gray-400 font-normal",children:"(optional)"})]}),r.jsxs("div",{className:"relative",children:[r.jsx("input",{type:V?"text":"password",value:Z,onChange:$=>{dt(xe=>({...xe,[qe]:{...xe?.[qe],openaiApiKey:$.target.value}})),H($.target.value)},placeholder:"Leave empty unless auth is enabled in LMStudio",className:`w-full px-4 py-3 border border-gray-200 dark:border-gray-600 rounded-lg pr-12 text-xs\r
                                        bg-gray-50 dark:bg-gray-700\r
                                        text-gray-900 dark:text-white\r
                                        placeholder-gray-500 dark:placeholder-gray-400\r
                                        focus:border-blue-500 dark:focus:border-blue-400 \r
                                        focus:ring-2 focus:ring-blue-500/20 dark:focus:ring-blue-400/20\r
                                        focus:outline-none`}),r.jsx("button",{type:"button",className:`absolute inset-y-0 right-0 pr-4 flex items-center text-gray-500 dark:text-gray-400 \r
                                        hover:text-gray-700 dark:hover:text-gray-200 transition-colors bg-transparent border-none`,onClick:()=>X(!V),children:V?r.jsxs("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]}):r.jsx("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"})})})]}),r.jsx("p",{className:"mt-1 text-[10px] text-gray-400 dark:text-gray-500",children:`Only needed if you enabled "Require Authentication" in LMStudio's Developer Settings`})]}),r.jsxs("div",{className:"mb-4",children:[r.jsx("label",{className:"block text-xs font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Server URL"}),r.jsx("input",{type:"text",value:R,onChange:$=>{dt(xe=>({...xe,[qe]:{...xe?.[qe],openaiBaseUrl:$.target.value}})),B($.target.value)},placeholder:{OpenAI:"https://api.openai.com/v1",Groq:"https://api.groq.com/openai/v1",Anthropic:"https://api.anthropic.com/v1",LMStudio:"http://localhost:1234/api/v1"}[qe]||"https://api.openai.com/v1",className:`w-full px-4 py-3 border border-gray-200 dark:border-gray-600 rounded-lg text-xs\r
                                bg-gray-50 dark:bg-gray-700\r
                                text-gray-900 dark:text-white\r
                                placeholder-gray-500 dark:placeholder-gray-400\r
                                focus:border-blue-500 dark:focus:border-blue-400 \r
                                focus:ring-2 focus:ring-blue-500/20 dark:focus:ring-blue-400/20\r
                                focus:outline-none`})]}),r.jsxs("div",{className:"mb-4 text-xs text-gray-500 dark:text-gray-400",children:[qe==="LMStudio"&&r.jsxs("div",{className:"mb-1",children:[r.jsx("strong",{children:"🔗 LMStudio:"})," http://localhost:1234/api/v1 — ⚠️ Competes with ComfyUI for VRAM. Use 14B+ models for tool calling."]}),qe==="OpenAI"&&r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"mb-1",children:[r.jsx("strong",{children:"🌐 OpenAI:"})," https://api.openai.com/v1 (requires API key)"]}),r.jsxs("div",{children:[r.jsx("strong",{children:"⚙️ Custom:"})," Any OpenAI-compatible server URL"]})]}),qe==="Groq"&&r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"mb-1",children:[r.jsx("strong",{children:"⚡ Groq:"})," Ultra-fast cloud inference — best for Agent Mode"]}),r.jsxs("div",{children:["Get a free API key at ",r.jsx("a",{href:"https://console.groq.com",target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 underline",children:"console.groq.com"})]})]}),qe==="Anthropic"&&r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"mb-1",children:[r.jsx("strong",{children:"🧠 Anthropic:"})," Claude models — excellent at tool calling and planning"]}),r.jsxs("div",{children:["Get an API key at ",r.jsx("a",{href:"https://console.anthropic.com",target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 underline",children:"console.anthropic.com"})]})]})]}),r.jsx("div",{className:"flex items-center mb-2",children:r.jsx("button",{onClick:qt,disabled:y,className:`px-4 py-2 rounded-lg font-medium text-xs transition-colors ${y?"bg-gray-300 dark:bg-gray-600 text-gray-500 dark:text-gray-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-600 text-white"}`,children:y?r.jsxs("span",{className:"flex items-center text-xs",children:[r.jsxs("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[r.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),r.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Verifying..."]}):"Verify"})}),oe&&r.jsx("div",{className:`text-xs p-2 rounded-md ${oe.success?"bg-green-50 dark:bg-green-900/20 text-green-700 dark:text-green-400":"bg-red-50 dark:bg-red-900/20 text-red-700 dark:text-red-400"}`,children:oe.message})]})}),r.jsx(Zi,{title:r.jsx("h3",{className:"text-sm text-gray-900 dark:text-white font-medium",children:"Workflow LLM Configuration (Optional)"}),className:"mb-4",children:r.jsxs("div",{children:[r.jsxs("div",{className:"mb-4",children:[r.jsx("label",{className:"block text-xs font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Workflow LLM API Key"}),r.jsxs("div",{className:"relative",children:[r.jsx("input",{type:ze?"text":"password",value:ae,onChange:$=>de($.target.value),placeholder:"Enter workflow LLM API key (if required)",className:`w-full px-4 py-3 border border-gray-200 dark:border-gray-600 rounded-lg pr-12 text-xs\r
                                    bg-gray-50 dark:bg-gray-700 \r
                                    text-gray-900 dark:text-white\r
                                    placeholder-gray-500 dark:placeholder-gray-400\r
                                    focus:border-blue-500 dark:focus:border-blue-400 \r
                                    focus:ring-2 focus:ring-blue-500/20 dark:focus:ring-blue-400/20\r
                                    focus:outline-none`}),r.jsx("button",{type:"button",className:`absolute inset-y-0 right-0 pr-4 flex items-center text-gray-500 dark:text-gray-400 \r
                                    hover:text-gray-700 dark:hover:text-gray-200 transition-colors bg-transparent border-none`,onClick:()=>ue(!ze),children:ze?r.jsxs("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]}):r.jsx("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"})})})]})]}),r.jsxs("div",{className:"mb-4",children:[r.jsx("label",{className:"block text-xs font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Workflow LLM Server URL"}),r.jsx("input",{type:"text",value:le,onChange:$=>G($.target.value),placeholder:"e.g. https://api.openai.com/v1 or http://localhost:1234/v1",className:`w-full px-4 py-3 border border-gray-200 dark:border-gray-600 rounded-lg text-xs\r
                                bg-gray-50 dark:bg-gray-700 \r
                                text-gray-900 dark:text-white\r
                                placeholder-gray-500 dark:placeholder-gray-400\r
                                focus:border-blue-500 dark:focus:border-blue-400 \r
                                focus:ring-2 focus:ring-blue-500/20 dark:focus:ring-blue-400/20\r
                                focus:outline-none`}),r.jsx("div",{className:"mt-2 text-xs text-gray-500 dark:text-gray-400",children:r.jsxs("div",{className:"mb-1",children:[r.jsx("strong",{children:"Optional:"})," If you don't set, the workflow will use the Claude4 model provided by us. If you need to use other models(note: only some very powerful closed-source models can support this, and they require at least 8192 context) for workflow Debug and modification, please set it."]})}),r.jsx("div",{className:"flex items-center mt-2",children:r.jsx("button",{onClick:jt,disabled:J,className:`px-4 py-2 rounded-lg font-medium text-xs transition-colors ${J?"bg-gray-300 dark:bg-gray-600 text-gray-500 dark:text-gray-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-600 text-white"}`,children:J?r.jsxs("span",{className:"flex items-center text-xs",children:[r.jsxs("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[r.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),r.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Verifying..."]}):"Verify"})}),T&&r.jsx("div",{className:`mt-2 text-xs p-2 rounded-md ${T.success?"bg-green-50 dark:bg-green-900/20 text-green-700 dark:text-green-400":"bg-red-50 dark:bg-red-900/20 text-red-700 dark:text-red-400"}`,children:T.message})]}),r.jsxs("div",{className:"mb-4",children:[r.jsx("label",{className:"block text-xs font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Workflow LLM Model"}),r.jsx("div",{className:"flex items-center gap-2",children:r.jsxs("div",{className:"relative flex-1",children:[r.jsx("input",{list:"workflow-llm-models",type:"text",value:ie,onChange:$=>ke($.target.value),placeholder:"e.g. gpt-4o-mini, claude-3-5-sonnet, llama-3.1-70b",className:`w-full px-4 py-3 border border-gray-200 dark:border-gray-600 rounded-lg text-xs\r
                                        bg-gray-50 dark:bg-gray-700 \r
                                        text-gray-900 dark:text-white\r
                                        placeholder-gray-500 dark:placeholder-gray-400\r
                                        focus:border-blue-500 dark:focus:border-blue-400 \r
                                        focus:ring-2 focus:ring-blue-500/20 dark:focus:ring-blue-400/20\r
                                        focus:outline-none`,disabled:Fe}),Fe&&r.jsx("div",{className:"absolute inset-y-0 right-3 flex items-center",children:r.jsxs("svg",{className:"animate-spin h-4 w-4 text-gray-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[r.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),r.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})}),!Fe&&r.jsx("datalist",{id:"workflow-llm-models",children:Q.map($=>r.jsx("option",{value:$},$))})]})})]})]})}),r.jsx(Zi,{title:r.jsx("h3",{className:"text-sm text-gray-900 dark:text-white font-medium",children:"🎙️ Voice Configuration (Optional)"}),className:"mb-4",children:r.jsxs("div",{children:[r.jsxs("div",{className:"mb-3 text-xs text-gray-500 dark:text-gray-400",children:["Voice features (mic input & text-to-speech) are ",r.jsx("strong",{children:"auto-detected"})," from your chat provider. If your provider doesn't support voice (Anthropic, LMStudio), you can manually configure a voice provider here."]}),r.jsxs("div",{className:"mb-4",children:[r.jsx("label",{className:"block text-xs font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Voice Provider"}),r.jsxs("select",{value:Ee,onChange:$=>{Re($.target.value),$.target.value==="groq"?It("https://api.groq.com/openai/v1"):$.target.value==="openai"?It("https://api.openai.com/v1"):It("")},className:`w-full px-4 py-3 border border-gray-200 dark:border-gray-600 rounded-lg text-xs\r
                                bg-gray-50 dark:bg-gray-700\r
                                text-gray-900 dark:text-white\r
                                focus:border-blue-500 dark:focus:border-blue-400 \r
                                focus:ring-2 focus:ring-blue-500/20 dark:focus:ring-blue-400/20\r
                                focus:outline-none`,children:[r.jsx("option",{value:"auto",children:"Auto-detect (from chat provider)"}),r.jsx("option",{value:"groq",children:"Groq (Orpheus TTS + Whisper STT)"}),r.jsx("option",{value:"openai",children:"OpenAI (tts-1 + Whisper)"})]})]}),Ee!=="auto"&&r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"mb-4",children:[r.jsx("label",{className:"block text-xs font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Voice API Key"}),r.jsxs("div",{className:"relative",children:[r.jsx("input",{type:Ze?"text":"password",value:St,onChange:$=>Qe($.target.value),placeholder:Ee==="groq"?"Groq API key (gsk_...)":"OpenAI API key (sk-...)",className:`w-full px-4 py-3 border border-gray-200 dark:border-gray-600 rounded-lg pr-12 text-xs\r
                                            bg-gray-50 dark:bg-gray-700 \r
                                            text-gray-900 dark:text-white\r
                                            placeholder-gray-500 dark:placeholder-gray-400\r
                                            focus:border-blue-500 dark:focus:border-blue-400 \r
                                            focus:ring-2 focus:ring-blue-500/20 dark:focus:ring-blue-400/20\r
                                            focus:outline-none`}),r.jsx("button",{type:"button",className:`absolute inset-y-0 right-0 pr-4 flex items-center text-gray-500 dark:text-gray-400 \r
                                            hover:text-gray-700 dark:hover:text-gray-200 transition-colors bg-transparent border-none`,onClick:()=>Dt(!Ze),children:Ze?r.jsxs("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]}):r.jsx("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"})})})]}),r.jsx("div",{className:"mt-1 text-xs text-gray-400 dark:text-gray-500",children:"Leave empty to reuse your chat API key"})]}),r.jsxs("div",{className:"mb-4",children:[r.jsx("label",{className:"block text-xs font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Voice Server URL"}),r.jsx("input",{type:"text",value:xt,onChange:$=>It($.target.value),placeholder:Ee==="groq"?"https://api.groq.com/openai/v1":"https://api.openai.com/v1",className:`w-full px-4 py-3 border border-gray-200 dark:border-gray-600 rounded-lg text-xs\r
                                        bg-gray-50 dark:bg-gray-700 \r
                                        text-gray-900 dark:text-white\r
                                        placeholder-gray-500 dark:placeholder-gray-400\r
                                        focus:border-blue-500 dark:focus:border-blue-400 \r
                                        focus:ring-2 focus:ring-blue-500/20 dark:focus:ring-blue-400/20\r
                                        focus:outline-none`})]})]}),r.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:[Ee==="auto"&&r.jsxs("div",{children:["✅ ",r.jsx("strong",{children:"Groq"})," and ",r.jsx("strong",{children:"OpenAI"})," users get voice automatically. Anthropic/LMStudio users: select a provider above."]}),Ee==="groq"&&r.jsxs("div",{children:["⚡ ",r.jsx("strong",{children:"Groq:"})," Orpheus TTS (6 voices) + Whisper STT — ultra-fast, free tier available at ",r.jsx("a",{href:"https://console.groq.com",target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 underline",children:"console.groq.com"})]}),Ee==="openai"&&r.jsxs("div",{children:["🌐 ",r.jsx("strong",{children:"OpenAI:"})," tts-1 (6 voices) + Whisper — reliable, usage-based pricing"]})]})]})}),r.jsxs("div",{className:"flex justify-end gap-3",children:[r.jsx("button",{onClick:l,className:`px-5 py-2.5 text-gray-700 bg-white dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 \r
                        rounded-lg font-medium transition-colors`,children:"Cancel"}),r.jsx("button",{onClick:tn,className:`px-5 py-2.5 bg-blue-600 hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-600 \r
                        text-white rounded-lg font-medium transition-colors`,children:"Save"})]})]}),r.jsx(so,{open:j,onClose:()=>I(!1),children:r.jsx("p",{children:N})})]}):null}class ep{dbName="ComfyUICopilotDB";version=1;storeName="chatSessions";db=null;async init(){return new Promise((l,s)=>{const c=indexedDB.open(this.dbName,this.version);c.onerror=()=>{s(new Error("Failed to open IndexedDB"))},c.onsuccess=()=>{this.db=c.result,l()},c.onupgradeneeded=d=>{const f=d.target.result;f.objectStoreNames.contains(this.storeName)||f.createObjectStore(this.storeName,{keyPath:"id"}).createIndex("lastUpdated","lastUpdated",{unique:!1})}})}async saveSession(l,s){if(this.db||await this.init(),!this.db)throw new Error("Database not initialized");const c=s.find(f=>f.role==="user")?.content||"",d={id:l,firstMessage:c.length>50?c.substring(0,50)+"...":c,lastUpdated:Date.now(),messages:s};return new Promise((f,m)=>{const S=this.db.transaction([this.storeName],"readwrite").objectStore(this.storeName).put(d);S.onsuccess=()=>f(),S.onerror=()=>m(new Error("Failed to save session"))})}async getSession(l){if(this.db||await this.init(),!this.db)throw new Error("Database not initialized");return new Promise((s,c)=>{const m=this.db.transaction([this.storeName],"readonly").objectStore(this.storeName).get(l);m.onsuccess=()=>{s(m.result||null)},m.onerror=()=>c(new Error("Failed to get session"))})}async getAllSessions(){if(this.db||await this.init(),!this.db)throw new Error("Database not initialized");return new Promise((l,s)=>{const m=this.db.transaction([this.storeName],"readonly").objectStore(this.storeName).index("lastUpdated").openCursor(null,"prev"),g=[];m.onsuccess=()=>{const _=m.result;_?(g.push(_.value),_.continue()):l(g)},m.onerror=()=>s(new Error("Failed to get all sessions"))})}async deleteSession(l){if(this.db||await this.init(),!this.db)throw new Error("Database not initialized");return new Promise((s,c)=>{const m=this.db.transaction([this.storeName],"readwrite").objectStore(this.storeName).delete(l);m.onsuccess=()=>s(),m.onerror=()=>c(new Error("Failed to delete session"))})}}const Pr=new ep;function tp({isOpen:o,onClose:l,onSelectSession:s,currentSessionId:c}){const[d,f]=x.useState([]),[m,g]=x.useState(!1);x.useEffect(()=>{o&&_()},[o]);const _=async()=>{g(!0);try{const I=await Pr.getAllSessions();f(I)}catch(I){console.error("Failed to load sessions:",I)}finally{g(!1)}},S=I=>{const N=new Date(I),W=new Date().getTime()-N.getTime(),z=Math.floor(W/(1e3*60*60*24));return z===0?N.toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}):z===1?"昨天":z<7?`${z}天前`:N.toLocaleDateString("zh-CN",{month:"short",day:"numeric"})},v=I=>{s(I.id,I.messages),l()},j=async(I,N)=>{if(I.stopPropagation(),confirm("确定要删除这个会话吗？"))try{await Pr.deleteSession(N),_()}catch(L){console.error("Failed to delete session:",L)}};return o?r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:r.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl w-96 max-h-[80vh] flex flex-col",children:[r.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700",children:[r.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-gray-100",children:"Session History"}),r.jsx("button",{onClick:l,className:"text-gray-400 hover:text-gray-600 dark:hover:text-white transition-colors",children:r.jsx(On,{className:"h-5 w-5"})})]}),r.jsx("div",{className:"flex-1 overflow-y-auto",children:m?r.jsx("div",{className:"flex items-center justify-center py-8",children:r.jsx("div",{className:"text-gray-500 dark:text-gray-400",children:"Loading..."})}):d.length===0?r.jsx("div",{className:"flex items-center justify-center py-8",children:r.jsx("div",{className:"text-gray-500 dark:text-gray-400",children:"No session history"})}):r.jsx("div",{className:"space-y-1 p-2",children:d.map(I=>r.jsxs("div",{onClick:()=>v(I),className:`flex items-center justify-between p-3 rounded-lg cursor-pointer group ${I.id===c?"dark:bg-gray-700 border border-blue-200 dark:border-gray-600":"hover:bg-gray-50 dark:hover:bg-gray-700"}`,children:[r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsxs("div",{className:"flex items-center justify-between mb-1",children:[r.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:S(I.lastUpdated)}),I.id===c&&r.jsx("span",{className:"text-xs text-blue-600 dark:text-blue-400 font-medium",children:"Current"})]}),r.jsx("div",{className:"text-sm text-gray-900 dark:text-gray-100 truncate",children:I.firstMessage||"Empty session"})]}),r.jsx("button",{onClick:N=>j(N,I.id),className:"ml-2 p-1 text-gray-400 hover:text-red-500 opacity-0 group-hover:opacity-100 transition-all",title:"Delete session",children:r.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]},I.id))})}),r.jsxs("div",{className:"p-4 border-t border-gray-200 dark:border-gray-700 text-xs text-gray-500 dark:text-gray-400",children:["Click session to switch, total ",d.length," sessions"]})]})}):null}const rc="/copilot_web/assets/logo-BTZhX0BN.png";function np({onClose:o,onClear:l,hasMessages:s,onHeightResize:c,title:d="ComfyUI-Copilot",onSelectSession:f,currentSessionId:m,onConfigurationUpdated:g}){const[_,S]=x.useState(!1),[v,j]=x.useState(!1),[I,N]=x.useState(!1),L=()=>{S(!0)},W=()=>{j(!0)},z=Z=>{localStorage.setItem("chatApiKey",Z)},U=(Z,H)=>{f?.(Z,H)},se=()=>{window.open("https://docs.google.com/forms/d/e/1FAIpQLSf_SeUpgrZh8sPGwVFXAlsviVXKpsQnyaevcB2VrIqUBYUMKg/viewform?usp=dialog","_blank")};return x.useEffect(()=>{const Z=R=>{if(!I)return;const B=R.movementY;c?.(B)},H=()=>{N(!1)};return I&&(document.addEventListener("mousemove",Z),document.addEventListener("mouseup",H)),()=>{document.removeEventListener("mousemove",Z),document.removeEventListener("mouseup",H)}},[I,c]),r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:`flex items-center justify-between border-b px-3 py-2 \r
                        bg-white border-gray-200 sticky top-2 z-10`,children:[r.jsxs("div",{className:"flex items-center space-x-1",children:[r.jsx("img",{src:`.${rc}`,alt:"ComfyUI-Copilot Logo",className:"h-7 w-7 -ml-1"}),r.jsx("h3",{className:"text-[14px] font-medium text-gray-800",children:d}),r.jsx("button",{onClick:L,className:"p-1 bg-white border-none hover:!bg-gray-100 rounded text-gray-500",children:r.jsx(jg,{className:"h-4 w-4"})})]}),r.jsxs("div",{className:"flex items-center gap-1",children:[r.jsx("button",{onClick:W,className:"p-1.5 bg-white border-none hover:bg-gray-100 rounded text-gray-500",title:"Session History",children:r.jsx(Cg,{className:"h-4 w-4"})}),r.jsx("button",{className:"inline-flex bg-white border-none items-center justify-center rounded-md p-1.5 text-gray-500 hover:!bg-gray-100",onClick:se,children:r.jsx(Ng,{className:"h-4 w-4"})}),r.jsx("button",{className:`inline-flex bg-white border-none items-center justify-center rounded-md p-1.5 
                                 ${s?"text-gray-500 hover:!bg-gray-100":"text-gray-300 cursor-not-allowed"}`,disabled:!s,onClick:l,children:r.jsx(ec,{className:"h-4 w-4"})})]})]}),r.jsx(Zg,{isOpen:_,onClose:()=>S(!1),onSave:z,initialApiKey:localStorage.getItem("chatApiKey")||"",onConfigurationUpdated:g}),r.jsx(tp,{isOpen:v,onClose:()=>j(!1),onSelectSession:U,currentSessionId:m||null})]})}class rp{mediaRecorder=null;audioContext=null;analyser=null;stream=null;silenceTimer=null;chunks=[];animFrameId=null;active=!1;manualStop=!1;silenceMs;silenceThreshold;onSilenceStop;onVolumeChange;onStart;onError;constructor(l){this.silenceMs=l?.silenceMs??1500,this.silenceThreshold=l?.silenceThreshold??.015,this.onSilenceStop=l?.onSilenceStop,this.onVolumeChange=l?.onVolumeChange,this.onStart=l?.onStart,this.onError=l?.onError}get isActive(){return this.active}async start(){if(!this.active){this.manualStop=!1;try{this.stream=await navigator.mediaDevices.getUserMedia({audio:!0}),this.audioContext=new AudioContext;const l=this.audioContext.createMediaStreamSource(this.stream);this.analyser=this.audioContext.createAnalyser(),this.analyser.fftSize=512,l.connect(this.analyser),this.mediaRecorder=new MediaRecorder(this.stream,{mimeType:"audio/webm"}),this.chunks=[],this.mediaRecorder.ondataavailable=s=>{s.data.size>0&&this.chunks.push(s.data)},this.mediaRecorder.onstop=()=>{const s=new Blob(this.chunks,{type:"audio/webm"});this.cleanup(),!this.manualStop&&s.size>0&&this.onSilenceStop?.(s)},this.mediaRecorder.start(),this.active=!0,this.onStart?.(),this.monitorVolume()}catch(l){this.cleanup(),this.onError?.(l instanceof Error?l:new Error(String(l)))}}}async stop(){return this.active?(this.manualStop=!0,new Promise(l=>{if(!this.mediaRecorder||this.mediaRecorder.state==="inactive"){const s=this.chunks.length>0?new Blob(this.chunks,{type:"audio/webm"}):null;this.cleanup(),l(s);return}this.mediaRecorder.onstop=()=>{const s=this.chunks.length>0?new Blob(this.chunks,{type:"audio/webm"}):null;this.cleanup(),l(s)},this.mediaRecorder.stop()})):null}monitorVolume(){if(!this.analyser)return;const l=new Float32Array(this.analyser.frequencyBinCount),s=()=>{if(!this.analyser||!this.active)return;this.analyser.getFloatTimeDomainData(l);let c=0;for(let f=0;f<l.length;f++)c+=l[f]*l[f];const d=Math.sqrt(c/l.length);this.onVolumeChange?.(d),d<this.silenceThreshold?this.silenceTimer||(this.silenceTimer=setTimeout(()=>{this.mediaRecorder&&this.mediaRecorder.state==="recording"&&(this.active=!1,this.mediaRecorder.stop())},this.silenceMs)):this.silenceTimer&&(clearTimeout(this.silenceTimer),this.silenceTimer=null),this.active&&(this.animFrameId=requestAnimationFrame(s))};this.animFrameId=requestAnimationFrame(s)}cleanup(){this.active=!1,this.silenceTimer&&(clearTimeout(this.silenceTimer),this.silenceTimer=null),this.animFrameId&&(cancelAnimationFrame(this.animFrameId),this.animFrameId=null),this.stream&&(this.stream.getTracks().forEach(l=>l.stop()),this.stream=null),this.audioContext&&(this.audioContext.close().catch(()=>{}),this.audioContext=null),this.analyser=null,this.mediaRecorder=null}}const sc=()=>r.jsx("div",{className:"absolute top-0 left-0 w-full h-full bg-black/80 flex items-center justify-center",children:r.jsx("div",{className:"aspect-square h-3/5 border-4 border-solid border-[#d1d5db] border-t-[#00D9FF] rounded-full loading-spin"})}),Ts="/api/expert/experts",Ps=async o=>{const s=(o.headers.get("content-type")||"").includes("application/json"),c=s?await o.json():await o.text();if(!o.ok){const d=s?c?.message||"Request failed":c;throw new Error(d)}return c},sp=async o=>{const l=await fetch(Ts,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});return Ps(l)},ip=async()=>{console.log("getRewriteExpertsList--->");const o=await fetch(Ts,{method:"GET"});return Ps(o)},op=async o=>{const l=await fetch(`${Ts}/${o.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});return Ps(l)},ap=async o=>{const l=await fetch(`${Ts}/${o}`,{method:"DELETE"});return Ps(l)},ic=()=>r.jsx(Lg,{image:r.jsx("svg",{viewBox:"0 0 1351 1024",fill:"#ffffff73",children:r.jsx("path",{d:"M467.19776 479.648s2.688 2.688 8.096 2.688h393.44c2.688 0 5.376-2.688 8.096-2.688V358.4h409.6c-2.688-8.096-2.688-13.472-8.096-21.568l-264.096-277.568H335.16576l-264.096 277.568c-5.376 2.688-8.096 10.784-8.096 21.568h409.6v121.248h-5.376z m-409.6-61.952v476.96c0 37.728 40.416 70.048 88.928 70.048h1053.632c48.512 0 88.928-32.352 88.928-70.048V412.288H936.06176v64.672c0 32.352-29.632 59.296-61.984 59.296H480.63776c-35.04 0-61.984-26.944-61.984-59.296v-64.672H62.94176v5.376zM1200.18976 1024H146.55776C65.72576 1024 1.05376 964.704 1.05376 894.656V417.696c-2.688-48.512-2.688-94.304 29.632-123.968L313.62976 0H1038.52576l282.944 293.728c32.352 29.632 29.632 83.552 29.632 142.816v455.424C1345.72576 964.736 1278.33376 1024 1200.18976 1024z"})}),styles:{image:{height:40}}}),{TextArea:Rl}=Tr,lp=({onClose:o})=>{const[l,s]=x.useState([]),[c,d]=x.useState(""),[f,m]=x.useState(!1),[g,_]=x.useState([]),[S,v]=x.useState(null),[j,I]=x.useState(null),N=x.useRef(!1),L=V=>{I(V)},W=async V=>{if(!(V<1))try{(await ap(V)).success&&(v("Delete success"),z())}catch(X){console.log("error---_>",X),v(`Delete error: ${X}`)}},z=async()=>{m(!0);try{const V=await ip();V.success&&V?.data?.experts&&(s(V.data.experts),_(V.data.experts))}catch(V){v(`Get list error: ${V}`),console.log("error---_>",V)}finally{m(!1)}},U=V=>{_(V===""?l:l.filter(X=>X.name.includes(V)))},se=()=>{N.current=!0,I({id:0,name:"",description:"",content:""})},Z=V=>{const X=V.target.value;U(X),d(X)},H=async V=>{let X=null;N.current?X=sp:X=op;try{(await X(V)).success&&(v(N.current?"Add success":"Edit success"),z(),I(null))}catch(y){v(N.current?`Add error ${y}`:`Edit error ${y}`)}},R=()=>{I(null),N.current=!1};x.useEffect(()=>{z()},[]);const B=[{title:"Name",dataIndex:"name",key:"name",ellipsis:{showTitle:!0}},{title:"Description",dataIndex:"description",key:"description",ellipsis:{showTitle:!0}},{title:"Content",dataIndex:"content",key:"content",ellipsis:{showTitle:!0}},{title:"Action",key:"action",render:(V,X)=>r.jsxs(Pl,{size:"middle",children:[r.jsx("button",{onClick:()=>L(X),className:"bg-transparent border-none text-gray-500 hover:!text-gray-700",children:r.jsx(Eg,{className:"w-5 h-5"})}),r.jsx("button",{onClick:()=>W(X.id),className:"bg-transparent border-none text-gray-500 hover:!text-gray-700",children:r.jsx(ec,{className:"w-5 h-5"})})]})}];return r.jsxs("div",{id:"comfyui-copilot-rewrite-expert-modal",className:"fixed inset-0 bg-[rgba(0,0,0,0.5)] flex items-center justify-center",style:{backgroundColor:"rgba(0,0,0,0.5)"},children:[r.jsxs("div",{className:"relative bg-white rounded-xl p-6 w-1/2 h-2/3 flex flex-col",children:[r.jsxs("div",{className:"flex justify-between items-center mb-6",children:[r.jsx("h2",{className:"text-xl text-gray-900 dark:text-white font-semibold",children:"Set expert experience to help you rewrite workflow"}),r.jsx("button",{onClick:o,disabled:f,className:"bg-white border-none text-gray-500 hover:!text-gray-700",children:r.jsx(On,{className:"w-5 h-5"})})]}),r.jsxs("div",{className:"flex justify-between mb-2",children:[r.jsx(Tr,{placeholder:"Enter search name",allowClear:!0,value:c,disabled:f,onChange:Kn.debounce(Z,500),className:"search-input w-1/4 bg-white text-[#888] placeholder-gray-500 border border-gray-300"}),r.jsx("button",{onClick:se,className:"bg-white border-none text-gray-500 hover:!text-gray-700",children:r.jsx(Ag,{className:"w-5 h-5"})})]}),r.jsx("div",{className:"flex-1 min-h-0 overflow-y-auto",children:r.jsx(tc,{bordered:!0,loading:f,columns:B,dataSource:g,rowClassName:"text-gray-800",locale:{emptyText:r.jsx(ic,{})}})}),j&&r.jsxs("div",{className:"absolute top-0 left-0 w-full h-full bg-white rounded-xl p-6 z-5 overflow-y-auto",children:[r.jsx("h2",{className:"text-xl text-gray-900 dark:text-white font-semibold",children:`${j?.name&&j?.name!==""?"Edit":"Add"} Rewrite Expert`}),r.jsxs(ur,{onFinish:H,initialValues:j,layout:"vertical",children:[r.jsx(ur.Item,{name:"id",label:"Id",hidden:!0,children:r.jsx(Tr,{disabled:!0})}),r.jsx(ur.Item,{name:"name",label:"Name",rules:[{required:!0}],children:r.jsx(Tr,{placeholder:"Enter name"})}),r.jsx(ur.Item,{name:"description",label:"Description",rules:[{required:!0}],children:r.jsx(Rl,{placeholder:"Enter description",autoSize:{maxRows:6}})}),r.jsx(ur.Item,{name:"content",label:"Content",rules:[{required:!0}],children:r.jsx(Rl,{placeholder:"Enter content",autoSize:{maxRows:10}})}),r.jsx(ur.Item,{children:r.jsxs(Pl,{align:"end",size:"middle",children:[r.jsx(Dl,{type:"primary",htmlType:"submit",children:"Submit"}),r.jsx(Dl,{onClick:R,children:"Cancel"})]})})]})]})]}),r.jsx(so,{open:!!S&&S!=="",onClose:()=>v(null),children:r.jsx("p",{children:S})})]})};function oc({children:o,container:l=document.body,className:s=""}){const[c,d]=x.useState(!1);if(x.useEffect(()=>(d(!0),()=>d(!1)),[]),!c)return null;const f=r.jsx("div",{className:`fixed inset-0 ${s}`,style:{zIndex:9999},children:o});return Yl.createPortal(f,l)}const to=o=>{const{buttonClass:l="",buttonContent:s,renderModal:c,onOpen:d}=o,[f,m]=x.useState(!1);return r.jsxs(r.Fragment,{children:[r.jsx("button",{className:l,onClick:()=>{d&&d(),m(!0)},children:s}),f&&r.jsx(oc,{children:c&&c(()=>m(!1))})]})},cp=5*1024*1024,zl=["image/jpeg","image/png","image/gif","image/webp"],dp=o=>{const{onUploadImages:l,uploadedImages:s,onRemoveImage:c,onClose:d}=o,f=x.useRef(null),m=g=>{if(g.target.files){if(s?.length>=3){alert("You can only upload up to 3 images");return}const _=[],S=[];if(Array.from(g.target.files).forEach(v=>{zl.includes(v.type)?v.size>cp?_.push(`${v.name} (exceeds 5MB)`):S.push(v):_.push(`${v.name} (unsupported format)`)}),_.length>0&&alert(`The following files couldn't be uploaded:
${_.join(`
`)}`),s?.length+S.length>3){alert("You can only upload up to 3 images");return}if(S.length>0){const v=new DataTransfer;S.forEach(j=>v.items.add(j)),l(v.files)}}};return r.jsx("div",{id:"comfyui-copilot-image-upload-modal",className:"fixed inset-0 bg-[rgba(0,0,0,0.5)] flex items-center justify-center",style:{backgroundColor:"rgba(0,0,0,0.5)"},children:r.jsxs("div",{className:"bg-white rounded-lg p-6 w-96 relative",children:[r.jsx("button",{onClick:d,className:"absolute top-2 right-2 bg-white border-none text-gray-500 hover:!text-gray-700",children:r.jsx(On,{className:"w-5 h-5"})}),r.jsx("h3",{className:"text-lg text-gray-800 font-medium mb-4",children:"Upload Images"}),r.jsxs("div",{className:`border-2 border-dashed border-gray-300 rounded-lg p-8\r
                    flex flex-col items-center justify-center gap-4\r
                    hover:!border-blue-500 transition-colors cursor-pointer`,onClick:()=>f.current?.click(),children:[r.jsx(Mg,{className:"w-8 h-8 text-gray-400"}),r.jsxs("div",{className:"text-center",children:[r.jsx("p",{className:"text-sm text-gray-500 mb-2",children:"Click to upload images or drag and drop"}),r.jsx("p",{className:"text-xs text-gray-400",children:"Supported formats: JPG, PNG, GIF, WebP"}),r.jsx("p",{className:"text-xs text-gray-400",children:"Max file size: 5MB, Max 3 images"})]})]}),r.jsx("input",{ref:f,type:"file",multiple:!0,accept:zl.join(","),onChange:m,className:"hidden"}),s.length>0&&r.jsx("div",{className:"mt-4 grid grid-cols-3 gap-2",children:s.map(g=>r.jsxs("div",{className:"relative group",children:[r.jsx("img",{src:g.preview,alt:"preview",className:"w-full h-20 object-contain"}),g?.url&&g?.url!==""?r.jsx("button",{onClick:()=>c(g.id),className:`absolute -top-1 -right-1 bg-white border-none text-gray-500 rounded-full p-0.5\r
                                        opacity-0 group-hover:!opacity-100 transition-opacity`,children:r.jsx(On,{className:"w-3 h-3"})}):r.jsx(sc,{})]},g.id))}),r.jsx("div",{className:"mt-4 flex justify-end gap-2",children:r.jsx("button",{onClick:d,className:`px-4 py-2 text-sm font-medium text-gray-700 \r
                      bg-white border border-gray-300 rounded-md \r
                      hover:!bg-gray-50`,children:"Close"})})]})})},up=({className:o=""})=>r.jsxs("svg",{className:`loading-spin ${o}`,viewBox:"0 0 1024 1024",fill:"currentColor",children:[r.jsx("path",{d:"M469.333333 85.333333m42.666667 0l0 0q42.666667 0 42.666667 42.666667l0 128q0 42.666667-42.666667 42.666667l0 0q-42.666667 0-42.666667-42.666667l0-128q0-42.666667 42.666667-42.666667Z",opacity:".8","p-id":"14405"}),r.jsx("path",{d:"M469.333333 725.333333m42.666667 0l0 0q42.666667 0 42.666667 42.666667l0 128q0 42.666667-42.666667 42.666667l0 0q-42.666667 0-42.666667-42.666667l0-128q0-42.666667 42.666667-42.666667Z",opacity:".4","p-id":"14406"}),r.jsx("path",{d:"M938.666667 469.333333m0 42.666667l0 0q0 42.666667-42.666667 42.666667l-128 0q-42.666667 0-42.666667-42.666667l0 0q0-42.666667 42.666667-42.666667l128 0q42.666667 0 42.666667 42.666667Z",opacity:".2","p-id":"14407"}),r.jsx("path",{d:"M298.666667 469.333333m0 42.666667l0 0q0 42.666667-42.666667 42.666667l-128 0q-42.666667 0-42.666667-42.666667l0 0q0-42.666667 42.666667-42.666667l128 0q42.666667 0 42.666667 42.666667Z",opacity:".6","p-id":"14408"}),r.jsx("path",{d:"M783.530667 180.138667m30.169889 30.169889l0 0q30.169889 30.169889 0 60.339779l-90.509668 90.509668q-30.169889 30.169889-60.339779 0l0 0q-30.169889-30.169889 0-60.339779l90.509668-90.509668q30.169889-30.169889 60.339779 0Z",opacity:".1","p-id":"14409"}),r.jsx("path",{d:"M330.965333 632.661333m30.16989 30.16989l0 0q30.169889 30.169889 0 60.339778l-90.509668 90.509668q-30.169889 30.169889-60.339779 0l0 0q-30.169889-30.169889 0-60.339778l90.509668-90.509668q30.169889-30.169889 60.339779 0Z",opacity:".5","p-id":"14410"}),r.jsx("path",{d:"M843.861333 783.530667m-30.169889 30.169889l0 0q-30.169889 30.169889-60.339779 0l-90.509668-90.509668q-30.169889-30.169889 0-60.339779l0 0q30.169889-30.169889 60.339779 0l90.509668 90.509668q30.169889 30.169889 0 60.339779Z",opacity:".3","p-id":"14411"}),r.jsx("path",{d:"M391.338667 330.965333m-30.16989 30.16989l0 0q-30.169889 30.169889-60.339778 0l-90.509668-90.509668q-30.169889-30.169889 0-60.339779l0 0q30.169889-30.169889 60.339778 0l90.509668 90.509668q30.169889 30.169889 0 60.339779Z",opacity:".7","p-id":"14412"})]}),fp=({content:o})=>r.jsx("div",{className:"inline-block bg-gray-100 rounded-md px-2 py-1 text-sm flex justify-center items-center",children:o}),hp="发现模型缺失，推荐下载以下模型。",mp="Missing models detected. We recommend downloading the following models.",gp={name:"模型ID",dir:"模型下载存放目录",tags:"标签",updateTime:"更新时间",downloads:"下载量",action:"操作"},pp={name:"Model ID",dir:"Models download directory",tags:"Tags",updateTime:"Update time",downloads:"Downloads",action:"Action"},xp=o=>{const{modelList:l,loading:s=!1,showTitle:c=!0,showPagination:d=!0}=o,{modelDownloadMap:f,addDownloadId:m}=kn(),g=$e.extensionManager.setting.get("Comfy.Locale"),[_,S]=x.useState(null),[v,j]=x.useState({}),[I,N]=x.useState(null),L=g==="zh"?gp:pp,W=async()=>{const R=await(await fetch("/api/model-paths")).json();S(R?.data?.paths||[])};x.useEffect(()=>{W()},[]),x.useEffect(()=>{if(!_||_.length===0)return;let H={};l?.forEach(R=>{const B=_.findIndex(V=>R.model_type===V);H[R.Id]=_[B===-1?0:B]||""}),j(H)},[l,_]);const z=async(H,R,B)=>{ct.trackEvent({event_type:"model_download_trigger",message_type:"model",data:{id:H,model_id:R,model_type:B||v[H]}});let V={id:H,model_id:R,model_type:B&&B!==""?B:v[H]};const y=await(await fetch("/api/download-model",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(V)})).json();y.success?m(y.data.download_id):N(y.message||"Download Model Failed!")},U=(H,R)=>{j(B=>({...B,[H]:R}))},se=H=>H==="completed"?r.jsxs("svg",{className:"w-5 h-5",viewBox:"0 0 1024 1024",fill:"#13d320",children:[r.jsx("path",{d:"M198.920606 353.438906l294.89452 398.030819-141.866143 105.106304-294.89452-398.030819 141.866143-105.106304Z"}),r.jsx("path",{d:"M292.668567 679.383279l612.100893-449.37515 104.488343 142.3252-612.100893 449.37515-104.488343-142.3252Z"})]}):H==="downloading"?r.jsx(up,{className:"w-5 h-5 text-gray-700"}):null,Z=[{title:L.name,key:"modelId",render:(H,R)=>r.jsx("div",{children:`${R.Path}/${R.Name}`})},{title:L.dir,key:"directory",render:(H,R)=>r.jsx("select",{value:v[R.Id],onChange:B=>U(R.Id,B.target.value),className:`px-1.5 py-0.5 text-xs rounded-md bg-gray-100\r
                  text-gray-700 focus:outline-none focus:ring-2 \r
                  focus:ring-blue-500 hover:!bg-gray-50`,children:_?.map(B=>r.jsx("option",{value:B,children:B},B))})},{title:L.tags,key:"tags",render:(H,R)=>r.jsx("div",{className:"flex flex-wrap gap-1",children:R?.Libraries?.map(B=>r.jsx(fp,{content:B}))})},{title:L.updateTime,key:"updateTime",render:(H,R)=>r.jsx("div",{children:R.LastUpdatedTime?new Date(R.LastUpdatedTime*1e3).toLocaleString():""})},{title:L.downloads,key:"downloads",render:(H,R)=>r.jsx("div",{children:R.Downloads?R.Downloads:0})},{title:L.action,key:"action",render:(H,R)=>r.jsx("div",{className:"w-full h-full flex justify-center items-center",children:f[R.Id]&&f[R.Id].status!=="failed"?se(f[R.Id]?.status):r.jsx("button",{className:"text-gray-900 hover:!text-blue-500 disabled:!text-gray-300 flex justify-center items-center bg-transparent border-none",onClick:()=>z(R.Id,`${R.Path}/${R.Name}`,R?.model_type||""),children:r.jsxs("svg",{viewBox:"0 0 1071 1024",className:"w-5 h-5",fill:"currentColor",children:[r.jsx("path",{d:"M1022.955204 522.570753c0 100.19191-81.516572 181.698249-181.718715 181.698249l-185.637977 0c-11.2973 0-20.466124-9.168824-20.466124-20.466124 0-11.307533 9.168824-20.466124 20.466124-20.466124l185.637977 0c77.628008 0 140.786467-63.148226 140.786467-140.766001 0-77.423347-62.841234-140.448776-140.203182-140.766001-0.419556 0.030699-0.818645 0.051165-1.217734 0.061398-5.945409 0.143263-11.686157-2.292206-15.687284-6.702656-4.001127-4.400217-5.894244-10.335393-5.167696-16.250102 1.330298-10.806113 1.944282-19.760043 1.944282-28.192086 0-60.763922-23.658839-117.884874-66.617234-160.833035-42.968627-42.968627-100.089579-66.617234-160.843268-66.617234-47.368844 0-92.742241 14.449084-131.208321 41.781592-37.616736 26.738991-65.952084 63.700811-81.925894 106.884332-2.425236 6.538927-8.012488 11.399631-14.827707 12.893658-6.815219 1.483794-13.927197-0.603751-18.859533-5.54632-19.289322-19.330254-44.943608-29.972639-72.245418-29.972639-56.322773 0-102.146425 45.813419-102.146425 102.125959 0 0.317225 0.040932 0.982374 0.092098 1.627057 0.061398 0.920976 0.122797 1.831718 0.153496 2.762927 0.337691 9.465582-5.863545 17.928325-15.001669 20.455891-32.356942 8.933463-61.541635 28.550243-82.181721 55.217602-21.305235 27.516704-32.571836 60.508096-32.571836 95.41307 0 86.244246 70.188572 156.422585 156.443052 156.422585l169.981393 0c11.2973 0 20.466124 9.15859 20.466124 20.466124 0 11.2973-9.168824 20.466124-20.466124 20.466124l-169.981393 0c-108.828614 0-197.3753-88.536452-197.3753-197.354833 0-44.053332 14.223956-85.712127 41.126676-120.473839 22.809495-29.460985 53.897537-52.086285 88.710414-64.816215 5.065366-74.322729 67.149353-133.2447 142.751215-133.2447 28.386514 0 55.504128 8.217149 78.651314 23.52581 19.657712-39.868009 48.842405-74.169233 85.497233-100.212376 45.434795-32.295544 99.004875-49.354058 154.918325-49.354058 71.692832 0 139.087778 27.915793 189.782368 78.600149 50.694589 50.694589 78.610382 118.089535 78.610382 189.782368 0 3.704368-0.102331 7.470135-0.296759 11.368932C952.633602 352.568894 1022.955204 429.511287 1022.955204 522.570753z","p-id":"4439"}),r.jsx("path",{d:"M629.258611 820.711014l-102.023628 102.013395c-3.990894 4.001127-9.230222 5.996574-14.46955 5.996574s-10.478655-1.995447-14.46955-5.996574l-102.023628-102.013395c-7.992021-7.992021-7.992021-20.947078 0-28.939099s20.947078-8.002254 28.939099 0l67.087954 67.077721 0-358.699522c0-11.2973 9.15859-20.466124 20.466124-20.466124 11.307533 0 20.466124 9.168824 20.466124 20.466124l0 358.699522 67.087954-67.077721c7.992021-8.002254 20.947078-7.992021 28.939099 0S637.250632 812.718993 629.258611 820.711014z","p-id":"4440"})]})})}),fixed:"right"}];return _?r.jsxs("div",{className:"mt-4 w-full h-auto flex-1 min-h-0 overflow-y-auto",children:[c&&r.jsx("h3",{className:"text-xl text-gray-900 font-bold",children:g==="zh"?hp:mp}),r.jsx(tc,{id:"comfyui-copilot-model-download",loading:s,columns:Z,dataSource:l,pagination:d?void 0:!1,rowClassName:"text-gray-800",locale:{emptyText:r.jsx(ic,{})}}),r.jsx(so,{open:!!I&&I!=="",onClose:()=>N(null),children:r.jsx("p",{children:I})})]}):null},bp=o=>{const{onClose:l}=o,[s,c]=x.useState(!1),[d,f]=x.useState([]),m=x.useRef(null);x.useEffect(()=>{m?.current?.focus()},[d]);const g=async S=>{c(!0);try{ct.trackEvent({event_type:"model_search",message_type:"model",data:{keyword:S}});const j=await(await fetch(`/api/model-searchs?keyword=${S}`)).json();f(j?.data?.searchs||[])}catch(v){console.log("e--->",v)}finally{c(!1)}},_=S=>{g(S.target.value)};return r.jsx("div",{id:"comfyui-copilot-model-download-modal",className:"fixed inset-0 bg-[rgba(0,0,0,0.5)] flex items-center justify-center",style:{backgroundColor:"rgba(0,0,0,0.5)"},children:r.jsxs("div",{className:"relative bg-white rounded-xl p-6 w-1/2 h-3/4 flex flex-col",children:[r.jsxs("div",{className:"flex justify-between items-center mb-6",children:[r.jsx("h2",{className:"text-xl text-gray-900 font-semibold",children:"Model Download"}),r.jsx("button",{onClick:l,disabled:s,className:"bg-white border-none text-gray-500 hover:!text-gray-700",children:r.jsx(On,{className:"w-5 h-5"})})]}),r.jsx("div",{className:"flex justify-start mb-2",children:r.jsx(Tr,{ref:m,placeholder:"Enter search name",allowClear:!0,disabled:s,onChange:Kn.debounce(_,500),className:"search-input w-1/4 bg-white text-[#888] placeholder-gray-500 border border-gray-300"})}),r.jsx(xp,{modelList:d,loading:s,showTitle:!1})]})})};var fn=(o=>(o.START_POP_VIEW_AUTO_TIME="auto_time",o.START_POP_VIEW_ACCEPT_TIME="accept_time",o.MODELS_POP_VIEW_TIME="models_time",o.MODELS_POP_VIEW_SELECTED="models_selected",o.MODELS_POP_VIEW_LIST="models_list",o))(fn||{});const Ls=o=>localStorage.getItem(o),Es=(o,l)=>{localStorage.setItem(o,l)},yp=o=>{localStorage.removeItem(o)},_p=({className:o})=>r.jsxs("svg",{className:o,viewBox:"0 0 1024 1024",fill:"currentColor",children:[r.jsx("path",{d:"M928 576h-96.32V365.333333l86.826667-86.613333c12.48-12.48 12.48-32.746667 0.106666-45.226667-12.586667-12.586667-32.853333-12.48-45.333333-0.106666L786.453333 320H237.226667l-86.933334-86.613333c-12.48-12.48-32.746667-12.48-45.226666 0.106666-12.48 12.48-12.48 32.746667 0.106666 45.226667l87.146667 86.933333V576H96c-17.706667 0-32 14.293333-32 32s14.293333 32 32 32h96.32v29.653333c-0.213333 1.493333-0.32 2.986667-0.32 4.48 0 50.24 13.546667 97.493333 37.546667 138.986667l-92.053334 92.16c-12.48 12.48-12.48 32.746667 0 45.226667 6.293333 6.293333 14.4 9.386667 22.613334 9.386666s16.426667-3.093333 22.613333-9.386666l85.12-85.226667c58.773333 64.106667 146.346667 104.96 244.16 104.96 97.813333 0 185.493333-40.853333 244.16-104.96l85.226667 85.333333c6.293333 6.293333 14.4 9.386667 22.613333 9.386667s16.426667-3.093333 22.613333-9.386667c12.48-12.48 12.48-32.746667 0-45.226666l-92.16-92.266667c23.893333-41.493333 37.44-88.746667 37.44-138.986667 0-1.493333-0.106667-2.986667-0.32-4.48V640H928c17.706667 0 32-14.293333 32-32s-14.293333-32-32-32zM543.573333 904.533333c0.32-1.706667 0.426667-3.413333 0.426667-5.226666V544c0-17.706667-14.293333-32-32-32s-32 14.293333-32 32v355.413333c0 1.813333 0.106667 3.52 0.426667 5.226667-124.8-13.973333-222.08-109.76-224.426667-226.133333 0.213333-1.386667 0.32-2.773333 0.32-4.16V384h511.36v290.24c0 1.386667 0.106667 2.773333 0.213333 4.16-2.24 116.373333-99.52 212.16-224.32 226.133333z"}),r.jsx("path",{d:"M352 256h320c10.24 0 19.733333-4.8 25.813333-13.013333 5.973333-8.213333 7.786667-18.773333 4.8-28.48C674.453333 124.48 597.76 64 512 64c-85.866667 0-162.453333 60.48-190.506667 150.506667-3.093333 9.706667-1.28 20.266667 4.8 28.48 5.973333 8.213333 15.466667 13.013333 25.706667 13.013333z m160-128c43.84 0 84.48 24.533333 110.08 64H401.92c25.6-39.466667 66.24-64 110.08-64z"})]}),wp=({className:o})=>r.jsxs("svg",{className:o,viewBox:"0 0 1024 1024",fill:"currentColor",children:[r.jsx("path",{d:"M512.82 958.87c-25.38 0-49.1-12-63.45-32.21l-20.95-29.43a8 8 0 0 0-6.41-2.79l-319.1 1.72C46.17 896.16 0 852 0 797.7V165.3c0-54.3 46.17-98.45 102.91-98.45l256.13-1.72c50 0 97.12 18.21 132.6 51.28A182.32 182.32 0 0 1 512.9 140a184.56 184.56 0 0 1 21.06-23.31c35.55-33.21 82.65-51.51 132.63-51.51h254.7c56.74 0 102.91 44.17 102.91 98.46V796c0 54.29-46.17 98.45-102.91 98.45H603.63a8 8 0 0 0-6.42 2.79l-20.94 29.43c-14.35 20.16-38.07 32.2-63.45 32.2z m-409.91-822c-18.15 0-32.91 12.76-32.91 28.45V797.7c0 15.69 14.76 28.46 32.91 28.46l319.1-1.72c25.38 0 49.1 12 63.45 32.2l20.94 29.44c1.84 2.58 5.38 2.79 6.42 2.79s4.57-0.21 6.41-2.79l21-29.44c14.35-20.16 38.06-32.2 63.45-32.2h317.61c18.15 0 32.91-12.76 32.91-28.45v-632.4c0-15.69-14.76-28.46-32.91-28.46h-254.7c-65.49 0-118.77 48.76-118.77 108.68v461a35 35 0 1 1-70 0v-461c0-28.76-12-55.82-33.9-76.19-22.48-21-52.62-32.49-84.88-32.49z"}),r.jsx("path",{d:"M362.52 330.46H197.37a35 35 0 0 1 0-70h165.15a35 35 0 0 1 0 70zM298.32 482.71h-101a35 35 0 0 1 0-70h101a35 35 0 0 1 0 70zM828.16 330.46H663.02a35 35 0 0 1 0-70h165.14a35 35 0 0 1 0 70zM828.16 482.71H727.21a35 35 0 0 1 0-70h100.95a35 35 0 0 1 0 70z"})]}),vp=({className:o})=>r.jsx("svg",{className:o,viewBox:"0 0 1024 1024",fill:"currentColor",children:r.jsx("path",{d:"M820.376748 284.430361v228.885113a20.509419 20.509419 0 0 0 41.018838 0V249.974538a19.689042 19.689042 0 0 0-2.871319-9.434333v-2.050942a21.739984 21.739984 0 0 0-5.332449-5.332448L423.314402 2.630948a20.509419 20.509419 0 0 0-20.09923 0L10.254709 232.336438a13.946405 13.946405 0 0 0-4.92226 4.92226v2.461131a16.407535 16.407535 0 0 0-5.332449 10.254709v533.244886a8.203767 8.203767 0 0 0 2.46113 2.871319l2.871319 2.871319 392.960462 229.295301a20.09923 20.09923 0 0 0 20.099231 0l196.890419-100.085964a20.919607 20.919607 0 0 0 8.203768-27.892809 20.509419 20.509419 0 0 0-27.89281-8.613956l-164.075349 87.780312v-243.651894l189.917217-102.136905a20.509419 20.509419 0 0 0 11.075086-18.048289V383.695948zM41.018837 287.30168l184.17458 105.8286V615.452379l2.461131 3.281507a11.075086 11.075086 0 0 0 3.281507 2.871319l157.512335 91.882196v252.676038L41.018837 762.710006z m351.941625 210.016448v172.279117l-126.748207-75.88485v-176.381L394.191028 492.395867a22.150172 22.150172 0 0 0-1.230566 3.281507z m20.919608-41.018838l-137.413106-82.037675 146.43725-85.72937L574.263724 369.339355z m0-410.188374l382.295564 205.094187L615.282561 347.189183l-182.944015-98.855399a20.509419 20.509419 0 0 0-20.09923 0L235.448127 351.701255 61.118068 249.974538z m180.072696 549.242233l-159.973466 86.139559v-185.815334-3.691695l160.383654-86.139559zM1066.489773 841.876362a20.509419 20.509419 0 0 0-29.123375 0l-98.035021 95.984079v-229.295301a20.509419 20.509419 0 0 0-41.018837 0v229.295301l-95.98408-95.984079a20.509419 20.509419 0 0 0-29.123375 0 20.509419 20.509419 0 0 0 0 28.713186l131.26028 131.26028a20.919607 20.919607 0 0 0 28.713186 0l131.26028-131.26028a20.509419 20.509419 0 0 0 2.050942-28.713186z"})}),ac=x.forwardRef(({input:o,loading:l,onChange:s,onSend:c,onKeyPress:d,onUploadImages:f,uploadedImages:m,onRemoveImage:g,selectedModel:_,onModelChange:S,onStop:v,onAddDebugMessage:j,agentMode:I=!1,onAgentModeToggle:N,voiceMode:L=!1,onVoiceModeToggle:W},z)=>{const{state:U,dispatch:se}=kn(),{messages:Z}=U,[H,R]=x.useState([]),B=x.useRef(null),[V,X]=x.useState(!1),[y,ee]=x.useState(!1),[oe,F]=x.useState(!1),pe=x.useRef(null),[ge,ae]=x.useState(0);x.useEffect(()=>{ct.voiceCapabilities().then(T=>{F(T.tts||T.stt)}).catch(()=>F(!1))},[]),x.useEffect(()=>{const T=B.current;if(!T)return;const te=()=>{requestAnimationFrame(()=>{const Fe=T.style.cssText;T.style.height="auto",T.style.minHeight="auto",T.style.cssText=Fe})},Q=new ResizeObserver(te);Q.observe(T);const Se=new MutationObserver(te);return Se.observe(T,{childList:!0,subtree:!0,characterData:!0}),te(),()=>{Q.disconnect(),Se.disconnect()}},[]),x.useLayoutEffect(()=>{B.current&&(B.current.style.height="auto",B.current.style.height=`${Math.min(B.current.scrollHeight,400)}px`)},[o]);const de=T=>{const te=Ls(fn.MODELS_POP_VIEW_SELECTED);te&&T.findIndex(Q=>Q.name===te)!==-1?S(te):S(T[0].name),Es(fn.MODELS_POP_VIEW_LIST,JSON.stringify(T)),R(T)},le=async()=>{X(!0),yp(fn.MODELS_POP_VIEW_TIME);try{const T=await ct.listModels();T.models&&T.models.length>0?(de(T.models),Es(fn.MODELS_POP_VIEW_TIME,new Date().getTime().toString())):(console.warn("listModels returned empty, using fallback"),G())}catch(T){console.error("Failed to load models:",T),G()}X(!1)},G=()=>{de([{label:"gemini-2.5-flash",name:"gemini-2.5-flash",image_enable:!0},{label:"gpt-4.1-mini",name:"gpt-4.1-mini-2025-04-14-GlobalStandard",image_enable:!0},{label:"gpt-4.1",name:"gpt-4.1-2025-04-14-GlobalStandard",image_enable:!0}])};x.useImperativeHandle(z,()=>({refreshModels:le}),[]),x.useEffect(()=>{const T=new Date().getTime(),te=Ls(fn.MODELS_POP_VIEW_TIME);if(Number(te)&&T-Number(te)<1e3*60*60*24){const Q=Ls(fn.MODELS_POP_VIEW_LIST);if(Q){de(JSON.parse(Q));return}}le()},[]);const ze=async T=>{if(T.size!==0)try{const te=await ct.speechToText(T);if(te){const Q=B.current;if(Q){const Se=Object.getOwnPropertyDescriptor(window.HTMLTextAreaElement.prototype,"value")?.set,Fe=(Q.value?Q.value+" ":"")+te;Se?.call(Q,Fe),Q.dispatchEvent(new Event("input",{bubbles:!0})),L&&setTimeout(()=>c(),150)}}}catch(te){console.error("STT failed:",te)}},ue=async()=>{pe.current&&await pe.current.stop();const T=new rp({silenceMs:1800,silenceThreshold:.012,onSilenceStop:te=>{ee(!1),ae(0),ze(te)},onVolumeChange:te=>{ae(Math.min(te*10,1))},onStart:()=>{ee(!0)},onError:te=>{console.error("Microphone access denied:",te),ee(!1)}});pe.current=T,await T.start()},ie=async()=>{if(pe.current){const T=await pe.current.stop();pe.current=null,ee(!1),ae(0),T&&ze(T)}},ke=()=>{y?ie():ue()},J=()=>{if(ct.trackEvent({event_type:"debug_icon_click",message_type:"debug",data:{}}),j){Z?.[0]?.role==="showcase"&&se({type:"CLEAR_MESSAGES"});const T={id:it(),role:"ai",content:JSON.stringify({text:"Would you like me to help you debug the current workflow on the canvas?",ext:[]}),format:"debug_guide",name:"Assistant"};j(T)}},ye=T=>{T==="reload"?le():S(T)};return r.jsxs("div",{className:`relative ${m.length>0?"mt-12":""}`,children:[m.length>0&&r.jsx("div",{className:"absolute -top-10 left-0 grid grid-cols-3 gap-2 w-1/2",children:m.map(T=>r.jsxs("div",{className:"relative group",children:[r.jsx("img",{src:T.preview,alt:"uploaded",className:"w-full h-12 object-contain"}),T?.url&&T?.url!==""?r.jsx("button",{onClick:()=>g(T.id),className:`absolute -top-1 -right-1 bg-white border-none text-gray-500 rounded-full p-0.5\r
                                             opacity-0 group-hover:!opacity-100 transition-opacity`,children:r.jsx(On,{className:"w-3 h-3"})}):r.jsx(sc,{})]},T.id))}),r.jsxs("div",{className:"w-full flex flex-row justify-end p-1 gap-2",children:[r.jsx(to,{buttonClass:`rounded-md bg-white border-none \r
                                hover:!bg-gray-100`,buttonContent:r.jsx(vp,{className:"h-5 w-5"}),onOpen:()=>{ct.trackEvent({event_type:"model_download_icon_click",message_type:"ui",data:{}})},renderModal:T=>r.jsx(bp,{onClose:T})}),r.jsx(to,{buttonClass:`rounded-md bg-white border-none \r
                                hover:!bg-gray-100`,buttonContent:r.jsx(wp,{className:"h-5 w-5"}),renderModal:T=>r.jsx(lp,{onClose:T})}),r.jsx("button",{onClick:J,className:`rounded-md bg-white border-none \r
                                hover:!bg-gray-100`,children:r.jsx(_p,{className:"h-5 w-5"})})]}),r.jsx("textarea",{ref:B,onChange:s,onKeyDown:T=>{if(T.key==="Enter"&&!T.shiftKey){if(T.nativeEvent.isComposing)return;T.preventDefault(),o.trim()!==""&&c()}d(T)},value:o,placeholder:"Type your message...",className:`w-full min-h-[80px] max-h-[400px] resize-none rounded-md border \r
                         border-gray-200 px-3 py-2 pr-12 pb-10 text-[14px] shadow-sm \r
                         focus:outline-none focus:ring-2 focus:ring-blue-500 \r
                         focus:border-transparent bg-white transition-all \r
                         duration-200 text-gray-700 overflow-y-auto`,style:{height:"80px"}}),r.jsxs("div",{className:`absolute bottom-2 left-3 right-12 flex items-center gap-1.5 \r
                          bg-white border-t border-gray-100 pt-1 z-10`,children:[r.jsxs("div",{className:"border-r border-gray-100 flex flex-row items-center pr-1.5 min-w-0 flex-shrink",children:[r.jsx("button",{className:`p-1 rounded cursor-pointer ${V?"text-gray-200":"text-gray-500 hover:!text-gray-600 hover:!bg-gray-100 active:!scale-90"} transition-all`,onClick:le,disabled:V,children:r.jsx(Tg,{className:`w-4 h-4 transition-transform ${V?"animate-spin":""}`})}),r.jsx("select",{value:_,disabled:V,onChange:T=>ye(T.target.value),className:`px-1 py-0.5 text-xs rounded-md min-w-0\r
                                bg-white text-gray-700\r
                                focus:outline-none focus:ring-1 focus:ring-blue-500\r
                                focus:border-transparent hover:bg-gray-50\r
                                transition-colors border-0`,style:{maxWidth:"180px"},children:H?.map(T=>{const te=T.tier||"red",Q=te==="green"?"🟢":te==="yellow"?"🟡":"🔴";return r.jsxs("option",{value:T.name,children:[Q," ",T.label]},T.name)})})]}),r.jsx(to,{buttonClass:`flex-shrink-0 p-1.5 text-gray-500 bg-white border-none
                        hover:!bg-gray-100 hover:!text-gray-600 
                        transition-all duration-200 outline-none
                        ${H?.find(T=>T.name===_)?.image_enable?"":"opacity-50 cursor-not-allowed"}`,buttonContent:r.jsx(Pg,{className:"h-4 w-4"}),renderModal:T=>r.jsx(dp,{onUploadImages:f,uploadedImages:m,onRemoveImage:g,onClose:T})}),oe&&r.jsx("button",{onClick:ke,className:`flex-shrink-0 p-1.5 rounded-md border-none transition-all duration-200 outline-none cursor-pointer relative
                        ${y?"bg-red-50 text-red-500 hover:!bg-red-100":"bg-white text-gray-500 hover:!bg-gray-100 hover:!text-gray-600"}`,title:y?"Stop recording (or wait for silence)":"Voice input (auto-stops on silence)",style:y?{boxShadow:`0 0 0 ${Math.max(1,ge*6)}px rgba(239, 68, 68, ${.2+ge*.4})`}:void 0,children:y?r.jsx(Dg,{className:"h-4 w-4"}):r.jsx(Og,{className:"h-4 w-4"})}),oe&&W&&r.jsx("button",{onClick:()=>W(!L),className:`flex-shrink-0 p-1.5 rounded-md border-none transition-all duration-200 outline-none cursor-pointer
                            ${L?"bg-purple-50 text-purple-600 hover:!bg-purple-100":"bg-white text-gray-400 hover:!bg-gray-100 hover:!text-gray-600"}`,title:L?"Voice Mode ON — responses read aloud as they stream":"Enable Voice Mode (auto-read responses)",children:r.jsx(Fg,{className:"h-4 w-4"})}),N&&r.jsxs("button",{onClick:()=>N(!I),className:`flex-shrink-0 p-1 rounded-md border transition-all duration-200 text-xs font-medium flex items-center gap-1
                            ${I?"bg-blue-50 border-blue-300 text-blue-700 hover:!bg-blue-100":"bg-white border-gray-200 text-gray-500 hover:!bg-gray-100 hover:!text-gray-600"}`,title:I?"Agent Mode ON — autonomous planner":"Enable Agent Mode",children:[r.jsx("span",{className:"text-sm",children:"🤖"}),r.jsx("span",{className:"hidden sm:inline",children:"Agent"})]})]}),r.jsx("button",{type:"submit",onClick:l?v:c,disabled:l?!1:o.trim()==="",className:`absolute bottom-3 right-3 p-2 rounded-md text-gray-500 bg-white border-none \r
                         hover:!bg-gray-100 hover:!text-gray-600 disabled:opacity-50 \r
                         transition-all duration-200 active:scale-95 z-10`,children:l?r.jsx(Rg,{className:"h-5 w-5 text-red-500 hover:text-red-600"}):r.jsx(zg,{className:"h-5 w-5 group-hover:translate-x-1"})})]})});ac.displayName="ChatInput";function kp(o){const l=o[0],s=new Set;function c(d,f){if(!(!d||f>=1)&&d.inputs)for(const m of Object.values(d.inputs)){const g=m.link;if(g&&$e.graph.links[g]){const _=$e.graph.links[g].origin_id,S=$e.graph._nodes_by_id[_];S&&(s.add(S.type),c(S,f+1))}}}return l?(c(l,0),[{type:"upstream_node_types",data:Array.from(s)}]):null}function Sp({nodeInfo:o,onSendWithIntent:l,loading:s,onSendWithContent:c}){return console.log("SelectedNodeInfo nodeInfo:",o[0]),r.jsx("div",{className:"mb-3 p-3 rounded-md bg-gray-50 border border-gray-200",children:r.jsxs("div",{className:"text-sm text-gray-700",children:[r.jsxs("p",{children:["Selected node: ",o[0].type]}),r.jsxs("div",{className:"flex gap-2 mt-2",children:[r.jsx("button",{className:`px-3 py-1 text-xs rounded-md bg-blue-50 \r
                                 text-blue-700 hover:bg-blue-100`,onClick:()=>c(`Reply in ${navigator.language} language: How does the ${o[0].type} node work? I need its official usage guide.`),disabled:s,children:"Usage"}),r.jsx("button",{className:`px-3 py-1 text-xs rounded-md bg-green-100 \r
                                 text-green-700 hover:bg-green-200`,onClick:()=>c(`Reply in ${navigator.language} language: Show me the technical specifications for the ${o[0].type} node's inputs and outputs.`),disabled:s,children:"Parameters"}),r.jsx("button",{className:`px-3 py-1 text-xs rounded-md bg-purple-100 \r
                                 text-purple-700 hover:bg-purple-200`,onClick:()=>l("downstream_subgraph_search",kp(o)),disabled:s,children:"Downstream Nodes"})]})]})})}function Ip(){return r.jsx(nc,{name:"Assistant",children:r.jsxs("div",{className:"flex items-center space-x-2 p-4 bg-gray-50 rounded-lg",children:[r.jsxs("div",{className:"flex space-x-1",children:[r.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0ms"}}),r.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"150ms"}}),r.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"300ms"}})]}),r.jsx("span",{className:"text-sm text-gray-500",children:"AI is thinking..."})]})})}const jp=({children:o,className:l,borderClassName:s})=>{const c=Ug();return r.jsx("div",{className:"sticky w-full",children:r.jsxs("div",{className:`relative ${l||""} ${c?"beautify-card-dark":"beautify-card-light"}`,children:[r.jsx("div",{className:`card-border ${s||""}`}),o]})})},Cp=2,Np=[r.jsxs("svg",{viewBox:"0 0 1024 1024",width:"16",height:"16",fill:"currentColor",children:[r.jsx("path",{d:"M149.333333 661.333333h213.333334v213.333334H149.333333zM753.066667 411.733333l-119.466667-119.466666c-8.533333-8.533333-8.533333-21.333333 0-29.866667l119.466667-119.466667c8.533333-8.533333 21.333333-8.533333 29.866666 0l119.466667 119.466667c8.533333 8.533333 8.533333 21.333333 0 29.866667l-119.466667 119.466666c-8.533333 8.533333-21.333333 8.533333-29.866666 0z",fill:"currentColor","p-id":"27396"}),r.jsx("path",{d:"M256 277.333333m-128 0a128 128 0 1 0 256 0 128 128 0 1 0-256 0Z",fill:"currentColor","p-id":"27397"}),r.jsx("path",{d:"M768 768m-128 0a128 128 0 1 0 256 0 128 128 0 1 0-256 0Z",fill:"currentColor","p-id":"27398"}),r.jsx("path",{d:"M234.666667 512h42.666666v106.666667h-42.666666z",fill:"currentColor","p-id":"27399"}),r.jsx("path",{d:"M256 448l-64 85.333333h128z",fill:"currentColor","p-id":"27400"}),r.jsx("path",{d:"M426.666667 256h106.666666v42.666667h-106.666666z",fill:"currentColor","p-id":"27401"}),r.jsx("path",{d:"M597.333333 277.333333l-85.333333-64v128z",fill:"currentColor","p-id":"27402"}),r.jsx("path",{d:"M746.666667 448h42.666666v106.666667h-42.666666z",fill:"currentColor","p-id":"27403"}),r.jsx("path",{d:"M768 618.666667l64-85.333334h-128z",fill:"currentColor","p-id":"27404"})]}),r.jsxs("svg",{viewBox:"0 0 1024 1024",width:"16",height:"16",fill:"currentColor",children:[r.jsx("path",{d:"M512 1024C229.2224 1024 0 794.7776 0 512S229.2224 0 512 0s512 229.2224 512 512-229.2224 512-512 512z m0-53.9136a458.0864 458.0864 0 1 0 0-916.1728 458.0864 458.0864 0 0 0 0 916.1728z",fill:"currentColor","p-id":"11651"}),r.jsx("path",{d:"M363.5712 657.9712a8.8576 8.8576 0 0 1 8.8576 8.8576v143.5136A8.8576 8.8576 0 0 1 363.52 819.2H220.5184a8.8576 8.8576 0 0 1-8.8064-9.3184v-143.0528c0-4.864 3.9424-8.8576 8.8064-8.8576h143.0528z m222.6688 0c4.9152 0 8.96 3.9424 9.0624 8.8576v143.0528a9.1136 9.1136 0 0 1-9.0624 8.8064H443.392a9.1136 9.1136 0 0 1-9.1136-8.8064v-143.0528a9.1136 9.1136 0 0 1 9.1136-8.8576h142.7968z m216.5248 0c4.9152 0 8.96 3.9424 9.0624 8.8576v143.0528a9.1136 9.1136 0 0 1-9.0624 8.8064h-142.848a9.1136 9.1136 0 0 1-9.0624-8.8064v-143.0528a9.1136 9.1136 0 0 1 9.1136-8.8576h142.7968z m-25.1904 33.2288h-90.8288a5.7856 5.7856 0 0 0-5.7856 5.632v91.136c0.1024 3.1232 2.6624 5.632 5.7856 5.632h90.8288a5.7856 5.7856 0 0 0 5.7856-5.632v-91.136a5.7856 5.7856 0 0 0-5.7856-5.632z m-215.04 0H471.7056a5.7856 5.7856 0 0 0-5.7856 5.632v91.136c0.1024 3.1232 2.6624 5.632 5.7856 5.632h90.8288a5.7856 5.7856 0 0 0 5.7856-5.632v-91.136a5.7856 5.7856 0 0 0-5.7856-5.632z m-225.28 0H246.4256a5.7856 5.7856 0 0 0-5.7856 5.632v91.136c0.1024 3.1232 2.6624 5.632 5.7856 5.632h90.8288a5.7856 5.7856 0 0 0 5.7856-5.632v-91.136a5.7856 5.7856 0 0 0-5.7856-5.632zM608.8192 204.8H414.72c-6.3488 0-12.032 3.9424-12.032 8.8576v143.0016c0 4.9152 5.4272 8.8576 12.032 8.8576h194.1504c6.656 0 12.0832-3.9424 12.0832-8.8576V213.6576c0-4.9152-5.4272-8.8576-12.0832-8.8576z m53.3504 419.0208v-107.4176h-136.3968v107.1616h-27.2896v-107.1616H361.3696v107.4176h-27.2896V489.3696h163.6864V394.752h27.7504v94.6176h163.9424v134.4512h-27.2896zM584.6528 235.52c5.0176 0 9.1136 2.5088 9.2672 5.632v91.136c-0.1536 3.1232-4.2496 5.632-9.216 5.632H439.296c-4.9664 0-9.0624-2.5088-9.216-5.632V241.152c0.1536-3.1232 4.2496-5.632 9.216-5.632h145.408z",fill:"currentColor","p-id":"11652"})]}),r.jsx("svg",{viewBox:"0 0 1024 1024",width:"16",height:"16",fill:"currentColor",children:r.jsx("path",{d:"M800 960 224 960c-52.928 0-96-43.072-96-96L128 224c0-52.928 43.072-96 96-96l448 0c17.696 0 32 14.336 32 32s-14.304 32-32 32L224 192C206.368 192 192 206.368 192 224l0 640c0 17.664 14.368 32 32 32l576 0c17.664 0 32-14.336 32-32L832 352c0-17.664 14.304-32 32-32s32 14.336 32 32l0 512C896 916.928 852.928 960 800 960zM612 448c-8.192 0-16.384-3.136-22.624-9.376-12.512-12.512-12.512-32.736 0-45.248l318.016-318.016c12.512-12.512 32.736-12.512 45.248 0s12.512 32.736 0 45.248l-318.016 318.016C628.384 444.896 620.192 448 612 448zM480 448 288 448c-17.664 0-32-14.336-32-32s14.336-32 32-32l192 0c17.664 0 32 14.336 32 32S497.664 448 480 448zM672 640 288 640c-17.664 0-32-14.304-32-32s14.336-32 32-32l384 0c17.696 0 32 14.304 32 32S689.696 640 672 640z",fill:"currentColor","p-id":"17265"})}),r.jsx("svg",{viewBox:"0 0 1024 1024",width:"16",height:"16",fill:"currentColor",children:r.jsx("path",{d:"M812.8 204.8c-6.4-12.8-12.8-25.6-25.6-32L633.6 70.4c-6.4 0-12.8-6.4-19.2-6.4-25.6-6.4-51.2 6.4-70.4 32l-384 595.2c-6.4 12.8-12.8 25.6-12.8 38.4l19.2 185.6v12.8c6.4 12.8 12.8 25.6 32 25.6h25.6l166.4-70.4c12.8-6.4 25.6-12.8 32-25.6l384-595.2c12.8-19.2 12.8-38.4 6.4-57.6z m-224-44.8c6.4-12.8 19.2-12.8 32-12.8l6.4 6.4 96 64c12.8 6.4 19.2 25.6 6.4 38.4l-38.4 57.6-140.8-96 38.4-57.6zM384 787.2l-19.2 19.2-96 51.2c-6.4 0-12.8 6.4-19.2 0-12.8 0-19.2-12.8-19.2-25.6v-115.2c0-12.8 6.4-19.2 12.8-32L512 275.2l140.8 89.6L384 787.2zM256 249.6s-6.4 0-6.4 6.4l-25.6 19.2c-6.4 12.8-19.2 19.2-38.4 19.2h-6.4l-32-6.4c-6.4 0-6.4 0-6.4 6.4-6.4 6.4-6.4 12.8 0 12.8l25.6 25.6c12.8 12.8 19.2 25.6 12.8 44.8v38.4H192l19.2-25.6c19.2-12.8 32-19.2 44.8-19.2h38.4c6.4 0 12.8-6.4 12.8-12.8 0 0 0-6.4-6.4-6.4l-25.6-19.2c-6.4-12.8-12.8-25.6-12.8-44.8V256s0-6.4-6.4-6.4c6.4 0 0 0 0 0zM697.6 691.2c-6.4 0-6.4 0-6.4 6.4l-25.6 32c-12.8 12.8-32 25.6-51.2 25.6H576c-6.4 0-6.4 0-12.8 6.4s-6.4 12.8 0 19.2l32 25.6c12.8 12.8 25.6 25.6 25.6 51.2v38.4c0 6.4 0 6.4 6.4 6.4h6.4c6.4 0 6.4 0 6.4-6.4l25.6-32c12.8-12.8 25.6-25.6 44.8-25.6h38.4c6.4 0 6.4 0 12.8-6.4s6.4-12.8 0-19.2l-32-25.6c-12.8-12.8-19.2-25.6-25.6-44.8V704c0-6.4 0-6.4-6.4-6.4 6.4-6.4 6.4-6.4 0-6.4zM812.8 435.2c-6.4 0-6.4 6.4-6.4 6.4v25.6c0 12.8-6.4 25.6-19.2 38.4l-25.6 19.2-6.4 6.4v6.4l6.4 6.4h32c12.8 0 25.6 6.4 32 19.2l12.8 25.6 6.4 6.4c6.4 0 6.4-6.4 6.4-6.4v-25.6c0-12.8 6.4-25.6 19.2-32l19.2-19.2 6.4-6.4c0-6.4-6.4-12.8-6.4-12.8h-25.6c-12.8 0-25.6-6.4-32-19.2l-12.8-25.6c0-12.8-6.4-12.8-6.4-12.8z","p-id":"43213"})}),r.jsxs("svg",{viewBox:"0 0 1024 1024",width:"16",height:"16",fill:"currentColor",children:[r.jsx("path",{d:"M256 85.333333h85.333333v85.333334H256V85.333333zM426.666667 469.333333h170.666666v85.333334h-170.666666v-85.333334zM597.333333 640h-170.666666v85.333333h170.666666v-85.333333z","p-id":"36367"}),r.jsx("path",{d:"M682.666667 170.666667h-85.333334v85.333333h-170.666666V170.666667H341.333333v85.333333H256v128H170.666667V298.666667H85.333333v85.333333h85.333334v85.333333h85.333333v85.333334H85.333333v85.333333h170.666667v85.333333H170.666667v85.333334H85.333333v85.333333h85.333334v-85.333333h85.333333v128h512v-128h85.333333v85.333333h85.333334v-85.333333h-85.333334v-85.333334h-85.333333v-85.333333h170.666667v-85.333333h-170.666667v-85.333334h85.333333V384h85.333334V298.666667h-85.333334v85.333333h-85.333333V256h-85.333333V170.666667zM341.333333 853.333333V341.333333h341.333334v512H341.333333z","p-id":"36368"}),r.jsx("path",{d:"M682.666667 170.666667V85.333333h85.333333v85.333334h-85.333333z","p-id":"36369"})]}),r.jsx("svg",{viewBox:"0 0 1024 1024",width:"16",height:"16",fill:"currentColor",children:r.jsx("path",{d:"M153.6 204.8a128 128 0 0 1 128-128h386.9696c21.6576 0 41.984 9.1136 56.6272 24.4736 14.7968 15.5648 37.888 39.168 59.904 58.88 18.688 16.6912 47.36 46.08 64.0512 63.3856 13.824 14.2336 21.248 33.28 21.248 52.8384V819.2a128 128 0 0 1-128 128h-460.8A128 128 0 0 1 153.6 819.2V204.8z m665.6 76.8v-5.2224a24.8832 24.8832 0 0 0-6.912-17.3056c-16.896-17.5616-44.288-45.568-61.3376-60.7744-23.552-21.0944-47.7696-45.8752-62.8736-61.7472a27.0336 27.0336 0 0 0-19.456-8.5504H665.6V256a25.6 25.6 0 0 0 25.6 25.6H819.2z m-204.8-153.6H281.6A76.8 76.8 0 0 0 204.8 204.8v614.4a76.8 76.8 0 0 0 76.8 76.8h460.8A76.8 76.8 0 0 0 819.2 819.2V332.8h-128A76.8 76.8 0 0 1 614.4 256V128zM332.8 307.2a25.6 25.6 0 0 1 25.6-25.6h102.4a25.6 25.6 0 1 1 0 51.2H358.4a25.6 25.6 0 0 1-25.6-25.6z m0 153.6a25.6 25.6 0 0 1 25.6-25.6h307.2a25.6 25.6 0 1 1 0 51.2H358.4a25.6 25.6 0 0 1-25.6-25.6z m0 153.6a25.6 25.6 0 0 1 25.6-25.6h307.2a25.6 25.6 0 1 1 0 51.2H358.4a25.6 25.6 0 0 1-25.6-25.6z",fill:"currentColor","p-id":"24974"})}),r.jsx("svg",{viewBox:"0 0 1024 1024",width:"16",height:"16",fill:"currentColor",children:r.jsx("path",{d:"M960.547341 839.611479l0-656.56349c0-119.372761-102.850459-119.372761-119.385041-119.372761L184.573227 63.675228c-16.471137 0-119.346155 0-119.346155 119.372761l0 656.56349c0 119.378901 119.346155 119.378901 119.346155 119.378901l656.589073 0c34.458813 0 58.69582-10.053983 76.130911-24.249287 1.105171-0.816598 2.211365-1.633197 3.316535-2.533706 3.960195-3.497661 7.637957-7.231705 10.839883-11.109012 0.938372-1.105171 1.696642-2.301416 2.571568-3.496637C960.367239 883.154181 960.547341 839.611479 960.547341 839.611479L960.547341 839.611479zM187.453834 128.375809l645.788076 0c16.265452 0 58.69582 0 58.69582 58.721403l0 645.725654c0 0-0.115634 33.892925-25.998117 50.125631-43.075051-45.201481-161.341618-169.178097-191.248765-199.054545-22.205745-22.237467-45.170782-27.27725-59.160401-26.51898-30.048363 0.405229-49.489134 19.260669-50.891064 20.893866l-61.872163 53.919027c-12.562107 11.919471-22.964014 1.511423-28.004821-3.554966-37.827537-37.8347-111.092168-103.230106-120.311133-111.394043-6.055926-6.088672-27.502377-25.118074-58.426691-25.851784-16.175401-0.784876-40.720424 4.314259-65.343217 28.943193-22.938432 22.964014-66.950831 63.530942-101.925391 95.418186L128.755967 187.097212C128.756991 128.375809 171.252851 128.375809 187.453834 128.375809L187.453834 128.375809zM128.756991 830.636061l0-28.505217c26.873044-24.218588 110.809735-100.137675 147.1852-136.571469 4.718465-4.685719 11.186783-10.986215 18.361183-10.254551 7.522324 0.058328 14.400988 6.583952 14.452153 6.583952l0 0 2.391467 2.359744c0.822738 0.700965 80.207763 71.380724 118.408807 109.61349 23.298636 23.318078 47.188742 26.784016 62.052265 27.774577 32.92897-0.437975 54.736649-22.438035 54.91675-22.817682l61.782112-53.803393c6.351662-5.998621 12.292977-4.776793 21.215184 4.081968 23.080671 23.136953 102.991676 106.637716 156.185178 162.363901-139.251507-0.058328-540.893051-0.264013-594.22777-0.264013C126.776893 891.287419 128.756991 830.636061 128.756991 830.636061L128.756991 830.636061zM662.076552 549.130665c83.550904 0 151.582347-68.108191 151.582347-151.755286 0-83.672678-68.030419-151.755286-151.582347-151.755286-83.563184 0-151.581324 68.082608-151.581324 151.755286C510.495228 481.022475 578.513368 549.130665 662.076552 549.130665L662.076552 549.130665zM662.076552 309.59515c48.293913 0 87.575568 39.370683 87.575568 87.781252s-39.281655 87.754646-87.575568 87.754646-87.574544-39.3451-87.574544-87.754646S613.782639 309.59515 662.076552 309.59515L662.076552 309.59515zM662.076552 309.59515",fill:"currentColor","p-id":"26245"})}),r.jsx("svg",{viewBox:"0 0 1024 1024",width:"16",height:"16",fill:"currentColor",children:r.jsx("path",{d:"M625.7664 886.6816V739.5328h147.1488L625.7664 886.6816z m-398.2336 23.552V113.7664h568.9344v568.9344H625.7664c-31.4368 0-56.9344 25.3952-56.9344 56.9344V910.336l-341.2992-0.1024zM796.4672 56.9344H227.5328c-31.4368 0-56.9344 25.3952-56.9344 56.9344V910.336c0 31.4368 25.3952 56.9344 56.9344 56.9344h374.6816c15.0528 0 29.5936-6.0416 40.2432-16.6912l40.2432-40.2432 113.7664-113.7664 40.2432-40.2432c10.6496-10.6496 16.6912-25.1904 16.6912-40.2432V113.7664c-0.1024-31.4368-25.4976-56.832-56.9344-56.832zM654.2336 227.5328H369.7664c-15.6672 0-28.4672 12.6976-28.4672 28.4672 0 15.6672 12.6976 28.4672 28.4672 28.4672h284.4672c15.6672 0 28.4672-12.6976 28.4672-28.4672 0-15.6672-12.8-28.4672-28.4672-28.4672m0 113.7664H369.7664c-15.6672 0-28.4672 12.6976-28.4672 28.4672 0 15.6672 12.6976 28.4672 28.4672 28.4672h284.4672c15.6672 0 28.4672-12.6976 28.4672-28.4672 0-15.6672-12.8-28.4672-28.4672-28.4672M540.4672 455.0656H369.7664c-15.6672 0-28.4672 12.6976-28.4672 28.4672 0 15.6672 12.6976 28.4672 28.4672 28.4672h170.7008c15.6672 0 28.4672-12.6976 28.4672-28.4672 0-15.6672-12.8-28.4672-28.4672-28.4672",fill:"currentColor","p-id":"20502"})}),r.jsx("svg",{viewBox:"0 0 1024 1024",width:"16",height:"16",fill:"currentColor",children:r.jsx("path",{d:"M812.885333 302.08v227.370667a42.666667 42.666667 0 1 0 85.333334 0V302.08q0-74.197333-52.48-126.634667-52.48-52.48-126.634667-52.48H264.405333q-74.154667 0-126.634666 52.48Q85.333333 227.925333 85.333333 302.08v454.698667q0 74.197333 52.48 126.634666 52.394667 52.394667 126.506667 52.48h341.12a42.666667 42.666667 0 1 0 0-85.333333H372.053333l278.058667-261.76 38.954667 38.784a42.666667 42.666667 0 0 0 60.16-60.501333L681.045333 499.2a42.666667 42.666667 0 0 0-59.306666-0.853333L248.32 849.792Q170.666667 842.112 170.666667 756.778667V302.08q0-38.826667 27.477333-66.304 27.434667-27.434667 66.261333-27.434667h454.698667q93.781333 0 93.781333 93.738667z m-369.408 68.224q0-110.890667-110.848-110.890667-45.952 0-78.421333 32.469334-32.426667 32.469333-32.426667 78.421333 0 45.909333 32.426667 78.378667 32.469333 32.469333 78.421333 32.469333 45.909333 0 78.378667-32.469333 32.469333-32.469333 32.469333-78.378667z m-136.405333 0q0-25.557333 25.557333-25.557333 25.514667 0 25.514667 25.557333 0 25.514667-25.514667 25.514667-25.557333 0-25.557333-25.514667z m464.213333 427.221333q-14.890667 0-28.416-6.101333a42.666667 42.666667 0 0 0-56.405333 56.448q18.688 41.429333 56.917333 66.133333 38.186667 24.661333 83.669334 24.661334 63.914667 0 109.098666-45.226667Q981.333333 848.341333 981.333333 784.426667q0-45.482667-24.661333-83.669334-24.704-38.229333-66.133333-56.917333a42.666667 42.666667 0 0 0-56.448 56.405333q6.101333 13.525333 6.101333 28.373334 0 28.586667-20.181333 48.768t-48.768 20.181333z","p-id":"22383",fill:"currentColor"})})],Lp=({scrollRef:o})=>{const{dispatch:l,showcasIng:s}=kn(),{showcase_title:c,showcase_subtitle:d,showcase_list:f}=Ms(),m=(S,v=!1,j=()=>{})=>{let I=0;const N=it(),L=(W=!1)=>{if(!s.current)return;I+=Cp;const U=typeof S=="string"?S:S?.text||"",se=v?{id:N,role:"user",content:U.slice(0,I)}:{id:N,role:"ai",content:I>U.length&&S?.ext?JSON.stringify({text:U.slice(0,I),ext:S?.ext}):JSON.stringify({text:U.slice(0,I)}),finished:I>U.length,format:"markdown",name:"Assistant"};l({type:W?"ADD_MESSAGE":"UPDATE_MESSAGE",payload:se}),I<=U.length?setTimeout(()=>{L()},10):setTimeout(()=>{j()},500)};L(!0)},g=(S,v)=>{l({type:"SET_LOADING",payload:!0}),m(S,!0,v)},_=(S,v)=>{l({type:"SET_LOADING",payload:!1}),m(S,!1,v)};return r.jsx(nc,{name:"showcase",children:r.jsxs("div",{className:"bg-gray-100 p-4 rounded-lg",children:[r.jsx("div",{className:"text-xl text-gray-900 font-extrabold text-center mb-2",children:c}),r.jsx("div",{className:"w-full mb-4 flex justify-center items-center",children:r.jsx(io,{children:d})}),f?.map((S,v)=>r.jsx("div",{onClick:()=>{o?.current&&(o.current.scrollTop=o.current.scrollHeight),s.current=!0;const j=S.messages||[];let I=0;const N=()=>{if(I<j.length){const L=j[I];L.role==="user"?g(L.content,N):_(JSON.parse(L.content||"{}")||"",N),I++}};setTimeout(N,100)},children:r.jsxs(jp,{className:"min-h-[50px] flex flex-row items-center mt-4 px-4 py-2 rounded-full mx-[1px] my-[1px]",borderClassName:"rounded-full",children:[r.jsx("div",{className:"text-[#4fabdb]",children:Np[v]}),r.jsx("div",{className:"flex-1 text-sm text-gray-700 font-normal ml-4",children:S.name})]})},v.toString()))]})})},lc=(o,l,s)=>{const c=new Map;for(const d of o)c.set(d[s],{...d});for(const d of l){const f=d[s];c.set(f,{...c.get(f)??{},...d})}return Array.from(c.values())},Dn=o=>o!==null&&typeof o=="object"&&!Array.isArray(o),Ap=o=>`https://ui-avatars.com/api/?name=${o||"User"}&background=random`,Ns=x.lazy(()=>hn(()=>import("./message-components-vcAbzMOn.js").then(o=>o.O),__vite__mapDeps([0,1,2])).then(o=>({default:o.AIMessage}))),Ep=x.lazy(()=>hn(()=>import("./message-components-vcAbzMOn.js").then(o=>o.U),__vite__mapDeps([0,1,2])).then(o=>({default:o.UserMessage}))),Mp=x.lazy(()=>hn(()=>import("./WorkflowOption-DGjMCBYt.js"),__vite__mapDeps([3,2,1,0,4,5,6,7])).then(o=>({default:o.WorkflowOption}))),Tp=x.lazy(()=>hn(()=>import("./message-components-vcAbzMOn.js").then(o=>o.Q),__vite__mapDeps([0,1,2])).then(o=>({default:o.NodeSearch}))),Pp=x.lazy(()=>hn(()=>import("./message-components-vcAbzMOn.js").then(o=>o.Y),__vite__mapDeps([0,1,2])).then(o=>({default:o.DownstreamSubgraphs}))),Dp=x.lazy(()=>hn(()=>import("./message-components-vcAbzMOn.js").then(o=>o.Z),__vite__mapDeps([0,1,2])).then(o=>({default:o.NodeInstallGuide}))),Op=x.lazy(()=>hn(()=>import("./DebugGuide-C033E6Gd.js"),__vite__mapDeps([8,2,1,0])).then(o=>({default:o.DebugGuide}))),Ul=x.lazy(()=>hn(()=>import("./DebugResult-Dnw-e9dx.js"),__vite__mapDeps([9,2,1,0,4,5,6,7])).then(o=>({default:o.DebugResult}))),Fp=3;function Rp({messages:o,latestInput:l,onOptionClick:s,installedNodes:c,onAddMessage:d,onUpdateMessage:f,loading:m,isActive:g}){const[_,S]=x.useState(0),[v,j]=x.useState([]),I=x.useRef(null),N=x.useRef(0),L=x.useRef(0),W=x.useRef(0),z=x.useRef(0),U=x.useRef(0),se=x.useRef(!1),Z=x.useRef(new Set),H=x.useRef(!1);x.useEffect(()=>{o.length<Z.current.size/2&&Z.current.clear()},[o]);const R=y=>{const ee=[...y];for(let oe=0;oe<ee.length;oe++){const F=ee[oe];if((F.role==="ai"||F.role==="tool")&&F.content&&F.finished)try{const pe=JSON.parse(F.content);if(pe.ext){console.log(`[MessageList] Processing AI message ${oe} with ext:`,pe.ext);const ge=pe.ext.find(de=>de.type==="workflow_rewrite_checkpoint"||de.type==="debug_checkpoint"&&de.data?.checkpoint_type==="workflow_rewrite_start"),ae=pe.ext.find(de=>de.type==="workflow_rewrite_complete");if(ge&&oe>0){const de=ee[oe-1];if(console.log("[MessageList] Found checkpoint ext:",ge),console.log("[MessageList] Previous message role:",de.role),de.role==="user"){const G=[...de.ext||[],ge];ee[oe-1]={...de,ext:G},console.log("[MessageList] Associated checkpoint to user message:",ee[oe-1])}}if(ae){const de={...pe};de.ext=pe.ext.filter(le=>le.type!=="workflow_rewrite_checkpoint"&&!(le.type==="debug_checkpoint"&&le.data?.checkpoint_type==="workflow_rewrite_start")),ee[oe]={...F,content:JSON.stringify(de)}}}}catch(pe){console.warn("[MessageList] Failed to parse AI message content:",pe)}}return ee};x.useEffect(()=>{const y=I.current;if(!y)return;const ee=()=>{requestAnimationFrame(()=>{se.current?y.scrollTop=y.scrollHeight-U.current:(L.current<y.scrollHeight&&L.current-W.current-z.current<1&&(y.scrollTop=y.scrollHeight-y.clientHeight),L.current=y.scrollHeight,W.current=y.scrollTop,z.current=y.clientHeight)})},oe=new ResizeObserver(ee);oe.observe(y);const F=new MutationObserver(ee);F.observe(y,{childList:!0,subtree:!0,attributes:!0,characterData:!0}),ee();const pe=()=>{y.scrollHeight<L.current&&L.current>0||(se.current?y.scrollHeight>L.current?(y.scrollTop=y.scrollHeight-U.current,L.current=y.scrollHeight):(se.current=!1,L.current=y.scrollHeight,U.current=y.scrollHeight):(L.current<y.scrollHeight&&L.current-W.current-z.current<1&&(y.scrollTop=y.scrollHeight-y.clientHeight),L.current=y.scrollHeight,W.current=y.scrollTop,z.current=y.clientHeight,U.current=y.scrollHeight))};return y.addEventListener("scroll",pe),()=>{oe.disconnect(),F.disconnect(),y.removeEventListener("scroll",pe)}},[]);const B=(y,ee)=>{if(console.log("[MessageList] Rendering message:",y),y.role==="user")return r.jsx(x.Suspense,{fallback:r.jsx("div",{children:"Loading..."}),children:r.jsx(Ep,{content:y.content,trace_id:y.trace_id,ext:y.ext,finished:y.finished})},y.id);if(y.role==="showcase")return r.jsx(Lp,{scrollRef:I},"showcase");if(y.role==="ai"||y.role==="tool"){const oe=Ap(y.role);try{const F=JSON.parse(y.content),pe=F.ext?.find(J=>J.type==="workflow"),ge=F.ext?.find(J=>J.type==="node"),ae=F.ext?.find(J=>J.type==="downstream_subgraph_search"),de=F.ext?.find(J=>J.type==="node_install_guide"),le=F.ext?.find(J=>J.type==="param_update"),G=F.ext?.find(J=>J.type==="workflow_update"),ze=F.ext?.find(J=>J.type==="debug_checkpoint"),ue=F.ext?.find(J=>J.type==="workflow_update_complete"),ie=F.text==="The workflow has been successfully loaded to the canvas";if(G&&G.data){const{workflow_data:J}=G.data;if(typeof window<"u"&&window.app&&J){const ye=JSON.stringify(J).slice(0,100),T=`workflow_update_${y.id}_${ye}`;if(!Z.current.has(T)){const te=async(Q=0)=>{try{const{applyNewWorkflow:Se}=await hn(async()=>{const{applyNewWorkflow:De}=await import("./message-components-vcAbzMOn.js").then(Ee=>Ee.N);return{applyNewWorkflow:De}},__vite__mapDeps([0,1,2]));Se(J)?(console.log("[MessageList] Successfully applied workflow update"),Z.current.add(T)):(console.warn(`[MessageList] Failed to apply workflow update (attempt ${Q+1})`),Q<2?setTimeout(()=>{te(Q+1)},1e3*(Q+1)):console.error("[MessageList] Workflow update failed after 3 attempts"))}catch(Se){console.error(`[MessageList] Error in workflow update (attempt ${Q+1}):`,Se),Q<2&&setTimeout(()=>{te(Q+1)},1e3*(Q+1))}};te()}}}if(le&&le.data){const{changes:J}=le.data;if(typeof window<"u"&&window.app&&J){const ye=JSON.stringify(J).slice(0,100),T=`param_update_${y.id}_${ye}`;if(!Z.current.has(T)){const te=async(Q=0)=>{try{const{applyParameterChanges:Se}=await hn(async()=>{const{applyParameterChanges:Ee}=await import("./message-components-vcAbzMOn.js").then(Re=>Re.N);return{applyParameterChanges:Ee}},__vite__mapDeps([0,1,2])),Fe=Array.isArray(J)?J:[J];Se(Fe)?(console.log(`[MessageList] Successfully applied ${Fe.length} parameter changes`),Z.current.add(T)):(console.warn(`[MessageList] Failed to apply parameter changes, changes is ${JSON.stringify(Fe)}, (attempt ${Q+1})`),Q<2?setTimeout(()=>{te(Q+1)},1e3*(Q+1)):console.error("[MessageList] Parameter update failed after 3 attempts"))}catch(Se){console.error(`[MessageList] Error in parameter update (attempt ${Q+1}):`,Se),Q<2&&setTimeout(()=>{te(Q+1)},1e3*(Q+1))}};te()}}}if(F.ext&&y.finished){const J=F.ext.find(ye=>ye.data&&ye.data.checkpoint_id&&(ye.type==="debug_checkpoint"||ye.type==="workflow_rewrite_complete"||ye.type==="workflow_update_complete"));if(J&&J.data?.checkpoint_id){const ye=J.data.checkpoint_id,T=`save_workflow_ui_${y.id}_${ye}`;if(!Z.current.has(T)){const te=async(Q=0)=>{try{if(typeof window<"u"&&window.app){const Se=window.app;if(Se.graph){const De=(await Se.graphToPrompt()).workflow;if(De){const Re=await(await fetch("/api/update-workflow-ui",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({checkpoint_id:ye,workflow_data_ui:De})})).json();Re.success?(console.log(`[MessageList] Successfully saved workflow UI for checkpoint ${ye}`),Z.current.add(T)):(console.warn(`[MessageList] Failed to save workflow UI for checkpoint ${ye}: ${Re.message}`),Q<2?setTimeout(()=>{te(Q+1)},1e3*(Q+1)):console.error(`[MessageList] Save workflow UI failed after 3 attempts for checkpoint ${ye}`))}}}}catch(Se){console.error(`[MessageList] Error saving workflow UI (attempt ${Q+1}):`,Se),Q<2&&setTimeout(()=>{te(Q+1)},1e3*(Q+1))}};te()}}}let ke=null;if(pe)ke=r.jsx(x.Suspense,{fallback:r.jsx("div",{children:"Loading..."}),children:r.jsx(Mp,{content:y.content,name:y.name,avatar:oe,latestInput:l,installedNodes:c,onAddMessage:d})},`workflow_option_${y.id}`);else if(ge)ke=r.jsx(x.Suspense,{fallback:r.jsx("div",{children:"Loading..."}),children:r.jsx(Tp,{content:y.content,name:y.name,avatar:oe,installedNodes:c})},`node_search_${y.id}`);else if(ae){const J=r.jsx(x.Suspense,{fallback:r.jsx("div",{children:"Loading..."}),children:r.jsx(Pp,{content:y.content,name:y.name,avatar:oe,onAddMessage:d})},`down_stream_subgraph_${y.id}`);if(y.metadata?.intent==="downstream_subgraph_search")return r.jsx(x.Suspense,{fallback:r.jsx("div",{children:"Loading..."}),children:r.jsx(Ns,{content:y.content,name:y.name,avatar:oe,format:y.format,onOptionClick:s,extComponent:J,metadata:y.metadata,finished:y.finished,debugGuide:y.debugGuide})},y.id);ke=J}else de?ke=r.jsx(x.Suspense,{fallback:r.jsx("div",{children:"Loading..."}),children:r.jsx(Dp,{content:y.content,onLoadSubgraph:()=>{if(y.metadata?.pendingSubgraph){const J=Object.values($e.canvas.selected_nodes)[0];if(J){const ye=y.metadata.pendingSubgraph,T=ye.json.nodes,te=ye.json.links,Q=T.find(De=>De.id===0),Se=Q?.id,Fe={};Se&&(Fe[Se]=J),$e.canvas.emitBeforeChange();try{for(const De of T)if(De.id!==Se){const Ee=Q?.pos||[0,0],Re=J._pos||[0,0],St=[De.pos[0]+Re[0]-Ee[0],De.pos[1]+Re[1]-Ee[1]];Fe[De.id]=Bg(De.type,{pos:St})}}finally{$e.canvas.emitAfterChange()}for(const De of te){const Ee=Fe[De.origin_id],Re=Fe[De.target_id];Ee&&Re&&Ee.connect(De.origin_slot,Re,De.target_slot)}}else alert("Please select a upstream node first before adding a subgraph.")}else if(y.metadata?.pendingWorkflow){const J=y.metadata.pendingWorkflow,ye=y.metadata.optimizedParams;if(J.nodes)$e.loadGraphData(J);else{$e.loadApiJson(J);const te=Object.keys(J),Q=Object.keys($e.graph._nodes_by_id)[0],Se=$e.graph._nodes_by_id[Q],Fe=Se?Se.pos[0]:0,De=Se?Se.pos[1]:0,Ee=250,Re=60,St=20,Qe=60,xt=50,It=1e3;let Ze=Fe,Dt=De,qe=0;for(const bt of te){const Ue=$e.graph._nodes_by_id[bt];if(Ue){qe>It&&(Ze+=Ee+Qe,qe=0,Dt=De);const dt=Ue.inputs?Ue.inputs.length:0,Ot=Ue.outputs?Ue.outputs.length:0,qt=Ue.widgets?Ue.widgets.length:0,jt=Math.max(dt,Ot)+qt,ft=St*jt+Re;Ue.size[0]=Ee,Ue.size[1]=ft,Ue.pos[0]=Ze,Ue.pos[1]=Dt,qe+=ft+xt,Dt+=ft+xt}}}for(const[te,Q,Se,Fe,De]of ye){const Ee=$e.graph._nodes_by_id[te].widgets;for(const Re of Ee)Re.name===Fe&&(Re.value=De)}$e.graph.setDirtyCanvas(!1,!0);const T={id:it(),role:"tool",content:JSON.stringify({text:"The workflow has been successfully loaded to the canvas",ext:[]}),format:"markdown",name:"Assistant"};d?.(T)}}})},`node_install_guide_${y.id}`):ie||y.format==="debug_guide"?ke=r.jsx(x.Suspense,{fallback:r.jsx("div",{children:"Loading..."}),children:r.jsx(Op,{content:y.content,name:y.name,avatar:oe,onAddMessage:d,onUpdateMessage:f,messageId:y.id})},`debug_guide_${y.id}`):ze?y.finished&&(ke=r.jsx(x.Suspense,{fallback:r.jsx("div",{children:"Loading..."}),children:r.jsx(Ul,{content:y.content,name:y.name,avatar:oe,format:y.format})},y.id)):(G||le)&&y.finished&&(ke=r.jsx(x.Suspense,{fallback:r.jsx("div",{children:"Loading..."}),children:r.jsx(Ul,{content:y.content,name:y.name,avatar:oe,format:y.format})},`debug_result_${y.id}`));return(ie||y.format==="debug_guide")&&ke||ze&&y.finished&&ke||(G||le)&&y.finished&&ke?ke:F.text||ke?r.jsx(x.Suspense,{fallback:r.jsx("div",{children:"Loading..."}),children:r.jsx(Ns,{content:y.content,name:y.name,avatar:oe,format:y.format,onOptionClick:s,extComponent:ke,metadata:y.metadata,finished:y.finished,debugGuide:y.debugGuide})},y.id):ke||r.jsx(x.Suspense,{fallback:r.jsx("div",{children:"Loading..."}),children:r.jsx(Ns,{content:y.content,name:y.name,avatar:oe,format:y.format,onOptionClick:s,metadata:y.metadata,finished:y.finished,debugGuide:y.debugGuide})},y.id)}catch{return r.jsx(x.Suspense,{fallback:r.jsx("div",{children:"Loading..."}),children:r.jsx(Ns,{content:y.content,name:y.name,avatar:oe,format:y.format,onOptionClick:s,metadata:y.metadata,finished:y.finished,debugGuide:y.debugGuide})},y.id)}}return null},V=()=>{se.current=!0,S(y=>y+1)},X=x.useMemo(()=>R(o),[o]);return x.useEffect(()=>{let y=[];if(N.current>0&&N.current<X.length)X?.[N.current-1]?.role==="user"?y=X?.slice(N.current-1):y=X?.slice(N.current),j(ee=>lc(ee,y,"id")),y?.[y?.length-1].finished&&(N.current=X.length);else{let ee=0,oe=X?.length-1;H.current=!1;for(let F=X?.length-1;F>=0;F--)if(oe=F,(X[F].role==="user"||X[F].role==="showcase"||X[F].format==="debug_guide")&&(ee++,F>0&&ee>=Fp+_)){H.current=!0;break}j([...X.slice(oe,X?.length)]),N.current=X.length}},[X,_]),x.useLayoutEffect(()=>{},[v]),r.jsxs("div",{className:"flex-1 flex-col overflow-y-auto p-4 h-0",ref:I,style:{display:g?"flex":"none"},children:[H.current&&r.jsx("div",{className:"flex justify-center items-center",children:r.jsx("button",{className:"w-full h-[24px] text-gray-700 text-xs bg-transparent hover:!bg-gray-100 px-2 py-1 rounded-md",onClick:V,children:"Load more"})},"loadmore"),v?.map((y,ee)=>!!y&&B(y)),m&&r.jsx(Ip,{})]})}function zp(o=!0){x.useEffect(()=>{if(!o)return;const l=Kn.debounce(s=>{document.documentElement.style.setProperty("--mouse-x",`${s.clientX}px`),document.documentElement.style.setProperty("--mouse-y",`${s.clientY}px`)},16);return document.addEventListener("mousemove",l),()=>{l.cancel(),document.removeEventListener("mousemove",l)}},[o])}function Up(o=!0){const{state:l,dispatch:s}=kn(),{activeTab:c,screenState:d}=l;x.useEffect(()=>{if(!o)return;const f=m=>{const g=c==="parameter-debug",_=c==="chat";//!screenState || screenState.currentScreen === 0;
if(_||g){const S=$e.canvas.selected_nodes;Object.keys(S??{}).length?s({type:"SET_SELECTED_NODE",payload:Object.values(S)}):s({type:"SET_SELECTED_NODE",payload:null})}};return document.addEventListener("click",f),()=>{document.removeEventListener("click",f)}},[s,o,c,d])}const Bp=({selectedNodes:o,handleParamSelect:l,selectedParams:s,handleNext:c,handleClose:d})=>{const m=o.flatMap(g=>(g.widgets||[]).map(_=>_.name)).some(g=>s[g]===!0);return r.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:[r.jsxs("div",{className:"mb-4 border-b pb-2 flex justify-between items-center",children:[r.jsxs("div",{children:[r.jsx("h3",{className:"text-base font-medium text-gray-800",children:"Select parameters"}),r.jsx("p",{className:"text-xs text-gray-500",children:"multiple selections supported"})]}),r.jsx("button",{className:"text-gray-400 hover:text-gray-600",onClick:d,children:r.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),o.map((g,_)=>{const S=g.title||"Unknown Node",v=g.widgets||[];return r.jsxs("div",{className:"border rounded-md mb-4 overflow-hidden",children:[r.jsx("div",{className:"bg-gray-50 px-3 py-2 text-sm font-medium text-gray-700 border-b",children:S}),r.jsx("div",{className:"p-4 space-y-3",children:r.jsx("div",{className:"flex items-center gap-3 flex-wrap",children:v.map((j,I)=>{const N=j.name;return r.jsxs("div",{className:"flex items-center",children:[r.jsx("div",{className:`w-5 h-5 rounded-full border flex items-center justify-center ${s[N]?"border-red-500 bg-red-100":"border-gray-300"}`,onClick:L=>l(N,L),children:s[N]&&r.jsx("div",{className:"w-3 h-3 rounded-full bg-red-500"})}),r.jsx("span",{className:"ml-2 text-gray-700 text-xs",children:N})]},`widget-${I}`)})})})]},`node-${_}`)}),r.jsx("div",{className:"mt-6 flex justify-center",children:r.jsx("button",{onClick:g=>c(g),disabled:!m,className:`px-3 py-1.5 text-xs ${m?"bg-pink-200 text-pink-700 hover:bg-pink-300":"bg-gray-200 text-gray-500 cursor-not-allowed"} rounded-md transition-colors`,children:"Next"})})]})},Gp=({selectedNodes:o,paramTestValues:l,selectedParams:s,updateParamTestValues:c,toggleDropdown:d,openDropdowns:f,handleTestValueSelect:m,searchTerms:g,handleSearch:_,handleSelectAll:S,handleNext:v,handlePrevious:j,handleClose:I,inputValues:N,updateState:L,textInputs:W,handleTextInputChange:z,handleAddTextInput:U,handleRemoveTextInput:se,openAiWritingModal:Z})=>{const H=(R,B,V,X=0)=>{if(R=isNaN(R)?0:R,B=isNaN(B)?100:B,V=isNaN(V)||V<=0?1:V,B<R&&(B=R),Math.floor((B-R)/V)+1<=1)return[R];const ee=[];let oe=R;for(;oe<=B;){const F=Math.pow(10,X),pe=Math.round(oe*F)/F;ee.push(pe),oe+=V}return ee};return x.useEffect(()=>{!o||o.length===0||o.forEach(R=>{const B=R.id.toString(),V=R.widgets||{};Object.values(V).forEach(y=>{const ee=y.name;if(!s[ee])return;if(!(l[B]?.[ee]?.length>0)&&y.type==="number"){const F=y.options?.min||0,pe=y.options?.max||100;let ge=(y.options?.step||10)/10;ge<.1&&(ge=.1);const ae=y.options?.precision||0,de=H(F,pe,ge,ae);if(de.length>0){c(B,ee,de);const le=`${B}_${ee}`;L(Ae.InputValues,{...N,[le]:{min:F.toString(),max:pe.toString(),step:ge.toString()}})}}if(y.type==="customtext"||y.type.toLowerCase().includes("text")){const F=`${B}_${ee}`,pe=W[F]||[""];JSON.stringify(pe)!==JSON.stringify(l[B]?.[ee]||[""])&&c(B,ee,pe)}})})},[o,s,l,W,c,H]),r.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:[r.jsxs("div",{className:"mb-4 border-b pb-2 flex justify-between items-center",children:[r.jsxs("div",{children:[r.jsx("h3",{className:"text-base font-medium text-gray-800",children:"Set test values"}),r.jsx("p",{className:"text-xs text-gray-500",children:"Configure the test values for each parameter"})]}),r.jsx("button",{className:"text-gray-400 hover:text-gray-600",onClick:I,children:r.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),o.length>0?o.map((R,B)=>{const V=R.widgets||{},X=Object.values(V),y=R.id;return r.jsxs("div",{className:"border rounded-md mb-4 overflow-hidden",children:[r.jsxs("div",{className:"bg-gray-50 px-3 py-2 text-xs font-medium text-gray-700 border-b flex justify-between items-center",children:[r.jsxs("span",{children:[R.type," (ID: ",y,")"]}),r.jsx("button",{className:"text-gray-400 hover:text-gray-600",onClick:ee=>I(ee,B),children:r.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),r.jsx("div",{className:"p-4 space-y-4",children:X.map((ee,oe)=>{const F=ee.name;if(!s[F])return null;const pe=`${y}_${F}`;if(ee.type==="customtext"||ee.type.toLowerCase().includes("text")){const ge=W[pe]||[""];return r.jsxs("div",{className:"border-b pb-3",children:[r.jsxs("div",{className:"flex justify-between items-center mb-2",children:[r.jsxs("label",{className:"text-xs font-medium text-gray-700",children:[F,":"]}),r.jsxs("button",{className:"px-2 py-1 bg-blue-100 text-blue-700 rounded text-xs flex items-center hover:bg-blue-200 transition-colors",onClick:()=>Z(y,F),children:[r.jsx("svg",{className:"w-3 h-3 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})}),"AI Writing"]})]}),r.jsx("div",{className:"space-y-2",children:ge.map((ae,de)=>r.jsxs("div",{className:"flex items-start",children:[r.jsx("textarea",{className:`flex-1 border ${ae?"border-gray-300":"border-red-500"} rounded p-2 text-xs resize-y`,rows:2,placeholder:"Enter text...",value:ae,onChange:le=>z(y,F,de,le.target.value),required:!0}),r.jsx("button",{className:"ml-2 text-red-500 hover:text-red-700",onClick:()=>se(y,F,de),title:"Remove",children:r.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]},de))}),r.jsxs("button",{className:"mt-2 px-2 py-1 border border-dashed border-gray-300 rounded text-xs text-gray-600 hover:bg-gray-50 flex items-center",onClick:()=>U(y,F),children:[r.jsx("svg",{className:"w-3 h-3 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})}),"Add Text"]})]},oe)}if(ee.type==="number"){const ge=ee.options?.min||0,ae=ee.options?.max||100,de=(ee.options?.step||10)/10,le=ee.options?.precision||0,G=H(ge,ae,de,le),ze=N[pe]||{min:ge.toString(),max:ae.toString(),step:de.toString()};return r.jsxs("div",{className:"border-b pb-3",children:[r.jsxs("div",{className:"flex justify-between items-center",children:[r.jsxs("label",{className:"text-xs font-medium text-gray-700",children:[F,":"]}),r.jsx("div",{className:"w-4"})]}),r.jsxs("div",{className:"flex space-x-2 items-center",children:[r.jsx("label",{className:"text-xs text-gray-600",children:"Min"}),r.jsx("input",{type:"text",className:"w-12 h-6 border border-gray-300 rounded text-xs px-2",value:ze.min,required:!0,onClick:ue=>{ue.preventDefault(),ue.stopPropagation()},onChange:ue=>{ue.preventDefault(),ue.stopPropagation();const ie=ue.target.value;if(L(Ae.InputValues,{...N,[pe]:{...N[pe],min:ie}}),ie===""||!isNaN(parseFloat(ie))){const ke=ie===""?0:parseFloat(ie),J=parseFloat(ze.max||ae.toString()),ye=parseFloat(ze.step||de.toString()),T=H(ke,J,ye,le);c(y,F,T)}}}),r.jsx("label",{className:"text-xs text-gray-600",children:"Max"}),r.jsx("input",{type:"text",className:"w-12 h-6 border border-gray-300 rounded text-xs px-2",value:ze.max,onClick:ue=>{ue.preventDefault(),ue.stopPropagation()},required:!0,onChange:ue=>{ue.preventDefault(),ue.stopPropagation();const ie=ue.target.value;if(L(Ae.InputValues,{...N,[pe]:{...N[pe],max:ie}}),ie===""||!isNaN(parseFloat(ie))){const ke=parseFloat(ze.min||ge.toString()),J=ie===""?ke:parseFloat(ie),ye=parseFloat(ze.step||de.toString()),T=H(ke,J,ye,le);c(y,F,T)}}}),r.jsx("label",{className:"text-xs text-gray-600",children:"Step"}),r.jsx("input",{type:"text",className:"w-12 h-6 border border-gray-300 rounded text-xs px-2",value:ze.step,required:!0,onClick:ue=>{ue.preventDefault(),ue.stopPropagation()},onChange:ue=>{ue.preventDefault(),ue.stopPropagation();const ie=ue.target.value;if(L(Ae.InputValues,{...N,[pe]:{...N[pe],step:ie}}),ie===""||!isNaN(parseFloat(ie))&&parseFloat(ie)>0){const ke=parseFloat(ze.min||ge.toString()),J=parseFloat(ze.max||ae.toString());let ye=ie===""?1:parseFloat(ie);ye<.1&&(ye=.1);const T=H(ke,J,ye,le);c(y,F,T)}}})]}),r.jsxs("div",{className:"mt-1",children:[r.jsx("label",{className:"text-xs text-gray-600",children:"Test values"}),r.jsx("div",{className:"mt-1 flex flex-wrap gap-1",children:(()=>{const ue=l[y]?.[F]||G;if(ue.length<=10)return ue.map((ie,ke)=>r.jsxs("div",{className:"px-2 py-0.5 bg-blue-100 text-blue-800 rounded-md flex items-center text-xs cursor-pointer hover:bg-blue-200",onClick:J=>{J.stopPropagation(),m(y,F,ie,J)},children:[r.jsx("span",{children:ie}),r.jsx("svg",{className:"w-4 h-4 ml-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})]},ke));{const ie=ue.slice(0,5),ke=ue.slice(ue.length-5);return r.jsxs(r.Fragment,{children:[ie.map((J,ye)=>r.jsxs("div",{className:"px-2 py-0.5 bg-blue-100 text-blue-800 rounded-md flex items-center text-xs cursor-pointer hover:bg-blue-200",onClick:T=>{T.stopPropagation(),m(y,F,J,T)},children:[r.jsx("span",{children:J}),r.jsx("svg",{className:"w-4 h-4 ml-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})]},`first-${ye}`)),r.jsx("div",{className:"px-2 py-0.5 bg-gray-100 text-gray-600 rounded-md flex items-center text-xs",children:"..."}),ke.map((J,ye)=>r.jsxs("div",{className:"px-2 py-0.5 bg-blue-100 text-blue-800 rounded-md flex items-center text-xs cursor-pointer hover:bg-blue-200",onClick:T=>{T.stopPropagation(),m(y,F,J,T)},children:[r.jsx("span",{children:J}),r.jsx("svg",{className:"w-4 h-4 ml-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})]},`last-${ye}`))]})}})()})]}),r.jsx("div",{className:"mt-1",children:r.jsx("p",{className:"text-xs text-gray-500",children:"Values are distributed evenly between Min and Max"})})]},oe)}else if(ee.type==="combo"){const ge=ee.options?.values||[],ae=`${y}_${F}`,de=G=>typeof G=="string"?G:G&&typeof G=="object"&&"name"in G?G.name:String(G),le=G=>typeof G=="object"&&G!==null&&"name"in G?G.name:G;return r.jsxs("div",{className:"border-b pb-3",children:[r.jsxs("div",{className:"flex justify-between items-center",children:[r.jsx("label",{className:"text-xs font-medium text-gray-700",children:F}),r.jsxs("div",{className:"relative dropdown-container",children:[r.jsxs("button",{className:`appearance-none border ${(l[y]?.[F]||[]).length===0?"border-red-500":"border-gray-300"} rounded px-2 py-0.5 pr-6 text-xs flex items-center bg-white text-gray-700`,onClick:G=>{G.preventDefault(),G.stopPropagation(),d(y,F,G)},"data-dropdown":ae,children:[r.jsx("span",{children:(l[y]?.[F]||[]).length>0?`${F}: ${(l[y]?.[F]||[]).length} selected`:`Select ${F}`}),r.jsx("div",{className:"ml-2",children:r.jsx("svg",{className:"fill-current h-4 w-4",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",children:r.jsx("path",{d:"M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"})})})]}),f[ae]&&r.jsxs("div",{className:"absolute z-[9999] mt-1 w-64 bg-white border border-gray-300 rounded-md shadow-lg dropdown-menu",style:{position:"fixed",top:typeof f[ae]=="object"?`${f[ae].y}px`:"0px",left:typeof f[ae]=="object"?`${f[ae].x}px`:"0px",maxHeight:"300px",overflowY:"auto"},children:[r.jsx("div",{className:"p-2 border-b sticky top-0 bg-white",children:r.jsx("input",{type:"text",className:"w-full px-2 py-0.5 text-xs border border-gray-300 rounded",placeholder:"Search...",value:g[ae]||"",onChange:G=>{G.preventDefault(),G.stopPropagation(),_(y,F,G.target.value)},onClick:G=>{G.preventDefault(),G.stopPropagation()},autoFocus:!0})}),r.jsxs("div",{className:"px-3 py-1.5 bg-gray-50 border-b cursor-pointer text-xs flex items-center text-gray-700 hover:bg-gray-100",onClick:G=>{G.preventDefault(),G.stopPropagation();const ue=ge.filter(ie=>!g[ae]||de(ie).toLowerCase().includes((g[ae]||"").toLowerCase())).map(le);S(y,F,ue)},children:[r.jsx("div",{className:`w-4 h-4 mr-2 border rounded-sm flex items-center justify-center ${ge.length>0&&(l[y]?.[F]||[]).length===ge.length?"bg-blue-500 border-blue-500":(l[y]?.[F]||[]).length>0?"bg-blue-500 border-blue-500 opacity-50":"border-gray-300"}`,children:(l[y]?.[F]||[]).length>0&&r.jsx("svg",{className:"w-3 h-3 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),r.jsx("span",{className:"font-medium",children:ge.length>0&&(l[y]?.[F]||[]).length===ge.length?"Deselect All":"Select All"})]}),r.jsxs("div",{className:"max-h-60 overflow-y-auto",children:[ge.filter(G=>!g[ae]||de(G).toLowerCase().includes((g[ae]||"").toLowerCase())).map((G,ze)=>r.jsxs("div",{className:"px-3 py-1.5 hover:bg-gray-100 cursor-pointer text-xs flex items-center text-gray-700",onClick:ue=>{ue.preventDefault(),ue.stopPropagation(),m(y,F,le(G),ue)},children:[r.jsx("div",{className:`w-4 h-4 mr-2 border rounded-sm flex items-center justify-center ${(l[y]?.[F]||[]).includes(le(G))?"bg-blue-500 border-blue-500":"border-gray-300"}`,children:(l[y]?.[F]||[]).includes(le(G))&&r.jsx("svg",{className:"w-3 h-3 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),r.jsx("span",{className:"whitespace-normal overflow-hidden text-ellipsis",children:de(G)})]},ze)),ge.filter(G=>!g[ae]||de(G).toLowerCase().includes((g[ae]||"").toLowerCase())).length===0&&r.jsx("div",{className:"px-3 py-4 text-sm text-gray-500 text-center",children:"No matching options"})]})]})]})]}),r.jsxs("div",{className:"mt-2",children:[r.jsx("label",{className:"text-xs text-gray-600",children:"Test values"}),(l[y]?.[F]||[]).length===0&&r.jsx("div",{className:"text-xs text-red-500 mt-1",children:"Please select at least one value"}),r.jsx("div",{className:"mt-1 flex flex-wrap gap-1",children:(l[y]?.[F]||[]).map((G,ze)=>r.jsxs("div",{className:"px-2 py-0.5 bg-blue-100 text-blue-800 rounded-md flex items-center text-xs",children:[r.jsx("span",{children:G}),r.jsx("svg",{className:"w-4 h-4 ml-1 cursor-pointer hover:text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",onClick:ue=>{ue.preventDefault(),ue.stopPropagation(),m(y,F,G,ue)},children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})]},ze))})]})]},oe)}else return r.jsxs("div",{className:"border-b pb-3",children:[r.jsx("div",{className:"flex justify-between items-center",children:r.jsx("label",{className:"text-xs font-medium text-gray-700",children:F})}),r.jsxs("div",{className:"mt-2",children:[r.jsx("label",{className:"text-xs text-gray-600",children:"Test values"}),r.jsxs("div",{className:"mt-1 flex flex-wrap gap-1",children:[(l[y]?.[F]||[]).map((ge,ae)=>r.jsxs("div",{className:"px-2 py-0.5 bg-blue-100 text-blue-800 rounded-md flex items-center text-xs",children:[r.jsx("span",{children:ge}),r.jsx("svg",{className:"w-4 h-4 ml-1 cursor-pointer hover:text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",onClick:de=>{de.preventDefault(),de.stopPropagation(),m(y,F,ge,de)},children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})]},ae)),r.jsxs("button",{className:"px-2 py-0.5 border border-dashed border-blue-300 text-blue-600 rounded-md text-xs flex items-center hover:bg-blue-50",onClick:ge=>{ge.preventDefault(),ge.stopPropagation();const ae=`${F}${(l[y]?.[F]||[]).length+1}`;c(y,F,[...l[y]?.[F]||[],ae])},children:[r.jsx("svg",{className:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})}),r.jsx("span",{children:"Add"})]})]})]})]},oe)})})]},B)}):r.jsx("div",{className:"border rounded-md mb-4 p-4 text-center text-gray-500",children:"No nodes selected. Please select a node in the workflow to configure parameters."}),r.jsxs("div",{className:"mt-6 flex justify-between",children:[r.jsx("button",{onClick:R=>j(R),className:"px-3 py-1.5 text-xs bg-gray-100 text-gray-800 rounded-md hover:bg-gray-200 transition-colors",children:"Previous"}),r.jsx("button",{onClick:R=>v(R),className:"px-3 py-1.5 text-xs bg-pink-200 text-pink-700 rounded-md hover:bg-pink-300 transition-colors",children:"Next"})]})]})},Wp=({selectedNodes:o,paramTestValues:l,selectedParams:s,totalCount:c,errorMessage:d,handlePrevious:f,handleStartGeneration:m,handleClose:g})=>{const[_,S]=x.useState([]),[v,j]=x.useState(null),[I,N]=x.useState(!1),{dispatch:L}=kn(),W=()=>{const U=Object.values($e.graph._nodes_by_id),se=[],Z=[];for(const R of U)R.type==="SaveImage"?se.push(R.id):R.type==="PreviewImage"&&Z.push(R.id);const H=[...se,...Z];S(H),H.length===1?j(H[0]):H.length>1&&(N(!0),j(null))};x.useEffect(()=>{W()},[]),x.useEffect(()=>{if(o?.length>0){const U=o?.find(se=>se.type==="SaveImage"||se.type==="PreviewImage");U&&j(U.id)}},[o]);const z=U=>{if(U&&(U.preventDefault(),U.stopPropagation()),_.length>1&&!v){N(!0);return}console.log("selectedImageNodeId-->",v),m(U,v||void 0)};return r.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:[r.jsxs("div",{className:"mb-4 border-b pb-2 flex justify-between items-center",children:[r.jsxs("div",{children:[r.jsx("h3",{className:"text-base font-medium text-gray-800",children:"Conform combinations"}),r.jsxs("p",{className:"text-xs text-gray-500",children:["In the selected parameter combinations, there are ",c," total runs. Each run will generate a separate image."]})]}),r.jsx("button",{className:"text-gray-400 hover:text-gray-600",onClick:g,children:r.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),I&&_.length>1&&r.jsx("div",{className:"mb-4 p-3 bg-yellow-50 border border-yellow-200 rounded-md text-amber-600 text-xs",children:r.jsxs("div",{className:"flex items-start",children:[r.jsx("div",{className:"flex-shrink-0 mt-0.5",children:r.jsx("svg",{className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),r.jsx("div",{className:"ml-2",children:v===null?`Multiple SaveImage and PreviewImage nodes detected with IDs ${_.join(",")}. Please click the node on canvas.`:`Current node ID is ${v}, please click Start Generation again`})]})}),d&&r.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-md text-red-600 text-xs",children:r.jsxs("div",{className:"flex items-start",children:[r.jsx("div",{className:"flex-shrink-0 mt-0.5",children:r.jsx("svg",{className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),r.jsx("div",{className:"ml-2",children:d})]})}),o.length>0?o.map((U,se)=>{const Z=U.type||"Unknown Node",H=U.widgets||[],R=U.id;return r.jsxs("div",{className:"border rounded-md mb-4 overflow-hidden",children:[r.jsxs("div",{className:"bg-gray-50 px-3 py-2 text-xs font-medium text-gray-700 border-b",children:[Z," (ID: ",R,")"]}),r.jsx("div",{className:"p-4 space-y-3",children:H.map((B,V)=>{const X=B.name;if(!s[X])return null;const y=l[R]?.[X]||[],ee=Array.isArray(y)?`[${y.join(", ")}]`:JSON.stringify(y);return r.jsxs("div",{className:V<H.length-1?"flex justify-between items-center border-b pb-2":"flex justify-between items-center",children:[r.jsx("label",{className:"font-medium text-gray-700 text-xs",children:X}),r.jsx("div",{className:"flex space-x-2 items-center",children:r.jsx("input",{type:"text",className:"w-64 h-7 border border-gray-300 rounded text-xs px-2 bg-gray-50 cursor-not-allowed text-gray-500",readOnly:!0,disabled:!0,value:ee,onClick:oe=>oe.preventDefault()})})]},V)})})]},se)}):r.jsx("div",{className:"border rounded-md mb-4 p-4 text-center text-gray-500 text-xs",children:"No nodes selected. Please select a node in the workflow to configure parameters."}),r.jsxs("div",{className:"mt-6 flex justify-between",children:[r.jsx("button",{onClick:U=>f(U),className:"px-3 py-1.5 text-xs bg-gray-100 text-gray-800 rounded-md hover:bg-gray-200 transition-colors",children:"Previous"}),r.jsx("button",{onClick:U=>z(U),className:`px-3 py-1.5 text-xs rounded-md transition-colors ${_.length>1&&!v?"bg-gray-200 text-gray-500 cursor-not-allowed":"bg-pink-200 text-pink-700 hover:bg-pink-300"}`,disabled:_.length>1&&!v,children:"Generate & Compare"})]})]})},qp=({selectedNodes:o,paramTestValues:l,selectedParams:s,totalCount:c,completedCount:d,errorMessage:f,handleClose:m,updateState:g,cleanupPolling:_})=>{const S=v=>{v.preventDefault(),v.stopPropagation(),Gg({clear:!0}),Wg(),_&&_(),g(Ae.IsProcessing,!1),g(Ae.CurrentScreen,2)};return r.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 relative",children:[r.jsx("div",{className:"absolute inset-0 bg-gray-500 bg-opacity-30 flex flex-col items-center justify-center z-10",children:r.jsxs("div",{className:"text-center text-gray-800 bg-white p-4 rounded-lg shadow-lg",children:[r.jsx("div",{className:"mb-2 text-sm font-medium",children:"Processing..."}),r.jsxs("div",{className:"text-xs mb-3",children:["Completed ",d," of ",c," runs"]}),r.jsx("div",{className:"w-48 h-2 bg-gray-200 rounded-full overflow-hidden",children:r.jsx("div",{className:"h-full bg-pink-500 transition-all duration-200",style:{width:`${d/c*100}%`}})}),r.jsxs("div",{className:"mt-2 text-xs text-gray-600",children:["Already generated ",d," images"]}),r.jsx("button",{onClick:S,className:"mt-4 px-3 py-1.5 text-xs bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300 transition-colors",children:"Cancel"})]})}),r.jsxs("div",{className:"mb-4 border-b pb-2 flex justify-between items-center",children:[r.jsxs("div",{children:[r.jsx("h3",{className:"text-base font-medium text-gray-800",children:"Confirm Test Configuration"}),r.jsxs("p",{className:"text-xs text-gray-500",children:["In the selected parameter combinations, there are ",c," total runs. Each run will generate a separate image."]})]}),r.jsx("button",{className:"text-gray-400 hover:text-gray-600",onClick:m,children:r.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),f&&r.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-md text-red-600 text-xs",children:r.jsxs("div",{className:"flex items-start",children:[r.jsx("div",{className:"flex-shrink-0 mt-0.5",children:r.jsx("svg",{className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),r.jsx("div",{className:"ml-2",children:f})]})}),o.length>0?o.map((v,j)=>{const I=v.type||"Unknown Node",N=v.widgets||[],L=v.id;return r.jsxs("div",{className:"border rounded-md mb-4 overflow-hidden",children:[r.jsxs("div",{className:"bg-gray-50 px-3 py-2 text-xs font-medium text-gray-700 border-b",children:[I," (ID: ",L,")"]}),r.jsx("div",{className:"p-4 space-y-3",children:N.map((W,z)=>{const U=W.name;if(!s[U])return null;const se=l[L]?.[U]||[],Z=Array.isArray(se)?`[${se.join(", ")}]`:JSON.stringify(se);return r.jsxs("div",{className:z<N.length-1?"flex justify-between items-center border-b pb-2":"flex justify-between items-center",children:[r.jsx("label",{className:"font-medium text-gray-700",children:U}),r.jsx("div",{className:"flex space-x-2 items-center",children:r.jsx("input",{type:"text",className:"w-64 h-7 border border-gray-300 rounded text-sm px-2 bg-gray-50 cursor-not-allowed text-gray-500",readOnly:!0,disabled:!0,value:Z,onClick:H=>H.preventDefault()})})]},z)})})]},j)}):r.jsx("div",{className:"border rounded-md mb-4 p-4 text-center text-gray-500",children:"No nodes selected. Please select a node in the workflow to configure parameters."})]})},Dr=({visible:o,imageUrl:l,params:s,onClose:c})=>{if(!o)return null;const d=()=>{if(!s||!s.nodeParams)return null;const f=Object.entries(s.nodeParams).map(([m,g])=>{const _=s.nodeNames?.[m]||s.selectedNodeInfoMap&&s.selectedNodeInfoMap[m]||(m.includes("text")?"Text Node":`Node ${m}`),S=Object.entries(g).filter(([v,j])=>typeof j!="object"||j===null).map(([v,j])=>r.jsxs("div",{className:"pl-4 text-sm py-1 flex",children:[r.jsx("span",{className:"text-gray-600 dark:text-gray-400 mr-2",children:"-"}),r.jsxs("span",{className:"font-medium mr-1",children:[v,":"]}),r.jsx("span",{className:"text-gray-700 dark:text-gray-300 break-all",children:String(j)})]},v));return r.jsxs("div",{className:"mb-4",children:[r.jsx("div",{className:"font-semibold text-pink-600 dark:text-pink-400 text-base py-1 border-b border-gray-200 dark:border-gray-700 mb-2",children:_}),S.length>0?S:r.jsx("div",{className:"pl-4 text-sm text-gray-500 italic",children:"nodeParams is null"})]},m)});return r.jsx("div",{className:"overflow-y-auto max-h-full",children:f.length>0?f:r.jsx("div",{className:"text-sm text-gray-500 italic",children:"nodeParams is null"})})};return r.jsx("div",{className:"fixed inset-0 bg-black/40 backdrop-blur-sm flex items-center justify-center z-50",onClick:c,children:r.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-2xl flex flex-row w-[90%] max-w-6xl max-h-[90vh] relative m-4 overflow-hidden",onClick:f=>f.stopPropagation(),style:{display:"flex",flexDirection:"row"},children:[r.jsx("button",{className:"absolute top-2 right-2 text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 p-1 z-10",onClick:c,children:r.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),r.jsx("div",{className:"w-[65%] border-r border-gray-200 dark:border-gray-700",children:r.jsx("div",{className:"p-4 h-full flex items-center justify-center",children:r.jsx("img",{src:l,alt:"Enlarged image",className:"max-w-full max-h-[calc(90vh-2rem)] object-contain"})})}),r.jsx("div",{className:"w-[35%] h-full overflow-hidden flex flex-col",children:r.jsxs("div",{className:"p-4 flex-1 overflow-y-auto",children:[r.jsx("h3",{className:"text-lg font-medium text-gray-800 dark:text-gray-200 mb-4",children:"Parameters"}),s&&!s.nodeParams&&Object.entries(s).filter(([f,m])=>f!=="nodeParams"&&typeof m!="object").map(([f,m])=>r.jsxs("div",{className:"py-1 text-sm text-gray-600 dark:text-gray-300",children:[r.jsxs("span",{className:"font-medium",children:[f,":"]})," ",String(m)]},f)),r.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-300",children:d()})]})})]})})};function hr(o,l,s){let c=s.initialDeps??[],d;function f(){var m,g,_,S;let v;s.key&&((m=s.debug)!=null&&m.call(s))&&(v=Date.now());const j=o();if(!(j.length!==c.length||j.some((L,W)=>c[W]!==L)))return d;c=j;let N;if(s.key&&((g=s.debug)!=null&&g.call(s))&&(N=Date.now()),d=l(...j),s.key&&((_=s.debug)!=null&&_.call(s))){const L=Math.round((Date.now()-v)*100)/100,W=Math.round((Date.now()-N)*100)/100,z=W/16,U=(se,Z)=>{for(se=String(se);se.length<Z;)se=" "+se;return se};console.info(`%c⏱ ${U(W,5)} /${U(L,5)} ms`,`
            font-size: .6rem;
            font-weight: bold;
            color: hsl(${Math.max(0,Math.min(120-120*z,120))}deg 100% 31%);`,s?.key)}return(S=s?.onChange)==null||S.call(s,d),d}return f.updateDeps=m=>{c=m},f}function Bl(o,l){if(o===void 0)throw new Error("Unexpected undefined");return o}const Vp=(o,l)=>Math.abs(o-l)<1.01,$p=(o,l,s)=>{let c;return function(...d){o.clearTimeout(c),c=o.setTimeout(()=>l.apply(this,d),s)}},Gl=o=>{const{offsetWidth:l,offsetHeight:s}=o;return{width:l,height:s}},Hp=o=>o,Kp=o=>{const l=Math.max(o.startIndex-o.overscan,0),s=Math.min(o.endIndex+o.overscan,o.count-1),c=[];for(let d=l;d<=s;d++)c.push(d);return c},Jp=(o,l)=>{const s=o.scrollElement;if(!s)return;const c=o.targetWindow;if(!c)return;const d=m=>{const{width:g,height:_}=m;l({width:Math.round(g),height:Math.round(_)})};if(d(Gl(s)),!c.ResizeObserver)return()=>{};const f=new c.ResizeObserver(m=>{const g=()=>{const _=m[0];if(_?.borderBoxSize){const S=_.borderBoxSize[0];if(S){d({width:S.inlineSize,height:S.blockSize});return}}d(Gl(s))};o.options.useAnimationFrameWithResizeObserver?requestAnimationFrame(g):g()});return f.observe(s,{box:"border-box"}),()=>{f.unobserve(s)}},Wl={passive:!0},ql=typeof window>"u"?!0:"onscrollend"in window,Xp=(o,l)=>{const s=o.scrollElement;if(!s)return;const c=o.targetWindow;if(!c)return;let d=0;const f=o.options.useScrollendEvent&&ql?()=>{}:$p(c,()=>{l(d,!1)},o.options.isScrollingResetDelay),m=v=>()=>{const{horizontal:j,isRtl:I}=o.options;d=j?s.scrollLeft*(I&&-1||1):s.scrollTop,f(),l(d,v)},g=m(!0),_=m(!1);_(),s.addEventListener("scroll",g,Wl);const S=o.options.useScrollendEvent&&ql;return S&&s.addEventListener("scrollend",_,Wl),()=>{s.removeEventListener("scroll",g),S&&s.removeEventListener("scrollend",_)}},Yp=(o,l,s)=>{if(l?.borderBoxSize){const c=l.borderBoxSize[0];if(c)return Math.round(c[s.options.horizontal?"inlineSize":"blockSize"])}return o[s.options.horizontal?"offsetWidth":"offsetHeight"]},Qp=(o,{adjustments:l=0,behavior:s},c)=>{var d,f;const m=o+l;(f=(d=c.scrollElement)==null?void 0:d.scrollTo)==null||f.call(d,{[c.options.horizontal?"left":"top"]:m,behavior:s})};class Zp{constructor(l){this.unsubs=[],this.scrollElement=null,this.targetWindow=null,this.isScrolling=!1,this.measurementsCache=[],this.itemSizeCache=new Map,this.pendingMeasuredCacheIndexes=[],this.scrollRect=null,this.scrollOffset=null,this.scrollDirection=null,this.scrollAdjustments=0,this.elementsCache=new Map,this.observer=(()=>{let s=null;const c=()=>s||(!this.targetWindow||!this.targetWindow.ResizeObserver?null:s=new this.targetWindow.ResizeObserver(d=>{d.forEach(f=>{const m=()=>{this._measureElement(f.target,f)};this.options.useAnimationFrameWithResizeObserver?requestAnimationFrame(m):m()})}));return{disconnect:()=>{var d;(d=c())==null||d.disconnect(),s=null},observe:d=>{var f;return(f=c())==null?void 0:f.observe(d,{box:"border-box"})},unobserve:d=>{var f;return(f=c())==null?void 0:f.unobserve(d)}}})(),this.range=null,this.setOptions=s=>{Object.entries(s).forEach(([c,d])=>{typeof d>"u"&&delete s[c]}),this.options={debug:!1,initialOffset:0,overscan:1,paddingStart:0,paddingEnd:0,scrollPaddingStart:0,scrollPaddingEnd:0,horizontal:!1,getItemKey:Hp,rangeExtractor:Kp,onChange:()=>{},measureElement:Yp,initialRect:{width:0,height:0},scrollMargin:0,gap:0,indexAttribute:"data-index",initialMeasurementsCache:[],lanes:1,isScrollingResetDelay:150,enabled:!0,isRtl:!1,useScrollendEvent:!1,useAnimationFrameWithResizeObserver:!1,...s}},this.notify=s=>{var c,d;(d=(c=this.options).onChange)==null||d.call(c,this,s)},this.maybeNotify=hr(()=>(this.calculateRange(),[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]),s=>{this.notify(s)},{key:!1,debug:()=>this.options.debug,initialDeps:[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]}),this.cleanup=()=>{this.unsubs.filter(Boolean).forEach(s=>s()),this.unsubs=[],this.observer.disconnect(),this.scrollElement=null,this.targetWindow=null},this._didMount=()=>()=>{this.cleanup()},this._willUpdate=()=>{var s;const c=this.options.enabled?this.options.getScrollElement():null;if(this.scrollElement!==c){if(this.cleanup(),!c){this.maybeNotify();return}this.scrollElement=c,this.scrollElement&&"ownerDocument"in this.scrollElement?this.targetWindow=this.scrollElement.ownerDocument.defaultView:this.targetWindow=((s=this.scrollElement)==null?void 0:s.window)??null,this.elementsCache.forEach(d=>{this.observer.observe(d)}),this._scrollToOffset(this.getScrollOffset(),{adjustments:void 0,behavior:void 0}),this.unsubs.push(this.options.observeElementRect(this,d=>{this.scrollRect=d,this.maybeNotify()})),this.unsubs.push(this.options.observeElementOffset(this,(d,f)=>{this.scrollAdjustments=0,this.scrollDirection=f?this.getScrollOffset()<d?"forward":"backward":null,this.scrollOffset=d,this.isScrolling=f,this.maybeNotify()}))}},this.getSize=()=>this.options.enabled?(this.scrollRect=this.scrollRect??this.options.initialRect,this.scrollRect[this.options.horizontal?"width":"height"]):(this.scrollRect=null,0),this.getScrollOffset=()=>this.options.enabled?(this.scrollOffset=this.scrollOffset??(typeof this.options.initialOffset=="function"?this.options.initialOffset():this.options.initialOffset),this.scrollOffset):(this.scrollOffset=null,0),this.getFurthestMeasurement=(s,c)=>{const d=new Map,f=new Map;for(let m=c-1;m>=0;m--){const g=s[m];if(d.has(g.lane))continue;const _=f.get(g.lane);if(_==null||g.end>_.end?f.set(g.lane,g):g.end<_.end&&d.set(g.lane,!0),d.size===this.options.lanes)break}return f.size===this.options.lanes?Array.from(f.values()).sort((m,g)=>m.end===g.end?m.index-g.index:m.end-g.end)[0]:void 0},this.getMeasurementOptions=hr(()=>[this.options.count,this.options.paddingStart,this.options.scrollMargin,this.options.getItemKey,this.options.enabled],(s,c,d,f,m)=>(this.pendingMeasuredCacheIndexes=[],{count:s,paddingStart:c,scrollMargin:d,getItemKey:f,enabled:m}),{key:!1}),this.getMeasurements=hr(()=>[this.getMeasurementOptions(),this.itemSizeCache],({count:s,paddingStart:c,scrollMargin:d,getItemKey:f,enabled:m},g)=>{if(!m)return this.measurementsCache=[],this.itemSizeCache.clear(),[];this.measurementsCache.length===0&&(this.measurementsCache=this.options.initialMeasurementsCache,this.measurementsCache.forEach(v=>{this.itemSizeCache.set(v.key,v.size)}));const _=this.pendingMeasuredCacheIndexes.length>0?Math.min(...this.pendingMeasuredCacheIndexes):0;this.pendingMeasuredCacheIndexes=[];const S=this.measurementsCache.slice(0,_);for(let v=_;v<s;v++){const j=f(v),I=this.options.lanes===1?S[v-1]:this.getFurthestMeasurement(S,v),N=I?I.end+this.options.gap:c+d,L=g.get(j),W=typeof L=="number"?L:this.options.estimateSize(v),z=N+W,U=I?I.lane:v%this.options.lanes;S[v]={index:v,start:N,size:W,end:z,key:j,lane:U}}return this.measurementsCache=S,S},{key:!1,debug:()=>this.options.debug}),this.calculateRange=hr(()=>[this.getMeasurements(),this.getSize(),this.getScrollOffset(),this.options.lanes],(s,c,d,f)=>this.range=s.length>0&&c>0?e2({measurements:s,outerSize:c,scrollOffset:d,lanes:f}):null,{key:!1,debug:()=>this.options.debug}),this.getVirtualIndexes=hr(()=>{let s=null,c=null;const d=this.calculateRange();return d&&(s=d.startIndex,c=d.endIndex),this.maybeNotify.updateDeps([this.isScrolling,s,c]),[this.options.rangeExtractor,this.options.overscan,this.options.count,s,c]},(s,c,d,f,m)=>f===null||m===null?[]:s({startIndex:f,endIndex:m,overscan:c,count:d}),{key:!1,debug:()=>this.options.debug}),this.indexFromElement=s=>{const c=this.options.indexAttribute,d=s.getAttribute(c);return d?parseInt(d,10):(console.warn(`Missing attribute name '${c}={index}' on measured element.`),-1)},this._measureElement=(s,c)=>{const d=this.indexFromElement(s),f=this.measurementsCache[d];if(!f)return;const m=f.key,g=this.elementsCache.get(m);g!==s&&(g&&this.observer.unobserve(g),this.observer.observe(s),this.elementsCache.set(m,s)),s.isConnected&&this.resizeItem(d,this.options.measureElement(s,c,this))},this.resizeItem=(s,c)=>{const d=this.measurementsCache[s];if(!d)return;const f=this.itemSizeCache.get(d.key)??d.size,m=c-f;m!==0&&((this.shouldAdjustScrollPositionOnItemSizeChange!==void 0?this.shouldAdjustScrollPositionOnItemSizeChange(d,m,this):d.start<this.getScrollOffset()+this.scrollAdjustments)&&this._scrollToOffset(this.getScrollOffset(),{adjustments:this.scrollAdjustments+=m,behavior:void 0}),this.pendingMeasuredCacheIndexes.push(d.index),this.itemSizeCache=new Map(this.itemSizeCache.set(d.key,c)),this.notify(!1))},this.measureElement=s=>{if(!s){this.elementsCache.forEach((c,d)=>{c.isConnected||(this.observer.unobserve(c),this.elementsCache.delete(d))});return}this._measureElement(s,void 0)},this.getVirtualItems=hr(()=>[this.getVirtualIndexes(),this.getMeasurements()],(s,c)=>{const d=[];for(let f=0,m=s.length;f<m;f++){const g=s[f],_=c[g];d.push(_)}return d},{key:!1,debug:()=>this.options.debug}),this.getVirtualItemForOffset=s=>{const c=this.getMeasurements();if(c.length!==0)return Bl(c[cc(0,c.length-1,d=>Bl(c[d]).start,s)])},this.getOffsetForAlignment=(s,c,d=0)=>{const f=this.getSize(),m=this.getScrollOffset();c==="auto"&&(c=s>=m+f?"end":"start"),c==="center"?s+=(d-f)/2:c==="end"&&(s-=f);const g=this.getTotalSize()+this.options.scrollMargin-f;return Math.max(Math.min(g,s),0)},this.getOffsetForIndex=(s,c="auto")=>{s=Math.max(0,Math.min(s,this.options.count-1));const d=this.measurementsCache[s];if(!d)return;const f=this.getSize(),m=this.getScrollOffset();if(c==="auto")if(d.end>=m+f-this.options.scrollPaddingEnd)c="end";else if(d.start<=m+this.options.scrollPaddingStart)c="start";else return[m,c];const g=c==="end"?d.end+this.options.scrollPaddingEnd:d.start-this.options.scrollPaddingStart;return[this.getOffsetForAlignment(g,c,d.size),c]},this.isDynamicMode=()=>this.elementsCache.size>0,this.scrollToOffset=(s,{align:c="start",behavior:d}={})=>{d==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getOffsetForAlignment(s,c),{adjustments:void 0,behavior:d})},this.scrollToIndex=(s,{align:c="auto",behavior:d}={})=>{d==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),s=Math.max(0,Math.min(s,this.options.count-1));let f=0;const m=10,g=S=>{if(!this.targetWindow)return;const v=this.getOffsetForIndex(s,S);if(!v){console.warn("Failed to get offset for index:",s);return}const[j,I]=v;this._scrollToOffset(j,{adjustments:void 0,behavior:d}),this.targetWindow.requestAnimationFrame(()=>{const N=this.getScrollOffset(),L=this.getOffsetForIndex(s,I);if(!L){console.warn("Failed to get offset for index:",s);return}Vp(L[0],N)||_(I)})},_=S=>{this.targetWindow&&(f++,f<m?this.targetWindow.requestAnimationFrame(()=>g(S)):console.warn(`Failed to scroll to index ${s} after ${m} attempts.`))};g(c)},this.scrollBy=(s,{behavior:c}={})=>{c==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getScrollOffset()+s,{adjustments:void 0,behavior:c})},this.getTotalSize=()=>{var s;const c=this.getMeasurements();let d;if(c.length===0)d=this.options.paddingStart;else if(this.options.lanes===1)d=((s=c[c.length-1])==null?void 0:s.end)??0;else{const f=Array(this.options.lanes).fill(null);let m=c.length-1;for(;m>=0&&f.some(g=>g===null);){const g=c[m];f[g.lane]===null&&(f[g.lane]=g.end),m--}d=Math.max(...f.filter(g=>g!==null))}return Math.max(d-this.options.scrollMargin+this.options.paddingEnd,0)},this._scrollToOffset=(s,{adjustments:c,behavior:d})=>{this.options.scrollToFn(s,{behavior:d,adjustments:c},this)},this.measure=()=>{this.itemSizeCache=new Map,this.notify(!1)},this.setOptions(l)}}const cc=(o,l,s,c)=>{for(;o<=l;){const d=(o+l)/2|0,f=s(d);if(f<c)o=d+1;else if(f>c)l=d-1;else return d}return o>0?o-1:0};function e2({measurements:o,outerSize:l,scrollOffset:s,lanes:c}){const d=o.length-1,f=_=>o[_].start;if(o.length<=c)return{startIndex:0,endIndex:d};let m=cc(0,d,f,s),g=m;if(c===1)for(;g<d&&o[g].end<s+l;)g++;else if(c>1){const _=Array(c).fill(0);for(;g<d&&_.some(v=>v<s+l);){const v=o[g];_[v.lane]=v.end,g++}const S=Array(c).fill(s+l);for(;m>=0&&S.some(v=>v>=s);){const v=o[m];S[v.lane]=v.start,m--}m=Math.max(0,m-m%c),g=Math.min(d,g+(c-1-g%c))}return{startIndex:m,endIndex:g}}const Vl=typeof document<"u"?x.useLayoutEffect:x.useEffect;function t2(o){const l=x.useReducer(()=>({}),{})[1],s={...o,onChange:(d,f)=>{var m;f?Yl.flushSync(l):l(),(m=o.onChange)==null||m.call(o,d,f)}},[c]=x.useState(()=>new Zp(s));return c.setOptions(s),Vl(()=>c._didMount(),[]),Vl(()=>c._willUpdate()),c}function n2(o){return t2({observeElementRect:Jp,observeElementOffset:Xp,scrollToFn:Qp,...o})}const dc=o=>{const{items:l,renderItem:s,minWidth:c=200,gap:d=16}=o,f=x.useRef(null),[m,g]=x.useState(1),[_,S]=x.useState(0);x.useLayoutEffect(()=>{if(!f.current)return;const j=()=>{if(f.current){const N=f.current.offsetWidth,L=Math.max(1,Math.floor(N/(c+d/2)));g(L),S(Math.ceil(l.length/L))}};j();const I=new window.ResizeObserver(Kn.debounce(j,50));return I.observe(f.current),()=>I.disconnect()},[]);const v=n2({count:_,getScrollElement:()=>f.current,estimateSize:()=>c+40,overscan:3,gap:d});return r.jsx("div",{ref:f,className:"h-full relative overflow-auto hide-scrollbar",children:r.jsx("div",{style:{height:v.getTotalSize(),position:"relative"},children:v.getVirtualItems().map(j=>{const I=j.index,N=I*m,L=Math.min(N+m,l.length);return r.jsx("div",{"data-index":I,ref:v.measureElement,style:{position:"absolute",top:0,left:0,width:"100%",transform:`translateY(${j.start}px)`,display:"grid",gridTemplateColumns:`repeat(${m}, minmax(${c}px, 1fr))`,gap:`${d}px`},children:l.slice(N,L).map((W,z)=>s(W,N+z))},I)})})})},r2=({generatedImages:o,selectedImageIndex:l,handleSelectImage:s,handleApplySelected:c,handleClose:d,notificationVisible:f,modalVisible:m,modalImageUrl:g,modalImageParams:_,openImageModal:S,closeImageModal:v})=>{const j=(I,N)=>r.jsxs("div",{className:`relative flex flex-col rounded-lg overflow-hidden border ${l===N?"border-2 border-green-400":"border-gray-200"}`,style:{boxShadow:l===N?"inset 0 -16px 24px 0 rgba(255, 255, 255, 0.25)":""},onClick:L=>s(N,L),children:[r.jsx("button",{className:"absolute top-2 right-2 bg-white bg-opacity-75 rounded-full p-0.5 text-gray-600 hover:text-gray-900 shadow-sm z-10",onClick:L=>S(I.url,I.params,L),children:r.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5v-4m0 4h-4m4 0l-5-5"})})}),r.jsx("div",{className:"aspect-square",children:r.jsx("img",{src:I.url,alt:`Generated image ${N+1}`,className:"w-full h-full object-cover",onError:L=>{const W=L.target;W.onerror=null,W.src="data:image/svg+xml,%3Csvg t='1760082631200' class='icon' viewBox='0 0 1024 1024' version='1.1' xmlns='http://www.w3.org/2000/svg' p-id='4747' width='56' height='56' fill='%238a8a8a'%3E%3Cpath d='M371.2 737.536l137.728-247.808c5.376-9.472 7.936-20.224 7.936-30.976 0-19.456-8.704-37.632-24.064-49.92L222.208 192.512 437.76 1.28H118.528C53.248 1.536 0 54.784 0 120.064v783.36c0 65.536 53.248 118.784 118.784 118.784h566.528L371.2 737.536z m-252.672 211.712c-25.088 0-45.568-20.48-45.568-45.824v-783.36c0-24.832 19.712-44.8 44.288-45.568h109.312l-71.68 62.976C137.984 150.784 128.256 170.752 128.256 192.512c0 21.504 9.728 41.728 26.368 55.04l271.104 216.832-133.376 240.128c-6.144 10.752-9.216 23.296-9.216 35.84 0 21.504 9.216 41.728 25.088 55.552l168.704 153.088h-358.4z' p-id='4748'%3E%3C/path%3E%3Cpath d='M905.216 1.536H565.504c-1.792 2.048-156.16 135.936-156.16 135.936-16.896 13.312-26.624 33.28-26.624 55.04 0 21.504 9.728 41.728 26.368 55.04l271.104 216.832-133.376 240.128c-6.144 10.752-9.216 23.296-9.216 35.84 0 21.504 9.216 41.728 25.088 55.552l249.088 226.304h93.44c65.536 0 118.784-53.248 118.784-118.784v-783.36c0-65.28-53.248-118.528-118.784-118.528z m45.824 901.888c0 25.344-20.48 45.824-45.824 45.824h-47.104l-232.448-211.456 137.728-247.808c5.376-9.472 7.936-20.224 7.936-30.976 0-19.456-8.704-37.632-24.064-49.92L476.672 192.512l133.632-118.016h294.912c25.344 0 45.824 20.48 45.824 45.568v783.36z' p-id='4749'%3E%3C/path%3E%3C/svg%3E"}})}),r.jsx("div",{className:"p-2 text-xs text-gray-600 bg-white max-h-16 overflow-y-auto",children:Object.entries(I.params).filter(([L,W])=>L!=="nodeParams"&&typeof W!="object").map(([L,W])=>r.jsxs("div",{children:[L,": ",String(W)]},L))})]},N.toString());return r.jsxs("div",{className:"h-full flex flex-col relative bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:[r.jsxs("div",{className:"mb-4 border-b pb-2 flex justify-between items-center",children:[r.jsxs("div",{children:[r.jsx("h3",{className:"text-base font-medium text-gray-800",children:"Generation Complete"}),r.jsxs("p",{className:"text-xs text-gray-500",children:["All ",o.length," images have been generated."]})]}),r.jsx("button",{className:"text-gray-400 hover:text-gray-600",onClick:d,children:r.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),f&&r.jsx("div",{className:"fixed top-4 right-4 bg-green-100 border-l-4 border-green-500 text-green-700 p-3 shadow-md rounded animate-fade-in-out z-50",children:r.jsxs("div",{className:"flex items-center",children:[r.jsx("div",{className:"py-1",children:r.jsx("svg",{className:"h-4 w-4 text-green-500 mr-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),r.jsx("p",{className:"text-xs",children:"Parameters has been applied."})]})}),r.jsx("div",{className:"flex-1 min-h-0",children:r.jsx(dc,{items:o,renderItem:j})}),r.jsx("div",{className:"mt-6 flex justify-end",children:r.jsx("button",{onClick:I=>c(I),className:"px-3 py-1.5 text-xs bg-pink-200 text-pink-700 rounded-md hover:bg-pink-300 transition-colors",disabled:l===null,children:"Apply Selected"})}),r.jsx(Dr,{visible:m,imageUrl:g,params:_||{},onClose:v})]})},s2=({visible:o,aiWritingModalText:l,setAiWritingModalText:s,aiGeneratedTexts:c,aiSelectedTexts:d,aiWritingLoading:f,aiWritingError:m,handleAiWriting:g,toggleTextSelection:_,addSelectedTexts:S,onClose:v})=>o?r.jsx("div",{className:"fixed inset-0 bg-black flex items-center justify-center z-50",children:r.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-2xl w-full max-w-2xl max-h-[90vh] flex flex-col",children:[r.jsxs("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700 flex justify-between items-center",children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"AI Writing Assistant"}),r.jsx("button",{className:"text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200",onClick:v,children:r.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),r.jsxs("div",{className:"p-4 overflow-y-auto flex-1",children:[r.jsxs("div",{className:"mb-4",children:[r.jsx("p",{className:"text-sm text-gray-700 dark:text-gray-300 mb-2",children:"Enter text and AI will generate variations"}),r.jsx("textarea",{className:`w-full px-4 py-3 border border-gray-200 dark:border-gray-600 rounded-lg text-gray-900 dark:text-white\r
                bg-gray-50 dark:bg-gray-700 \r
                placeholder-gray-500 dark:placeholder-gray-400\r
                focus:border-blue-500 dark:focus:border-blue-400 \r
                focus:ring-2 focus:ring-blue-500/20 dark:focus:ring-blue-400/20\r
                focus:outline-none`,rows:3,placeholder:"Enter some text here...",value:l,onChange:j=>s(j.target.value)}),r.jsx("button",{className:`mt-2 px-4 py-2 rounded-lg text-sm flex items-center transition-colors ${f?"bg-gray-300 dark:bg-gray-600 text-gray-500 dark:text-gray-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-600 text-white"}`,onClick:g,disabled:f,children:f?r.jsxs(r.Fragment,{children:[r.jsxs("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-gray-500 dark:text-gray-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[r.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),r.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Generating..."]}):r.jsx(r.Fragment,{children:"Generate"})})]}),m&&r.jsx("div",{className:"mb-4 p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800/20 rounded-md text-red-700 dark:text-red-400 text-sm",children:m}),c.length>0&&r.jsxs("div",{className:"mb-4",children:[r.jsx("p",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Generated variations (select items to add):"}),r.jsx("div",{className:"space-y-2 max-h-[40vh] overflow-y-auto p-2",children:c.map((j,I)=>r.jsxs("div",{className:"flex items-start border border-gray-200 dark:border-gray-600 rounded-md p-2",children:[r.jsx("div",{className:"mr-2 mt-1",children:r.jsxs("div",{className:"relative",children:[r.jsx("input",{type:"checkbox",id:`text${I+1}`,checked:!!d[`text${I+1}`],onChange:()=>_(`text${I+1}`),className:"sr-only"}),r.jsx("div",{className:`h-4 w-4 rounded border ${d[`text${I+1}`]?"bg-blue-600 dark:bg-blue-500 border-blue-600 dark:border-blue-500":"border-gray-300 dark:border-gray-600"} flex items-center justify-center cursor-pointer`,onClick:()=>_(`text${I+1}`),children:d[`text${I+1}`]&&r.jsx("svg",{className:"h-3 w-3 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})})]})}),r.jsx("label",{htmlFor:`text${I+1}`,className:"text-sm text-gray-700 dark:text-gray-300 cursor-pointer flex-1",children:j})]},I))})]})]}),r.jsxs("div",{className:"p-4 border-t border-gray-200 dark:border-gray-700 flex justify-end flex-shrink-0",children:[r.jsx("button",{className:`px-5 py-2.5 text-gray-700 dark:text-gray-200 bg-white dark:bg-gray-800 hover:bg-gray-100 dark:hover:bg-gray-700 \r
            rounded-lg font-medium transition-colors mr-3`,onClick:v,children:"Cancel"}),r.jsx("button",{className:`px-5 py-2.5 rounded-lg font-medium transition-colors ${Object.values(d).every(j=>!j)?"bg-gray-300 dark:bg-gray-600 text-gray-500 dark:text-gray-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-600 text-white"}`,onClick:S,disabled:Object.values(d).every(j=>!j),children:"Add Selected"})]})]})}):null,ro=o=>{const l=[],s={};if(Object.keys(o).forEach(f=>{const m=parseInt(f),g=o[f]||{},_=Object.keys(g).filter(v=>g[v]&&g[v].length>0);if(_.length===0)return;const S=[[]];_.forEach(v=>{const j=g[v],I=[];S.forEach(N=>{j.forEach(L=>{const W=[...N,{nodeId:m,paramName:v,paramValue:String(L)}];I.push(W)})}),S.length=0,S.push(...I)}),s[f]=S}),Object.keys(s).length===0)return l;if(Object.keys(s).length===1){const f=Object.keys(s)[0];return s[f]}const c=Object.keys(s);let d=s[c[0]];for(let f=1;f<c.length;f++){const m=s[c[f]],g=[];d.forEach(_=>{m.forEach(S=>{g.push([..._,...S])})}),d=g}return d},i2=(o,l)=>{const s={};s.nodeParams={};const c=ro(o);return l<c.length&&c[l].forEach(f=>{const m=f.nodeId.toString(),g=f.paramName,_=f.paramValue;s.nodeParams[m]||(s.nodeParams[m]={}),s.nodeParams[m][g]=_,s[g]=_}),s},uc="parameter_debug_history",$l=30,Hl=async(o,l,s,c,d)=>{try{const f=fc(),m={id:it(),timestamp:Date.now(),title:oo(o,l),nodeName:o,params:{...l,nodeNames:{...l.nodeNames||{},[o.split("<")[0]]:o.split("<")[0]}},generatedImages:s,totalCount:c,workflow:d};return f.unshift(m),f.length>$l&&f.splice($l),localStorage.setItem(uc,JSON.stringify(f)),m}catch(f){return console.error("Error saving parameter debug history:",f),null}},fc=()=>{try{const o=localStorage.getItem(uc);if(o)return JSON.parse(o)}catch(o){console.error("Error loading parameter debug history:",o)}return[]},hc=o=>{const l=new Date(o);return`${l.getFullYear()}-${String(l.getMonth()+1).padStart(2,"0")}-${String(l.getDate()).padStart(2,"0")} ${String(l.getHours()).padStart(2,"0")}:${String(l.getMinutes()).padStart(2,"0")}`},oo=(o,l)=>{if(l.nodeParams)return Object.entries(l.nodeParams).map(([f,m])=>{let g=o;l.selectedNodeInfoMap&&l.selectedNodeInfoMap[f]&&(g=l.selectedNodeInfoMap[f]);const _=Object.keys(m).slice(0,3);return`${g}<${_.join(",")}>`}).join(";");const s=Object.keys(l).filter(c=>c!=="nodeParams"&&c!=="selectedNodeInfoMap").slice(0,3);return`${o}<${s.join(",")}>`},o2=({historyItems:o,onViewHistoryItem:l,onClose:s})=>r.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 flex flex-col h-full",children:[r.jsxs("div",{className:"mb-4 border-b pb-2 flex justify-between items-center",children:[r.jsxs("div",{children:[r.jsx("h3",{className:"text-base font-medium text-gray-800",children:"Experiments History"}),r.jsxs("p",{className:"text-xs text-gray-500",children:["Last ",o.length," experiments"]})]}),r.jsx("button",{className:"text-gray-400 hover:text-gray-600",onClick:s,children:r.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),o.length===0?r.jsx("div",{className:"flex-1 flex items-center justify-center text-gray-500 text-sm",children:"No history items found"}):r.jsx("div",{className:"flex-1 overflow-y-auto",children:o.map(c=>r.jsxs("div",{className:"border border-gray-200 rounded-lg mb-3 overflow-hidden",children:[r.jsxs("div",{className:"bg-gray-50 py-2 px-3 flex items-center justify-between border-b",children:[r.jsx("div",{className:"text-[14px] text-gray-600",children:hc(c.timestamp)}),r.jsx("button",{onClick:()=>l(c),className:"px-3 py-1 text-xs bg-pink-200 text-pink-700 rounded-md hover:bg-pink-300 transition-colors",children:"view"})]}),r.jsx("div",{className:"p-3",children:r.jsx("div",{className:"text-[10px] font-medium text-gray-700",children:oo(c.nodeName,c.params)})})]},c.id))})]}),a2=({historyItem:o,selectedImageIndex:l,handleSelectImage:s,handleClose:c,modalVisible:d,modalImageUrl:f,modalImageParams:m,openImageModal:g,closeImageModal:_})=>{const{timestamp:S,nodeName:v,generatedImages:j,params:I}=o,N=(L,W)=>r.jsxs("div",{className:`relative flex flex-col rounded-lg overflow-hidden border ${l===W?"border-pink-500 ring-2 ring-pink-300":"border-gray-200"}`,onClick:z=>s(W,z),children:[r.jsx("button",{className:"absolute top-2 right-2 bg-white bg-opacity-75 rounded-full p-0.5 text-gray-600 hover:text-gray-900 shadow-sm z-10",onClick:z=>g(L.url,L.params,z),children:r.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5v-4m0 4h-4m4 0l-5-5"})})}),r.jsx("div",{className:"aspect-square",children:r.jsx("img",{src:L.url,alt:`Generated image ${W+1}`,className:"w-full h-full object-cover"})}),r.jsx("div",{className:"p-2 text-xs text-gray-600 bg-white max-h-16 overflow-y-auto",children:Object.entries(L.params).filter(([z,U])=>z!=="nodeParams"&&typeof U!="object").map(([z,U])=>r.jsxs("div",{children:[z,": ",String(U)]},z))})]},W.toString());return r.jsxs("div",{className:"h-full flex flex-col relative bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:[r.jsxs("div",{className:"mb-4 border-b pb-2 flex justify-between items-start",children:[r.jsxs("div",{className:"min-w-0",children:[r.jsx("h3",{className:"text-base font-medium text-gray-800 truncate hover:!break-words hover:!whitespace-normal hover:!overflow-visible",children:oo(v,I)}),r.jsxs("p",{className:"text-xs text-gray-500",children:[hc(S)," • ",j.length," images"]})]}),r.jsx("button",{className:"text-gray-400 hover:text-gray-600 mt-0",onClick:c,children:r.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),r.jsx("div",{className:"flex-1 min-h-0",children:r.jsx(dc,{items:j,renderItem:N})}),r.jsx(Dr,{visible:d,imageUrl:f,params:m?{...m,nodeNames:{[o.nodeName.split("<")[0]]:o.nodeName.split("<")[0]}}:void 0,onClose:_})]})},l2=`
  @keyframes highlight-pulse {
    0% { 
      box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.5);
    }
    70% { 
      box-shadow: 0 0 0 15px rgba(59, 130, 246, 0);
    }
    100% { 
      box-shadow: 0 0 0 0 rgba(59, 130, 246, 0);
    }
  }
  
  .highlight-pulse {
    animation: highlight-pulse 1.5s infinite;
    border: 2px solid #3b82f6;
  }

  @keyframes fade-in-out {
    0% { opacity: 0; transform: translateY(-20px); }
    10% { opacity: 1; transform: translateY(0); }
    90% { opacity: 1; transform: translateY(0); }
    100% { opacity: 0; transform: translateY(-20px); }
  }
  
  .animate-fade-in-out {
    animation: fade-in-out 3s forwards;
  }
`,Or="parameter_debug_state",c2=o=>{try{localStorage.setItem(Or,JSON.stringify(o))}catch(l){console.error("Error saving parameter debug state:",l)}},d2=()=>{try{const o=localStorage.getItem(Or);if(o)return JSON.parse(o)}catch(o){console.error("Error loading parameter debug state:",o)}return null},u2=()=>{try{localStorage.removeItem(Or)}catch(o){console.error("Error clearing parameter debug state:",o)}},f2=(o,l,s,c,d,f)=>{const m=`${o}_${l}`,g=[...d[m]||[]];return g[s]=c,f(Ae.TextInputs,{...d,[m]:g.map((_,S)=>S===s?c:_)}),g},h2=(o,l,s,c)=>{const d=`${o}_${l}`,f=[...s[d]||[]];return f.push(""),c(Ae.TextInputs,{...s,[d]:f}),f},m2=(o,l,s,c,d)=>{const f=`${o}_${l}`,m=[...c[f]||[]];return m.splice(s,1),d(Ae.TextInputs,{...c,[f]:m}),m},g2=(o,l,s,c,d)=>{s.preventDefault(),s.stopPropagation();const f=`${o}_${l}`;d(m=>{if(m[f]&&typeof m[f]=="object"?m[f].isOpen:!!m[f])return{...m,[f]:!1};{let _=0,S=0;if(s.currentTarget){const I=s.currentTarget.getBoundingClientRect();_=I.left,S=I.bottom}else _=s.clientX,S=s.clientY+20;const v=window.innerWidth,j=250;return _+j>v&&(_=v-j-10),_<0&&(_=10),{...m,[f]:{isOpen:!0,x:_,y:S}}}})},p2=(o,l,s,c,d)=>{const f={...c};f[o]||(f[o]={}),f[o][l]=s,d(Ae.ParamTestValues,f)},x2=(o,l,s,c,d,f)=>{f&&(f.preventDefault(),f.stopPropagation());const m={...c};m[o]||(m[o]={}),m[o][l]||(m[o][l]=[]);const g=m[o][l];g.includes(s)?m[o][l]=g.filter(_=>_!==s):m[o][l]=[...g,s],d(Ae.ParamTestValues,m)},b2=(o,l,s,c,d)=>{const f=`${o}_${l}`;d(Ae.SearchTerms,{...c,[f]:s})},y2=(o,l,s,c,d)=>{if(!c[o]){d(o,l,s);return}const f=c[o][l]||[];s.length===f.length?d(o,l,[]):d(o,l,[...s])},_2=(o,l,s,c,d)=>{d&&(d.preventDefault(),d.stopPropagation());const f=l[o];if(c(Ae.SelectedParams,{...l,[o]:!f}),f){const m={...s};Object.keys(m).forEach(g=>{m[g][o]&&delete m[g][o]}),c(Ae.ParamTestValues,m)}},w2=(o,l,s,c,d,f,m)=>{m.preventDefault(),m.stopPropagation();const g={...l};if(l.nodeParams){const _={};Object.keys(l.nodeParams).forEach(S=>{const v=s.find(j=>j.id.toString()===S);_[S]=v?v.title||`Node ${S}`:`Node ${S}`}),g.nodeNames=_}else if(Object.keys(l).length>0){const _={};Object.entries(l).forEach(([S,v])=>{(typeof v!="object"||v===null)&&(_[S]=v)}),Object.keys(_).length>0&&(g.nodeParams={default:_},g.nodeNames={default:l.node_name||l.nodeName||"参数"})}c(o),d(g),f(!0)},v2=(o,l)=>{l&&(l.preventDefault(),l.stopPropagation()),o(!1)},k2=(o,l,s,c,d,f,m,g,_)=>{if(_&&(_.preventDefault(),_.stopPropagation()),o===0){const S={...s};Object.keys(S).forEach(v=>{const j=S[v];Object.keys(j).forEach(I=>{l[I]||delete j[I]})}),g(Ae.ParamTestValues,S)}if(o===1){const S={...s};d.forEach(j=>{const I=j.id.toString(),N=j.widgets||{};Object.values(N).forEach(L=>{const W=L.name;if(l[W]&&(L.type==="customtext"||L.type.toLowerCase().includes("text"))){const z=`${I}_${W}`,U=c[z]||[""];S[I]=S[I]||{},S[I][W]=U}})}),g(Ae.ParamTestValues,S);const v=m(S);g(Ae.TotalCount,v.length)}f(null),g(Ae.CurrentScreen,Math.min(o+1,2))},S2=(o,l,s,c,d,f,m,g)=>{if(g&&(g.preventDefault(),g.stopPropagation()),f(null),d&&m(Ae.IsCompleted,!1),o===1){const _=l.map(j=>j.id.toString()),S=Object.keys(s),v={...s};S.forEach(j=>{_.includes(j)||delete v[j]}),m(Ae.ParamTestValues,v)}if(o===2||d){const _={...s};Object.entries(c).forEach(([S,v])=>{if(!v||v.length===0)return;const[j,I]=S.split("_");l.some(N=>N.id.toString()===j)&&(_[j]=_[j]||{},JSON.stringify(_[j][I])!==JSON.stringify(v)&&(_[j][I]=v))}),m(Ae.ParamTestValues,_)}m(Ae.CurrentScreen,Math.max(o-1,0))},I2=(o,l,s,c,d)=>{d&&(d.preventDefault(),d.stopPropagation()),c(Ae.CurrentPage,Math.max(1,Math.min(o,Math.ceil(s.length/l))))};function j2(o,l){try{if(!o)return console.error("Invalid prompt_output: ",o),o;for(const s of l){if(!o[s.nodeId]){console.error(`Node with ID ${s.nodeId} not found`);continue}if(!o[s.nodeId].inputs){console.error(`Inputs not found for node with ID ${s.nodeId}`);continue}o[s.nodeId].inputs[s.paramName]=s.paramValue}return o}catch(s){return console.error("Error updating prompt:",s),o}}async function C2(o){const l=await $e.graphToPrompt(),s=j2(l.output,o);console.log("queuePrompt updated_prompt:",s);const c={prompt:s,client_id:$e.api.clientId,extra_data:{extra_pageinfo:{workflow:l.workflow}}};console.debug("queuePrompt request_body.prompt:",s);const d=await qg(c);return console.debug("queuePrompt response:",d),d}function Kl(o){const l=document.createElement("canvas"),s=l.getContext("2d");if(l.width=512,l.height=512,s){s.fillStyle="#f8d7da",s.fillRect(0,0,l.width,l.height),s.strokeStyle="#dc3545",s.lineWidth=4,s.strokeRect(10,10,l.width-20,l.height-20),s.fillStyle="#dc3545",s.beginPath(),s.arc(l.width/2,150,50,0,2*Math.PI),s.fill(),s.fillStyle="white",s.font="bold 80px Arial",s.textAlign="center",s.textBaseline="middle",s.fillText("!",l.width/2,150),s.fillStyle="#721c24",s.font="20px Arial",s.textAlign="center",s.textBaseline="middle";const c=l.width-60,d=30,f=o.split(" ");let m="",g=250;for(let _=0;_<f.length;_++){const S=m+f[_]+" ";s.measureText(S).width>c&&_>0?(s.fillText(m,l.width/2,g),m=f[_]+" ",g+=d):m=S}s.fillText(m,l.width/2,g)}return l.toDataURL("image/png")}async function N2(o){try{if(!o||o==="")return console.log("No prompt ID provided"),{1:[Kl("Fail to generate prompt ID")]};const l=await Vg(o);if(!l||!l[o])return console.log("Not finished for prompt ID:",o),{};const s=l[o];if(s.status&&s.status.status_str==="error"){console.error("Error for prompt ID:",o);const d=s.status.messages;if(d&&d.length>0){const f=d[d.length-1];if(f&&f.length>0){const m=f[0];return{1:[Kl(m)]}}}}const c={};if(s.outputs)for(const d in s.outputs){const f=s.outputs[d];if(f&&f.images){c[d]=[];for(const m of f.images)if(m&&m.filename&&m.type){const g=$e?.graph._nodes_by_id?.[d]?.imgs?.[0]?.currentSrc?.split("?")[0];c[d].push(g+"?filename="+encodeURIComponent(m.filename)+"&type="+encodeURIComponent(m.type)+(m.subfolder?"&subfolder="+encodeURIComponent(m.subfolder):""))}console.log("outputImages for nodeId:",d,c[d])}}return c}catch(l){throw console.error("Error getting output images from prompt:",l),l}}function L2(){const o=Object.values($e.graph._nodes_by_id),l=[],s=[];for(const c of o)c.type==="SaveImage"?l.push(c.id):c.type==="PreviewImage"&&s.push(c.id);if(console.log("saveNodeIds:",l),console.log("previewNodeIds:",s),l.length===0&&s.length===0)throw new Error("No SaveImage or PreviewImage node found, please add one to the graph");return l.length===1?l[0]:l.length==0&&s.length===1?s[0]:null}async function A2(o,l){const s=await N2(o);return Object.keys(s).length===0?null:s[l.toString()]&&s[l.toString()].length>0?s[l.toString()][0]:null}const E2=async(o,l,s,c,d,f,m,g,_,S)=>{_&&(_.preventDefault(),_.stopPropagation()),gc(d,c);const v=f(o),j=v.length;if(j>100){s(`Cannot generate more than 100 images at once (currently: ${j} images)`);return}s(null),g(Ae.IsProcessing,!0),g(Ae.CompletedCount,0),console.log("Generated parameter combinations:",v);let I=null;try{I=(await m.graphToPrompt()).output}catch(z){console.error("Error capturing workflow data:",z)}if(ct.trackEvent({event_type:"start_generation",message_type:"parameter_debug",message_id:l,data:{workflow:I,all_params:o,count:j}}),v.length===0){s("No valid parameter combinations found. Please check your parameter selections."),g(Ae.IsProcessing,!1);return}let N=S||null;if(N===null){const z=L2();z!==null&&(N=z)}if(console.log("showNodeId-->",N,S),N===null){s("Please select a SaveImage or PreviewImage node first."),g(Ae.IsProcessing,!1);return}const L={};Object.keys(o).forEach(z=>{const U=m.graph._nodes_by_id[z];U&&(L[z]=U.type||U.comfyClass||"Unknown Node")});const W=[];try{const z=Date.now().toString();c.current=z;for(const V of v){const X=await C2(V);X.prompt_id?W.push(X.prompt_id):(console.error("Failed to get prompt_id from response:",X),W.push(""))}const U=Array(v.length).fill(null).map((V,X)=>({url:`https://source.unsplash.com/random/300x300?sig=${Math.random()}`,params:i2(o,X)}));g(Ae.GeneratedImages,U);const se=Date.now(),Z=5*60*1e3,H=Object.keys(o)[0],R=L[H]||"Unknown Node";mc(W,N,U,z,se,Z,c,d,g,{},R,o,j,I,L)}catch(z){console.error("Error generating images:",z),g(Ae.IsProcessing,!1)}},mc=async(o,l,s,c,d,f,m,g,_,S,v,j,I,N,L)=>{if(m.current!==c){console.log("Another polling session has started, stopping this one");return}if(Date.now()-d>f){if(console.log("Timeout reached while waiting for images"),m.current===c&&(_(Ae.IsProcessing,!1),_(Ae.IsCompleted,!0),_(Ae.CurrentPage,1),s.length>0&&v&&j)){const z=s[0].params;L&&(z.selectedNodeInfoMap=L),Hl(v,z,s,I||s.length,N)}return}let W=Object.keys(S)?.length||0;for(let z=0;z<o.length;z++){const U=o[z];if(!(!U||S[U]))try{const se=await A2(U,Number(l));se&&(s[z]={...s[z],url:se},S[U]=!0,W++)}catch(se){console.error(`Error fetching image for prompt ID ${U}:`,se)}}if(_(Ae.GeneratedImages,[...s]),_(Ae.CompletedCount,W),W===o.length){if(console.log("All images have been generated!"),m.current===c&&(_(Ae.IsProcessing,!1),_(Ae.IsCompleted,!0),_(Ae.CurrentPage,1),s.length>0&&v&&j)){const z=s[0].params;L&&(z.selectedNodeInfoMap=L),Hl(v,z,s,I||s.length,N)}return}m.current===c&&(g.current=setTimeout(()=>{mc(o,l,s,c,d,f,m,g,_,S,v,j,I,N,L)},2e3))},gc=(o,l)=>{o.current&&(clearTimeout(o.current),o.current=null),l.current=null},M2=async(o,l,s,c,d,f)=>{if(!o.trim()){c("Please enter some text to generate variations");return}s(!0),c(null),d([]),f({});try{const m=await ct.generateSDPrompts(o);d(m),ct.trackEvent({event_type:"prompt_generate",message_type:"parameter_debug",message_id:l,data:{input_text:o,generated_texts:m}});const g={};m.forEach((_,S)=>{g[`text${S+1}`]=!1}),f(g)}catch(m){console.error("Error generating text:",m),c("Failed to generate text variations. Please try again.")}finally{s(!1)}},T2=(o,l)=>{l(s=>({...s,[o]:!s[o]}))},P2=(o,l,s,c,d,f,m,g,_,S)=>{const v=`${o}_${l}`,j=Object.entries(s).filter(([L,W])=>W).map(([L])=>{const W=parseInt(L.replace("text",""))-1;return c[W]});if(j.length===0)return;const I=[...m[v]||[]];g(Ae.TextInputs,{...m,[v]:[...I,...j]}),ct.trackEvent({event_type:"prompt_apply",message_type:"parameter_debug",message_id:f,data:{input_text:d,generated_texts:c,selected_texts:j}});const N=[...m[v]||[],...j];_(o,l,N),S(!1)},D2=(o,l,s,c,d,f,m,g,_,S)=>{s(!0),c(o),d(l),f(""),m([]),g({}),_(!1),S(null)},O2=(o,l,s,c,d,f,m,g,_,S,v,j,I,N,L,W,z,U,se,Z,H,R,B,V,X,y,ee,oe,F,pe=!1)=>{o(0),l({Steps:!0,CFG:!0,sampler_name:!0,threshold:!1,prompt:!1}),s(it()),c(),d(!1),f(!1),m(0),g(12),_(null),S(Array(12).fill(null).map((ge,ae)=>({url:`https://source.unsplash.com/random/300x300?sig=${Math.random()}`,params:{step:ae%3===0?5:ae%3===1?10:15,sampler_name:"euler",cfg:1}}))),v({}),j({}),I({}),N({}),L(1),W(null),z(!1),U(!1),se(""),Z(null),H({}),R(!1),B(""),V([]),X(!1),y(""),ee(""),oe(null),F({}),pe&&u2()},F2=async(o,l,s,c,d,f,m)=>{if(m&&(m.preventDefault(),m.stopPropagation()),o!==null){console.log(`Applied image ${o+1} with parameters:`,l[o].params);let g=1;if(d){for(const S in d)if(d[S])for(const v in d[S]){const j=d[S][v];if(j){let I=1;Array.isArray(j)?I=j.length>0?j.length:1:typeof j=="object"&&j!==null&&(I=Object.keys(j).length>0?Object.keys(j).length:1),g=g*I}}}ct.trackEvent({event_type:"parameter_debug_apply",message_type:"parameter_debug",message_id:c,data:{workflow:(await s.graphToPrompt()).output,selected_params:l[o].params,all_params:d,count:g}});const _=l[o].params;_.nodeParams&&($g(_.nodeParams)?(console.log("[stateManagementUtils] Successfully applied selected parameters to canvas"),f(!0),setTimeout(()=>{f(!1)},3e3)):console.warn("[stateManagementUtils] Failed to apply selected parameters to canvas"))}},R2=(o,l,s,c,d,f,m)=>{if(m&&(m.preventDefault(),m.stopPropagation()),o===1&&s!==void 0){const g=[...l];g[s],g.splice(s,1),g.length===0?d&&(c({type:"SET_SCREEN_STATE",payload:null}),f(!0),d()):c({type:"SET_SELECTED_NODE",payload:g});return}d&&(c({type:"SET_SCREEN_STATE",payload:null}),f(!0),d())};var Ae=(o=>(o.CurrentScreen="currentScreen",o.SelectedParams="selectedParams",o.TaskId="task_id",o.IsProcessing="isProcessing",o.IsCompleted="isCompleted",o.CompletedCount="completedCount",o.TotalCount="totalCount",o.SelectedImageIndex="selectedImageIndex",o.GeneratedImages="generatedImages",o.ParamTestValues="paramTestValues",o.SearchTerms="searchTerms",o.InputValues="inputValues",o.CurrentPage="currentPage",o.TextInputs="textInputs",o))(Ae||{});const z2=({selectedNodes:o,visible:l,onClose:s})=>{const c=x.useRef([]),[d,f]=x.useState(0),[m,g]=x.useState({Steps:!0,CFG:!0,sampler_name:!0,threshold:!1,prompt:!1}),[_,S]=x.useState(it()),[v,j]=x.useState(!1),[I,N]=x.useState(!1),[L,W]=x.useState(0),[z,U]=x.useState(12),[se,Z]=x.useState(null),[H,R]=x.useState(()=>Array(12).fill(null).map((P,D)=>({url:`https://source.unsplash.com/random/300x300?sig=${Math.random()}`,params:{step:D%3===0?5:D%3===1?10:15,sampler_name:"euler",cfg:1}}))),[B,V]=x.useState({}),[X,y]=x.useState({}),[ee,oe]=x.useState({}),[F,pe]=x.useState({}),[ge,ae]=x.useState(1),de=6,[le,G]=x.useState(null),[ze,ue]=x.useState(!1),[ie,ke]=x.useState(!1),[J,ye]=x.useState(""),[T,te]=x.useState(null),[Q,Se]=x.useState({}),[Fe,De]=x.useState(!1),[Ee,Re]=x.useState(""),[St,Qe]=x.useState([]),[xt,It]=x.useState(!1),[Ze,Dt]=x.useState(""),[qe,bt]=x.useState(""),[Ue,dt]=x.useState(null),[Ot,qt]=x.useState({}),[jt,ft]=x.useState(!1),[Vt,$t]=x.useState([]),[ln,tn]=x.useState(null),{dispatch:$}=kn(),xe=x.useRef(null),et=x.useRef(null),ot=x.useRef(!0),[ut,gt]=x.useState(()=>l),[Ft,q]=x.useState(!1);x.useEffect(()=>{if(jt){const P=fc();$t(P)}},[jt]);const re=async()=>{M2(Ee,_,It,dt,Qe,qt)},Ie=(P,D,_e,rt)=>{const At=f2(P,D,_e,rt,Q,nt);Sn(P,D,At)},ce=(P,D)=>{const _e=h2(P,D,Q,nt);Sn(P,D,_e)},Ne=(P,D,_e)=>{const rt=m2(P,D,_e,Q,nt);Sn(P,D,rt)},Je=P=>{T2(P,qt)},be=()=>{P2(Ze,qe,Ot,St,Ee,_,Q,nt,Sn,De)},Me=(P,D)=>{D2(P,D,De,Dt,bt,Re,Qe,qt,It,dt)},tt=P=>{P&&(P.preventDefault(),P.stopPropagation()),ft(D=>!D)},wt=P=>{tn(P),ft(!1),nt("generatedImages",P.generatedImages||[]),nt("selectedImageIndex",null),nt("currentPage",1)},nn=P=>{P&&(P.preventDefault(),P.stopPropagation()),tn(null)},Ds=(P,D)=>{const _e={currentScreen:d,selectedParams:m,task_id:_,isProcessing:v,isCompleted:I,completedCount:L,totalCount:z,selectedImageIndex:se,generatedImages:H,paramTestValues:B,searchTerms:ee,inputValues:F,currentPage:ge,textInputs:Q},rt=_e[P],At=Dn(rt)&&Dn(D)?{...rt,...D}:D;c2({..._e,[P]:At})},nt=(P,D)=>{switch(P){case"currentScreen":f(D);break;case"selectedParams":g(_e=>Dn(_e)&&Dn(D)?{..._e,...D}:D);break;case"task_id":S(D);break;case"isProcessing":j(D);break;case"isCompleted":N(D);break;case"completedCount":W(D);break;case"totalCount":U(D);break;case"selectedImageIndex":Z(D);break;case"generatedImages":R(D);break;case"paramTestValues":V(_e=>Dn(_e)&&Dn(D)?{..._e,...D}:D);break;case"searchTerms":oe(_e=>Dn(_e)&&Dn(D)?{..._e,...D}:D);break;case"inputValues":pe(D);break;case"currentPage":ae(D);break;case"textInputs":Se(D);break}Ds(P,D)};x.useEffect(()=>{if(!Ft||!o||o.length===0)return;const P={...B},D=o.map(rt=>rt.id.toString());Object.keys(P).forEach(rt=>{D.includes(rt)||delete P[rt]}),o.forEach(rt=>{const At=rt.id.toString();P[At]||(P[At]={})}),JSON.stringify(P)!==JSON.stringify(B)&&nt("paramTestValues",P)},[o,B,Ft]),x.useEffect(()=>{$({type:"SET_SCREEN_STATE",payload:{currentScreen:d,isProcessing:v,isCompleted:I}})},[d,v,I,$]),x.useEffect(()=>{const P=document.createElement("style");return P.textContent=l2,document.head.appendChild(P),()=>{document.head.removeChild(P)}},[]),x.useEffect(()=>{const P=D=>{if(Object.values(X).some(_e=>_e)){const _e=D.target,rt=!!_e.closest(".dropdown-menu"),At=!!_e.closest("[data-dropdown]");!rt&&!At&&y({})}};return document.addEventListener("mousedown",P),()=>{document.removeEventListener("mousedown",P)}},[X]),x.useEffect(()=>{l&&(JSON.parse(localStorage.getItem(Or)||"{}").task_id||nt("task_id",it()))},[l]),x.useEffect(()=>{if(ot.current&&(ot.current=!1,v)){let P=0;const D=Object.values($e.graph._nodes_by_id),_e=[],rt=[];for(const Xn of D)Xn.type==="SaveImage"?_e.push(Xn.id):Xn.type==="PreviewImage"&&rt.push(Xn.id);const At=[..._e,...rt];At.length===1?P=At[0]:At.length>1&&(P=void 0),console.log("isProcessing-->",P),pr(void 0,P)}},[v]),x.useEffect(()=>{if(l){gt(!0);try{const P=localStorage.getItem(Or);if(P){const D=JSON.parse(P);if(console.log("parsedState-->",D),!o||o.length===0){console.log("Not restoring parameter debug state: no nodes selected"),gt(!1);return}D.currentScreen!==void 0&&f(Kn.isEqual(o,c.current)?D.currentScreen:0),D.selectedParams&&g(D.selectedParams),D.task_id&&S(D.task_id),j(D?.isProcessing);const _e=D.generatedImages&&D.generatedImages.length>0;D.isCompleted!==void 0&&_e&&N(D.isCompleted),D.completedCount!==void 0&&W(D.completedCount),D.totalCount!==void 0&&U(D.totalCount),D.selectedImageIndex!==void 0&&Z(D.selectedImageIndex),D.generatedImages&&R(D.generatedImages),D.paramTestValues&&V(D.paramTestValues),D.searchTerms&&oe(D.searchTerms),D.inputValues&&pe(D.inputValues),D.currentPage!==void 0&&ae(D.currentPage),D.textInputs&&Se(D.textInputs),Ft||q(!0)}}catch(P){console.error("Error loading parameter debug state:",P)}finally{c.current=o,setTimeout(()=>{gt(!1)},50)}}else gt(!0)},[l,o]);const mr=(P=!1)=>{O2(f,g,S,gr,j,N,W,U,Z,R,V,y,oe,pe,ae,G,ue,ke,ye,te,Se,De,Re,Qe,It,Dt,bt,dt,qt,P),ft(!1),tn(null)},Fr=P=>{k2(d,m,B,Q,o,G,ro,nt,P)},Fn=P=>{S2(d,o,B,Q,I,G,nt,P)},Os=(P,D)=>{_2(P,m,B,nt,D)},Fs=(P,D,_e)=>{g2(P,D,_e,X,y)},Sn=(P,D,_e)=>{p2(P,D,_e,B,nt)},Rs=(P,D,_e,rt)=>{x2(P,D,_e,B,nt,rt)},zs=(P,D,_e)=>{b2(P,D,_e,ee,nt)},Us=(P,D,_e)=>{y2(P,D,_e,B,Sn)},Rr=(P,D)=>{I2(P,de,H,nt,D)},gr=()=>{gc(xe,et)};x.useEffect(()=>()=>{gr()},[]);const pr=async(P,D)=>{console.log("handleStartGeneration-->",D),E2(B,_,G,et,xe,ro,$e,nt,P,D)},zr=(P,D)=>{D&&(D.preventDefault(),D.stopPropagation()),nt("selectedImageIndex",P)},Ur=(P,D,_e)=>{w2(P,D,o,ye,te,ke,_e)},Rn=P=>{v2(ke,P)},Bs=async P=>{F2(se,H,$e,_,B,ue,P)},In=(P,D)=>{R2(d,o,D,$,s,mr,P)},Jn=()=>r.jsx(r.Fragment,{children:r.jsx(Dr,{visible:ie,imageUrl:J,params:T||{},onClose:Rn})});return ln?r.jsx("div",{className:"flex-1 overflow-y-auto bg-gray-50 p-4",onClick:P=>P.stopPropagation(),children:r.jsx(a2,{historyItem:ln,selectedImageIndex:se,handleSelectImage:zr,handleClose:nn,currentPage:ge,handlePageChange:Rr,imagesPerPage:de,modalVisible:ie,modalImageUrl:J,modalImageParams:T,openImageModal:Ur,closeImageModal:Rn})}):jt?r.jsx("div",{className:"flex-1 overflow-y-auto bg-gray-50 p-4 flex flex-col h-full max-h-[80vh]",onClick:P=>P.stopPropagation(),children:r.jsx(o2,{historyItems:Vt,onViewHistoryItem:wt,onClose:tt})}):ut&&l&&o.length>0?r.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center p-8 bg-gray-50 overflow-y-auto",onClick:P=>P.stopPropagation(),children:[r.jsxs("div",{className:"p-8 rounded-lg shadow-sm relative flex flex-col items-center",children:[r.jsx("div",{className:"w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"}),r.jsx("div",{className:"mt-4 text-gray-600 text-sm",children:"Loading interface..."})]}),r.jsx(Dr,{visible:ie,imageUrl:J,params:T||{},onClose:Rn})]}):!l||o.length===0?r.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center p-8 bg-gray-50 overflow-y-auto",onClick:P=>P.stopPropagation(),children:[r.jsxs("div",{className:"max-w-lg p-8 rounded-lg shadow-sm border border-blue-100 relative",children:[r.jsxs("div",{className:"absolute top-3 right-3 flex",children:[r.jsx("button",{className:"text-blue-500 hover:text-blue-700 mr-2",onClick:tt,title:"Show History",children:r.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:r.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z",clipRule:"evenodd"})})}),r.jsx("button",{className:"text-gray-400 hover:text-gray-600",onClick:In,children:r.jsx("svg",{className:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),r.jsxs("div",{className:"mb-6 text-center",children:[r.jsx("h3",{className:"text-base font-bold text-blue-600 mb-2",children:"GenLab"}),r.jsx("div",{className:"h-1 w-16 bg-blue-500 mx-auto rounded-full mb-4"})]}),r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{className:"text-left mb-4",children:[r.jsx("h3",{className:"text-sm font-medium text-gray-800 mb-3",children:"Batch-test parameters & find the best combo in one click."}),r.jsx("div",{className:"h-px w-full bg-gray-200 my-4"})]}),r.jsxs("div",{className:"text-left",children:[r.jsx("h4",{className:"text-base font-medium text-gray-800 mb-4",children:"How to use"}),r.jsxs("div",{className:"space-y-2 mb-4",children:[r.jsxs("p",{className:"text-sm text-gray-700",children:[r.jsx("span",{className:"font-bold",children:"1 - "}),"Click any node(hold Shift to select multiple nodes)"]}),r.jsxs("p",{className:"text-sm text-gray-700",children:[r.jsx("span",{className:"font-bold",children:"2 - "}),"Set parameter ranges and start batch generation."]})]}),r.jsx("div",{className:"h-px w-full bg-gray-200 my-4"}),r.jsx("p",{className:"text-sm text-blue-600 mt-6",children:"Let's select a node to begin!"})]})]})]}),r.jsx(Dr,{visible:ie,imageUrl:J,params:T||{},onClose:Rn})]}):I?r.jsx("div",{className:"flex-1 overflow-y-auto bg-gray-50 p-4",onClick:P=>P.stopPropagation(),children:r.jsx(r2,{generatedImages:H,selectedImageIndex:se,handleSelectImage:zr,handleApplySelected:Bs,handlePrevious:Fn,handleClose:In,currentPage:ge,handlePageChange:Rr,imagesPerPage:de,notificationVisible:ze,modalVisible:ie,modalImageUrl:J,modalImageParams:T,openImageModal:Ur,closeImageModal:Rn})}):v?r.jsxs("div",{className:"flex-1 overflow-y-auto bg-gray-50 p-4",onClick:P=>P.stopPropagation(),children:[r.jsx(qp,{selectedNodes:o,paramTestValues:B,selectedParams:m,totalCount:z,completedCount:L,errorMessage:le,handleClose:In,updateState:nt,cleanupPolling:gr}),r.jsx(Jn,{})]}):d===0?r.jsxs("div",{className:"flex-1 overflow-y-auto bg-gray-50 p-4 flex flex-col h-full max-h-[80vh]",onClick:P=>P.stopPropagation(),children:[r.jsx(Bp,{selectedNodes:o,handleParamSelect:Os,selectedParams:m,handleNext:Fr,handleClose:In}),r.jsx(Jn,{})]}):d===1?r.jsxs("div",{className:"flex-1 overflow-y-auto bg-gray-50 p-4 flex flex-col h-full max-h-[80vh]",onClick:P=>P.stopPropagation(),children:[r.jsx(Gp,{selectedNodes:o,paramTestValues:B,selectedParams:m,updateParamTestValues:Sn,toggleDropdown:Fs,openDropdowns:X,handleTestValueSelect:Rs,searchTerms:ee,handleSearch:zs,handleSelectAll:Us,handleNext:Fr,handlePrevious:Fn,handleClose:In,inputValues:F,updateState:nt,textInputs:Q,handleTextInputChange:Ie,handleAddTextInput:ce,handleRemoveTextInput:Ne,openAiWritingModal:Me}),r.jsx(s2,{visible:Fe,aiWritingModalText:Ee,setAiWritingModalText:Re,aiGeneratedTexts:St,aiSelectedTexts:Ot,aiWritingLoading:xt,aiWritingError:Ue,handleAiWriting:re,toggleTextSelection:Je,addSelectedTexts:be,onClose:()=>De(!1)}),r.jsx(Jn,{})]}):r.jsxs("div",{className:"flex-1 overflow-y-auto bg-gray-50 p-4 flex flex-col h-full max-h-[80vh]",onClick:P=>P.stopPropagation(),children:[r.jsx(Wp,{selectedNodes:o,paramTestValues:B,selectedParams:m,totalCount:z,errorMessage:le,handlePrevious:Fn,handleStartGeneration:pr,handleClose:In}),r.jsx(Jn,{})]})},U2=o=>{const{dispatch:l}=kn(),[s,c]=x.useState(!1);return x.useEffect(()=>{if(o.visible&&!s){const d=d2();d&&d.screenState&&l({type:"SET_SCREEN_STATE",payload:{currentScreen:d.currentScreen,isProcessing:d.isProcessing,isCompleted:d.isCompleted}}),c(!0)}},[o.visible,s,l]),x.useEffect(()=>()=>{o.visible||l({type:"SET_SCREEN_STATE",payload:null})},[o.visible,l]),r.jsx(z2,{...o})},B2="/copilot_web/assets/gif-Dx_BC5pS.gif",G2=({onClose:o=()=>{},loading:l=!1})=>r.jsx("button",{onClick:o,disabled:l,className:"bg-white border-none text-gray-500 hover:!text-gray-700",children:r.jsx(On,{className:"w-5 h-5"})}),Jl="accept_event",W2={auto:{name:fn.START_POP_VIEW_AUTO_TIME,offset:1e3*60*60*24*3},accept:{name:fn.START_POP_VIEW_ACCEPT_TIME,offset:1e3*60*60*24*1}},q2=()=>{const{startpopview_title:o,startpopview_join:l}=Ms(),[s,c]=x.useState(!1),d=()=>{window.open(Ql,"_blank"),c(!1)},f=m=>{const{name:g,offset:_}=W2[m],S=new Date().getTime(),v=Ls(g);(!v||Number(v)&&S-Number(v)>_)&&(Es(g,S.toString()),c(!0))};return x.useEffect(()=>{f("auto");const m=()=>{f("accept")};return window.addEventListener(Jl,m),()=>{window.removeEventListener(Jl,m)}},[]),r.jsx(oc,{className:"pointer-events-none",children:r.jsx("div",{id:"comfyui-copilot-start-pop-view",children:s&&r.jsxs("div",{className:"fixed !left-auto !top-auto right-2 bottom-2 text-gray-700 w-[300px] h-[280px] bg-white border border-gray-600 rounded-[12px] flex flex-col justify-center shadow-[inset_0_0_12px_2px_#3b82f6] shadow-[inset_0_0_0_4px_rgba(59,130,246,0.15)] pointer-events-auto",children:[r.jsxs("div",{className:"flex-1",children:[r.jsxs("div",{className:"w-full flex justify-between items-center",children:[r.jsx("img",{src:`.${rc}`,alt:"ComfyUI-Copilot Logo",className:"w-16 h-16"}),r.jsx("div",{className:"w-16 h-16 flex justify-center items-center",children:r.jsx(G2,{onClose:()=>c(!1)})})]}),r.jsx("div",{className:"text-gray-700 text-sm text-center whitespace-pre-line",children:o}),r.jsx("img",{src:`.${B2}`,className:"w-20 h-20 mt-2 mx-auto block"})]}),r.jsx("button",{className:"bg-gray-100 rounded-md flex justify-center items-center w-[240px] h-[40px] mx-[30px] mb-4",onClick:d,children:r.jsx("span",{className:"text-gray-900 text-sm",children:l})})]})})})};class Xl{claimedOffset=0;buffer="";playQueue=[];isPlaying=!1;currentAudio=null;stopped=!1;streamFinished=!1;pendingFetches=0;minChunk;onAllDone;onError;errorFired=!1;constructor(l){this.onAllDone=l?.onAllDone,this.onError=l?.onError,this.minChunk=l?.minChunk??40}feed(l){if(this.stopped||!l)return;const s=l.substring(this.claimedOffset);s&&(this.buffer+=s,this.claimedOffset=l.length,this.extractAndQueue())}flush(){this.streamFinished=!0,this.buffer.trim()&&(this.sendChunk(this.buffer.trim()),this.buffer=""),this.checkAllDone()}stop(){if(this.stopped=!0,this.currentAudio){this.currentAudio.pause();try{URL.revokeObjectURL(this.currentAudio.src)}catch{}this.currentAudio=null}this.playQueue=[],this.isPlaying=!1}get isStopped(){return this.stopped}extractAndQueue(){for(;;){let l=-1;for(let c=this.minChunk;c<this.buffer.length;c++){const d=this.buffer[c];if(d==="."||d==="!"||d==="?"||d===`
`){const f=this.buffer[c+1];if(!f||f===" "||f===`
`||f==="\r"){l=c+1;break}}}if(l<0)break;const s=this.buffer.substring(0,l).trim();this.buffer=this.buffer.substring(l).trimStart(),s&&this.sendChunk(s)}}async sendChunk(l){if(!(this.stopped||!l)){this.pendingFetches++;try{const s=await ct.textToSpeech(l);if(this.stopped)return;this.playQueue.push(s),this.playNext()}catch(s){const c=s?.message||String(s);console.error("[StreamingTTS] chunk error:",c),!this.errorFired&&this.onError&&(this.errorFired=!0,this.onError(c)),(c.includes("terms")||c.includes("model_terms_required"))&&this.stop()}finally{this.pendingFetches--,this.checkAllDone()}}}playNext(){if(this.isPlaying||this.stopped||this.playQueue.length===0)return;const l=this.playQueue.shift(),s=URL.createObjectURL(l),c=new Audio(s);this.currentAudio=c,this.isPlaying=!0;const d=()=>{try{URL.revokeObjectURL(s)}catch{}this.currentAudio=null,this.isPlaying=!1,this.playNext(),this.checkAllDone()};c.onended=d,c.onerror=d,c.play().catch(d)}checkAllDone(){this.streamFinished&&!this.isPlaying&&this.playQueue.length===0&&this.pendingFetches===0&&!this.buffer.trim()&&this.onAllDone?.()}}const V2=Zl.apiBaseUrl,$2=({message:o,onClose:l})=>o?r.jsxs("div",{className:`bg-gradient-to-r from-gray-50 to-gray-100 \r
            border border-gray-300 px-2 py-1 mt-2 ml-2 mr-2 relative shadow-sm rounded-sm`,children:[r.jsxs("div",{className:"flex items-center",children:[r.jsx("div",{className:"flex-shrink-0 mr-1",children:r.jsx("svg",{className:"w-3.5 h-3.5 text-gray-700",fill:"currentColor",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg",children:r.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})})}),r.jsx("div",{className:"text-gray-700 font-medium leading-relaxed pr-6 markdown-content",style:{fontSize:"11px"},children:r.jsx(Kg,{rehypePlugins:[[vg,{target:"_blank",rel:["noopener","noreferrer"]}]],remarkPlugins:[wg],className:"prose !text-[11px] prose-a:text-gray-700 prose-a:underline prose-a:font-medium hover:prose-a:text-gray-800",components:{a:({node:s,...c})=>r.jsx("a",{...c,className:"text-gray-700 underline hover:text-gray-800 transition-colors",style:{fontSize:"11px"}}),p:({children:s})=>r.jsx("span",{className:"inline",style:{fontSize:"11px"},children:s}),span:({children:s})=>r.jsx("span",{style:{fontSize:"11px"},children:s}),li:({children:s})=>r.jsx("li",{style:{fontSize:"11px"},children:s}),ul:({children:s})=>r.jsx("ul",{style:{fontSize:"11px"},children:s}),ol:({children:s})=>r.jsx("ol",{style:{fontSize:"11px"},children:s})},children:o})})]}),r.jsx("button",{onClick:l,className:"absolute right-2 top-1/2 -translate-y-1/2 text-gray-700 hover:text-gray-800 transition-colors p-1 rounded-full hover:bg-gray-800","aria-label":"Close announcement",children:r.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}):null,H2=()=>{const{state:o,dispatch:l}=kn(),{selectedNode:s,screenState:c}=o,d=s||[],f=()=>{l({type:"SET_SELECTED_NODE",payload:null}),l({type:"SET_SCREEN_STATE",payload:null}),localStorage.removeItem("screenState")};return r.jsx("div",{className:"flex-1 flex flex-col overflow-y-auto",children:r.jsx(U2,{selectedNodes:d,visible:!0,onClose:f})})};function K2({onClose:o,visible:l=!0,triggerUsage:s=!1,onUsageTriggered:c}){const{state:d,dispatch:f,showcasIng:m,abortControllerRef:g}=kn(),{messages:_,installedNodes:S,loading:v,sessionId:j,selectedNode:I,activeTab:N}=d;x.useRef(null);const[L,W]=x.useState(""),[z,U]=x.useState(""),[se,Z]=x.useState(window.innerWidth/3),[H,R]=x.useState(!1),[B,V]=x.useState([]),[X,y]=x.useState("gemini-2.5-flash"),[ee,oe]=x.useState(window.innerHeight),[F,pe]=x.useState(0),[ge,ae]=x.useState(!1),[de,le]=x.useState(!1),G=x.useRef(null),[ze,ue]=x.useState(null),[ie,ke]=x.useState(""),[J,ye]=x.useState(!1);x.useRef(I);const T=x.useRef(null),[te,Q]=x.useState("None");zp(l&&N==="chat"),Up(l);const{chatinput_title:Se}=Ms();x.useEffect(()=>{Pr.init().catch(console.error)},[]),x.useEffect(()=>{_.length>0&&j&&ft(_)},[_,j]),x.useEffect(()=>{switch(te){case"Usage":dt();break;case"Parameters":Ot();break;case"DownstreamNodes":jt();break}Q("None")},[te]),x.useEffect(()=>{if(N!=="chat")return;(async()=>{const re=await Hg();console.log("[WorkflowChat] Received installed nodes:",re.length),f({type:"SET_INSTALLED_NODES",payload:re})})()},[N]);const Fe=()=>{f({type:"SET_MESSAGES",payload:[{id:it(),role:"showcase",content:""}]})},De=async q=>{try{const re=await Pr.getSession(q);if(re&&re.messages.length>0){f({type:"SET_MESSAGES",payload:re.messages});return}const Ie=await ct.fetchMessages(q);Ie?.length>0?f({type:"SET_MESSAGES",payload:Ie}):Fe()}catch(re){console.error("Error fetching messages:",re)}};x.useEffect(()=>{if(N!=="chat")return;let q=localStorage.getItem("sessionId");q?(f({type:"SET_SESSION_ID",payload:q}),De(q)):(q=it(),f({type:"SET_SESSION_ID",payload:q}),localStorage.setItem("sessionId",q))},[N]),x.useEffect(()=>{const q=localStorage.getItem("activeTab");q&&f({type:"SET_ACTIVE_TAB",payload:q});const re=localStorage.getItem("screenState");re&&f({type:"SET_SCREEN_STATE",payload:JSON.parse(re)});const Ie=()=>{Q("Usage")},ce=()=>{Q("Parameters")},Ne=()=>{Q("DownstreamNodes")};return window.addEventListener(fr.TOOLBOX_USAGE,Ie),window.addEventListener(fr.TOOLBOX_PARAMETERS,ce),window.addEventListener(fr.TOOLBOX_DOWNSTREAMNODES,Ne),()=>{window.removeEventListener(fr.TOOLBOX_USAGE,Ie),window.removeEventListener(fr.TOOLBOX_PARAMETERS,ce),window.removeEventListener(fr.TOOLBOX_DOWNSTREAMNODES,Ne)}},[]),x.useEffect(()=>{localStorage.setItem("activeTab",N)},[N]),x.useEffect(()=>{d.screenState&&localStorage.setItem("screenState",JSON.stringify(d.screenState))},[d.screenState]);const Ee=Qi.useCallback(q=>{if(!H)return;const re=window.innerWidth-q.clientX,Ie=Math.min(Math.max(300,re),window.innerWidth*.8);Z(Ie)},[H]),Re=Qi.useMemo(()=>Kn.debounce(Ee,16),[Ee]);x.useEffect(()=>(H&&(document.addEventListener("mousemove",Re),document.addEventListener("mouseup",$)),()=>{document.removeEventListener("mousemove",Re),document.removeEventListener("mouseup",$),Re.cancel()}),[H,Re]);const St=q=>{W(q.target.value)},Qe=()=>{g.current&&(g.current.abort(),g.current=null,f({type:"SET_LOADING",payload:!1})),G.current&&(G.current.stop(),G.current=null)},xt=async()=>{if(ge)return It();if(_?.[0]?.role==="showcase"&&f({type:"CLEAR_MESSAGES"}),m.current=!1,f({type:"SET_LOADING",payload:!0}),L.trim()===""&&!I||!j)return;U(L);const q=it(),re=it(),Ie={id:re,role:"user",content:L,trace_id:q};B.length>0&&(Ie.ext=[{type:"img",data:B.map(ce=>({url:ce.url,name:ce.file.name}))}]),f({type:"ADD_MESSAGE",payload:Ie}),W(""),g.current=new AbortController,de&&(G.current=new Xl({onError:ce=>{(ce.includes("terms")||ce.includes("model_terms_required"))&&ue("https://console.groq.com/playground?model=canopylabs%2Forpheus-v1-english")}}));try{const ce={type:"model_select",data:[X]};let Ne=it(),Je=!0;for await(const be of ct.streamInvokeServer(j,L,B.map(Me=>({url:Me.url,name:Me.file.name})),null,ce,q,g.current.signal,d.messages,re)){const Me={id:Ne,role:"ai",content:JSON.stringify(be),format:be.format,finished:be.finished,name:"Assistant",ext:be.ext};if(Je)f({type:"ADD_MESSAGE",payload:Me}),Je=!1;else{f({type:"UPDATE_MESSAGE",payload:Me});const tt=d.messages.map(wt=>wt.id===Me.id&&!wt.finished?Me:wt);ft(tt)}G.current&&be.text&&G.current.feed(be.text),be.finished&&(G.current?.flush(),G.current=null,f({type:"SET_LOADING",payload:!1}),g.current=null)}}catch(ce){ce instanceof Error&&ce.name==="AbortError"?console.log("User aborted the request"):console.error("Error sending message:",ce),G.current?.stop(),G.current=null,f({type:"SET_LOADING",payload:!1}),g.current=null}finally{V([])}},It=async()=>{if(L.trim()===""||!j)return;_?.[0]?.role==="showcase"&&f({type:"CLEAR_MESSAGES"}),m.current=!1,f({type:"SET_LOADING",payload:!0}),U(L);const q=it(),Ie={id:it(),role:"user",content:L,trace_id:q,metadata:{agent_mode:!0}};f({type:"ADD_MESSAGE",payload:Ie}),W(""),g.current=new AbortController,de&&(G.current=new Xl({onError:ce=>{(ce.includes("terms")||ce.includes("model_terms_required"))&&ue("https://console.groq.com/playground?model=canopylabs%2Forpheus-v1-english")}}));try{const ce=d.messages.filter(be=>be.role==="user"||be.role==="ai").slice(-4).map(be=>({role:be.role==="ai"?"assistant":"user",content:be.role==="ai"&&typeof be.content=="string"&&be.content.startsWith("{")&&JSON.parse(be.content)?.text||be.content}));ce.push({role:"user",content:L});let Ne=it(),Je=!0;for await(const be of ct.streamAgentMode(L,ce,X,g.current.signal)){const Me={id:Ne,role:"ai",content:JSON.stringify(be),format:be.format,finished:be.finished,name:"Agent",ext:be.ext,metadata:{agent_mode:!0}};if(Je)f({type:"ADD_MESSAGE",payload:Me}),Je=!1;else{f({type:"UPDATE_MESSAGE",payload:Me});const tt=d.messages.map(wt=>wt.id===Me.id&&!wt.finished?Me:wt);ft(tt)}G.current&&be.text&&G.current.feed(be.text),be.finished&&(G.current?.flush(),G.current=null,f({type:"SET_LOADING",payload:!1}),g.current=null)}}catch(ce){ce instanceof Error&&ce.name==="AbortError"?console.log("User aborted agent mode request"):console.error("Error in agent mode:",ce),G.current?.stop(),G.current=null,f({type:"SET_LOADING",payload:!1}),g.current=null}finally{V([])}},Ze=async q=>{if(!j)return;f({type:"SET_LOADING",payload:!0}),U(q);const re=it(),Ie=it();f({type:"ADD_MESSAGE",payload:{id:Ie,role:"user",content:q,trace_id:re}}),g.current=new AbortController;try{const Ne={type:"model_select",data:[X]};let Je=it(),be=!0;for await(const Me of ct.streamInvokeServer(j,q,B.map(tt=>({url:tt.url,name:tt.file.name})),null,Ne,re,g.current.signal,d.messages,Ie)){const tt={id:Je,role:"ai",content:JSON.stringify(Me),format:Me.format,finished:Me.finished,name:"Assistant"};if(be)f({type:"ADD_MESSAGE",payload:tt}),be=!1;else{f({type:"UPDATE_MESSAGE",payload:tt});const wt=d.messages.map(nn=>nn.id===tt.id&&!nn.finished?tt:nn);ft(wt)}Me.finished&&(f({type:"SET_LOADING",payload:!1}),g.current=null)}}catch(Ne){Ne instanceof Error&&Ne.name==="AbortError"?console.log("User aborted the request"):console.error("Error sending message:",Ne),f({type:"SET_LOADING",payload:!1}),g.current=null}finally{V([])}},Dt=q=>{q.metaKey&&q.key==="Enter"&&xt()},qe=()=>{m.current=!1,f({type:"CLEAR_MESSAGES"});const q=d.sessionId;q&&localStorage.removeItem(`messages_${q}`),localStorage.removeItem("sessionId");const re=it();f({type:"SET_SESSION_ID",payload:re}),localStorage.setItem("sessionId",re),setTimeout(()=>{Fe()},500)},bt=q=>{W(q)},Ue=async(q,re)=>{if(!j||!I)return;f({type:"SET_LOADING",payload:!0});const Ie=I[0].comfyClass||I[0].type,ce=it(),Ne={id:it(),role:"user",content:Ie,trace_id:ce};f({type:"ADD_MESSAGE",payload:Ne}),g.current=new AbortController;try{let Je=it(),be=!0;for await(const Me of ct.streamInvokeServer(j,Ie,[],q,re,ce,g.current.signal,d.messages)){const tt={id:Je,role:"ai",content:JSON.stringify(Me),format:Me.format,finished:Me.finished,name:"Assistant"};if(q&&q!==""&&(tt.metadata={intent:q}),be)f({type:"ADD_MESSAGE",payload:tt}),be=!1;else{f({type:"UPDATE_MESSAGE",payload:tt});const wt=d.messages.map(nn=>nn.id===tt.id&&!nn.finished?tt:nn);ft(wt)}Me.finished&&(f({type:"SET_LOADING",payload:!1}),g.current=null)}}catch(Je){Je instanceof Error&&Je.name==="AbortError"?console.log("User aborted the request"):console.error("Error sending message:",Je),f({type:"SET_LOADING",payload:!1}),g.current=null}},dt=()=>{Ze(`Reply in ${navigator.language} language: How does the ${I?.[0]?.type} node work? I need its official usage guide.`)},Ot=()=>{Ze(`Reply in ${navigator.language} language: Show me the technical specifications for the ${I?.[0].type} node's inputs and outputs.`)},qt=()=>{const q=new Set;function re(Ie,ce){if(!(!Ie||ce>=1)&&Ie.inputs)for(const Ne of Object.values(Ie.inputs)){const Je=Ne.link;if(Je&&$e.graph.links[Je]){const be=$e.graph.links[Je].origin_id,Me=$e.graph._nodes_by_id[be];Me&&(q.add(Me.type),re(Me,ce+1))}}}return I[0]?(re(I[0],0),[{type:"upstream_node_types",data:Array.from(q)}]):null},jt=()=>{Ue("downstream_subgraph_search",qt())},ft=async q=>{if(d.sessionId){localStorage.setItem(`messages_${d.sessionId}`,JSON.stringify(q));try{await Pr.saveSession(d.sessionId,q)}catch(re){console.error("Failed to save session to IndexedDB:",re)}}},Vt=q=>{console.log("[WorkflowChat] Adding new message:",q);const re=[...d.messages,q];f({type:"ADD_MESSAGE",payload:q}),ft(re)},$t=q=>{const re=d.messages.map(Ie=>Ie.id===q.id&&!Ie.finished?q:Ie);f({type:"UPDATE_MESSAGE",payload:q}),ft(re)},ln=(q,re)=>{f({type:"SET_SESSION_ID",payload:q}),f({type:"SET_MESSAGES",payload:re}),localStorage.setItem("sessionId",q),localStorage.setItem(`messages_${q}`,JSON.stringify(re))},tn=()=>{T.current&&T.current.refreshModels()},$=()=>{R(!1)},xe=async(q,re)=>{const Ie=new FormData;Ie.append("file",q);const Ne=await(await fetch(`${V2}/api/chat/imgfile2oss`,{method:"POST",body:Ie})).json();return await ct.uploadImage(q),Ne.success?{url:Ne.data,file:q,id:re}:null},et=q=>{const re=[],Ie=[];Array.from(q).forEach(ce=>{const Ne=Math.random().toString(36).substr(2,9);Ie.push(xe(ce,Ne)),re.push({id:Ne,file:ce,preview:URL.createObjectURL(ce),url:""})}),V(ce=>[...ce,...re]),Promise.all(Ie).then(ce=>{ce?.forEach(Ne=>{if(Ne){const Je=re.findIndex(be=>be.id===Ne.id);re.splice(Je,1,{id:Ne.id,file:Ne?.file,preview:URL.createObjectURL(Ne?.file),url:Ne?.url})}}),V(Ne=>lc(Ne,re,"id"))})},ot=q=>{V(re=>re.filter(ce=>ce.id!==q))};Qi.useEffect(()=>()=>{B.forEach(q=>URL.revokeObjectURL(q.preview))},[B]),x.useEffect(()=>{s&&c&&N==="chat"&&(Ue("node_explain"),c())},[s,N]),x.useEffect(()=>{if(!l||N!=="chat")return;(async()=>{try{const re=new Date().toDateString();if(localStorage.getItem("announcementLastShownDate")!==re){const ce=await ct.fetchAnnouncement();ce&&ce.trim()!==""&&(ke(ce),ye(!0),localStorage.setItem("announcementLastShownDate",re))}}catch(re){console.error("Error fetching announcement:",re)}})()},[l,N]);const ut=()=>{ye(!1)},gt=q=>{f({type:"SET_ACTIVE_TAB",payload:q})},Ft=q=>{y(q),Es(fn.MODELS_POP_VIEW_SELECTED,q)};return l?r.jsxs("div",{className:"flex flex-col h-full w-full bg-white relative",style:{display:l?"flex":"none"},children:[r.jsx("div",{className:"absolute left-0 top-0 bottom-0 w-1 cursor-ew-resize hover:bg-gray-300"}),r.jsxs("div",{className:"flex h-full flex-col",children:[r.jsx(np,{onClose:o,onClear:qe,hasMessages:_.length>0,title:"ComfyUI-Copilot",onSelectSession:ln,currentSessionId:j,onConfigurationUpdated:tn}),r.jsxs("div",{className:"flex border-b border-gray-200 mt-2",children:[r.jsx(no,{active:N==="chat",onClick:()=>gt("chat"),children:"Chat"}),r.jsx(no,{active:N==="parameter-debug",onClick:()=>gt("parameter-debug"),children:"GenLab"})]}),J&&ie&&N==="chat"&&r.jsx($2,{message:ie,onClose:ut}),r.jsx(Rp,{messages:_,latestInput:z,onOptionClick:bt,installedNodes:S,onAddMessage:Vt,onUpdateMessage:$t,loading:v,isActive:N==="chat"}),r.jsxs("div",{className:"border-t px-4 py-3 border-gray-200 bg-white sticky bottom-0",style:{display:N==="chat"?"block":"none"},children:[ge&&r.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 mb-2 bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 rounded-lg text-xs text-blue-700",children:[r.jsx("span",{className:"text-sm",children:"🤖"}),r.jsx("span",{className:"font-medium",children:"Agent Mode"}),r.jsx("span",{className:"text-blue-500",children:"— autonomous planning & execution"})]}),ze&&r.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 mb-2 bg-amber-50 border border-amber-300 rounded-lg text-xs text-amber-800 shadow-sm",children:[r.jsx("span",{className:"text-base",children:"⚠️"}),r.jsxs("div",{className:"flex-1",children:[r.jsx("span",{className:"font-semibold",children:"Voice requires Groq model terms acceptance."}),r.jsx("span",{className:"ml-1",children:"Click below to accept, then try again."})]}),r.jsx("a",{href:ze,target:"_blank",rel:"noopener noreferrer",className:"px-2.5 py-1 bg-amber-600 text-white rounded-md text-xs font-medium hover:!bg-amber-700 transition-colors no-underline whitespace-nowrap",onClick:()=>{},children:"Accept Terms ↗"}),r.jsx("button",{onClick:()=>ue(null),className:"p-0.5 text-amber-500 hover:!text-amber-700 bg-transparent border-none cursor-pointer",title:"Dismiss",children:"✕"})]}),I&&r.jsx(Sp,{nodeInfo:I,onSendWithIntent:Ue,loading:v,onSendWithContent:Ze}),r.jsx(ac,{ref:T,input:L,loading:v,onChange:St,onSend:xt,onKeyPress:Dt,onUploadImages:et,uploadedImages:B,onRemoveImage:ot,selectedModel:X,onModelChange:Ft,onStop:Qe,onAddDebugMessage:Vt,agentMode:ge,onAgentModeToggle:ae,voiceMode:de,onVoiceModeToggle:le}),r.jsxs(io,{className:"w-full mt-2 flex-1 flex justify-center items-center gap-1",children:[Se,"👉🏻",r.jsx("svg",{viewBox:"0 0 1024 1024",className:"w-4 h-4",fill:"currentColor",children:r.jsx("path",{d:"M498.894518 100.608396c-211.824383 0-409.482115 189.041494-409.482115 422.192601 0 186.567139 127.312594 344.783581 295.065226 400.602887 21.13025 3.916193 32.039717-9.17701 32.039717-20.307512 0-10.101055 1.176802-43.343157 1.019213-78.596056-117.448946 25.564235-141.394311-49.835012-141.394311-49.835012-19.225877-48.805566-46.503127-61.793368-46.503127-61.793368-38.293141-26.233478 3.13848-25.611308 3.13848-25.611308 42.361807 2.933819 64.779376 43.443441 64.779376 43.443441 37.669948 64.574714 98.842169 45.865607 122.912377 35.094286 3.815909-27.262924 14.764262-45.918819 26.823925-56.431244-93.796246-10.665921-192.323237-46.90017-192.323237-208.673623 0-46.071292 16.498766-83.747379 43.449581-113.332185-4.379751-10.665921-18.805298-53.544497 4.076852-111.732757 0 0 35.46063-11.336186 116.16265 43.296085 33.653471-9.330506 69.783343-14.022365 105.654318-14.174837 35.869952 0.153496 72.046896 4.844332 105.753579 14.174837 80.606853-54.631248 116.00813-43.296085 116.00813-43.296085 22.935362 58.18826 8.559956 101.120049 4.180206 111.732757 27.052123 29.584806 43.443441 67.260893 43.443441 113.332185 0 162.137751-98.798167 197.850114-192.799074 208.262254 15.151072 13.088086 28.65155 38.804794 28.65155 78.17957 0 56.484456-0.459464 101.94381-0.459464 115.854635 0 11.235902 7.573489 24.381293 29.014824 20.2543C825.753867 867.330798 933.822165 709.10924 933.822165 522.700713c0-233.155201-224.12657-422.192601-434.927647-422.192601L498.894518 100.608396z"})}),"⭐️"]})]}),r.jsx("div",{className:"flex-1 flex flex-col h-0",style:{display:N==="parameter-debug"?"flex":"none"},children:r.jsx(H2,{})})]}),r.jsx(q2,{})]}):null}const e1=Object.freeze(Object.defineProperty({__proto__:null,default:K2},Symbol.toStringTag,{value:"Module"}));export{Jl as A,jp as B,xp as M,e1 as w};
